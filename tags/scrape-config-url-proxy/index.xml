<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Scrape-Config-Url-Proxy on (p)retired</title>
    <link>https://pretired.dazwilkin.com/tags/scrape-config-url-proxy/</link>
    <description>Recent content in Scrape-Config-Url-Proxy on (p)retired</description>
    <generator>Hugo</generator>
    <language>en-us</language>
    <lastBuildDate>Wed, 18 Oct 2023 00:00:00 -0700</lastBuildDate>
    <atom:link href="https://pretired.dazwilkin.com/tags/scrape-config-url-proxy/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Prometheus Operator support an auth proxy for Service Discovery</title>
      <link>https://pretired.dazwilkin.com/posts/231018/</link>
      <pubDate>Wed, 18 Oct 2023 00:00:00 -0700</pubDate>
      <guid>https://pretired.dazwilkin.com/posts/231018/</guid>
      <description>&lt;p&gt;CRD &lt;a href=&#34;https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/user-guides/linting.md&#34;&gt;linting&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Returning to yesterday&amp;rsquo;s failing tests, it&amp;rsquo;s unclear how to introspect the E2E tests.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl get namespaces&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;NAME                      STATUS   AGE&#xA;...&#xA;allns-s2os2u-0-90f56669   Active   22h&#xA;allns-s2qhuw-0-6b33d5eb   Active   4m23s&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl get all &lt;span style=&#34;color:#ae81ff&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;--namespace&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;allns-s2os2u-0-90f56669&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;No resources found in allns-s2os2u-0-90f56669 namespace.&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl get all &lt;span style=&#34;color:#ae81ff&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;--namespace&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;allns-s2qhuw-0-6b33d5eb&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;NAME                                                        READY   STATUS             RESTARTS   AGE&#xA;pod/prometheus-operator-6c96477b9c-q6qm2                    1/1     Running            0          4m12s&#xA;pod/prometheus-operator-admission-webhook-68bc9f885-nq6r8   0/1     ImagePullBackOff   0          4m7s&#xA;&#xA;NAME                          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE&#xA;service/prometheus-operator   ClusterIP   10.152.183.247   &amp;lt;none&amp;gt;        443/TCP   4m9s&#xA;&#xA;NAME                                                    READY   UP-TO-DATE   AVAILABLE   AGE&#xA;deployment.apps/prometheus-operator                     1/1     1            1           4m12s&#xA;deployment.apps/prometheus-operator-admission-webhook   0/1     1            0           4m7s&#xA;&#xA;NAME                                                              DESIRED   CURRENT   READY   AGE&#xA;replicaset.apps/prometheus-operator-6c96477b9c                    1         1         1       4m13s&#xA;replicaset.apps/prometheus-operator-admission-webhook-68bc9f885   1         1         0       4m8s&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl logs deployment/prometheus-operator-admission-webhook &lt;span style=&#34;color:#ae81ff&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;--namespace&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;allns-s2qhuw-0-6b33d5eb&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Error from server (BadRequest): container &amp;#34;prometheus-operator-admission-webhook&amp;#34; in pod &amp;#34;prometheus-operator-admission-webhook-68bc9f885-nq6r8&amp;#34; is waiting to start: trying and failing to pull image&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;NAME&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;prometheus-operator-admission-webhook&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;FILTER&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{.spec.template.spec.containers[?(@.name==\&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;${&lt;/span&gt;NAME&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;\&amp;#34;)].image}&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl get deployment/prometheus-operator-admission-webhook &lt;span style=&#34;color:#ae81ff&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;--namespace&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;allns-s2qjz2-0-fad82c03 &lt;span style=&#34;color:#ae81ff&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;--output&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;jsonpath&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;${&lt;/span&gt;FILTER&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;quay.io/prometheus-operator/admission-webhook:52d1e55af&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Want:&lt;/p&gt;</description>
    </item>
    <item>
      <title>Prometheus Operator support an auth proxy for Service Discovery</title>
      <link>https://pretired.dazwilkin.com/posts/231017/</link>
      <pubDate>Tue, 17 Oct 2023 00:00:00 -0700</pubDate>
      <guid>https://pretired.dazwilkin.com/posts/231017/</guid>
      <description>&lt;p&gt;For &lt;code&gt;ackalctld&lt;/code&gt; to be deployable to Kubernetes with &lt;a href=&#34;github.com/prometheus-operator/prometheus-operator&#34;&gt;Prometheus Operator&lt;/a&gt;, it is necessary to &lt;a href=&#34;https://github.com/prometheus-operator/prometheus-operator/issues/5966&#34;&gt;Enable &lt;code&gt;ScrapeConfig&lt;/code&gt; to use (discovery|target) proxies #5966&lt;/a&gt;. While I&amp;rsquo;m familiar with Kubernetes, Kubernetes operators (&lt;a href=&#34;https://ack.al&#34; data-goatcounter-click=&#34;ack.al&#34;&gt;Ackal&lt;/a&gt; uses one built with the &lt;a href=&#34;&#34;&gt;Operator SDK&lt;/a&gt;) and &lt;a href=&#34;https://sdk.operatorframework.io/&#34;&gt;Prometheus Operator&lt;/a&gt;, I&amp;rsquo;m unfamiliar with developing Prometheus Operator. This (and subsequent) posts will document some preliminary work on this.&lt;/p&gt;&#xA;&lt;p&gt;Cloned &lt;a href=&#34;github.com/prometheus-operator/prometheus-operator&#34;&gt;Prometheus Operator&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Branched &lt;code&gt;scrape-config-url-proxy&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;I&amp;rsquo;m unsure how to effect these changes and unsure whether documentation exists.&lt;/p&gt;&#xA;&lt;p&gt;Clearly, I will need to revise the &lt;code&gt;ScrapeConfig&lt;/code&gt; CRD to add the &lt;code&gt;proxy_url&lt;/code&gt; fields (one &lt;code&gt;proxy_url&lt;/code&gt; defines a proxy for the Service Discovery endpoint; the second defines a proxy for the targets themselves) and it would be useful for this to closely mirror the existing &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/http_sd/&#34;&gt;Prometheus HTTP Service Discovery&lt;/a&gt; use, namely &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/configuration/configuration/#http_sd_config&#34;&gt;&lt;code&gt;,http_sd_config&amp;gt;&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
