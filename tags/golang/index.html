<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>(p)retired</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="">
    <meta name="generator" content="Hugo 0.150.0-DEV">
    
    
    
    
      <meta name="robots" content="index, follow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.b89013985a078d0be77ff0f1ae39ec6d9f2c3c36e0f1aa8195900276fa8a5ad6.css" >



  


    

    
    
      

    

    
    
      <link href="/tags/golang/index.xml" rel="alternate" type="application/rss+xml" title="(p)retired" />
      <link href="/tags/golang/index.xml" rel="feed" type="application/rss+xml" title="(p)retired" />
      
    

    <script data-goatcounter="https://pretired.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
 
    <meta property="og:url" content="https://pretired.dazwilkin.com/tags/golang/">
  <meta property="og:site_name" content="(p)retired">
  <meta property="og:title" content="Golang">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Golang">
  <meta itemprop="datePublished" content="2025-02-27T00:00:00-08:00">
  <meta itemprop="dateModified" content="2025-02-27T00:00:00-08:00">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Golang">

      
    
	
  </head>

  <body class="ma0 avenir bg-near-white production">

    

  <header>
    <div class="pb3-m pb6-l bg-dark-blue">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        (p)retired
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

      <div class="tc-l pv3 ph3 ph4-ns">
        <h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">
          Golang
        </h1>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
  <article class="cf pa3 pa4-m pa4-l">
    <div class="measure-wide-l center f4 lh-copy nested-copy-line-height nested-links mid-gray">
      <p>Below you will find pages that utilize the taxonomy term “Golang”</p>
    </div>
  </article>
  <div class="mw8 center">
    <section class="flex-ns mt5 flex-wrap justify-around">
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250227/" class="link black dim">
        Prometheus Exporter for USGS Water Data service
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m a little obsessed with creating Prometheus Exporters:</p>
<ul>
<li><a href="https://github.com/DazWilkin/azure-exporter">Prometheus Exporter for Azure</a></li>
<li><a href="https://github.com/DazWilkin/crtsh-exporter">Prometheus Exporter for crt.sh</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/goatcounter-exporter">Prometheus Exporter for GoatCounter</a></li>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud</a></li>
<li><a href="https://github.com/DazWilkin/koyeb-exporter">Prometheus Exporter for Koyeb</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/porkbun-exporter">Prometheus Exporter for PorkBun</a></li>
<li><a href="https://github.com/DazWilkin/updown-exporter">Prometheus Exporter for updown.io</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>All of these were written to scratch an itch.</p>
<p>In the case of the cloud platform exporters (Azure, Fly, Google, Linode, Vultr etc.), it&rsquo;s an overriding anxiety that I&rsquo;ll leave resources deployed on these platforms and, running an exporter that ships alerts to <a href="https://pushover.net/">Pushover</a> and Gmail, provides me a support mechanism for me.</p>
    </div>
    <a href="/posts/250227/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/241025/" class="link black dim">
        FauxRPC using gRPCurl, Golang and rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Read <a href="https://kmcd.dev/posts/fauxrpc-testcontainers/">FauxRPC + Testcontainers</a> on Hacker News and was intrigued. I spent a little more time &ldquo;evaluating&rdquo; this than I&rsquo;d planned because I&rsquo;m forcing myself to use rust as much as possible and my ignorance (see below) caused me some challenges.</p>
<p>The technology is interesting and works well. The experience helped me explore <a href="https://testcontainers.com/">Testcontainers</a> too which I&rsquo;d heard about but not explored until this week.</p>
<p>For my future self:</p>
<table>
  <thead>
      <tr>
          <th>What</th>
          <th>What?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="https://fauxrpc.com/">FauxRPC</a></td>
          <td>A general-purpose tool (built using <a href="https://buf.build/">Buf</a>&rsquo;s <a href="https://connectrpc.com/">Connect</a>) that includes registry and stub (gRPC) services that can be (programmatically) configured (using a Protobuf descriptor) and stubs (example method responses) to help test gRPC implementations.</td>
      </tr>
      <tr>
          <td><a href="https://testcontainers.com/">Testcontainers</a></td>
          <td>Write code (e.g. rust) to create and interact (test)services (running in [Docker] containers).</td>
      </tr>
      <tr>
          <td><a href="https://connectrpc.com/">Connect</a></td>
          <td>(More than a) gRPC implementation used by FauxRPC</td>
      </tr>
      <tr>
          <td><a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a></td>
          <td>A command-line gRPC tool.</td>
      </tr>
  </tbody>
</table>
<p>I started following along with FauxRPC&rsquo;s <a href="https://fauxrpc.com/docs/testcontainers/">Testcontainers</a> example but, being unfamiliar with Connect, I wasn&rsquo;t familiar with its Eliza service. The service is available on <code>demo.connectrpc.com:443</code> and is described using <a href="https://github.com/connectrpc/examples-go/blob/main/proto/connectrpc/eliza/v1/eliza.proto"><code>eliza.proto</code></a> as part of <a href="https://github.com/connectrpc/examples-go"><code>examples-go</code></a>. Had I realized this sooner, I would have used this example rather than the Health Checking protocol.</p>
    </div>
    <a href="/posts/241025/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240528/" class="link black dim">
        Using Delve to debug Go containers on Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>An interesting <a href="https://stackoverflow.com/questions/78537605">question</a> on Stack overflow prompted me to understand how to use Visual Studio Code and <a href="https://github.com/go-delve/delve">Delve</a> to remotely debug a Golang app running on Kubernetes (MicroK8s).</p>
<p>The OP is using <a href="https://github.com/gin-gonic/gin">Gin</a> which was also new to me so the question gave me an opportunity to try out several things.</p>
<h2 id="sources">Sources</h2>
<p>A simple <code>healthz</code> handler:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;flag&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log/slog&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">addr</span> = <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;addr&#34;</span>, <span style="color:#e6db74">&#34;0.0.0.0:8080&#34;</span>, <span style="color:#e6db74">&#34;HTTP server endpoint&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">healthz</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">String</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusOK</span>, <span style="color:#e6db74">&#34;ok&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Parse</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/fib&#34;</span>, <span style="color:#a6e22e">handler</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;healthz&#34;</span>, <span style="color:#a6e22e">healthz</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server starting&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server error&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;err&#34;</span>, <span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">addr</span>),
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>Containerfile</code>:</p>
    </div>
    <a href="/posts/240528/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240409/" class="link black dim">
        Google Cloud Translation w/ gRPC 3 ways
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="general">General</h2>
<p>You&rsquo;ll need a Google Cloud project with Cloud Translation (<code>translate.googleapis.com</code>) enabled and a Service Account (and key) with suitable permissions in order to run the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BILLING<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Billing ID (gcloud billing accounts list)</span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Project ID</span>
</span></span><span style="display:flex;"><span>ACCOUNT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tester&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>EMAIL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span><span style="color:#e6db74">@</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">.iam.gserviceaccount.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ROLES<span style="color:#f92672">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/cloudtranslate.user&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/serviceusage.serviceUsageConsumer&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Project</span>
</span></span><span style="display:flex;"><span>gcloud projects create <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Associate Project with your Billing Account</span>
</span></span><span style="display:flex;"><span>gcloud billing accounts link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Enable Cloud Translation</span>
</span></span><span style="display:flex;"><span>gcloud services enable translate.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts create <span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account Key</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts keys create <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--iam-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update Project IAM permissions</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ROLE in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ROLES[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  gcloud projects add-iam-policy-binding <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --member<span style="color:#f92672">=</span>serviceAccount:<span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>ROLE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>For the code, you&rsquo;ll need to install <a href="https://github.com/protocolbuffers/protobuf"><code>protoc</code></a> and preferably have it in your path.</p>
    </div>
    <a href="/posts/240409/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240405/" class="link black dim">
        Google Cloud Events protobufs and SDKs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written before about <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s use of <a href="https://cloud.google.com/firestore">Firestore</a> and subscribing to Firestore document CRUD events:</p>
<ul>
<li><a href="/posts/230530/">Routing Firestore events to GKE with Eventarc</a></li>
<li><a href="/posts/210413/">Cloud Firestore Triggers in Golang</a> using <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Firestore triggers</a></li>
</ul>
<p>I find Google&rsquo;s <a href="cloud.google.com/eventarc">Eventarc</a> documentation to be confusing and, in typical Google fashion, even though open-sourced, you often need to do some legwork to find relevant sources, viz:</p>
<ul>
<li>Google&rsquo;s Protobufs for Eventarc (using <a href="https://cloudevents.io/">cloudevents</a>) <a href="https://github.com/googleapis/google-cloudevents"><code>google-cloudevents</code></a><sup>1</sup></li>
<li>Convenience (since you can generate these using <code>protoc</code>) language-specific types generated from the above e.g. <a href="https://github.com/googleapis/google-cloudevents-go"><code>google-cloudevents-go</code></a>; <a href="https://github.com/googleapis/google-cloudevents-python"><code>google-cloudevents-python</code></a> etc.</li>
</ul>
<p><sup>1</sup> &ndash; IIUC EventArc is the Google service. It carries Google Events that are CloudEvents. These are defined by protocol buffers schemas.</p>
    </div>
    <a href="/posts/240405/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240325/" class="link black dim">
        Prost! Tonic w/ a dash of JSON
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I naively (!) began exploring JSON marshaling of Protobufs in rust. Other protobuf language SDKs include JSON marshaling making the process straightforward. I was to learn that, in rust, it&rsquo;s not so simple. Unfortunately, for me, this continues to discourage my further use of rust (rust is just hard).</p>
<p>My goal was to marshal an arbitrary protocol buffer message that included a <a href="https://protobuf.dev/programming-guides/proto3/#oneof"><code>oneof</code></a> feature. I was unable to JSON marshal the rust generated by <code>tonic</code> for such a message.</p>
    </div>
    <a href="/posts/240325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240105/" class="link black dim">
        Navigating Koyeb&#39;s Golang SDK
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> deploys gRPC <a href="https://grpc.io/docs/guides/health-checking/">Health Checking</a> clients in locations around the World in order to health check services that are representative of customer need.</p>
<p><a href="https://koyeb.com">Koyeb</a> offers multiple locations and I spent time today writing a client for Ackal to integrate with Koyeb using the <a href="https://github.com/koyeb/koyeb-api-client-go">Golang client for the Koyeb API</a>.</p>
<p>The SDK is generated from Koyeb&rsquo;s OpenAPI (nee Swagger) <a href="https://developer.koyeb.com/public.swagger.json">endpoint</a> using <a href="https://github.com/OpenAPITools/openapi-generator-cli"><code>openapi-generator-cli</code></a>. This is a smart, programmatic solution to ensuring that the SDK always matches the API definition <strong>but</strong> I found the result is idiosyncratic and therefore a little gnarly.</p>
    </div>
    <a href="/posts/240105/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230314/" class="link black dim">
        Access Google Services using gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google publishes interface definitions of Google APIs (services) that support REST and gRPC in a repo called <a href="https://github.com/googleapis/googleapis">Google APIs</a>. Google&rsquo;s SDKs uses gRPC to access these services but, how to do this using e.g. <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a>?</p>
<p>I wanted to debug <a href="https://cloud.google.com/profiler/docs">Cloud Profiler</a> and its agent makes <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L83"><code>UpdateProfile</code></a> RPCs to <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L41"><code>cloudprofiler.googleapis.com</code></a>. Cloud Profiler is more challenging service to debug because (a) it&rsquo;s publicly &ldquo;write-only&rdquo;; and (b) it has complex messages. <code>UpdateProfile</code> sends <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L123"><code>UpdateProfileRequest</code></a> messages that include <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L123"><code>Profile</code></a> messages that include <code>profile_bytes</code> which are gzip compressed serialized protos of <a href="https://github.com/google/pprof">pprof</a>&rsquo;s <a href="https://github.com/google/pprof/blob/d61513b1440d93d62aad023cc60d7a33f3917b70/proto/profile.proto#L46"><code>Profile</code></a>.</p>
    </div>
    <a href="/posts/230314/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221128/" class="link black dim">
        Maintaining Container Images
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>As I contemplate moving my &ldquo;thing&rdquo; into production, I&rsquo;m anticipating aspects of the application that need maintenance and how this can be automated.</p>
<p>I&rsquo;d been negligent in the maintenance of some of my container images.</p>
<p>I&rsquo;m using mostly Go and some Rust as the basis of static(ally-compiled) binaries that run in these containers <strong>but</strong> not every container has a base image of <a href="https://hub.docker.com/_/scratch"><code>scratch</code></a>. <code>scratch</code> is the <strong>only</strong> base image that doesn&rsquo;t change and thus the only base image that doesn&rsquo;t require that container images buit <code>FROM</code> it, be maintained.</p>
    </div>
    <a href="/posts/221128/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221117/" class="link black dim">
        Delegate domain-wide authority using Golang
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;d not used Google&rsquo;s <a href="https://developers.google.com/identity/protocols/oauth2/service-account#delegatingauthority">Domain-wide Delegation</a> from Golang and struggled to find example code.</p>
<p>Google provides Java and Python <a href="https://developers.google.com/identity/protocols/oauth2/service-account#authorizingrequests">samples</a>.</p>
<p>Google has a myriad packages implementing its OAuth security and it&rsquo;s always daunting trying to determine which one to use.</p>
<p>As it happens, I backed into the solution through <code>client.Options</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Google Workspace APIS don&#39;t use IAM do use OAuth scopes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Scopes used here must be reflected in the scopes on the</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Google Workspace Domain-wide Delegate client</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">scopes</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{ <span style="color:#f92672">...</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Delegates on behalf of this Google Workspace user</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">subject</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;a@google-workspace-email.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">creds</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">FindDefaultCredentialsWithParams</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ctx</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">CredentialsParams</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Scopes</span>: <span style="color:#a6e22e">scopes</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Subject</span>: <span style="color:#a6e22e">subject</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">opts</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">option</span>.<span style="color:#a6e22e">WithCredentials</span>(<span style="color:#a6e22e">creds</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">service</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">admin</span>.<span style="color:#a6e22e">NewService</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">opts</span>)
</span></span></code></pre></div><p>In this case <code>NewService</code> applies to Google&rsquo;s Golang <a href="https://pkg.go.dev/google.golang.org/api/admin/directory/v1">Admin SDK API</a> although the pattern of <code>NewService(ctx)</code> or <code>NewService(ctx, opts)</code> where <code>opts</code> is a <a href="https://pkg.go.dev/google.golang.org/api@v0.103.0/option#ClientOption"><code>option.ClientOption</code></a> is consistent across Google&rsquo;s Golang libraries.</p>
    </div>
    <a href="/posts/221117/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221106/" class="link black dim">
        Basic programmatic access to GitHub Issues
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>It&rsquo;s been a while!</p>
<p>I&rsquo;ve been spending time writing Bash scripts and a web site but neither has been sufficiently creative that I&rsquo;ve felt worth a blog post.</p>
<p>As I&rsquo;ve been finalizing the web site, I needed an Issue Tracker and decided to leverage GitHub(&rsquo;s <a href="https://docs.github.com/en/issues">Issues</a>).</p>
<p>As a former Googler, I&rsquo;m familiar with Google&rsquo;s (excellent) internal issue tracking tool (Buganizer) and it&rsquo;s public manifestation <a href="https://issuetracker.google.com">Issue Tracker</a>. Google documents Issue Tracker and its <a href="https://developers.google.com/issue-tracker/concepts/issues">Issue</a> type which I&rsquo;ve mercilessly plagiarized in my implementation.</p>
    </div>
    <a href="/posts/221106/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211018/" class="link black dim">
        Golang Structured Logging w/ Google Cloud Logging (2)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>UPDATE</strong> There&rsquo;s an issue with my naive implementation of <code>RenderValuesHook</code> as described in this post. I summarized the problem in this <a href="https://github.com/go-logr/logr/issues/120">issue</a> where I&rsquo;ve outlined (hopefully) a more robust solution.</p></blockquote>
<p>Recently, I <a href="/posts/210928/">described</a> how to configure Golang logging so that user-defined key-values applied to the logs are parsed when ingested by <a href="https://cloud.google.com/logging">Google Cloud Logging</a>.</p>
<p>Here&rsquo;s an example of what we&rsquo;re trying to achieve. This is an example Cloud Logging log entry that incorporates user-defined labels (see <code>dog:freddie</code> and <code>foo:bar</code>) and a readily-querable <code>jsonPayload</code>:</p>
    </div>
    <a href="/posts/211018/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210928/" class="link black dim">
        Golang Structured Logging w/ Google Cloud Logging
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve multiple components in an app and these are deployed across multiple Google Cloud Platform (GCP) services: Kubernetes Engine, Cloud Functions, Cloud Run, etc. Almost everything is written in Golang and I started the project using <a href="https://github.com/go-logr/logr"><code>go-logr</code></a>.</p>
<p><code>logr</code> is in two parts: a <code>Logger</code> that you use to write log entries; a <code>LogSink</code> (adaptor) that consumes log entries and outputs them to a specific log implementation.</p>
<p>Initially, I defaulted to using <code>stdr</code> which is a <code>LogSink</code> for Go&rsquo;s standard logging implementation. Something similar to the module&rsquo;s <a href="https://github.com/go-logr/stdr/blob/master/example/main.go">example</a>:</p>
    </div>
    <a href="/posts/210928/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210924/" class="link black dim">
        GitHub help with dependency management
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This is very useful:</p>
<p><img src="/images/210924.notifications.png" alt="GitHub Notifications"></p>
<p>I am building an application that comprises multiple repos. I continue to procrastinate on whether using multiple repos vs. a monorepo was a good idea but, an issue that I have (had) is the need to ensure that the repos&rsquo; contents are using current|latest modules. GitHub can help.</p>
<p>Most of the application is written in Golang with a smattering of Rust and some JavaScript.</p>
    </div>
    <a href="/posts/210924/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210724/" class="link black dim">
        gRPC Interceptors and in-memory gRPC connections
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For&hellip; reasons, I wanted to pre-filter gRPC requests to check for authorization. Authorization is implemented as a &lsquo;micro-service&rsquo; and I wanted the authorization server to run in the same process as the gRPC client.</p>
<p>TL;DR:</p>
<ul>
<li>Shiju&rsquo;s <a href="https://shijuvar.medium.com/writing-grpc-interceptors-in-go-bf3e7671fe48">&ldquo;Writing gRPC Interceptors in Go&rdquo;</a> is great</li>
<li>This Stack overflow <a href="https://stackoverflow.com/a/52080545/609290">answer</a> ostensibly for writing unit tests for gRPC got me an in-process server</li>
</ul>
<p>What follows stands on these folks&rsquo; shoulders&hellip;</p>
<p>A key motivator for me to write blog posts is that helps me ensure that I understand things. Writing this post, I realized I&rsquo;d not researched gRPC Interceptors and, as luck would have it, I found some interesting content, not on <a href="https://grpc.io"><code>grpc.io</code></a> but on the <a href="https://github.com/grpc-ecosystem"><code>grpc-ecosystem</code></a> repo, specifically <a href="https://github.com/grpc-ecosystem/go-grpc-middleware">Go gRPC middleware</a>. But, I refer again to Shiju&rsquo;s clear and helpful <a href="https://shijuvar.medium.com/writing-grpc-interceptors-in-go-bf3e7671fe48">&ldquo;Writing gRPC Interceptors in Go&rdquo;</a></p>
    </div>
    <a href="/posts/210724/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210716/" class="link black dim">
        Stripe
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>It&rsquo;s been almost a month since my last post. I&rsquo;ve been occupied learning <a href="https://stripe.com">Stripe</a> and integrating it into an application that I&rsquo;m developing. The app benefits from a billing mechanism for prospective customers and, as far as I can tell, Stripe is the solution. I&rsquo;d be interested in hearing perspectives on alternatives.</p>
<p>As with any platform, there&rsquo;s good and bad and I&rsquo;ll summarize my perspective on Stripe here. It&rsquo;s been some time since I developed in JavaScript and this lack of familiarity has meant that the solution took longer than I wanted to develop. That said, before this component, I developed integration with <a href="https://firebase.google.com/products/auth">Firebase Authentication</a> and that required JavaScript&rsquo;ing too and that was much easier (and more enjoyable).</p>
    </div>
    <a href="/posts/210716/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210527/" class="link black dim">
        Struggling with Golang structs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Julia&rsquo;s post <a href="https://jvns.ca/blog/2021/05/24/blog-about-what-you-ve-struggled-with/">Blog about what you&rsquo;ve struggled with</a> resonates because I&rsquo;ve been struggling with Golang structs in a project. Not the definitions of structs but seemingly needing to reproduce them across the project. I realize that each instance of these resources differs from the others but I&rsquo;m particularly concerned by having to duplicate method implementations on them.</p>
<p>I&rsquo;m kinda hoping that I see the solution to my problem by writing it out. If you&rsquo;re reading this, I didn&rsquo;t :-(</p>
    </div>
    <a href="/posts/210527/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210506/" class="link black dim">
        Firestore Golang Timestamps &amp; Merging
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using Google&rsquo;s <a href="https://pkg.go.dev/cloud.google.com/go/firestore#DocumentRef">Golang SDK for Firestore</a>. The experience is excellent and I&rsquo;m quickly becoming a fan of Firestore. However, as a Golang Firestore developer, I&rsquo;m feeling less loved and some of the concepts in the database were causing me a conundrum.</p>
<p>I&rsquo;m still not entirely certain that I have Timestamps nailed but&hellip; I learned an important lesson on the auto-creation of Timestamps in documents and how to retain these values.</p>
    </div>
    <a href="/posts/210506/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210413/" class="link black dim">
        Cloud Firestore Triggers in Golang
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was pleased to discover that Google provides a non-Node.JS mechanism to subscribe to and act upon Firestore triggers, <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Google Cloud Firestore Triggers</a>. I&rsquo;ve nothing against Node.JS but, for the project i&rsquo;m developing, everything else is written in Golang. It&rsquo;s good to keep it all in one language.</p>
<p>I&rsquo;m perplexed that Cloud Functions still (!) only supports Go 1.13 (03-Sep-2019). Even <a href="https://golang.org/doc/devel/release.html#go1.14">Go 1.14</a> (25-Feb-2020) was released pre-pandemic and we&rsquo;re now running on 1.16. Come on Google!</p>
    </div>
    <a href="/posts/210413/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210317/" class="link black dim">
        Using Golang with the Firestore Emulator
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><img src="/images/210317.firebase.firestore.docs.png" alt="Firestore"></p>
<p>This works great but it wasn&rsquo;t clearly documented for non-Firebase users. I assume it will work, as well, for any of the client libraries (not just Golang).</p>
<p>Assuming you have some (Golang) code (in this case using the Google Cloud Client Library) that interacts with a Firestore database. Something of the form:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Golang" data-lang="Golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;crypto/sha256&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;cloud.google.com/go/firestore&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sha256</span>.<span style="color:#a6e22e">New</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#a6e22e">s</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%x&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Sum</span>(<span style="color:#66d9ef">nil</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Dog</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Name</span>    <span style="color:#66d9ef">string</span>                 <span style="color:#e6db74">`firestore:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Age</span>     <span style="color:#66d9ef">int</span>                    <span style="color:#e6db74">`firestore:&#34;age&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Human</span>   <span style="color:#f92672">*</span><span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">DocumentRef</span> <span style="color:#e6db74">`firestore:&#34;human&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Created</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>              <span style="color:#e6db74">`firestore:&#34;created&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewDog</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">age</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">human</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">DocumentRef</span>) <span style="color:#a6e22e">Dog</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Dog</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>:    <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Age</span>:     <span style="color:#a6e22e">age</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Human</span>:   <span style="color:#a6e22e">human</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Created</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(),
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">d</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Dog</span>) <span style="color:#a6e22e">ID</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Human</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`firestore:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">h</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Human</span>) <span style="color:#a6e22e">ID</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">project</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;PROJECT&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">NewClient</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">project</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;FIRESTORE_EMULATOR_HOST&#34;</span>); <span style="color:#a6e22e">value</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Using Firestore Emulator: %s&#34;</span>, <span style="color:#a6e22e">value</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">me</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Human</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;me&#34;</span>,
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">meDocRef</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Collection</span>(<span style="color:#e6db74">&#34;humans&#34;</span>).<span style="color:#a6e22e">Doc</span>(<span style="color:#a6e22e">me</span>.<span style="color:#a6e22e">ID</span>())
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">meDocRef</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">me</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">freddie</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewDog</span>(<span style="color:#e6db74">&#34;Freddie&#34;</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">meDocRef</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">freddieDocRef</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Collection</span>(<span style="color:#e6db74">&#34;dogs&#34;</span>).<span style="color:#a6e22e">Doc</span>(<span style="color:#a6e22e">freddie</span>.<span style="color:#a6e22e">ID</span>())
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">freddieDocRef</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">freddie</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Then you can interact instead with the Firestore Emulator.</p>
    </div>
    <a href="/posts/210317/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210316/" class="link black dim">
        Programmatically deploying Cloud Run services (Golang|Python)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Phew! Programmitcally deploying Cloud Run services should be easy but it didn&rsquo;t find it so.</p>
<p>My issues were that the Cloud Run Admin (!) API is poorly documented and it uses non-standard endpoints (thanks Sal!). Here, for others who may struggle with this, is how I got this to work.</p>
<h2 id="goal">Goal</h2>
<p>Programmatically (have Golang, Python, want Rust) deploy services to Cloud Run.</p>
<p>i.e. achieve this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud run deploy <span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--image<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--platform<span style="color:#f92672">=</span>managed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--no-allow-unauthenticated <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--region<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><blockquote>
<p><strong>TRICK</strong> <a href="https://cloud.google.com/sdk/gcloud/reference#--log-http"><code>--log-http</code></a> is your friend</p>
    </div>
    <a href="/posts/210316/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210222/" class="link black dim">
        Dapr
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>It&rsquo;s a good name, I read it as &ldquo;dapper&rdquo; but I frequently type &ldquo;darp&rdquo; :-(</p>
<p>Was interested to <a href="https://blog.dapr.io/posts/2021/02/17/announcing-dapr-v1.0/">read</a> that <a href="https://dapr.io/">Dapr</a> is now v1.0 and decided to check it out. I was initially confused between Dapr and service mesh functionality. But, having used Dapr, it appears to be more focused in aiding the development of (cloud-native) (distributed) apps by providing developers with abstractions for e.g. service discovery, eventing, observability whereas service meshes feel (!) more oriented towards simplifying the deployment of existing apps. Both use the concept of proxies, deployed alongside app components (as sidecars on Kubernetes) to provide their functionality to apps.</p>
    </div>
    <a href="/posts/210222/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201229/" class="link black dim">
        Kubernetes Webhooks
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I spent some time last week writing my first <a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/">admission webhook</a> for Kubernetes. I wrote the handler in Golang because I&rsquo;m most familiar with Golang and because, as Kubernetes&rsquo; native language, I was more confident that the necessary SDKs would exist and that the documentation would likely use Golang by default. I struggled to find useful documentation and so this post is to help you (and me!) remember how to do this next time!</p>
    </div>
    <a href="/posts/201229/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201113/" class="link black dim">
        Akri
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For the past couple of weeks, I&rsquo;ve been playing around with <a href="http://github.com/deislabs/akri">Akri</a>, a Microsoft (DeisLabs) project for <a href="https://cloudblogs.microsoft.com/opensource/2020/10/20/announcing-akri-open-source-project-building-connected-edge-kubernetes/">building a connected edge with Kubernetes</a>. Kubernetes, IoT, Rust (and Golang) make this all compelling to me.</p>
<p>Initially, I deployed an Akri <a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo.md">End-to-End</a> to <a href="https://microk8s.io/">MicroK8s</a> on Google Compute Engine (<a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo-gce.md">link</a>) and Digital Ocean (<a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo-do.md">link</a>). But I was interested to create me own example and so have proposed a very (!) simple <a href="https://github.com/DazWilkin/akri/blob/protocol-http/docs/extensibility-http.md">HTTP-based protocol</a>.</p>
<p>This blog summarizes my thoughts about Akri and an explanation of the HTTP protocol implementation in the hope that this helps others.</p>
    </div>
    <a href="/posts/201113/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201029/" class="link black dim">
        GitHub Actions &amp;&amp; GitHub Container Registry
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>You know when you start something and then regret it!? I think I&rsquo;ll be sticking with <a href="https://cloud.google.com/cloud-build">Google Cloud Build</a>; <a href="https://github.com/features/actions">GitHub Actions</a> appears functional and useful but I found the documentation to be confusing and limited and struggled to get a simple container image build|push working.</p>
<p>I&rsquo;ve long used <a href="https://hub.docker.com">Docker Hub</a> but am planning to use it less as a result of the planned <a href="https://www.docker.com/blog/scaling-docker-to-serve-millions-more-developers-network-egress/">changes</a>. I want to see Docker succeed and to do so it needs to find a way to make money but, there are free alternatives including the new <a href="https://github.blog/2020-09-01-introducing-github-container-registry/">GitHub Container Registry</a> and the very very cheap <a href="https://cloud.google.com/container-registry">Google Container Registry</a>.</p>
    </div>
    <a href="/posts/201029/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200908/" class="link black dim">
        Trillian Map Mode
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Chatting with one of Google&rsquo;s Trillian team, I was encouraged to explore Trillian&rsquo;s <a href="https://github.com/google/trillian#map-mode">Map Mode</a>. The following is the result of some spelunking through this unfamiliar cave. I can&rsquo;t provide any guarantee that this usage is correct or sufficient.</p>
<p>Here&rsquo;s the repo: <a href="https://github.com/DazWilkin/go-trillian-map">https://github.com/DazWilkin/go-trillian-map</a></p>
<p>I&rsquo;ve written about Trillian <a href="https://github.com/google/trillian#log-mode">Log Mode</a> <a href="/tags/trillian/">elsewhere</a>.</p>
<p>I uncovered use of Trillian Map Mode through Trillian&rsquo;s integration <a href="https://github.com/google/trillian/blob/master/integration/maptest/map.go">tests</a>. I&rsquo;m unclear on the distinction between <code>TrillianMapClient</code> and <code>TrillianMapWriteClient</code> but the latter served most of my needs.</p>
    </div>
    <a href="/posts/200908/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200817/" class="link black dim">
        WASM Transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been playing around with a proof-of-concept combining WASM and <a href="https://github.com/google/trillian">Trillian</a>. The hypothesis was to explore using WASM as a form of chaincode with Trillian. The project works but it&rsquo;s far from being a chaincode-like solution.</p>
<p>Let&rsquo;s start with a couple of (trivial) examples and then I&rsquo;ll explain what&rsquo;s going on and how it&rsquo;s implemented.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Method: mul
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [Client:Invoke] Metadata: complex.wasm
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Success: result:{real:0.036980484 imag:0.3898267}
</span></span></code></pre></div><p>After shipping a Rust-sourced WASM solution (<code>complex.wasm</code>) to the WASM transparency server, the client invokes a method <code>mul</code> that&rsquo;s exposed by it using a dynamically generated request message and outputs the response. Woo hoo! Yes, an expensive way to multiple complex numbers.</p>
    </div>
    <a href="/posts/200817/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200807/" class="link black dim">
        waPC and MsgPack (Rust|Golang)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>As my reader will know (Hey Mom!), I&rsquo;ve been noodling around with WASM and <a href="https://github.com/wapc">waPC</a>. I&rsquo;ve been exploring ways to pass structured messages across the host:guest boundary.</p>
<p><a href="https://developers.google.com/protocol-buffers">Protobufs</a> was my first choice. <a href="https://medium.com/@KevinHoffman">@KevinHoffman</a> created waPC and <a href="https://github.com/wascc">waSCC</a> and he <a href="https://medium.com/@KevinHoffman/interface-types-are-basically-a-way-of-embedding-metadata-into-a-wasm-file-so-that-arbitrary-data-14965ebdfa48">explained</a> to me and that wSCC uses <a href="https://msgpack.org/">Message Pack</a>.</p>
<p>It&rsquo;s slightly surprising to me (still) that technologies like this exist with <strong>everyone</strong> else seemingly using them and I&rsquo;ve not heard of them. I don&rsquo;t expect to know everything but I&rsquo;m surprised I&rsquo;ve not stumbled upon msgpack until now.</p>
    </div>
    <a href="/posts/200807/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200630/" class="link black dim">
        Golang Protobuf APIv2
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google has a new Golang Protobuf API, APIv2 (<a href="https://pkg.go.dev/google.golang.org/protobuf?tab=overview">google.golang.org/protobuf</a>) superseding APIv1 (<a href="https://pkg.go.dev/github.com/golang/protobuf?tab=overview">github.com/golang/protobuf</a>). If your code is importing <code>github.com/golang/protobuf</code>, you&rsquo;re using APIv2. Otherwise, you should consult with the docs because Google reimplemented APIv1 atop APIv2. One challenge this caused me, as someone who does not use protobufs and gRPC on a daily basis, is that <a href="https://pkg.go.dev/github.com/golang/protobuf/protoc-gen-go/grpc?tab=doc">gRPC</a> (code-generation) is being removed from the (Golang) <code>protoc-gen-go</code>, the Golang plugin that generates gRPC service bindings.</p>
    </div>
    <a href="/posts/200630/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200417/" class="link black dim">
        Golang Xiaomi Bluetooth Temperature|Humidity (LYWSD03MMC) 2nd Gen
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Well, this became more of an adventure that I&rsquo;d originally wanted but, after learning some BLE and, with the help of others (Thanks Jonatha, JsBergbau), I&rsquo;ve sample code that connects to 4 Xiaomi 2nd gen. Thermometers, subscribes to readings and publishes the data to MQTT. From there, I&rsquo;m scraping it using Inuits <a href="">MQTTGateway</a> into Prometheus.</p>
<p>Repo: <a href="https://github.com/DazWilkin/gomijia2">https://github.com/DazWilkin/gomijia2</a></p>
<p><img src="/images/200417.prometheus.png" alt="Prometheus"></p>
<h3 id="thankscredit">Thanks|Credit:</h3>
<ul>
<li><a href="https://github.com/u1f35c">Jonathan McDowell</a> for <a href="https://github.com/u1f35c/gomijia">gomijia</a> and <a href="https://github.com/u1f35c/gomijia/issues/1">help</a></li>
<li><a href="https://github.com/JsBergbau">JsBergbau</a> for <a href="https://github.com/JsBergbau/MiTemperature2/issues/29#issuecomment-614314939">help</a></li>
</ul>
<h3 id="background">Background</h3>
<p>I&rsquo;ve been playing around with <a href="https://esphome.io">ESPHome</a> and blogged around my very positive experience <a href="/posts/200227/">ESPHome, MQTT, Prometheus and almost Cloud IoT</a>. I&rsquo;ve ordered a couple of <a href="https://www.espressif.com/en/products/hardware/esp32-devkitc-googlecloud-iot/overview">ESP32-DevKitC</a> and hope this will enable me to connect to Google <a href="https://cloud.google.com/iot-core">Cloud IoT</a>.</p>
    </div>
    <a href="/posts/200417/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200325/" class="link black dim">
        gRPC, Cloud Run &amp; Endpoints
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>&lt;3 Google but there&rsquo;s quite often an assumption that we&rsquo;re all sitting around the engineering table and, of course, we&rsquo;re not.</p>
<p><a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> is a powerful offering but &ndash; IMO &ndash; it&rsquo;s <strong>super</strong> confusing to understand and complex to deploy.</p>
<p>If you&rsquo;re familiar with the motivations behind service meshes (e.g. <a href="https://istio.io">Istio</a>), Cloud Endpoints fits in a similar niche (&ldquo;neesh&rdquo; or &ldquo;nitch&rdquo;?). The underlying ambition is that, developers can take <strong>existing</strong> code and by adding a proxy (or sidecar), general-purpose abstractions, security, logging etc. may be added.</p>
    </div>
    <a href="/posts/200325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200320/" class="link black dim">
        Golang gRPC Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>Update: 2020-03-24</strong>: Since writing this post, I&rsquo;ve contributed <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/12">Golang</a> and <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/15">Rust</a> samples to Google&rsquo;s project. I recommend you start there.</p></blockquote>
<p>Google explained how to run gRPC servers with Cloud Run. The examples are good but only Python and Node.JS:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/compute/serve-cloud-run-requests-with-grpc-not-just-http">gRPC comes to Cloud Run</a></li>
<li><a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example">gRPC in Google Cloud Run</a></li>
</ul>
<p>Missing Golang&hellip;. until now ;-)</p>
<p>I had problems with 1.14 and so I&rsquo;m using 1.13.</p>
<h2 id="project-structure">Project structure</h2>
<p>I&rsquo;ll tidy up my repo but the code may be found:</p>
    </div>
    <a href="/posts/200320/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200310/" class="link black dim">
        Google&#39;s New Golang SDK for Protobufs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google has released a new Golang SDK for protobuf. In the [announcement], a useful tool to redact properties is described. If like me, this is somewhat novel to you, here&rsquo;s a mashup using Google&rsquo;s <a href="https://developers.google.com/protocol-buffers/docs/gotutorial">Protocol Buffer Basics</a> w/ redaction.</p>
<p>To be very clear, as it&rsquo;s an important distinction:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">Version</th>
          <th>Repo</th>
          <th>Docs</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">v2</td>
          <td><a href="https://google.golang.org/protobuf">google.golang.org/protobuf</a></td>
          <td><a href="https://pkg.go.dev/google.golang.org/protobuf">Docs</a></td>
      </tr>
      <tr>
          <td style="text-align: center">v1</td>
          <td><a href="https://github.com/golang/protobuf">github.com/golang/protobuf</a></td>
          <td><a href="https://pkg.go.dev/github.com/golang/protobuf">Docs</a></td>
      </tr>
  </tbody>
</table>
<h3 id="project">Project</h3>
<p>Here&rsquo;s my project structure:</p>
<pre tabindex="0"><code>.
├── protoc-3.11.4-linux-x86_64
│   ├── bin
│   │   └── protoc
│   ├── include
│   │   └── google
│   └── readme.txt
└── src
    ├── go.mod
    ├── go.sum
    ├── main.go
    ├── protos
    │   ├── addressbook.pb.go
    │   └── addressbook.proto
    └── README.md
</code></pre><p>You may structure as you wish.</p>
    </div>
    <a href="/posts/200310/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200226/" class="link black dim">
        OriginStamp: Verifying Proofs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Recently, I <a href="/posts/200217/">wrote</a> about some initial adventures with <a href="https://originstamp.org">OriginStamp</a></p>
<p>Using OriginStamp&rsquo;s <a href="https://originstamp.org/home">UI</a> or API, submitting a hash results in transactions being submitted to Bitcoin, Ethereum and a German newspaper.</p>
<p>Using the API, it&rsquo;s possible to query OriginStamp&rsquo;s service for a proof. This post explains how to verify such a proof.</p>
<p>The diligent reader among you (Hey Mom!) will recall that I submitted a hash for the message:</p>
<pre tabindex="0"><code>Frederik Jack is a bubbly Border Collie
</code></pre><p>The SHA-256 hash of this message is:</p>
    </div>
    <a href="/posts/200226/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200219/" class="link black dim">
        FreeTSA &amp; Digitorus&#39; Timestamp SDK
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I wrote recently about some exploration of Timestamping with <a href="/posts/200217/">OriginStamp</a>. Since writing that post, I had some supportive feedback from the helpful folks at OriginStamp and plan to continue exploring that solution.</p>
<p>Meanwhile, OriginStamp exposed me to <a href="https://en.wikipedia.org/wiki/Timestamping_%28computing%29">timestamping</a> and <a href="https://en.wikipedia.org/wiki/Trusted_timestamping">trusted timestamping</a> and I discovered <a href="https://freetsa.org">freeTSA.org</a>.</p>
<p>What&rsquo;s the point? These services provide authoritative proof of the existence of a digital asset before some point in time; OriginStamp provides a richer service and uses multiple timestamp authorities including Bitcoin, Ethereum and rather interestingly a German Newspaper&rsquo;s <a href="https://blockchain.suedkurier.de/faq">Trusted Timestamp</a>.</p>
    </div>
    <a href="/posts/200219/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200217/" class="link black dim">
        OriginStamp Python|Golang SDK Examples
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A friend mentioned <a href="https://originstamp.org">OriginStamp</a> to me.</p>
<p><strong>NB</strong> There are 2 sites: <a href="https://originstamp.com">originstamp.com</a> and <a href="https://originstamp.org">originstamp.org</a>.</p>
<p>It&rsquo;s an interesting project.</p>
<p>It&rsquo;s a solution for providing auditable proof that you had a(ccess to) some digital thing before a certain date. OriginStamp provides user-|developer-friendly means to submit files|hashes (of your content) and have these bundled into transactions that are submitted to e.g. bitcoin.</p>
<p>I won&rsquo;t attempt to duplicate the narrative here, review OriginStamp&rsquo;s site and some of its content.</p>
    </div>
    <a href="/posts/200217/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200206/" class="link black dim">
        Cloud Build wishlist: Mountable Golang Modules Proxy
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I think it would be valuable if Google were to provide volumes in <a href="https://cloud.google.com/cloud-build">Cloud Build</a> of package registries (e.g. <a href="https://proxy.golang.org">Go Modules</a>; <a href="https://pypi.org">PyPi</a>; <a href="https://search.maven.org/">Maven</a>; <a href="https://www.npmjs.com/">NPM</a> etc.).</p>
<p>Google provides a <a href="https://cloud.google.com/container-registry/docs/using-dockerhub-mirroring">mirror</a> of a subset of Docker Hub. This confers several benefits: Google&rsquo;s imprimatur; speed (latency); bandwidth; and convenience.</p>
<p>The same benefits would apply to package registries.</p>
<p>In the meantime, there&rsquo;s a hacky way to gain some of the benefits of these when using Cloud Build.</p>
<p>In the following example, I&rsquo;ll show an approach using Golang Modules and Google&rsquo;s module proxy aka <code>proxy.golang.org</code>.</p>
    </div>
    <a href="/posts/200206/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200122/" class="link black dim">
        Setting up a GCE Instance as an Inlets Exit Node
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The prolific <a href="https://blog.alexellis.io/">Alex Ellis</a> has a new project, <a href="https://github.com/inlets/inlets">Inlets</a>.</p>
<p>Here&rsquo;s a quick tutorial using <a href="https://cloud.google.com/">Google Compute Platform&rsquo;s (GCP)</a> <a href="https://cloud.google.com/compute/">Compute Engine (GCE)</a>.</p>
<p><strong>NB</strong> I&rsquo;m using one of Google&rsquo;s <a href="https://cloud.google.com/free/">&ldquo;Always free&rdquo;</a> f1-micro instances <strong>but</strong> you may still pay for network *gress and storage</p>
<h2 id="assumptions">Assumptions</h2>
<p>I&rsquo;m assuming you&rsquo;ve a Google account, have used GCP and have a billing account established, i.e. the following returns at least one billing account:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud beta billing accounts list
</span></span></code></pre></div><p>If you&rsquo;ve only one billing account and it&rsquo;s the one you wish to use, then you can:</p>
    </div>
    <a href="/posts/200122/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200110/" class="link black dim">
        Google Fit
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve spent a few days exploring [Google Fit SDK] as I try to wean myself from my obsession with metrics (of all forms). A quick Googling got me to Robert&rsquo;s <a href="https://ithoughthecamewithyou.com/post/export-google-fit-daily-steps-to-a-google-sheet">Exporter Google Fit Daily Steps, Weight and Distance to a Google Sheet</a>. This works and is probably where I should have stopped&hellip; avoiding the rabbit hole that I&rsquo;ve been down&hellip;</p>
<p>I threw together a simple Golang implementation of the SDK using <a href="https://godoc.org/google.golang.org/api/fitness/v1">Google&rsquo;s Golang API Client Library</a>. Thanks to Robert&rsquo;s example, I was able to infer some of the complexity this API particularly in its use of data types, data sources and datasets. Having used Stackdriver in my previous life, Google Fit&rsquo;s structure bears more than a passing resemblance to Stackdriver&rsquo;s data model and its use of resource types and metric types.</p>
    </div>
    <a href="/posts/200110/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200107/" class="link black dim">
        Google Home Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m obsessing over Prometheus exporters. First came <a href="/posts/191218/">Linode Exporter</a>, then <a href="/posts/191220/">GCP Exporter</a> and, on Sunday, I stumbled upon a reverse-engineered <a href="https://rithvikvibhu.github.io/GHLocalApi/">API for Google Home</a> devices and so wrote a very basic <a href="https://github.com/DazWilkin/gohome">Google Home SDK</a> and a similarly basic <a href="https://github.com/DazWilkin/home-exporter">Google Home Exporter</a>:</p>
<p><img src="/images/200107.home-exporter.png" alt="Prometheus Graphs"></p>
<p>The SDK only implements <code>/setup/eureka_info</code> and then only some of the returned properties. There&rsquo;s not a lot of metric-like data to use besides <code>SignalLevel</code> (<code>signal_level</code>) and <code>NoiseLevel</code> (<code>noise_level</code>). I&rsquo;m not clear on the meaning of some of the properties.</p>
    </div>
    <a href="/posts/200107/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191220/" class="link black dim">
        Google Cloud Platform (GCP) Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Earlier this week I discussed a <a href="/posts/191218/">Linode Prometheus Exporter</a>.</p>
<p>I <a href="https://github.com/metalmatze/digitalocean_exporter/pull/5">added</a> metrics for <a href="https://www.digitalocean.com/products/kubernetes/">Digital Ocean&rsquo;s Managed Kubernetes service</a> to <a href="https://github.com/metalmatze">@metalmatze</a>&rsquo;s <a href="https://github.com/metalmatze/digitalocean_exporter">Digital Ocean Exporter</a>.</p>
<p>This left, metrics for <a href="https://cloud.google.com">Google Cloud Platform (GCP)</a> which has, for many years, been my primary cloud platform. So, today I wrote <a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud Platform</a>.</p>
<p>All 3 of these exporters follow the template laid down by @metalmatze and, because each of these services has a well-written Golang SDK, it&rsquo;s straightforward to implement an exporter for each of them.</p>
    </div>
    <a href="/posts/191220/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191218/" class="link black dim">
        Linode Prometheus Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I enjoy using <a href="https://prometheus.io">Prometheus</a> and have toyed around with it for some time particularly in combination with Kubernetes. I signed up with <a href="https://www.linode.com/?r=9ab7d75b764e143a1b3b467390c852b2c56cd704">Linode</a> [referral] compelled by the addition of a managed Kubernetes service called <a href="https://www.linode.com/products/kubernetes/">Linode Kubernetes Engine (LKE)</a>. I have an anxiety that I&rsquo;ll inadvertently leave resources running (unused) on a cloud platform. Instead of refreshing the relevant billing page, it struck me that Prometheus may (not yet proven) help.</p>
<p>The hypothesis is that a combination of a cloud-specific Prometheus <a href="https://prometheus.io/docs/instrumenting/exporters/">exporter</a> reporting aggregate uses of e.g. Linodes (instances), NodeBalancers, Kubernetes clusters etc., could form the basis of an alert mechanism using Prometheus&rsquo; <a href="https://prometheus.io/docs/alerting/overview/">alerting</a>.</p>
    </div>
    <a href="/posts/191218/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190926/" class="link black dim">
        PyPi Transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been noodling around with another <a href="https://github.com/google/trillian">Trillian</a> personality.</p>
<p>Another in a theme that interests me in providing tamperproof logs for the packages in the popular package management registries.</p>
<p>The Golang team recently announced <a href="https://proxy.golang.org/">Go Module Mirror</a> which is built atop Trillian. It seems to me that all the package registries (<a href="https://proxy.golang.org">Go Modules</a>, <a href="https://www.npmjs.com">npm</a>, <a href="https://mvnrepository.com">Maven</a>, <a href="https://nuget.org">NuGet</a> etc.) would benefit from tamperproof logs hosted by a trusted 3rd-party.</p>
<p>As you may have guessed, PyPi Transparency is a log for <a href="https://pypi.org">PyPi</a> packages. PyPi is comprehensive, definitive and trusted but, as with Go Module Mirror, it doesn&rsquo;t hurt to provide a backup of some of its data. In the case of this solution, Trillian hosts a log of self-calculated SHA-256 hashes for Python packages that are added to it.</p>
    </div>
    <a href="/posts/190926/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190918/" class="link black dim">
        Cloud Functions Simple(st) HTTP Multi-host Proxy
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Tweaked yesterday&rsquo;s solution so that it will randomly select one from several hosts with which it&rsquo;s configured.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Golang" data-lang="Golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">proxy</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;math/rand&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/url&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;strings&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">robin</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">hostsList</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;PROXY_HOST&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">hostsList</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#e6db74">&#34;&#39;PROXY_HOST&#39; environment variable should contain comma-separated list of hosts&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Comma-separated lists of hosts</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hosts</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Split</span>(<span style="color:#a6e22e">hostsList</span>, <span style="color:#e6db74">&#34;,&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">urls</span> <span style="color:#f92672">:=</span> make([]<span style="color:#f92672">*</span><span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">URL</span>, len(<span style="color:#a6e22e">hosts</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">host</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">hosts</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">origin</span> = <span style="color:#a6e22e">Endpoint</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Host</span>: <span style="color:#a6e22e">host</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Port</span>: <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;PROXY_PORT&#34;</span>),
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">origin</span>.<span style="color:#a6e22e">URL</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">urls</span>[<span style="color:#a6e22e">i</span>] = <span style="color:#a6e22e">url</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">NewSource</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">UnixNano</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">q</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">s</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Handler</span> = <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Pick one of the URLs at random</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">url</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">urls</span>[<span style="color:#a6e22e">q</span>.<span style="color:#a6e22e">Int31n</span>(int32(len(<span style="color:#a6e22e">urls</span>)))]
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;[Handler] Forwarding: %s&#34;</span>, <span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">String</span>())
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Forward to it</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">reverseproxy</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This requires a minor tweak to the deployment to escape the commas within the <code>PROXY_HOST</code> string to disambiguate these for <code>gcloud</code>:</p>
    </div>
    <a href="/posts/190918/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190917/" class="link black dim">
        Cloud Functions Simple(st) HTTP Proxy
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m investigating the use of <a href="https://letsencrypt.org/">LetsEncrypt</a> for gRPC services. I found this straightforward <a href="https://www.d3void.net/post/acme/">post</a> by Scott Devoid and am going to try this approach.</p>
<p>Before I can do that, I need to be able to publish services (make them Internet-accessible) and would like to try to continue to use GCP for <a href="https://cloud.google.com/free/">free</a>.</p>
<p>Some time ago, I <a href="https://medium.com/google-cloud/microk8s-on-google-cloud-platform-d8b7a71a3ef">wrote</a> about using the excellent <a href="https://microk8s.io/">Microk8s</a> on GCP. Using an <code>f1-micro</code>, I&rsquo;m hoping (!) to stay within the Compute Engine free tier. I&rsquo;ll also try to be diligent and delete the instance when it&rsquo;s not needed. This gives me a runtime platform and I can expose services to the Instance&rsquo;s (Node)Ports but, I&rsquo;d prefer to not be billed for a simple proxy.</p>
    </div>
    <a href="/posts/190917/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190907/" class="link black dim">
        pypi-transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The goal of pypi-transparency is very similar to the underlying motivation for the Golang team&rsquo;s <a href="https://sum.golang.org/">Checksum Database</a> (also built with Trillian).</p>
<p>Even though, <a href="https://pypi.org">PyPi</a> provides hashes of the content of packages it hosts, the developer must trust that PyPi&rsquo;s data is consistent. One ambition with pypi-transparency is to provide a companion, tamperproof log of PyPi package files in order to provide a double-check of these hashes.</p>
<p>It is important to understand what this does (and does not) provide. There&rsquo;s no validation of a package&rsquo;s content. The only calculation is that, on first observation, a SHA-256 hash is computed of the package&rsquo;s content and the hash is recorded. If the package is subsequently altered, it&rsquo;s very probable that the hash will change and this provides a signal to the user that the package&rsquo;s contents has changed. Because pypi-transparency uses a tamperproof log, it&rsquo;s very difficult to update the hash recorded in the tamperproof log, to reflect this change. Corrolary: pypi-transparency will record the hashes of packages that include malicious code.</p>
    </div>
    <a href="/posts/190907/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
    </section>
  </div>

    </main>
    <footer class="bg-dark-blue bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://pretired.dazwilkin.com/" >
    &copy;  (p)retired 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>