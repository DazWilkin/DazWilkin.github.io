<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>(p)retired</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="">
    <meta name="generator" content="Hugo 0.146.0-DEV">
    
    
    
    
      <meta name="robots" content="index, follow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.6034ebad1bcaca305e5bfb3c7e4e0693f922718ecee81314bab17d117b4bab5b.css" >



    
    
    
      

    

    
    
      <link href="/tags/google/index.xml" rel="alternate" type="application/rss+xml" title="(p)retired" />
      <link href="/tags/google/index.xml" rel="feed" type="application/rss+xml" title="(p)retired" />
      
    

    <script data-goatcounter="https://pretired.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
 
    <meta property="og:url" content="https://pretired.dazwilkin.com/tags/google/">
  <meta property="og:site_name" content="(p)retired">
  <meta property="og:title" content="Google">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Google">
  <meta itemprop="datePublished" content="2025-02-13T00:00:00-08:00">
  <meta itemprop="dateModified" content="2025-02-13T00:00:00-08:00">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Google">

      
    
	
  </head>

  <body class="ma0 avenir bg-near-white production">

    

  <header>
    <div class="pb3-m pb6-l bg-dark-blue">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        (p)retired
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
    
    <a href="https://github.com/DazWilkin" target="_blank" rel="noopener" class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://www.linkedin.com/in/dazwilkin/" target="_blank" rel="noopener" class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://medium.com/@DazWilkin" target="_blank" rel="noopener" class="medium ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Medium link" aria-label="follow on Medium——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 170 170;" version="1.1" viewBox="0 0 170 170"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M46.5340803,65.2157554 C46.6968378,63.6076572 46.0836,62.018231 44.8828198,60.93592 L32.6512605,46.2010582 L32.6512605,44 L70.6302521,44 L99.9859944,108.380952 L125.794585,44 L162,44 L162,46.2010582 L151.542017,56.2281011 C150.640424,56.9153477 150.193188,58.0448862 150.380019,59.1628454 L150.380019,132.837155 C150.193188,133.955114 150.640424,135.084652 151.542017,135.771899 L161.755369,145.798942 L161.755369,148 L110.38282,148 L110.38282,145.798942 L120.963119,135.527337 C122.002801,134.487948 122.002801,134.182246 122.002801,132.592593 L122.002801,73.0417402 L92.585901,147.755438 L88.6106443,147.755438 L54.3622782,73.0417402 L54.3622782,123.115814 C54.0767278,125.221069 54.7759199,127.3406 56.2581699,128.863022 L70.0186741,145.55438 L70.0186741,147.755438 L31,147.755438 L31,145.55438 L44.7605042,128.863022 C46.2319621,127.338076 46.8903838,125.204485 46.5340803,123.115814 L46.5340803,65.2157554 Z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://stackoverflow.com/users/609290/dazwilkin" target="_blank" rel="noopener" class="stackoverflow ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Stack Overflow link" aria-label="follow on Stack Overflow——Opens in a new window">
      
        <span class="icon"><svg
    style="enable-background:new 0 0 67 67;"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    
>
    <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm.869 5.903l3.114 4.567-.975.665-3.115-4.567.976-.665zm-2.812 2.585l4.84 2.838-.6 1.017-4.842-2.838.602-1.017zm-1.276 2.724l5.413 1.521-.291 1.077-5.428-1.458.306-1.14zm-.588 2.461l5.687.569-.103 1.12-5.691-.513.107-1.176zm-.169 2.16h5.835v1.167h-5.835v-1.167zm7.976 3.167h-10v-6h1v5h8v-5h1v6zm.195-8.602l-.945-5.446 1.162-.202.947 5.446-1.164.202z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>

    </div>
  </div>
</nav>

      <div class="tc-l pv3 ph3 ph4-ns">
        <h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">
          Google
        </h1>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
  <article class="cf pa3 pa4-m pa4-l">
    <div class="measure-wide-l center f4 lh-copy nested-copy-line-height nested-links mid-gray">
      <p>Below you will find pages that utilize the taxonomy term “Google”</p>
    </div>
  </article>
  <div class="mw8 center">
    <section class="flex-ns flex-wrap justify-around mt5">
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250213/" class="link black dim">
        gRPC Firestore `Listen` in Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Obsessing on <a href="/posts/250210/">gRPC Firestore <code>Listen</code></a> somewhat but it&rsquo;s also a good learning opportunity for me to write stuff in Rust. This doesn&rsquo;t work against Google&rsquo;s public endpoint (possibly for the same reason that gRPCurl doesn&rsquo;t work either) but this does work against the Go server described in the other post.</p>
<p>I&rsquo;m also documenting here because I always encounter challenges using TLS with Rust (and this documents 2 working ways to do this with gRPC) as well as references two interesting (rust) examples that use Google services.</p>
    </div>
    <a href="/posts/250213/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250210/" class="link black dim">
        gRPC Firestore `Listen`
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A question on Stack overflow <a href="https://stackoverflow.com/questions/79422094">Firestore gRPC Listen does not send deletions</a> piqued by interest but created a second problem for me: I&rsquo;m unable to get its <a href="https://cloud.google.com/firestore/docs/reference/rpc/google.firestore.v1#google.firestore.v1.Firestore.Listen"><code>Listen</code></a> method to work using <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a>.</p>
<p>For what follows, you will need:</p>
<ol>
<li>a Google Project with Firestore enabled and a database (default: <code>(default)</code>) containing a Collection (e.g. <code>Dogs</code>) with at least one Document (e.g. <code>freddie</code>)</li>
<li><a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a> cloned locally in order to access Protobufs</li>
</ol>
<h2 id="summary">Summary</h2>
<table>
  <thead>
      <tr>
          <th>client</th>
          <th>server</th>
          <th>R</th>
          <th>See</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>gRPCurl</code></td>
          <td><code>firestore.googleapis.com:443</code></td>
          <td>✅</td>
          <td><a href="#grpcurl-listen-against-google-endpoint">link</a></td>
      </tr>
      <tr>
          <td>Go client</td>
          <td><code>firestore.googleapis.com:443</code></td>
          <td>✅</td>
          <td><a href="#go-client-listen-against-google-endpoint">link</a></td>
      </tr>
      <tr>
          <td><code>gRPCurl</code></td>
          <td>Go server</td>
          <td>✅</td>
          <td><a href="#grpcurl-listen-against-go-server">link</a></td>
      </tr>
      <tr>
          <td>Go client</td>
          <td>Go server</td>
          <td>✅</td>
          <td><a href="#go-client-listen-against-go-server">link</a></td>
      </tr>
  </tbody>
</table>
<p>I subsequently tried this using <a href="https://www.postman.com/">Postman</a> and it also works (✅).</p>
    </div>
    <a href="/posts/250210/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240409/" class="link black dim">
        Google Cloud Translation w/ gRPC 3 ways
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="general">General</h2>
<p>You&rsquo;ll need a Google Cloud project with Cloud Translation (<code>translate.googleapis.com</code>) enabled and a Service Account (and key) with suitable permissions in order to run the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BILLING<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Billing ID (gcloud billing accounts list)</span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Project ID</span>
</span></span><span style="display:flex;"><span>ACCOUNT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tester&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>EMAIL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span><span style="color:#e6db74">@</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">.iam.gserviceaccount.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ROLES<span style="color:#f92672">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/cloudtranslate.user&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/serviceusage.serviceUsageConsumer&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Project</span>
</span></span><span style="display:flex;"><span>gcloud projects create <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Associate Project with your Billing Account</span>
</span></span><span style="display:flex;"><span>gcloud billing accounts link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Enable Cloud Translation</span>
</span></span><span style="display:flex;"><span>gcloud services enable translate.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts create <span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account Key</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts keys create <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--iam-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update Project IAM permissions</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ROLE in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ROLES[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  gcloud projects add-iam-policy-binding <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --member<span style="color:#f92672">=</span>serviceAccount:<span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>ROLE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>For the code, you&rsquo;ll need to install <a href="https://github.com/protocolbuffers/protobuf"><code>protoc</code></a> and preferably have it in your path.</p>
    </div>
    <a href="/posts/240409/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230413/" class="link black dim">
        Filtering metrics w/ Google Managed Prometheus
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google has published two, very good blog posts on cost management:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/management-tools/learn-to-understand-and-reduce-cloud-monitoring-costs/">How to identify and reduce costs of your Google Cloud observability in Cloud Monitoring</a></li>
<li><a href="https://cloud.google.com/blog/topics/cost-management/how-to-approach-cloud-logging-pricing-for-cloud-admins">Cloud Logging pricing for Cloud Admins: How to approach it &amp; save cost</a></li>
</ul>
<p>This post is about my application cost reductions for Cloud Monitoring for <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>.</p>
<p>I&rsquo;m pleased with <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Google Cloud Managed Service for Prometheus</a> (hereinafter GMP). I&rsquo;ve a strong preference for letting service providers run components of <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> that I consider important but non-differentiating.</p>
    </div>
    <a href="/posts/230413/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221128/" class="link black dim">
        Maintaining Container Images
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>As I contemplate moving my &ldquo;thing&rdquo; into production, I&rsquo;m anticipating aspects of the application that need maintenance and how this can be automated.</p>
<p>I&rsquo;d been negligent in the maintenance of some of my container images.</p>
<p>I&rsquo;m using mostly Go and some Rust as the basis of static(ally-compiled) binaries that run in these containers <strong>but</strong> not every container has a base image of <a href="https://hub.docker.com/_/scratch"><code>scratch</code></a>. <code>scratch</code> is the <strong>only</strong> base image that doesn&rsquo;t change and thus the only base image that doesn&rsquo;t require that container images buit <code>FROM</code> it, be maintained.</p>
    </div>
    <a href="/posts/221128/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221117/" class="link black dim">
        Delegate domain-wide authority using Golang
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;d not used Google&rsquo;s <a href="https://developers.google.com/identity/protocols/oauth2/service-account#delegatingauthority">Domain-wide Delegation</a> from Golang and struggled to find example code.</p>
<p>Google provides Java and Python <a href="https://developers.google.com/identity/protocols/oauth2/service-account#authorizingrequests">samples</a>.</p>
<p>Google has a myriad packages implementing its OAuth security and it&rsquo;s always daunting trying to determine which one to use.</p>
<p>As it happens, I backed into the solution through <code>client.Options</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Google Workspace APIS don&#39;t use IAM do use OAuth scopes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Scopes used here must be reflected in the scopes on the</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Google Workspace Domain-wide Delegate client</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">scopes</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{ <span style="color:#f92672">...</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Delegates on behalf of this Google Workspace user</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">subject</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;a@google-workspace-email.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">creds</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">FindDefaultCredentialsWithParams</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ctx</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">CredentialsParams</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Scopes</span>: <span style="color:#a6e22e">scopes</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Subject</span>: <span style="color:#a6e22e">subject</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">opts</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">option</span>.<span style="color:#a6e22e">WithCredentials</span>(<span style="color:#a6e22e">creds</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">service</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">admin</span>.<span style="color:#a6e22e">NewService</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">opts</span>)
</span></span></code></pre></div><p>In this case <code>NewService</code> applies to Google&rsquo;s Golang <a href="https://pkg.go.dev/google.golang.org/api/admin/directory/v1">Admin SDK API</a> although the pattern of <code>NewService(ctx)</code> or <code>NewService(ctx, opts)</code> where <code>opts</code> is a <a href="https://pkg.go.dev/google.golang.org/api@v0.103.0/option#ClientOption"><code>option.ClientOption</code></a> is consistent across Google&rsquo;s Golang libraries.</p>
    </div>
    <a href="/posts/221117/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221110/" class="link black dim">
        Firestore Export &amp; Import
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using Firestore to maintain state in my &ldquo;thing&rdquo;.</p>
<p>In an attempt to ensure that I&rsquo;m able to restore the database, I run (Cloud Scheduler) scheduled backups (see <a href="/posts/220503/">Automating Scheduled Firestore Exports</a> and I&rsquo;ve been testing imports to ensure that the process works.</p>
<p>It does.</p>
<p>I thought I&rsquo;d document an important but subtle consideration with Firestore exports (which I&rsquo;d not initially understood).</p>
<p>Google facilitates that backup process with the sibling commands:</p>
    </div>
    <a href="/posts/221110/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211130/" class="link black dim">
        Automatic Certs w/ Golang gRPC service on Compute Engine
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I needed to deploy a <a href="https://github.com/grpc/grpc/blob/master/src/proto/grpc/health/v1/health.proto">healthcheck</a>-enabled gRPC TLS-enabled service. Fortunately, most (all?) of the SDKs include an implementation, e.g. Golang has <a href="https://github.com/grpc/grpc-go/tree/master/health"><code>grpc-go/health</code></a>.</p>
<p>I learned in my travels that:</p>
<ul>
<li>DigitalOcean [App] platform does not (<a href="https://www.digitalocean.com/community/questions/app-platform-http-2-support">link</a>) work with TLS-based gRPC apps.</li>
<li><a href="https://fly.io">Fly</a> has a regression (<a href="https://community.fly.io/t/urgent-grpc-server-unreachable-via-grpcurl/2694/5">link</a>) that breaks gRPC</li>
</ul>
<p>So, I resorted to Google Cloud Platform (GCP). Although Cloud Run would be well-suited to running the gRPC app, it uses a proxy|sidecar to provision a cert for the app and I wanted to be able to (easily use a custom domain) and give myself a somewhat general-purpose solution.</p>
    </div>
    <a href="/posts/211130/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210520/" class="link black dim">
        Consul discovers Google Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a basic <code>discoverer</code> of Google <a href="https://cloud.google.com/run">Cloud Run</a> services. This is for a project and it extends work done in some previous posts to <a href="/posts/210519/">Multiplex gRPC and Prometheus with Cloud Run</a> and to use <a href="/posts/210419/">Consul for Prometheus service discovery</a>.</p>
<p>This solution:</p>
<ul>
<li>Accepts a set of Google Cloud Platform (GCP) projects</li>
<li>Trawls them for Cloud Run services</li>
<li>Assumes that the services expose Prometheus metrics on <code>:443/metrics</code></li>
<li>Relabels the services</li>
<li>Surfaces any discovered Cloud Run services&rsquo; metrics in Prometheus</li>
</ul>
<p>You&rsquo;ll need Docker and Docker Compose.</p>
    </div>
    <a href="/posts/210520/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210519/" class="link black dim">
        Multiplexing gRPC and HTTP (Prometheus) endpoints with Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google <a href="https://cloud.google.com/run">Cloud Run</a> is useful but, each service is limited to exposing a single port. This caused me problems with a gRPC service that serves (non-gRPC) Prometheus metrics because customarily, you would serve gRPC on one port and the Prometheus metrics on another.</p>
<p>Fortunately, <a href="https://github.com/soheilhy/cmux">cmux</a> provides a solution by providing a mechanism that multiplexes both services (gRPC and HTTP) on a single port!</p>
<blockquote>
<p><strong>TL;DR</strong> See the cmux <a href="https://github.com/soheilhy/cmux#limitations">Limitations</a> and use:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#a6e22e">grpcl</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">MatchWithWriters</span>(
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">cmux</span>.<span style="color:#a6e22e">HTTP2MatchHeaderFieldSendSettings</span>(<span style="color:#e6db74">&#34;content-type&#34;</span>, <span style="color:#e6db74">&#34;application/grpc&#34;</span>))
</span></span></code></pre></div></blockquote>
<p>Extending the <a href="https://github.com/soheilhy/cmux#how-to">example</a> from the cmux repo:</p>
    </div>
    <a href="/posts/210519/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210506/" class="link black dim">
        Firestore Golang Timestamps &amp; Merging
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using Google&rsquo;s <a href="https://pkg.go.dev/cloud.google.com/go/firestore#DocumentRef">Golang SDK for Firestore</a>. The experience is excellent and I&rsquo;m quickly becoming a fan of Firestore. However, as a Golang Firestore developer, I&rsquo;m feeling less loved and some of the concepts in the database were causing me a conundrum.</p>
<p>I&rsquo;m still not entirely certain that I have Timestamps nailed but&hellip; I learned an important lesson on the auto-creation of Timestamps in documents and how to retain these values.</p>
    </div>
    <a href="/posts/210506/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210413/" class="link black dim">
        Cloud Firestore Triggers in Golang
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was pleased to discover that Google provides a non-Node.JS mechanism to subscribe to and act upon Firestore triggers, <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Google Cloud Firestore Triggers</a>. I&rsquo;ve nothing against Node.JS but, for the project i&rsquo;m developing, everything else is written in Golang. It&rsquo;s good to keep it all in one language.</p>
<p>I&rsquo;m perplexed that Cloud Functions still (!) only supports Go 1.13 (03-Sep-2019). Even <a href="https://golang.org/doc/devel/release.html#go1.14">Go 1.14</a> (25-Feb-2020) was released pre-pandemic and we&rsquo;re now running on 1.16. Come on Google!</p>
    </div>
    <a href="/posts/210413/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210317/" class="link black dim">
        Using Golang with the Firestore Emulator
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><img src="/images/210317.firebase.firestore.docs.png" alt="Firestore"></p>
<p>This works great but it wasn&rsquo;t clearly documented for non-Firebase users. I assume it will work, as well, for any of the client libraries (not just Golang).</p>
<p>Assuming you have some (Golang) code (in this case using the Google Cloud Client Library) that interacts with a Firestore database. Something of the form:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Golang" data-lang="Golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;crypto/sha256&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;cloud.google.com/go/firestore&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sha256</span>.<span style="color:#a6e22e">New</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#a6e22e">s</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%x&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Sum</span>(<span style="color:#66d9ef">nil</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Dog</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Name</span>    <span style="color:#66d9ef">string</span>                 <span style="color:#e6db74">`firestore:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Age</span>     <span style="color:#66d9ef">int</span>                    <span style="color:#e6db74">`firestore:&#34;age&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Human</span>   <span style="color:#f92672">*</span><span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">DocumentRef</span> <span style="color:#e6db74">`firestore:&#34;human&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Created</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>              <span style="color:#e6db74">`firestore:&#34;created&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewDog</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">age</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">human</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">DocumentRef</span>) <span style="color:#a6e22e">Dog</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Dog</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>:    <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Age</span>:     <span style="color:#a6e22e">age</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Human</span>:   <span style="color:#a6e22e">human</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Created</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(),
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">d</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Dog</span>) <span style="color:#a6e22e">ID</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Human</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`firestore:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">h</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Human</span>) <span style="color:#a6e22e">ID</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">project</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;PROJECT&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">NewClient</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">project</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;FIRESTORE_EMULATOR_HOST&#34;</span>); <span style="color:#a6e22e">value</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Using Firestore Emulator: %s&#34;</span>, <span style="color:#a6e22e">value</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">me</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Human</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;me&#34;</span>,
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">meDocRef</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Collection</span>(<span style="color:#e6db74">&#34;humans&#34;</span>).<span style="color:#a6e22e">Doc</span>(<span style="color:#a6e22e">me</span>.<span style="color:#a6e22e">ID</span>())
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">meDocRef</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">me</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">freddie</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewDog</span>(<span style="color:#e6db74">&#34;Freddie&#34;</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">meDocRef</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">freddieDocRef</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Collection</span>(<span style="color:#e6db74">&#34;dogs&#34;</span>).<span style="color:#a6e22e">Doc</span>(<span style="color:#a6e22e">freddie</span>.<span style="color:#a6e22e">ID</span>())
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">freddieDocRef</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">freddie</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Then you can interact instead with the Firestore Emulator.</p>
    </div>
    <a href="/posts/210317/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210316/" class="link black dim">
        Programmatically deploying Cloud Run services (Golang|Python)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Phew! Programmitcally deploying Cloud Run services should be easy but it didn&rsquo;t find it so.</p>
<p>My issues were that the Cloud Run Admin (!) API is poorly documented and it uses non-standard endpoints (thanks Sal!). Here, for others who may struggle with this, is how I got this to work.</p>
<h2 id="goal">Goal</h2>
<p>Programmatically (have Golang, Python, want Rust) deploy services to Cloud Run.</p>
<p>i.e. achieve this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud run deploy <span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--image<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--platform<span style="color:#f92672">=</span>managed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--no-allow-unauthenticated <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--region<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><blockquote>
<p><strong>TRICK</strong> <a href="https://cloud.google.com/sdk/gcloud/reference#--log-http"><code>--log-http</code></a> is your friend</p>
    </div>
    <a href="/posts/210316/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201203/" class="link black dim">
        webmention
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Let&rsquo;s see if this works!?</p>
<p>I&rsquo;ve added the following link to this site&rsquo;s <code>baseof.html</code> so that it is now rendered for each page:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-HTML" data-lang="HTML"><span style="display:flex;"><span>&lt;<span style="color:#f92672">link</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://us-central1-webmention.cloudfunctions.net/webmention&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;webmention&#34;</span> /&gt;
</span></span></code></pre></div><p>I discovered <a href="https://indieweb.org/">indieweb</a> yesterday reading about <a href="https://aaronparecki.com/2018/06/30/11/your-first-webmention">webmention</a>. Who knows what got me to webmention!?</p>
<p>The principles of both are sound. Instead of relying on come-go behemoths to run our digital world, indieweb seeks to provide technologies that enable us to achieve things without them. webmention is a cross-walled-garden mechanism to perform an evolved form of pingbacks. If X references one of Y&rsquo;s posts, X&rsquo;s server notifies Y&rsquo;s server during publication through a webmention service and, Y can then decide to add reference counts of copies of the referring link to their page. Clever.</p>
    </div>
    <a href="/posts/201203/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200930/" class="link black dim">
        Hugo and Google Cloud Storage
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using <a href="https://gohugo.io">Hugo</a> as a static site generator for <a href="https://pretired.dazwilkin.com">this</a> blog. I&rsquo;m using <a href="https://firebase.google.com">Firebase</a> (for free) to host <a href="https://lefsilver.com">lefsilver</a>.</p>
<p>I have other domains that I want to promote and decided to use Google Cloud Storage buckets for these sites. Using <a href="https://cloud.google.com/storage">Google Cloud Storage</a> for <a href="https://cloud.google.com/storage/docs/hosting-static-website">Hosting a static website</a> and using Hugo to deploy sites to <a href="https://gohugo.io/hosting-and-deployment/hugo-deploy/#google-cloud-storage-gcs">Google Cloud Storage (GCS)</a> are documented but, I didn&rsquo;t find a location where this is combined into a single tutorial and I wanted to add an explanation for ensuring your sites are included in Google&rsquo;s and Bing&rsquo;s search indexes.</p>
    </div>
    <a href="/posts/200930/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200916/" class="link black dim">
        Actions SDK Conversational Quickstart
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google&rsquo;s tutorial didn&rsquo;t work for me.</p>
<p>In this post, I&rsquo;ll help you get this working.</p>
<p><a href="https://developers.google.com/assistant/conversational/quickstart">https://developers.google.com/assistant/conversational/quickstart</a></p>
<h2 id="create-and-set-up-a-project"><a href="https://developers.google.com/assistant/conversational/quickstart">Create and set up a project</a></h2>
<p>This mostly works.</p>
<p>I recommend using the <a href="https://console.actions.google.com">Actions Console</a> as described to create the project.</p>
<p>I chose &ldquo;Custom&rdquo; and &ldquo;Blank Project&rdquo;</p>
<p>You need <strong>not</strong> enable <a href="https://console.developers.google.com/apis/library/actions.googleapis.com?q=actions">Actions API</a> as this is done automatically:</p>
<p><img src="/images/200916.api_library.png" alt="Actions API"></p>
<p>For the console work, I&rsquo;m going to use Google&rsquo;s excellent Cloud Shell. You may access this through the browser <strong>or</strong> through a terminal:</p>
    </div>
    <a href="/posts/200916/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200617/" class="link black dim">
        WASM Cloud Functions
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Following on from <a href="/posts/200612/">waPC &amp; Protobufs</a> and a question on Stack Overflow about Cloud Functions, I was compelled to try running WASM on Cloud Functions no JavaScript.</p>
<p>I wanted to reuse the WASM waPC functions that I&rsquo;d written in Rust as described in the other post. Cloud Functions does not (yet!?) provide a Rust runtime and so I&rsquo;m using the <a href="https://github.com/wapc/wapc-go">waPC Host for Go</a> in this example.</p>
<p>It works!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PARAMS<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>printf <span style="color:#e6db74">&#39;{&#34;a&#34;:{&#34;real&#34;:39,&#34;imag&#34;:3},&#34;b&#34;:{&#34;real&#34;:39,&#34;imag&#34;:3}}&#39;</span> | base64<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>gcloud auth print-identity-token<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;filename\&#34;:\&#34;complex.wasm\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;function\&#34;:\&#34;c:mul\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;params\&#34;:\&#34;</span><span style="color:#e6db74">${</span>PARAMS<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#34;</span> |<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request POST <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--data @- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span>-<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>.cloudfunctions.net/invoker
</span></span></code></pre></div><p>yields (correctly):</p>
    </div>
    <a href="/posts/200617/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200403/" class="link black dim">
        Rust Crate Transparency &amp;&amp; Rust SDK for Google Trillian
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m noodling the utility of a Transparency solution for Rust Crates. When developers push crates to Cargo, a bunch of metadata is associated with the crate. E.g. <a href="https://crates.io/crates/protobuf"><code>protobuf</code></a>. As with Golang Modules, Python packages on PyPi etc., there appears to be utility in making tamperproof recordings of these publications. Then, other developers may confirm that a crate pulled from cates.io is highly unlikely to have been changed.</p>
<p>On Linux, Cargo stores downloaded crates under <code>${HOME}/.crates/registry</code>. In the case of the latest version (<code>2.12.0</code>) of <code>protobuf</code>, on my machine, I have:</p>
    </div>
    <a href="/posts/200403/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200326/" class="link black dim">
        Google Trillian on Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written previously (<a href="https://medium.com/google-cloud/google-trillian-for-noobs-1a-c87a78e5e585">Google Trillian for Noobs</a>) about Google&rsquo;s interesting project <a href="https://github.com/google/trillian">Trillian</a> and about some of the &ldquo;personalities&rdquo; (e.g. <a href="/posts/190907/">PyPi Transparency</a>) that I&rsquo;ve build using it.</p>
<p>Having gone slight cra-cra on <a href="https://cloud.google.com/run">Cloud Run</a> and <a href="https://grpc.io">gRPC</a> this week with <a href="/posts/200320/">Golang gRPC Cloud Run</a> and <a href="/posts/200325/">gRPC, Cloud Run &amp; Endpoints</a>, I thought it&rsquo;d be fun to deploy Trillian and a personality to Cloud Run.</p>
<p>It mostly (!) works :-)</p>
<p>At the end of the post, I&rsquo;ve summarized creating a Cloud SQL instance to host the Trillian data(base).</p>
    </div>
    <a href="/posts/200326/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200325/" class="link black dim">
        gRPC, Cloud Run &amp; Endpoints
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>&lt;3 Google but there&rsquo;s quite often an assumption that we&rsquo;re all sitting around the engineering table and, of course, we&rsquo;re not.</p>
<p><a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> is a powerful offering but &ndash; IMO &ndash; it&rsquo;s <strong>super</strong> confusing to understand and complex to deploy.</p>
<p>If you&rsquo;re familiar with the motivations behind service meshes (e.g. <a href="https://istio.io">Istio</a>), Cloud Endpoints fits in a similar niche (&ldquo;neesh&rdquo; or &ldquo;nitch&rdquo;?). The underlying ambition is that, developers can take <strong>existing</strong> code and by adding a proxy (or sidecar), general-purpose abstractions, security, logging etc. may be added.</p>
    </div>
    <a href="/posts/200325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200320/" class="link black dim">
        Golang gRPC Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>Update: 2020-03-24</strong>: Since writing this post, I&rsquo;ve contributed <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/12">Golang</a> and <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/15">Rust</a> samples to Google&rsquo;s project. I recommend you start there.</p></blockquote>
<p>Google explained how to run gRPC servers with Cloud Run. The examples are good but only Python and Node.JS:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/compute/serve-cloud-run-requests-with-grpc-not-just-http">gRPC comes to Cloud Run</a></li>
<li><a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example">gRPC in Google Cloud Run</a></li>
</ul>
<p>Missing Golang&hellip;. until now ;-)</p>
<p>I had problems with 1.14 and so I&rsquo;m using 1.13.</p>
<h2 id="project-structure">Project structure</h2>
<p>I&rsquo;ll tidy up my repo but the code may be found:</p>
    </div>
    <a href="/posts/200320/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200207/" class="link black dim">
        Accessing GCR repos from Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Until today, I&rsquo;d not accessed a <a href="https://cloud.google.com/container-registry">Google Container Registry</a> repo from a <strong>non-GKE</strong> Kubernetes deployment.</p>
<p>It turns out that it&rsquo;s pretty well-documented (<a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/">link</a>) but, here&rsquo;s an end-end example.</p>
<p>Assuming:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BILLING<span style="color:#f92672">=[[</span>YOUR-BILLING<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=[[</span>YOUR-PROJECT<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>SERVER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;us.gcr.io&#34;</span>
</span></span></code></pre></div><p>If not already:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud projects create <span style="color:#f92672">{</span>$PROJECT<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud beta billing projects link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud services enable containerregistry.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><h2 id="container-registry">Container Registry</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>IMAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;busybox&#34;</span> <span style="color:#75715e"># Or ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker pull <span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker tag <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">${</span>SERVER<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker push <span style="color:#e6db74">${</span>SERVER<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud container images list-tags <span style="color:#e6db74">${</span>SERVER<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span></code></pre></div><h2 id="service-account">Service Account</h2>
<p>Create a service account that&rsquo;s permitted to download (read-only) images from this project&rsquo;s registry</p>
    </div>
    <a href="/posts/200207/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200206/" class="link black dim">
        Cloud Build wishlist: Mountable Golang Modules Proxy
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I think it would be valuable if Google were to provide volumes in <a href="https://cloud.google.com/cloud-build">Cloud Build</a> of package registries (e.g. <a href="https://proxy.golang.org">Go Modules</a>; <a href="https://pypi.org">PyPi</a>; <a href="https://search.maven.org/">Maven</a>; <a href="https://www.npmjs.com/">NPM</a> etc.).</p>
<p>Google provides a <a href="https://cloud.google.com/container-registry/docs/using-dockerhub-mirroring">mirror</a> of a subset of Docker Hub. This confers several benefits: Google&rsquo;s imprimatur; speed (latency); bandwidth; and convenience.</p>
<p>The same benefits would apply to package registries.</p>
<p>In the meantime, there&rsquo;s a hacky way to gain some of the benefits of these when using Cloud Build.</p>
<p>In the following example, I&rsquo;ll show an approach using Golang Modules and Google&rsquo;s module proxy aka <code>proxy.golang.org</code>.</p>
    </div>
    <a href="/posts/200206/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
    </section>
  </div>

    </main>
    <footer class="bg-dark-blue bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://pretired.dazwilkin.com/" >
    &copy;  (p)retired 2025 
  </a>
    <div>
<div class="ananke-socials">
  
    
    <a href="https://github.com/DazWilkin" target="_blank" rel="noopener" class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://www.linkedin.com/in/dazwilkin/" target="_blank" rel="noopener" class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://medium.com/@DazWilkin" target="_blank" rel="noopener" class="medium ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Medium link" aria-label="follow on Medium——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 170 170;" version="1.1" viewBox="0 0 170 170"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M46.5340803,65.2157554 C46.6968378,63.6076572 46.0836,62.018231 44.8828198,60.93592 L32.6512605,46.2010582 L32.6512605,44 L70.6302521,44 L99.9859944,108.380952 L125.794585,44 L162,44 L162,46.2010582 L151.542017,56.2281011 C150.640424,56.9153477 150.193188,58.0448862 150.380019,59.1628454 L150.380019,132.837155 C150.193188,133.955114 150.640424,135.084652 151.542017,135.771899 L161.755369,145.798942 L161.755369,148 L110.38282,148 L110.38282,145.798942 L120.963119,135.527337 C122.002801,134.487948 122.002801,134.182246 122.002801,132.592593 L122.002801,73.0417402 L92.585901,147.755438 L88.6106443,147.755438 L54.3622782,73.0417402 L54.3622782,123.115814 C54.0767278,125.221069 54.7759199,127.3406 56.2581699,128.863022 L70.0186741,145.55438 L70.0186741,147.755438 L31,147.755438 L31,145.55438 L44.7605042,128.863022 C46.2319621,127.338076 46.8903838,125.204485 46.5340803,123.115814 L46.5340803,65.2157554 Z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://stackoverflow.com/users/609290/dazwilkin" target="_blank" rel="noopener" class="stackoverflow ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Stack Overflow link" aria-label="follow on Stack Overflow——Opens in a new window">
      
        <span class="icon"><svg
    style="enable-background:new 0 0 67 67;"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    
>
    <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm.869 5.903l3.114 4.567-.975.665-3.115-4.567.976-.665zm-2.812 2.585l4.84 2.838-.6 1.017-4.842-2.838.602-1.017zm-1.276 2.724l5.413 1.521-.291 1.077-5.428-1.458.306-1.14zm-.588 2.461l5.687.569-.103 1.12-5.691-.513.107-1.176zm-.169 2.16h5.835v1.167h-5.835v-1.167zm7.976 3.167h-10v-6h1v5h8v-5h1v6zm.195-8.602l-.945-5.446 1.162-.202.947 5.446-1.164.202z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>
</div>
  </div>
</footer>

  </body>
</html>