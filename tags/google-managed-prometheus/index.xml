<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Google Managed Prometheus on (p)retired</title>
    <link>https://pretired.dazwilkin.com/tags/google-managed-prometheus/</link>
    <description>Recent content in Google Managed Prometheus on (p)retired</description>
    <generator>Hugo</generator>
    <language>en-us</language>
    <lastBuildDate>Thu, 04 Jan 2024 00:00:00 -0800</lastBuildDate>
    <atom:link href="https://pretired.dazwilkin.com/tags/google-managed-prometheus/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Capturing e.g. CronJob metrics with GMP</title>
      <link>https://pretired.dazwilkin.com/posts/240104/</link>
      <pubDate>Thu, 04 Jan 2024 00:00:00 -0800</pubDate>
      <guid>https://pretired.dazwilkin.com/posts/240104/</guid>
      <description>&lt;p&gt;The deployment of &lt;a href=&#34;https://cloud.google.com/stackdriver/docs/managed-prometheus/exporters/kube_state_metrics&#34;&gt;Kube State Metrics&lt;/a&gt; for Google Managed Prometheus creates both a &lt;code&gt;PodMonitoring&lt;/code&gt; and &lt;code&gt;ClusterPodMonitoring&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;The &lt;code&gt;PodMonitoring&lt;/code&gt; resource exposes metrics published on &lt;code&gt;metric-self&lt;/code&gt; port (8081).&lt;/p&gt;&#xA;&lt;p&gt;The &lt;code&gt;ClusterPodMonitoring&lt;/code&gt; exposes metrics published on &lt;code&gt;metric&lt;/code&gt; port (8080) &lt;strong&gt;but&lt;/strong&gt; this doesn&amp;rsquo;t include &lt;code&gt;cronjob&lt;/code&gt;-related metrics:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl get clusterpodmonitoring/kube-state-metrics &lt;span style=&#34;color:#ae81ff&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;--output&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;jsonpath&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{.spec.endpoints[0].metricRelabeling}&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;| jq -r .&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-JSON&#34; data-lang=&#34;JSON&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;action&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;keep&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;regex&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;kube_(daemonset|deployment|replicaset|pod|namespace|node|statefulset|persistentvolume|horizontalpodautoscaler|job_created)(_.+)?&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;sourceLabels&amp;#34;&lt;/span&gt;: [&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;__name__&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;&#xA;&lt;p&gt;&lt;strong&gt;NOTE&lt;/strong&gt; The &lt;code&gt;regex&lt;/code&gt; does &lt;strong&gt;not&lt;/strong&gt; include &lt;code&gt;kube_cronjob&lt;/code&gt; and only includes &lt;code&gt;kube_job_created&lt;/code&gt; patterns.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Robusta KRR w/ GMP</title>
      <link>https://pretired.dazwilkin.com/posts/230427/</link>
      <pubDate>Thu, 27 Apr 2023 00:00:00 -0700</pubDate>
      <guid>https://pretired.dazwilkin.com/posts/230427/</guid>
      <description>&lt;p&gt;I&amp;rsquo;ve been spending time recently optimizing &lt;a href=&#34;https://ack.al&#34; data-goatcounter-click=&#34;ack.al&#34;&gt;Ackal&lt;/a&gt;&amp;rsquo;s use of Google &lt;a href=&#34;https://cloud.google.com/logging&#34;&gt;Cloud Logging&lt;/a&gt; and &lt;a href=&#34;https://cloud.google.com/monitoring&#34;&gt;Cloud Monitoring&lt;/a&gt; in posts:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://pretired.dazwilkin.com/posts/230413/&#34;&gt;Filtering metrics w/ Google Managed Prometheus&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://pretired.dazwilkin.com/posts/230419/&#34;&gt;Kubernetes metrics, metrics everywhere&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://pretired.dazwilkin.com/posts/230425/&#34;&gt;Google Metric Diagnostics and Metric Data Ingested&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Yesterday, I read that &lt;a href=&#34;https://home.robusta.dev/&#34;&gt;Robusta&lt;/a&gt; has a new open source project &lt;a href=&#34;https://github.com/robusta-dev/krr&#34;&gt;Kubernetes Resource Recommendations (KRR)&lt;/a&gt; so I took some time to evaluate it.&lt;/p&gt;&#xA;&lt;p&gt;This post describes the changes I had to make to get KRR working with &lt;a href=&#34;https://cloud.google.com/stackdriver/docs/managed-prometheus&#34;&gt;Google Managed Prometheus (GMP)&lt;/a&gt;:&lt;/p&gt;</description>
    </item>
    <item>
      <title>Google Metric Diagnostics and Metric Data Ingested</title>
      <link>https://pretired.dazwilkin.com/posts/230425/</link>
      <pubDate>Tue, 25 Apr 2023 00:00:00 -0700</pubDate>
      <guid>https://pretired.dazwilkin.com/posts/230425/</guid>
      <description>&lt;p&gt;I&amp;rsquo;ve been on an efficiency drive with &lt;a href=&#34;https://cloud.google.com/logging&#34;&gt;Cloud Logging&lt;/a&gt; and &lt;a href=&#34;https://cloud.google.com/monitoring&#34;&gt;Cloud Monitoring&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;With regards Cloud Logging, I&amp;rsquo;m contemplating (!) eliminating almost all log storage. As it is I&amp;rsquo;ve buzz cut log storage with a &lt;code&gt;_Default&lt;/code&gt; sink that has comprehensive sets of &lt;code&gt;NOT LOG_ID(X)&lt;/code&gt; inclusion and exclusion filters. As I was doing so, I began to wonder why I need to pay for the storage of much logging. There&amp;rsquo;s the comfort from knowing that everything you may ever need is being logged (at least for 30 days) but there&amp;rsquo;s also the costs that that entails. I use logs exclusively for debugging which got me thinking, couldn&amp;rsquo;t I just capture logs when I&amp;rsquo;m debugging (rather thna all the time?). I&amp;rsquo;ve not taken that leap yet but I&amp;rsquo;m noodling on it.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Kubernetes metrics, metrics everywhere</title>
      <link>https://pretired.dazwilkin.com/posts/230419/</link>
      <pubDate>Wed, 19 Apr 2023 00:00:00 -0700</pubDate>
      <guid>https://pretired.dazwilkin.com/posts/230419/</guid>
      <description>&lt;p&gt;I&amp;rsquo;ve been tinkering with ways to &amp;ldquo;unit-test&amp;rdquo; my assumptions when using cloud platforms. I recently wrote about good posts by Google describing achieving cost savings with Cloud Monitoring and Cloud Logging:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/blog/products/management-tools/learn-to-understand-and-reduce-cloud-monitoring-costs/&#34;&gt;How to identify and reduce costs of your Google Cloud observability in Cloud Monitoring&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/blog/topics/cost-management/how-to-approach-cloud-logging-pricing-for-cloud-admins&#34;&gt;Cloud Logging pricing for Cloud Admins: How to approach it &amp;amp; save cost&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;With Cloud Monitoring, I&amp;rsquo;ve restricted the &lt;code&gt;prometheus.googleapis.com&lt;/code&gt; metrics that are being ingested but realized I wanted to track the number of Pods (and Containers) deployed to a GKE cluster.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Filtering metrics w/ Google Managed Prometheus</title>
      <link>https://pretired.dazwilkin.com/posts/230413/</link>
      <pubDate>Thu, 13 Apr 2023 00:00:00 -0700</pubDate>
      <guid>https://pretired.dazwilkin.com/posts/230413/</guid>
      <description>&lt;p&gt;Google has published two, very good blog posts on cost management:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/blog/products/management-tools/learn-to-understand-and-reduce-cloud-monitoring-costs/&#34;&gt;How to identify and reduce costs of your Google Cloud observability in Cloud Monitoring&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/blog/topics/cost-management/how-to-approach-cloud-logging-pricing-for-cloud-admins&#34;&gt;Cloud Logging pricing for Cloud Admins: How to approach it &amp;amp; save cost&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;This post is about my application cost reductions for Cloud Monitoring for &lt;a href=&#34;https://ack.al&#34; data-goatcounter-click=&#34;ack.al&#34;&gt;Ackal&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;I&amp;rsquo;m pleased with &lt;a href=&#34;https://cloud.google.com/stackdriver/docs/managed-prometheus&#34;&gt;Google Cloud Managed Service for Prometheus&lt;/a&gt; (hereinafter GMP). I&amp;rsquo;ve a strong preference for letting service providers run components of &lt;a href=&#34;https://ack.al&#34; data-goatcounter-click=&#34;ack.al&#34;&gt;Ackal&lt;/a&gt; that I consider important but non-differentiating.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Authenticate PromLens to Google Managed Prometheus</title>
      <link>https://pretired.dazwilkin.com/posts/230104/</link>
      <pubDate>Wed, 04 Jan 2023 00:00:00 -0800</pubDate>
      <guid>https://pretired.dazwilkin.com/posts/230104/</guid>
      <description>&lt;p&gt;I&amp;rsquo;m using &lt;a href=&#34;https://cloud.google.com/stackdriver/docs/managed-prometheus&#34;&gt;Google Managed Service for Prometheus (GMP)&lt;/a&gt; and liking it.&lt;/p&gt;&#xA;&lt;p&gt;Sometime ago, I tried using &lt;a href=&#34;https://promlens.com/&#34;&gt;PromLens&lt;/a&gt; with GMP but GMP&amp;rsquo;s Prometheus HTTP API endpoint requires auth and I&amp;rsquo;ve battled Prometheus&amp;rsquo; somewhat limited auth mechanism before (&lt;a href=&#34;https://pretired.dazwilkin.com/posts/211005/&#34;&gt;Scraping metrics exposed by Google Cloud Run services that require authentication&lt;/a&gt;).&lt;/p&gt;&#xA;&lt;p&gt;Listening to &lt;a href=&#34;https://promcon.io/2022-munich/schedule/&#34;&gt;PromCon EU 2022&lt;/a&gt; videos, I learned that PromLens has been &lt;a href=&#34;https://promlabs.com/blog/2022/10/25/promlabs-and-chronosphere-open-source-the-promlens-query-builder&#34;&gt;open sourced&lt;/a&gt; and contributed to the Prometheus project. Eventually, the functionality of PromLens should be combined into the Prometheus UI.&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
