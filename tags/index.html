<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>(p)retired</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="">
    <meta name="generator" content="Hugo 0.150.0-DEV">
    
    
    
    
      <meta name="robots" content="index, follow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.b89013985a078d0be77ff0f1ae39ec6d9f2c3c36e0f1aa8195900276fa8a5ad6.css" >



  


    

    
    
      

    

    
    
      <link href="/tags/index.xml" rel="alternate" type="application/rss+xml" title="(p)retired" />
      <link href="/tags/index.xml" rel="feed" type="application/rss+xml" title="(p)retired" />
      
    

    <script data-goatcounter="https://pretired.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
 
    <meta property="og:url" content="https://pretired.dazwilkin.com/tags/">
  <meta property="og:site_name" content="(p)retired">
  <meta property="og:title" content="Tags">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Tags">
  <meta itemprop="datePublished" content="2025-09-04T00:00:00-07:00">
  <meta itemprop="dateModified" content="2025-09-04T00:00:00-07:00">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Tags">

      
    
	
  </head>

  <body class="ma0 avenir bg-near-white production">

    

  <header>
    <div class="pb3-m pb6-l bg-dark-blue">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        (p)retired
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

      <div class="tc-l pv3 ph3 ph4-ns">
        <h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">
          Tags
        </h1>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
    
  <article class="cf pa3 pa4-m pa4-l">
    <div class="measure-wide-l center f4 lh-copy nested-copy-line-height nested-links mid-gray">
      
    </div>
  </article>
  <div class="mw8 center">
    <section class="ph4">
      
        <h2 class="f1">
          <a href="/tags/1-wire/" class="link blue hover-black">
            Tag: 1-Wire
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250904/" class="link black dim">
        Bare Metal: WS2812
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This one works!</p>
<h2 id="virtual-ws2812s">Virtual WS2812s</h2>
<!--![1-Wire ESP32-C3 w/ WS2812](/images/250904.esp32-c3.ws2812.png)-->
<video autoplay controls loop>
    <source src="/videos/250904.esp32-c3.ws2812.gpio4.webm" type="video/webm" />
</video>
<p><a href="https://gist.github.com/DazWilkin/7c2deded3ec5f7899f5d850ebd624cfb#file-diagram-json"><code>diagram.json</code></a></p>
<p>I&rsquo;d gone <em>cough</em> many years and never heard of 1-Wire and, suddenly, it&rsquo;s everywhere.</p>
<p>Addressable LEDs are hugely popular in tinkerer circles. Addressable LEDs come in myriad forms (wheels, matrices) but commonly they&rsquo;re sold as long strips. The part number is <a href="https://cdn-shop.adafruit.com/datasheets/WS2812B.pdf">WS2812</a> and they use 1-Wire too. Each, often multi-color (RGB) LED (often known as a pixel), is combined with an IC that enables the &ldquo;addressable&rdquo; behavior.</p>
    </div>
    <a href="/posts/250904/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250903/" class="link black dim">
        Bare Metal: DS18B20
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been working through Google&rsquo;s <a href="https://google.github.io/comprehensive-rust/">Comprehensive Rust</a> and, for the past couple of weeks, the <a href="https://google.github.io/comprehensive-rust/bare-metal.html">Bare Metal Rust</a> standalone course that uses the (excellent) <a href="https://tech.microbit.org/hardware/2-0-revision/">micro:bit v2</a> that has a Nordic Semiconductor <a href="https://tech.microbit.org/hardware/2-0-revision/#nrf52-application-processor">nRF52833</a> (an ARM Cortex-M4; interestingly its USB interface is also implemented using an ARM Cortex M0).</p>
<p>There&rsquo;s a wealth of Rust tutorials for microcontrollers and I bought an <a href="https://www.espressif.com/en/dev-board/esp32-c3-devkit-rust-1-en">ESP32-C3-DevKit-RUST-1</a> for another tutorial and spent some time with my favorite <a href="https://www.raspberrypi.com/products/raspberry-pi-pico/">Pi Pico</a> and a newly-acquired <a href="https://www.raspberrypi.com/products/debug-probe/">Debug Probe</a>.</p>
    </div>
    <a href="/posts/250903/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cyw43/" class="link blue hover-black">
            Tag: CYW43
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250905/" class="link black dim">
        Bare Metal: Pico and CYW43
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The &ldquo;W&rdquo; signifies that the board includes wireless. Interestingly, the wireless chip is an <a href="https://www.infineon.com/part/CYW43439">Infineon CYW43439</a>) which is itself a microcontroller running its own ARM Cortex chip (M3). The Pico&rsquo;s USB device includes another ARM microcontroller. So, with the dual Cortex (or Hazard) chips that are user programmable, and the 8 PIOs, these devices really pack a punch.</p>
<p>As a result of adding the wireless (microcontroller) chip to the Pico, the Pico&rsquo;s WS2812 (pixel) is accessible only through the CYW43439.</p>
    </div>
    <a href="/posts/250905/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/esp32-c3/" class="link blue hover-black">
            Tag: ESP32-C3
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250904/" class="link black dim">
        Bare Metal: WS2812
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This one works!</p>
<h2 id="virtual-ws2812s">Virtual WS2812s</h2>
<!--![1-Wire ESP32-C3 w/ WS2812](/images/250904.esp32-c3.ws2812.png)-->
<video autoplay controls loop>
    <source src="/videos/250904.esp32-c3.ws2812.gpio4.webm" type="video/webm" />
</video>
<p><a href="https://gist.github.com/DazWilkin/7c2deded3ec5f7899f5d850ebd624cfb#file-diagram-json"><code>diagram.json</code></a></p>
<p>I&rsquo;d gone <em>cough</em> many years and never heard of 1-Wire and, suddenly, it&rsquo;s everywhere.</p>
<p>Addressable LEDs are hugely popular in tinkerer circles. Addressable LEDs come in myriad forms (wheels, matrices) but commonly they&rsquo;re sold as long strips. The part number is <a href="https://cdn-shop.adafruit.com/datasheets/WS2812B.pdf">WS2812</a> and they use 1-Wire too. Each, often multi-color (RGB) LED (often known as a pixel), is combined with an IC that enables the &ldquo;addressable&rdquo; behavior.</p>
    </div>
    <a href="/posts/250904/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250903/" class="link black dim">
        Bare Metal: DS18B20
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been working through Google&rsquo;s <a href="https://google.github.io/comprehensive-rust/">Comprehensive Rust</a> and, for the past couple of weeks, the <a href="https://google.github.io/comprehensive-rust/bare-metal.html">Bare Metal Rust</a> standalone course that uses the (excellent) <a href="https://tech.microbit.org/hardware/2-0-revision/">micro:bit v2</a> that has a Nordic Semiconductor <a href="https://tech.microbit.org/hardware/2-0-revision/#nrf52-application-processor">nRF52833</a> (an ARM Cortex-M4; interestingly its USB interface is also implemented using an ARM Cortex M0).</p>
<p>There&rsquo;s a wealth of Rust tutorials for microcontrollers and I bought an <a href="https://www.espressif.com/en/dev-board/esp32-c3-devkit-rust-1-en">ESP32-C3-DevKit-RUST-1</a> for another tutorial and spent some time with my favorite <a href="https://www.raspberrypi.com/products/raspberry-pi-pico/">Pi Pico</a> and a newly-acquired <a href="https://www.raspberrypi.com/products/debug-probe/">Debug Probe</a>.</p>
    </div>
    <a href="/posts/250903/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/pico/" class="link blue hover-black">
            Tag: Pico
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250905/" class="link black dim">
        Bare Metal: Pico and CYW43
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The &ldquo;W&rdquo; signifies that the board includes wireless. Interestingly, the wireless chip is an <a href="https://www.infineon.com/part/CYW43439">Infineon CYW43439</a>) which is itself a microcontroller running its own ARM Cortex chip (M3). The Pico&rsquo;s USB device includes another ARM microcontroller. So, with the dual Cortex (or Hazard) chips that are user programmable, and the 8 PIOs, these devices really pack a punch.</p>
<p>As a result of adding the wireless (microcontroller) chip to the Pico, the Pico&rsquo;s WS2812 (pixel) is accessible only through the CYW43439.</p>
    </div>
    <a href="/posts/250905/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250903/" class="link black dim">
        Bare Metal: DS18B20
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been working through Google&rsquo;s <a href="https://google.github.io/comprehensive-rust/">Comprehensive Rust</a> and, for the past couple of weeks, the <a href="https://google.github.io/comprehensive-rust/bare-metal.html">Bare Metal Rust</a> standalone course that uses the (excellent) <a href="https://tech.microbit.org/hardware/2-0-revision/">micro:bit v2</a> that has a Nordic Semiconductor <a href="https://tech.microbit.org/hardware/2-0-revision/#nrf52-application-processor">nRF52833</a> (an ARM Cortex-M4; interestingly its USB interface is also implemented using an ARM Cortex M0).</p>
<p>There&rsquo;s a wealth of Rust tutorials for microcontrollers and I bought an <a href="https://www.espressif.com/en/dev-board/esp32-c3-devkit-rust-1-en">ESP32-C3-DevKit-RUST-1</a> for another tutorial and spent some time with my favorite <a href="https://www.raspberrypi.com/products/raspberry-pi-pico/">Pi Pico</a> and a newly-acquired <a href="https://www.raspberrypi.com/products/debug-probe/">Debug Probe</a>.</p>
    </div>
    <a href="/posts/250903/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/rust/" class="link blue hover-black">
            Tag: Rust
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250905/" class="link black dim">
        Bare Metal: Pico and CYW43
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The &ldquo;W&rdquo; signifies that the board includes wireless. Interestingly, the wireless chip is an <a href="https://www.infineon.com/part/CYW43439">Infineon CYW43439</a>) which is itself a microcontroller running its own ARM Cortex chip (M3). The Pico&rsquo;s USB device includes another ARM microcontroller. So, with the dual Cortex (or Hazard) chips that are user programmable, and the 8 PIOs, these devices really pack a punch.</p>
<p>As a result of adding the wireless (microcontroller) chip to the Pico, the Pico&rsquo;s WS2812 (pixel) is accessible only through the CYW43439.</p>
    </div>
    <a href="/posts/250905/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250904/" class="link black dim">
        Bare Metal: WS2812
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This one works!</p>
<h2 id="virtual-ws2812s">Virtual WS2812s</h2>
<!--![1-Wire ESP32-C3 w/ WS2812](/images/250904.esp32-c3.ws2812.png)-->
<video autoplay controls loop>
    <source src="/videos/250904.esp32-c3.ws2812.gpio4.webm" type="video/webm" />
</video>
<p><a href="https://gist.github.com/DazWilkin/7c2deded3ec5f7899f5d850ebd624cfb#file-diagram-json"><code>diagram.json</code></a></p>
<p>I&rsquo;d gone <em>cough</em> many years and never heard of 1-Wire and, suddenly, it&rsquo;s everywhere.</p>
<p>Addressable LEDs are hugely popular in tinkerer circles. Addressable LEDs come in myriad forms (wheels, matrices) but commonly they&rsquo;re sold as long strips. The part number is <a href="https://cdn-shop.adafruit.com/datasheets/WS2812B.pdf">WS2812</a> and they use 1-Wire too. Each, often multi-color (RGB) LED (often known as a pixel), is combined with an IC that enables the &ldquo;addressable&rdquo; behavior.</p>
    </div>
    <a href="/posts/250904/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250903/" class="link black dim">
        Bare Metal: DS18B20
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been working through Google&rsquo;s <a href="https://google.github.io/comprehensive-rust/">Comprehensive Rust</a> and, for the past couple of weeks, the <a href="https://google.github.io/comprehensive-rust/bare-metal.html">Bare Metal Rust</a> standalone course that uses the (excellent) <a href="https://tech.microbit.org/hardware/2-0-revision/">micro:bit v2</a> that has a Nordic Semiconductor <a href="https://tech.microbit.org/hardware/2-0-revision/#nrf52-application-processor">nRF52833</a> (an ARM Cortex-M4; interestingly its USB interface is also implemented using an ARM Cortex M0).</p>
<p>There&rsquo;s a wealth of Rust tutorials for microcontrollers and I bought an <a href="https://www.espressif.com/en/dev-board/esp32-c3-devkit-rust-1-en">ESP32-C3-DevKit-RUST-1</a> for another tutorial and spent some time with my favorite <a href="https://www.raspberrypi.com/products/raspberry-pi-pico/">Pi Pico</a> and a newly-acquired <a href="https://www.raspberrypi.com/products/debug-probe/">Debug Probe</a>.</p>
    </div>
    <a href="/posts/250903/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250627/" class="link black dim">
        Gemini Code Assist &#39;agent&#39; mode without `npx mcp-remote` (2/3)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Solved!</p>
<p>Ugh.</p>
<p>Before I continue, one important detail from yesterday&rsquo;s experience which I think I didn&rsquo;t clarify is that, unlike the Copilot agent, it appears (!?) that Gemini agent only supports integration with MCP servers via stdio. As a result, the only way to integrate with HTTP-based MCP servers (local or remote) is to proxy traffic through stdio as <a href="https://www.npmjs.com/package/mcp-remote"><code>mcp-remote</code></a> and the Rust example herein.</p>
<p>The most helpful change was to take a hint from the NPM <a href="https://www.npmjs.com/package/mcp-remote"><code>mcp-remote</code></a> and create a log file. This helps because, otherwise the <code>mcp-remote</code> process, because it&rsquo;s launched by Visual Studio Code, well Gemini Code Assist agent, isn&rsquo;t trivial to debug.</p>
    </div>
    <a href="/posts/250627/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250626/" class="link black dim">
        Gemini Code Assist &#39;agent&#39; mode without `npx mcp-remote` (1/3)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Former Microsoftie and Googler:</p>
<p>Good documentation <a href="https://learn.microsoft.com/en-us/microsoft-copilot-studio/agent-extend-action-mcp">Extend your agent with Model Context Protocol</a></p>
<p>Not such good documentation: <a href="https://developers.google.com/gemini-code-assist/docs/use-agentic-chat-pair-programmer">Using agentic chat as a pair programmer</a></p>
<p>Definition of &ldquo;good&rdquo; being, I was able to follow the clear instructions and it worked first time. Well done, Microsoft!</p>
<p>This space is moving so quickly and I&rsquo;m happy to alpha test these companies&rsquo; solutions but (a) Google&rsquo;s portfolio is a mess. This week I&rsquo;ve tried (and failed) to use Gemini CLI (because I don&rsquo;t want to run Node.JS on my host machine and it doesn&rsquo;t work in a container: <a href="https://github.com/google-gemini/gemini-cli/issues/1437">issue #1437</a>) and now this.</p>
    </div>
    <a href="/posts/250626/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250213/" class="link black dim">
        gRPC Firestore `Listen` in Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Obsessing on <a href="/posts/250210/">gRPC Firestore <code>Listen</code></a> somewhat but it&rsquo;s also a good learning opportunity for me to write stuff in Rust. This doesn&rsquo;t work against Google&rsquo;s public endpoint (possibly for the same reason that gRPCurl doesn&rsquo;t work either) but this does work against the Go server described in the other post.</p>
<p>I&rsquo;m also documenting here because I always encounter challenges using TLS with Rust (and this documents 2 working ways to do this with gRPC) as well as references two interesting (rust) examples that use Google services.</p>
    </div>
    <a href="/posts/250213/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/241113/" class="link black dim">
        gRPC-Web w/ FauxRPC and Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>After <a href="/posts/241025/">recently</a> discovering <a href="https://github.com/sudorandom/fauxrpc">FauxRPC</a>, I was sufficiently impressed that I decided to use it to test <a href="https://www.ack.al">Ackal</a>&rsquo;s gRPC services using rust.</p>
<p>FauxRPC provides <a href="https://fauxrpc.com/docs/server/multi-protocol-support/">multi-protocol support</a> and so, after successfully implementing the <em>faux</em> gRPC client tests, I was compelled to try gRPC-Web too. For no immediate benefit other than, it&rsquo;s there, it&rsquo;s free and it&rsquo;s interesting. As an aside, the <em>faux</em> REST client tests worked without issue using <a href="https://crates.io/crates/reqwest">Reqwest</a>.</p>
<p>Unfortunately, my optimism hit a wall with gRPC-Web and what follows is a summary of my unresolved issue.</p>
    </div>
    <a href="/posts/241113/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/241025/" class="link black dim">
        FauxRPC using gRPCurl, Golang and rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Read <a href="https://kmcd.dev/posts/fauxrpc-testcontainers/">FauxRPC + Testcontainers</a> on Hacker News and was intrigued. I spent a little more time &ldquo;evaluating&rdquo; this than I&rsquo;d planned because I&rsquo;m forcing myself to use rust as much as possible and my ignorance (see below) caused me some challenges.</p>
<p>The technology is interesting and works well. The experience helped me explore <a href="https://testcontainers.com/">Testcontainers</a> too which I&rsquo;d heard about but not explored until this week.</p>
<p>For my future self:</p>
<table>
  <thead>
      <tr>
          <th>What</th>
          <th>What?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="https://fauxrpc.com/">FauxRPC</a></td>
          <td>A general-purpose tool (built using <a href="https://buf.build/">Buf</a>&rsquo;s <a href="https://connectrpc.com/">Connect</a>) that includes registry and stub (gRPC) services that can be (programmatically) configured (using a Protobuf descriptor) and stubs (example method responses) to help test gRPC implementations.</td>
      </tr>
      <tr>
          <td><a href="https://testcontainers.com/">Testcontainers</a></td>
          <td>Write code (e.g. rust) to create and interact (test)services (running in [Docker] containers).</td>
      </tr>
      <tr>
          <td><a href="https://connectrpc.com/">Connect</a></td>
          <td>(More than a) gRPC implementation used by FauxRPC</td>
      </tr>
      <tr>
          <td><a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a></td>
          <td>A command-line gRPC tool.</td>
      </tr>
  </tbody>
</table>
<p>I started following along with FauxRPC&rsquo;s <a href="https://fauxrpc.com/docs/testcontainers/">Testcontainers</a> example but, being unfamiliar with Connect, I wasn&rsquo;t familiar with its Eliza service. The service is available on <code>demo.connectrpc.com:443</code> and is described using <a href="https://github.com/connectrpc/examples-go/blob/main/proto/connectrpc/eliza/v1/eliza.proto"><code>eliza.proto</code></a> as part of <a href="https://github.com/connectrpc/examples-go"><code>examples-go</code></a>. Had I realized this sooner, I would have used this example rather than the Health Checking protocol.</p>
    </div>
    <a href="/posts/241025/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240811/" class="link black dim">
        XML-RPC in Rust and Python
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A lazy Sunday afternoon and my interest was piqued by <a href="https://en.wikipedia.org/wiki/XML-RPC">XML-RPC</a></p>
<h2 id="client">Client</h2>
<p>A very basic XML-RPC client wrapped in a Cloud Functions function:</p>
<p><code>main.py</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python3" data-lang="python3"><span style="display:flex;"><span><span style="color:#f92672">import</span> functions_framework
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> xmlrpc.client
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>endpoint <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>get_env(<span style="color:#e6db74">&#34;ENDPOINT&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>proxy <span style="color:#f92672">=</span> xmlrpc<span style="color:#f92672">.</span>client<span style="color:#f92672">.</span>ServerProxy(endpoint)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@functions_framework.http</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add</span>(request):
</span></span><span style="display:flex;"><span>    print(request)
</span></span><span style="display:flex;"><span>    rqst <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>get_json(silent<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    resp <span style="color:#f92672">=</span> proxy<span style="color:#f92672">.</span>add(
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#34;x&#34;</span>:{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;real&#34;</span>:rqst[<span style="color:#e6db74">&#34;x&#34;</span>][<span style="color:#e6db74">&#34;real&#34;</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;imag&#34;</span>:rqst[<span style="color:#e6db74">&#34;x&#34;</span>][<span style="color:#e6db74">&#34;imag&#34;</span>]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;y&#34;</span>:{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;real&#34;</span>:rqst[<span style="color:#e6db74">&#34;y&#34;</span>][<span style="color:#e6db74">&#34;real&#34;</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;imag&#34;</span>:rqst[<span style="color:#e6db74">&#34;y&#34;</span>][<span style="color:#e6db74">&#34;imag&#34;</span>]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> resp
</span></span></code></pre></div><p><code>requirements.txt</code>:</p>
<pre tabindex="0"><code>functions-framework==3.*
</code></pre><p>Run it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 -m venv venv
</span></span><span style="display:flex;"><span>source venv/bin/activate
</span></span><span style="display:flex;"><span>python3 -m pip install --requirement requirements.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>python3 main.py
</span></span></code></pre></div><h2 id="server">Server</h2>
<p>Forcing myself to go Rust first and there&rsquo;s an (old) <a href="https://crates.io/crates/xml-rpc">xml-rpc</a> crate.</p>
    </div>
    <a href="/posts/240811/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240529/" class="link black dim">
        Using Rust to generate Kubernetes CRD
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For the first time, I chose Rust to solve a problem. Until this, I&rsquo;ve been trying to use Rust to learn the language and to rewrite existing code. But, this problem led me to Rust because my other tools wouldn&rsquo;t cut it.</p>
<p>The question was how to represent oneof fields in Kubernetes <a href="https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/">Custom Resource Definitions (CRDs)</a>.</p>
<p>CRDs use <a href="https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.0.md#schemaObject">OpenAPI</a> schema and the YAML that results can be challenging to grok.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apiextensions.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">CustomResourceDefinition</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deploymentconfigs.example.com</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">group</span>: <span style="color:#ae81ff">example.com</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">names</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">categories</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">DeploymentConfig</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">plural</span>: <span style="color:#ae81ff">deploymentconfigs</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">shortNames</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">singular</span>: <span style="color:#ae81ff">deploymentconfig</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">scope</span>: <span style="color:#ae81ff">Namespaced</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">versions</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">additionalPrinterColumns</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">v1alpha1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">schema</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">openAPIV3Schema</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">description</span>: <span style="color:#ae81ff">An example schema</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">deployment_strategy</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">oneOf</span>:
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">rolling_update</span>
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">recreate</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">recreate</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>                      <span style="color:#f92672">something</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">format</span>: <span style="color:#ae81ff">uint16</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">minimum</span>: <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">integer</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>                    - <span style="color:#ae81ff">something</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">object</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">rolling_update</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>                      <span style="color:#f92672">max_surge</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">format</span>: <span style="color:#ae81ff">uint16</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">minimum</span>: <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">integer</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#f92672">max_unavailable</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">format</span>: <span style="color:#ae81ff">uint16</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">minimum</span>: <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">integer</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>                    - <span style="color:#ae81ff">max_surge</span>
</span></span><span style="display:flex;"><span>                    - <span style="color:#ae81ff">max_unavailable</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">object</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">type</span>: <span style="color:#ae81ff">object</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">deployment_strategy</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">type</span>: <span style="color:#ae81ff">object</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">spec</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">title</span>: <span style="color:#ae81ff">DeploymentConfig</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">object</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">served</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storage</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">subresources</span>: {}
</span></span></code></pre></div><p>I&rsquo;ve developed several Kubernetes <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/operator/">Operators</a> using the <a href="https://sdk.operatorframework.io/">Operator SDK</a> in Go (which builds upon <a href="https://github.com/kubernetes-sigs/kubebuilder">Kubebuilder</a>).</p>
    </div>
    <a href="/posts/240529/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240409/" class="link black dim">
        Google Cloud Translation w/ gRPC 3 ways
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="general">General</h2>
<p>You&rsquo;ll need a Google Cloud project with Cloud Translation (<code>translate.googleapis.com</code>) enabled and a Service Account (and key) with suitable permissions in order to run the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BILLING<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Billing ID (gcloud billing accounts list)</span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Project ID</span>
</span></span><span style="display:flex;"><span>ACCOUNT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tester&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>EMAIL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span><span style="color:#e6db74">@</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">.iam.gserviceaccount.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ROLES<span style="color:#f92672">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/cloudtranslate.user&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/serviceusage.serviceUsageConsumer&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Project</span>
</span></span><span style="display:flex;"><span>gcloud projects create <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Associate Project with your Billing Account</span>
</span></span><span style="display:flex;"><span>gcloud billing accounts link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Enable Cloud Translation</span>
</span></span><span style="display:flex;"><span>gcloud services enable translate.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts create <span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account Key</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts keys create <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--iam-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update Project IAM permissions</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ROLE in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ROLES[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  gcloud projects add-iam-policy-binding <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --member<span style="color:#f92672">=</span>serviceAccount:<span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>ROLE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>For the code, you&rsquo;ll need to install <a href="https://github.com/protocolbuffers/protobuf"><code>protoc</code></a> and preferably have it in your path.</p>
    </div>
    <a href="/posts/240409/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240405/" class="link black dim">
        Google Cloud Events protobufs and SDKs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written before about <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s use of <a href="https://cloud.google.com/firestore">Firestore</a> and subscribing to Firestore document CRUD events:</p>
<ul>
<li><a href="/posts/230530/">Routing Firestore events to GKE with Eventarc</a></li>
<li><a href="/posts/210413/">Cloud Firestore Triggers in Golang</a> using <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Firestore triggers</a></li>
</ul>
<p>I find Google&rsquo;s <a href="cloud.google.com/eventarc">Eventarc</a> documentation to be confusing and, in typical Google fashion, even though open-sourced, you often need to do some legwork to find relevant sources, viz:</p>
<ul>
<li>Google&rsquo;s Protobufs for Eventarc (using <a href="https://cloudevents.io/">cloudevents</a>) <a href="https://github.com/googleapis/google-cloudevents"><code>google-cloudevents</code></a><sup>1</sup></li>
<li>Convenience (since you can generate these using <code>protoc</code>) language-specific types generated from the above e.g. <a href="https://github.com/googleapis/google-cloudevents-go"><code>google-cloudevents-go</code></a>; <a href="https://github.com/googleapis/google-cloudevents-python"><code>google-cloudevents-python</code></a> etc.</li>
</ul>
<p><sup>1</sup> &ndash; IIUC EventArc is the Google service. It carries Google Events that are CloudEvents. These are defined by protocol buffers schemas.</p>
    </div>
    <a href="/posts/240405/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240325/" class="link black dim">
        Prost! Tonic w/ a dash of JSON
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I naively (!) began exploring JSON marshaling of Protobufs in rust. Other protobuf language SDKs include JSON marshaling making the process straightforward. I was to learn that, in rust, it&rsquo;s not so simple. Unfortunately, for me, this continues to discourage my further use of rust (rust is just hard).</p>
<p>My goal was to marshal an arbitrary protocol buffer message that included a <a href="https://protobuf.dev/programming-guides/proto3/#oneof"><code>oneof</code></a> feature. I was unable to JSON marshal the rust generated by <code>tonic</code> for such a message.</p>
    </div>
    <a href="/posts/240325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240130/" class="link black dim">
        Navigating Koyeb&#39;s API with Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I wrote about <a href="/posts/240105/">Navigating Koyeb&rsquo;s Golang SDK</a>. That client is generated using the <a href="https://openapi-generator.tech/">OpenAPI Generator</a> project using Koyeb&rsquo;s Swagger (now OpenAPI) REST API <a href="https://developer.koyeb.com/public.swagger.json">spec</a>.</p>
<p>This post shows how to generate a Rust SDK using the Generator and provides a very basic example of using the SDK.</p>
<p>The Generator will create a Rust library project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>VERS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;v7.2.0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PACKAGE_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;koyeb-api-client-rs&#34;</span>
</span></span><span style="display:flex;"><span>PACKAGE_VERS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0.0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>podman run <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--interactive --tty --rm <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/local <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>docker.io/openapitools/openapi-generator-cli:<span style="color:#e6db74">${</span>VERS<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>generate <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-g<span style="color:#f92672">=</span>rust <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-i<span style="color:#f92672">=</span>https://developer.koyeb.com/public.swagger.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-o<span style="color:#f92672">=</span>/local/<span style="color:#e6db74">${</span>PACKAGE_NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--additional-properties<span style="color:#f92672">=</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>packageName<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PACKAGE_NAME<span style="color:#e6db74">}</span>,<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>packageVersion<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PACKAGE_VERS<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>This will create the project in <code>${PWD}/${PACKAGE_NAME}</code> including the documentation at:</p>
    </div>
    <a href="/posts/240130/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230310/" class="link black dim">
        Kubernetes Operators
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> uses a Kubernetes Operator to orchestrate the lifecycle of its health checks. Ackal&rsquo;s Operator is written in Go using <a href="https://github.com/kubernetes-sigs/kubebuilder"><code>kubebuilder</code></a>.</p>
<p>Yesterday, my interest was piqued by a <a href="https://metalbear.co">MetalBear</a> blog post <a href="https://metalbear.co/blog/writing-a-kubernetes-operator/">Writing a Kubernetes Operator [in Rust]</a>. I spent some time reimplementing one of Ackal&rsquo;s CRDs (<code>Check</code>) using <a href="https://github.com/kube-rs/kube"><code>kube-rs</code></a> and not only refreshed my Rust knowledge but learned a bunch more about Kubernetes and Operators.</p>
<p>While rummaging around the Kubernetes documentation, I discovered flant&rsquo;s <a href="https://github.com/flant/shell-operator"><code>Shell-operator</code></a> and spent some time today exploring its potential.</p>
    </div>
    <a href="/posts/230310/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201202/" class="link black dim">
        pest: parsing in Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A Microsoft engineer introduced me to <a href="https://pest.rs"><code>pest</code></a> as a way to introduce service filtering in a ZeroConf plugin that I&rsquo;m prototyping for <a href="https://github.com/deislabs/akri">Akri</a>. It&rsquo;s been fun to learn but I worry that, because I won&rsquo;t use it frequently, I&rsquo;m going to quickly forget what I&rsquo;ve done. So, here are my notes.</p>
<p>Here&rsquo;s the problem, I&rsquo;d like to be able to provide users of the ZeroConf plugin with a string-based filter that permits them to filter the services discovered when the Akri agent browses a network.</p>
    </div>
    <a href="/posts/201202/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201113/" class="link black dim">
        Akri
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For the past couple of weeks, I&rsquo;ve been playing around with <a href="http://github.com/deislabs/akri">Akri</a>, a Microsoft (DeisLabs) project for <a href="https://cloudblogs.microsoft.com/opensource/2020/10/20/announcing-akri-open-source-project-building-connected-edge-kubernetes/">building a connected edge with Kubernetes</a>. Kubernetes, IoT, Rust (and Golang) make this all compelling to me.</p>
<p>Initially, I deployed an Akri <a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo.md">End-to-End</a> to <a href="https://microk8s.io/">MicroK8s</a> on Google Compute Engine (<a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo-gce.md">link</a>) and Digital Ocean (<a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo-do.md">link</a>). But I was interested to create me own example and so have proposed a very (!) simple <a href="https://github.com/DazWilkin/akri/blob/protocol-http/docs/extensibility-http.md">HTTP-based protocol</a>.</p>
<p>This blog summarizes my thoughts about Akri and an explanation of the HTTP protocol implementation in the hope that this helps others.</p>
    </div>
    <a href="/posts/201113/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201008/" class="link black dim">
        Deploying a Rust HTTP server to DigitalOcean App Platform
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://digitalocean.com">DigitalOcean</a> launched an <a href="https://www.digitalocean.com/blog/introducing-digitalocean-app-platform-reimagining-paas-to-make-it-simpler-for-you-to-build-deploy-and-scale-apps">App Platform</a> with many <a href="https://www.digitalocean.com/docs/app-platform/languages-frameworks/">Supported Languages and Frameworks</a>. I used <a href="https://www.digitalocean.com/docs/app-platform/languages-frameworks/go/">Golang</a> first, then wondered how to use non-natively-supported languages, i.e. Rust.</p>
<p>The good news is that <a href="https://www.digitalocean.com/docs/app-platform/languages-frameworks/docker/">Docker</a> is a supported framework and so, you can run pretty much anything.</p>
<p>Repo: <a href="https://github.com/DazWilkin/do-apps-rust">https://github.com/DazWilkin/do-apps-rust</a></p>
<h2 id="rust">Rust</h2>
<p>I&rsquo;m a Rust noob. I&rsquo;m always receptive to feedback on improvements to the code. I looked to mirror the Golang example. I&rsquo;m using <a href="https://crates.io/crates/rocket">rocket</a> and <a href="https://crates.io/crates/rocket-prometheus">rocket-prometheus</a> for the first time:</p>
<p>You will want to install rust nightly (as Rocket has a dependency that requires it) and then you can override the default toolchain for the current project using:</p>
    </div>
    <a href="/posts/201008/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200819/" class="link black dim">
        Minimizing WASM binaries
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve spent time recently playing around with WebAssembly (WASM) and <a href="https://github.com/wapc">waPC</a>. Rust and WASM were born at Mozilla and there&rsquo;s a natural affinity with writing WASM binaries in Rust. In the WASM examples I&rsquo;ve been using for <a href="/posts/200817/">WASM Transparency</a>, <a href="/posts/200807/">waPC and MsgPack</a> and <a href="/posts/200612/">waPC and Protobufs</a>.</p>
<p>I&rsquo;ve created 3 WASM binaries: <code>complex.wasm</code>, <code>simplex.wasm</code> and <code>fabcar.wasm</code> and each is about 2.5MB when:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cargo build --target<span style="color:#f92672">=</span>wasm32-unknown-unknown --release
</span></span></code></pre></div><p>The <a href="https://rustwasm.github.io/docs/book">Rust and WebAssembly</a> book has an excellent section titled <a href="https://rustwasm.github.io/docs/book/reference/code-size.html">Shrinking <code>.wasm.</code> Code Size</a>. So, let&rsquo;s see what help that provides.</p>
    </div>
    <a href="/posts/200819/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200817/" class="link black dim">
        WASM Transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been playing around with a proof-of-concept combining WASM and <a href="https://github.com/google/trillian">Trillian</a>. The hypothesis was to explore using WASM as a form of chaincode with Trillian. The project works but it&rsquo;s far from being a chaincode-like solution.</p>
<p>Let&rsquo;s start with a couple of (trivial) examples and then I&rsquo;ll explain what&rsquo;s going on and how it&rsquo;s implemented.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Method: mul
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [Client:Invoke] Metadata: complex.wasm
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Success: result:{real:0.036980484 imag:0.3898267}
</span></span></code></pre></div><p>After shipping a Rust-sourced WASM solution (<code>complex.wasm</code>) to the WASM transparency server, the client invokes a method <code>mul</code> that&rsquo;s exposed by it using a dynamically generated request message and outputs the response. Woo hoo! Yes, an expensive way to multiple complex numbers.</p>
    </div>
    <a href="/posts/200817/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200807/" class="link black dim">
        waPC and MsgPack (Rust|Golang)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>As my reader will know (Hey Mom!), I&rsquo;ve been noodling around with WASM and <a href="https://github.com/wapc">waPC</a>. I&rsquo;ve been exploring ways to pass structured messages across the host:guest boundary.</p>
<p><a href="https://developers.google.com/protocol-buffers">Protobufs</a> was my first choice. <a href="https://medium.com/@KevinHoffman">@KevinHoffman</a> created waPC and <a href="https://github.com/wascc">waSCC</a> and he <a href="https://medium.com/@KevinHoffman/interface-types-are-basically-a-way-of-embedding-metadata-into-a-wasm-file-so-that-arbitrary-data-14965ebdfa48">explained</a> to me and that wSCC uses <a href="https://msgpack.org/">Message Pack</a>.</p>
<p>It&rsquo;s slightly surprising to me (still) that technologies like this exist with <strong>everyone</strong> else seemingly using them and I&rsquo;ve not heard of them. I don&rsquo;t expect to know everything but I&rsquo;m surprised I&rsquo;ve not stumbled upon msgpack until now.</p>
    </div>
    <a href="/posts/200807/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200723/" class="link black dim">
        Envoy WASM filters in Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A digression thanks to <a href="https://blog.salrashid.me/">Sal Rashid</a> who&rsquo;s exploring WASM filters w/ Envoy.</p>
<p>The documentation is sparse but:</p>
<ul>
<li><a href="https://banzaicloud.com/blog/envoy-wasm-filter/">How to write WASM filters for Envoy&hellip;</a></li>
</ul>
<p>There is a Rust SDK but it&rsquo;s not documented:</p>
<ul>
<li><a href="https://github.com/proxy-wasm/proxy-wasm-rust-sdk">proxy-wasm-rust-sdk</a></li>
</ul>
<p>I found two useful posts by Rustaceans who were able to make use of it:</p>
<ul>
<li><a href="https://antweiss.com/blog/extending-envoy-with-wasm-and-rust/">Extending Envoy with WASM and Rust</a></li>
<li><a href="https://blog.red-badger.com/extending-istio-with-rust-and-webassembly">Extending Istio with Rust and WebAssembly</a></li>
</ul>
<p>Here&rsquo;s my simple use of the SDK&rsquo;s examples.</p>
<h2 id="wasme">wasme</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -sL https://run.solo.io/wasme/install | sh
</span></span><span style="display:flex;"><span>PATH<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PATH<span style="color:#e6db74">}</span>:<span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.wasme/bin
</span></span><span style="display:flex;"><span>wasme --version
</span></span></code></pre></div><p>It may be possible to avoid creating an account on WebAssemblyHub if you&rsquo;re staying local.</p>
    </div>
    <a href="/posts/200723/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200429/" class="link black dim">
        Rust implementation of Crate Transparency using Google Trillian
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been hacking on a Rust-based transparent application for Google Trillian. As appears to be my fixation, this personality is for another package manager. This time, Rust&rsquo;s <a href="https://doc.rust-lang.org/1.0.0/book/crates-and-modules.html">Crates</a> often found in <a href="https://crates.io"><code>crates.io</code></a> which is Rust&rsquo;s Package Registry. I discussed this project earlier this month <a href="/posts/200403/">Rust Crate Transparency &amp;&amp; Rust SDK for Google Trillian</a> and and earlier approach for Python&rsquo;s packages with <a href="/posts/190907/">pypi-transparency</a>.</p>
<p>This time, of course, I&rsquo;m using Rust. And, by way of a first for me, for the gRPC server implementation (aka &ldquo;personality&rdquo;). I&rsquo;ve been lazy thanks to the excellent <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a> and have been using it way of a client. Because I&rsquo;m more familiar with Golang and because I&rsquo;ve written (most) other Trillian personalities in Golang, I resorted to quickly implementing Crate Transparency in Golang too in order to uncover bugs with the Rust implementation. I&rsquo;ll write a follow-up post on the complexity I seem to struggle with when using protobufs and gRPC [in Golang].</p>
    </div>
    <a href="/posts/200429/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200403/" class="link black dim">
        Rust Crate Transparency &amp;&amp; Rust SDK for Google Trillian
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m noodling the utility of a Transparency solution for Rust Crates. When developers push crates to Cargo, a bunch of metadata is associated with the crate. E.g. <a href="https://crates.io/crates/protobuf"><code>protobuf</code></a>. As with Golang Modules, Python packages on PyPi etc., there appears to be utility in making tamperproof recordings of these publications. Then, other developers may confirm that a crate pulled from cates.io is highly unlikely to have been changed.</p>
<p>On Linux, Cargo stores downloaded crates under <code>${HOME}/.crates/registry</code>. In the case of the latest version (<code>2.12.0</code>) of <code>protobuf</code>, on my machine, I have:</p>
    </div>
    <a href="/posts/200403/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200325/" class="link black dim">
        gRPC, Cloud Run &amp; Endpoints
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>&lt;3 Google but there&rsquo;s quite often an assumption that we&rsquo;re all sitting around the engineering table and, of course, we&rsquo;re not.</p>
<p><a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> is a powerful offering but &ndash; IMO &ndash; it&rsquo;s <strong>super</strong> confusing to understand and complex to deploy.</p>
<p>If you&rsquo;re familiar with the motivations behind service meshes (e.g. <a href="https://istio.io">Istio</a>), Cloud Endpoints fits in a similar niche (&ldquo;neesh&rdquo; or &ldquo;nitch&rdquo;?). The underlying ambition is that, developers can take <strong>existing</strong> code and by adding a proxy (or sidecar), general-purpose abstractions, security, logging etc. may be added.</p>
    </div>
    <a href="/posts/200325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190930/" class="link black dim">
        PyPi Transparency Client (Rust)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve finally being able to hack my way through to a working Rust gRPC client (for <a href="/posts/190926/">PyPi Transparency</a>).</p>
<p>It&rsquo;s not very good: poorly structured, hacky etc. but it serves the purpose of giving me a foothold into Rust development so that I can evolve it as I learn the language and its practices.</p>
<p>There are several Rust crates (SDK) for gRPC. There&rsquo;s no sanctioned SDK for Rust on <a href="https://grpc.io">grpc.io</a>.</p>
<p>I chose <a href="https://github.com/stepancheg">stepancheg</a>&rsquo;s <a href="https://github.com/stepancheg/grpc-rust">grpc-rust</a> because it&rsquo;s a pure Rust implementation (not built atop the C implementation).</p>
    </div>
    <a href="/posts/190930/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/wokwi/" class="link blue hover-black">
            Tag: Wokwi
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250905/" class="link black dim">
        Bare Metal: Pico and CYW43
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The &ldquo;W&rdquo; signifies that the board includes wireless. Interestingly, the wireless chip is an <a href="https://www.infineon.com/part/CYW43439">Infineon CYW43439</a>) which is itself a microcontroller running its own ARM Cortex chip (M3). The Pico&rsquo;s USB device includes another ARM microcontroller. So, with the dual Cortex (or Hazard) chips that are user programmable, and the 8 PIOs, these devices really pack a punch.</p>
<p>As a result of adding the wireless (microcontroller) chip to the Pico, the Pico&rsquo;s WS2812 (pixel) is accessible only through the CYW43439.</p>
    </div>
    <a href="/posts/250905/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250904/" class="link black dim">
        Bare Metal: WS2812
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This one works!</p>
<h2 id="virtual-ws2812s">Virtual WS2812s</h2>
<!--![1-Wire ESP32-C3 w/ WS2812](/images/250904.esp32-c3.ws2812.png)-->
<video autoplay controls loop>
    <source src="/videos/250904.esp32-c3.ws2812.gpio4.webm" type="video/webm" />
</video>
<p><a href="https://gist.github.com/DazWilkin/7c2deded3ec5f7899f5d850ebd624cfb#file-diagram-json"><code>diagram.json</code></a></p>
<p>I&rsquo;d gone <em>cough</em> many years and never heard of 1-Wire and, suddenly, it&rsquo;s everywhere.</p>
<p>Addressable LEDs are hugely popular in tinkerer circles. Addressable LEDs come in myriad forms (wheels, matrices) but commonly they&rsquo;re sold as long strips. The part number is <a href="https://cdn-shop.adafruit.com/datasheets/WS2812B.pdf">WS2812</a> and they use 1-Wire too. Each, often multi-color (RGB) LED (often known as a pixel), is combined with an IC that enables the &ldquo;addressable&rdquo; behavior.</p>
    </div>
    <a href="/posts/250904/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250903/" class="link black dim">
        Bare Metal: DS18B20
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been working through Google&rsquo;s <a href="https://google.github.io/comprehensive-rust/">Comprehensive Rust</a> and, for the past couple of weeks, the <a href="https://google.github.io/comprehensive-rust/bare-metal.html">Bare Metal Rust</a> standalone course that uses the (excellent) <a href="https://tech.microbit.org/hardware/2-0-revision/">micro:bit v2</a> that has a Nordic Semiconductor <a href="https://tech.microbit.org/hardware/2-0-revision/#nrf52-application-processor">nRF52833</a> (an ARM Cortex-M4; interestingly its USB interface is also implemented using an ARM Cortex M0).</p>
<p>There&rsquo;s a wealth of Rust tutorials for microcontrollers and I bought an <a href="https://www.espressif.com/en/dev-board/esp32-c3-devkit-rust-1-en">ESP32-C3-DevKit-RUST-1</a> for another tutorial and spent some time with my favorite <a href="https://www.raspberrypi.com/products/raspberry-pi-pico/">Pi Pico</a> and a newly-acquired <a href="https://www.raspberrypi.com/products/debug-probe/">Debug Probe</a>.</p>
    </div>
    <a href="/posts/250903/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/ws2812/" class="link blue hover-black">
            Tag: WS2812
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250904/" class="link black dim">
        Bare Metal: WS2812
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This one works!</p>
<h2 id="virtual-ws2812s">Virtual WS2812s</h2>
<!--![1-Wire ESP32-C3 w/ WS2812](/images/250904.esp32-c3.ws2812.png)-->
<video autoplay controls loop>
    <source src="/videos/250904.esp32-c3.ws2812.gpio4.webm" type="video/webm" />
</video>
<p><a href="https://gist.github.com/DazWilkin/7c2deded3ec5f7899f5d850ebd624cfb#file-diagram-json"><code>diagram.json</code></a></p>
<p>I&rsquo;d gone <em>cough</em> many years and never heard of 1-Wire and, suddenly, it&rsquo;s everywhere.</p>
<p>Addressable LEDs are hugely popular in tinkerer circles. Addressable LEDs come in myriad forms (wheels, matrices) but commonly they&rsquo;re sold as long strips. The part number is <a href="https://cdn-shop.adafruit.com/datasheets/WS2812B.pdf">WS2812</a> and they use 1-Wire too. Each, often multi-color (RGB) LED (often known as a pixel), is combined with an IC that enables the &ldquo;addressable&rdquo; behavior.</p>
    </div>
    <a href="/posts/250904/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/ds18b20/" class="link blue hover-black">
            Tag: DS18B20
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250903/" class="link black dim">
        Bare Metal: DS18B20
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been working through Google&rsquo;s <a href="https://google.github.io/comprehensive-rust/">Comprehensive Rust</a> and, for the past couple of weeks, the <a href="https://google.github.io/comprehensive-rust/bare-metal.html">Bare Metal Rust</a> standalone course that uses the (excellent) <a href="https://tech.microbit.org/hardware/2-0-revision/">micro:bit v2</a> that has a Nordic Semiconductor <a href="https://tech.microbit.org/hardware/2-0-revision/#nrf52-application-processor">nRF52833</a> (an ARM Cortex-M4; interestingly its USB interface is also implemented using an ARM Cortex M0).</p>
<p>There&rsquo;s a wealth of Rust tutorials for microcontrollers and I bought an <a href="https://www.espressif.com/en/dev-board/esp32-c3-devkit-rust-1-en">ESP32-C3-DevKit-RUST-1</a> for another tutorial and spent some time with my favorite <a href="https://www.raspberrypi.com/products/raspberry-pi-pico/">Pi Pico</a> and a newly-acquired <a href="https://www.raspberrypi.com/products/debug-probe/">Debug Probe</a>.</p>
    </div>
    <a href="/posts/250903/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/ackal/" class="link blue hover-black">
            Tag: Ackal
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250630/" class="link black dim">
        Gemini CLI (3/3)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h3 id="update-2025-07-08">Update 2025-07-08</h3>
<p>Gemini CLI supports <a href="https://github.com/google-gemini/gemini-cli/blob/0275ab0108e9a411d90d8ef8c8d70e21e498d81a/docs/tools/mcp-server.md#http-based-mcp-server">HTTP-based MCP server</a> integration</p>
<p>So, it&rsquo;s possible to replace the <code>.gemini/settings.json</code> included in the original post with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;theme&#34;</span>: <span style="color:#e6db74">&#34;Default&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;mcpServers&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;ackal-mcp-server&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;httpUrl&#34;</span>: <span style="color:#e6db74">&#34;http://localhost:7777/mcp&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;prometheus-mcp-server&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;httpUrl&#34;</span>: <span style="color:#e6db74">&#34;https://prometheus.{tailnet}/mcp&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;selectedAuthType&#34;</span>: <span style="color:#e6db74">&#34;gemini-api-key&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This solution permits the addition of <code>headers</code> too for e.g. including <code>Authorization</code></p>
<h3 id="original">Original</h3>
<p>Okay, so not &ldquo;Gemini Code Assist&rdquo; but sufficiently similar that I think it warrants the &ldquo;3/3&rdquo; appellation.</p>
    </div>
    <a href="/posts/250630/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250627/" class="link black dim">
        Gemini Code Assist &#39;agent&#39; mode without `npx mcp-remote` (2/3)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Solved!</p>
<p>Ugh.</p>
<p>Before I continue, one important detail from yesterday&rsquo;s experience which I think I didn&rsquo;t clarify is that, unlike the Copilot agent, it appears (!?) that Gemini agent only supports integration with MCP servers via stdio. As a result, the only way to integrate with HTTP-based MCP servers (local or remote) is to proxy traffic through stdio as <a href="https://www.npmjs.com/package/mcp-remote"><code>mcp-remote</code></a> and the Rust example herein.</p>
<p>The most helpful change was to take a hint from the NPM <a href="https://www.npmjs.com/package/mcp-remote"><code>mcp-remote</code></a> and create a log file. This helps because, otherwise the <code>mcp-remote</code> process, because it&rsquo;s launched by Visual Studio Code, well Gemini Code Assist agent, isn&rsquo;t trivial to debug.</p>
    </div>
    <a href="/posts/250627/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250626/" class="link black dim">
        Gemini Code Assist &#39;agent&#39; mode without `npx mcp-remote` (1/3)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Former Microsoftie and Googler:</p>
<p>Good documentation <a href="https://learn.microsoft.com/en-us/microsoft-copilot-studio/agent-extend-action-mcp">Extend your agent with Model Context Protocol</a></p>
<p>Not such good documentation: <a href="https://developers.google.com/gemini-code-assist/docs/use-agentic-chat-pair-programmer">Using agentic chat as a pair programmer</a></p>
<p>Definition of &ldquo;good&rdquo; being, I was able to follow the clear instructions and it worked first time. Well done, Microsoft!</p>
<p>This space is moving so quickly and I&rsquo;m happy to alpha test these companies&rsquo; solutions but (a) Google&rsquo;s portfolio is a mess. This week I&rsquo;ve tried (and failed) to use Gemini CLI (because I don&rsquo;t want to run Node.JS on my host machine and it doesn&rsquo;t work in a container: <a href="https://github.com/google-gemini/gemini-cli/issues/1437">issue #1437</a>) and now this.</p>
    </div>
    <a href="/posts/250626/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230708/" class="link black dim">
        Kubernetes Python SDK w/ CRDs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Responded to <a href="https://stackoverflow.com/questions/76636443/">Get Custom K8s Resource using Python</a> and found the <a href="https://github.com/kubernetes-client/python/blob/master/kubernetes/docs/CustomObjectsApi.md"><code>CustomObjectsApi</code></a> documentation unclear.</p>
<p>If you have a cluster and a kubeconfig file with a correctly configured <code>current-context</code>, so that you can successfully:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PLURAL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checks&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl get <span style="color:#e6db74">${</span>PLURAL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--all-namespaces
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> I&rsquo;m using <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s CRDs in these examples.</p></blockquote>
<p>Then you can use the following code to access the cluster&rsquo;s REST API server to enumerate its CRDs:</p>
<p><code>main.py</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python3" data-lang="Python3"><span style="display:flex;"><span><span style="color:#f92672">from</span> __future__ <span style="color:#f92672">import</span> print_function
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> kubernetes <span style="color:#f92672">import</span> client, config
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> kubernetes.client.rest <span style="color:#f92672">import</span> ApiException
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>config<span style="color:#f92672">.</span>load_kube_config()
</span></span><span style="display:flex;"><span>api <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>CustomObjectsApi()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ackal&#39;s Group|Version and some Kinds</span>
</span></span><span style="display:flex;"><span>group <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ack.al&#39;</span>
</span></span><span style="display:flex;"><span>version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;v1&#39;</span>
</span></span><span style="display:flex;"><span>plurals <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;checks&#39;</span>,<span style="color:#e6db74">&#39;customers&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> plural <span style="color:#f92672">in</span> plurals:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        resp <span style="color:#f92672">=</span> api<span style="color:#f92672">.</span>list_cluster_custom_object(
</span></span><span style="display:flex;"><span>            group,
</span></span><span style="display:flex;"><span>            version,
</span></span><span style="display:flex;"><span>            plural,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> resp[<span style="color:#e6db74">&#34;items&#34;</span>]:
</span></span><span style="display:flex;"><span>            spec <span style="color:#f92672">=</span> item[<span style="color:#e6db74">&#34;spec&#34;</span>]
</span></span><span style="display:flex;"><span>            print(spec)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> ApiException <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(e)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 -m venv venv
</span></span><span style="display:flex;"><span>source venv/bin/activate
</span></span><span style="display:flex;"><span>python3 -m pip install kubernetes<span style="color:#f92672">==</span>26.1.0
</span></span><span style="display:flex;"><span>python3 main.py
</span></span></code></pre></div><p>That&rsquo;s all!</p>
    </div>
    <a href="/posts/230708/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230404/" class="link black dim">
        Azure Container Apps
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The majority of <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s components are deployed to <a href="https://cloud.google.com">Google Cloud</a>. However, by its nature, Ackal benefits from deployments that span cloud platforms. I&rsquo;ve deployed Ackal&rsquo;s <a href="https://grpc.io">gRPC</a> <a href="https://github.com/grpc/grpc/blob/master/doc/health-checking.md">health checks</a> to <a href="https://fly.io">Fly</a>, and managed Kubernetes services on <a href="https://linode.com">Linode</a> and <a href="https://vultr.com">Vultr</a>.</p>
<p>Today, I decided to revisit<a href="#microsoft">¹</a> <a href="https://azure.microsoft.com">Azure</a>. Ackal uses Azure (Active Directory) for one of its OAuth providers. This time, I wanted to deploy a containerized gRPC service. Azure provides <a href="https://azure.microsoft.com/en-us/products/category/containers/">several</a> container-oriented services. I decided to use <a href="https://azure.microsoft.com/en-us/products/container-apps/">Azure Container Apps</a> and, in hindsight, find it analogous to Google <a href="https://cloud.google.com/run">Cloud Run</a>.</p>
    </div>
    <a href="/posts/230404/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/gemini/" class="link blue hover-black">
            Tag: Gemini
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250630/" class="link black dim">
        Gemini CLI (3/3)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h3 id="update-2025-07-08">Update 2025-07-08</h3>
<p>Gemini CLI supports <a href="https://github.com/google-gemini/gemini-cli/blob/0275ab0108e9a411d90d8ef8c8d70e21e498d81a/docs/tools/mcp-server.md#http-based-mcp-server">HTTP-based MCP server</a> integration</p>
<p>So, it&rsquo;s possible to replace the <code>.gemini/settings.json</code> included in the original post with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;theme&#34;</span>: <span style="color:#e6db74">&#34;Default&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;mcpServers&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;ackal-mcp-server&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;httpUrl&#34;</span>: <span style="color:#e6db74">&#34;http://localhost:7777/mcp&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;prometheus-mcp-server&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;httpUrl&#34;</span>: <span style="color:#e6db74">&#34;https://prometheus.{tailnet}/mcp&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;selectedAuthType&#34;</span>: <span style="color:#e6db74">&#34;gemini-api-key&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This solution permits the addition of <code>headers</code> too for e.g. including <code>Authorization</code></p>
<h3 id="original">Original</h3>
<p>Okay, so not &ldquo;Gemini Code Assist&rdquo; but sufficiently similar that I think it warrants the &ldquo;3/3&rdquo; appellation.</p>
    </div>
    <a href="/posts/250630/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250627/" class="link black dim">
        Gemini Code Assist &#39;agent&#39; mode without `npx mcp-remote` (2/3)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Solved!</p>
<p>Ugh.</p>
<p>Before I continue, one important detail from yesterday&rsquo;s experience which I think I didn&rsquo;t clarify is that, unlike the Copilot agent, it appears (!?) that Gemini agent only supports integration with MCP servers via stdio. As a result, the only way to integrate with HTTP-based MCP servers (local or remote) is to proxy traffic through stdio as <a href="https://www.npmjs.com/package/mcp-remote"><code>mcp-remote</code></a> and the Rust example herein.</p>
<p>The most helpful change was to take a hint from the NPM <a href="https://www.npmjs.com/package/mcp-remote"><code>mcp-remote</code></a> and create a log file. This helps because, otherwise the <code>mcp-remote</code> process, because it&rsquo;s launched by Visual Studio Code, well Gemini Code Assist agent, isn&rsquo;t trivial to debug.</p>
    </div>
    <a href="/posts/250627/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250626/" class="link black dim">
        Gemini Code Assist &#39;agent&#39; mode without `npx mcp-remote` (1/3)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Former Microsoftie and Googler:</p>
<p>Good documentation <a href="https://learn.microsoft.com/en-us/microsoft-copilot-studio/agent-extend-action-mcp">Extend your agent with Model Context Protocol</a></p>
<p>Not such good documentation: <a href="https://developers.google.com/gemini-code-assist/docs/use-agentic-chat-pair-programmer">Using agentic chat as a pair programmer</a></p>
<p>Definition of &ldquo;good&rdquo; being, I was able to follow the clear instructions and it worked first time. Well done, Microsoft!</p>
<p>This space is moving so quickly and I&rsquo;m happy to alpha test these companies&rsquo; solutions but (a) Google&rsquo;s portfolio is a mess. This week I&rsquo;ve tried (and failed) to use Gemini CLI (because I don&rsquo;t want to run Node.JS on my host machine and it doesn&rsquo;t work in a container: <a href="https://github.com/google-gemini/gemini-cli/issues/1437">issue #1437</a>) and now this.</p>
    </div>
    <a href="/posts/250626/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/gemini-cli/" class="link blue hover-black">
            Tag: Gemini CLI
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250630/" class="link black dim">
        Gemini CLI (3/3)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h3 id="update-2025-07-08">Update 2025-07-08</h3>
<p>Gemini CLI supports <a href="https://github.com/google-gemini/gemini-cli/blob/0275ab0108e9a411d90d8ef8c8d70e21e498d81a/docs/tools/mcp-server.md#http-based-mcp-server">HTTP-based MCP server</a> integration</p>
<p>So, it&rsquo;s possible to replace the <code>.gemini/settings.json</code> included in the original post with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;theme&#34;</span>: <span style="color:#e6db74">&#34;Default&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;mcpServers&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;ackal-mcp-server&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;httpUrl&#34;</span>: <span style="color:#e6db74">&#34;http://localhost:7777/mcp&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;prometheus-mcp-server&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;httpUrl&#34;</span>: <span style="color:#e6db74">&#34;https://prometheus.{tailnet}/mcp&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;selectedAuthType&#34;</span>: <span style="color:#e6db74">&#34;gemini-api-key&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This solution permits the addition of <code>headers</code> too for e.g. including <code>Authorization</code></p>
<h3 id="original">Original</h3>
<p>Okay, so not &ldquo;Gemini Code Assist&rdquo; but sufficiently similar that I think it warrants the &ldquo;3/3&rdquo; appellation.</p>
    </div>
    <a href="/posts/250630/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/jsonnet/" class="link blue hover-black">
            Tag: Jsonnet
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250630/" class="link black dim">
        Gemini CLI (3/3)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h3 id="update-2025-07-08">Update 2025-07-08</h3>
<p>Gemini CLI supports <a href="https://github.com/google-gemini/gemini-cli/blob/0275ab0108e9a411d90d8ef8c8d70e21e498d81a/docs/tools/mcp-server.md#http-based-mcp-server">HTTP-based MCP server</a> integration</p>
<p>So, it&rsquo;s possible to replace the <code>.gemini/settings.json</code> included in the original post with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;theme&#34;</span>: <span style="color:#e6db74">&#34;Default&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;mcpServers&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;ackal-mcp-server&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;httpUrl&#34;</span>: <span style="color:#e6db74">&#34;http://localhost:7777/mcp&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;prometheus-mcp-server&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;httpUrl&#34;</span>: <span style="color:#e6db74">&#34;https://prometheus.{tailnet}/mcp&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;selectedAuthType&#34;</span>: <span style="color:#e6db74">&#34;gemini-api-key&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This solution permits the addition of <code>headers</code> too for e.g. including <code>Authorization</code></p>
<h3 id="original">Original</h3>
<p>Okay, so not &ldquo;Gemini Code Assist&rdquo; but sufficiently similar that I think it warrants the &ldquo;3/3&rdquo; appellation.</p>
    </div>
    <a href="/posts/250630/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250429/" class="link black dim">
        Configuring Envoy to proxy Google Cloud Run v2
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m building an emulator for <a href="https://cloud.google.com/run">Cloud Run</a>. As I considered the solution, I assumed (more later) that I could implement Google&rsquo;s gRPC interface for <a href="https://github.com/googleapis/googleapis/tree/83df85b45a5d3e85b48f2571e1c8e57cdfd57e6c/google/cloud/run">Cloud Run</a> and use <a href="https://www.envoyproxy.io/">Envoy</a> to proxy HTTP/REST requests to the gRPC service using Envoy&rsquo;s <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/grpc_json_transcoder_filter">gRPC-JSON transcoder</a>.</p>
<p>Google calls this process <a href="https://cloud.google.com/endpoints/docs/grpc/transcoding">Transcoding HTTP/JSON to gRPC</a> which I think it a better description.</p>
<p>Google&rsquo;s Cloud Run <code>v2</code> (<code>v1</code> is no longer published to the <a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a> repo) <a href="https://github.com/googleapis/googleapis/blob/83df85b45a5d3e85b48f2571e1c8e57cdfd57e6c/google/cloud/run/v2/service.proto"><code>service.proto</code></a> includes the following <code>Services</code> definition for <code>CreateService</code>:</p>
    </div>
    <a href="/posts/250429/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250325/" class="link black dim">
        Migrating Prometheus Exporters to Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I have built <a href="https://prometheus.io">Prometheus</a> <a href="https://prometheus.io/docs/instrumenting/exporters/">Exporters</a> for multiple cloud platforms to track resources deployed across clouds:</p>
<ul>
<li><a href="https://github.com/DazWilkin/azure-exporter">Prometheus Exporter for Azure</a></li>
<li><a href="https://github.com/DazWilkin/crtsh-exporter">Prometheus Exporter for crt.sh</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/goatcounter-exporter">Prometheus Exporter for GoatCounter</a></li>
<li><a href="https://github.com/DazWilkin/ga-exporter">Prometheus Exporter for Google Analytics</a></li>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud</a></li>
<li><a href="https://github.com/DazWilkin/koyeb-exporter">Prometheus Exporter for Koyeb</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/porkbun-exporter">Prometheus Exporter for PorkBun</a></li>
<li><a href="https://github.com/DazWilkin/updown-exporter">Prometheus Exporter for updown.io</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>Additionally, I&rsquo;ve written two status service exporters:</p>
<ul>
<li><a href="https://github.com/DazWilkin/gcp-status">Prometheus Exporter for GCP Status</a></li>
<li><a href="https://github.com/DazWilkin/vultr-status-exporter">Prometheus Exporter for Vultr Status</a></li>
</ul>
<p>These exporters are all derived from an exemplar <a href="https://github.com/metalmatze/digitalocean_exporter"><code>DigitalOcean Exporter</code></a> written by <a href="https://github.com/metalmatze">metalmatze</a> for which I maintain a <a href="https://github.com/DazWilkin/digitalocean_exporter">fork</a>.</p>
    </div>
    <a href="/posts/250325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/mcp/" class="link blue hover-black">
            Tag: MCP
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250630/" class="link black dim">
        Gemini CLI (3/3)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h3 id="update-2025-07-08">Update 2025-07-08</h3>
<p>Gemini CLI supports <a href="https://github.com/google-gemini/gemini-cli/blob/0275ab0108e9a411d90d8ef8c8d70e21e498d81a/docs/tools/mcp-server.md#http-based-mcp-server">HTTP-based MCP server</a> integration</p>
<p>So, it&rsquo;s possible to replace the <code>.gemini/settings.json</code> included in the original post with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;theme&#34;</span>: <span style="color:#e6db74">&#34;Default&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;mcpServers&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;ackal-mcp-server&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;httpUrl&#34;</span>: <span style="color:#e6db74">&#34;http://localhost:7777/mcp&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;prometheus-mcp-server&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;httpUrl&#34;</span>: <span style="color:#e6db74">&#34;https://prometheus.{tailnet}/mcp&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;selectedAuthType&#34;</span>: <span style="color:#e6db74">&#34;gemini-api-key&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This solution permits the addition of <code>headers</code> too for e.g. including <code>Authorization</code></p>
<h3 id="original">Original</h3>
<p>Okay, so not &ldquo;Gemini Code Assist&rdquo; but sufficiently similar that I think it warrants the &ldquo;3/3&rdquo; appellation.</p>
    </div>
    <a href="/posts/250630/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250627/" class="link black dim">
        Gemini Code Assist &#39;agent&#39; mode without `npx mcp-remote` (2/3)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Solved!</p>
<p>Ugh.</p>
<p>Before I continue, one important detail from yesterday&rsquo;s experience which I think I didn&rsquo;t clarify is that, unlike the Copilot agent, it appears (!?) that Gemini agent only supports integration with MCP servers via stdio. As a result, the only way to integrate with HTTP-based MCP servers (local or remote) is to proxy traffic through stdio as <a href="https://www.npmjs.com/package/mcp-remote"><code>mcp-remote</code></a> and the Rust example herein.</p>
<p>The most helpful change was to take a hint from the NPM <a href="https://www.npmjs.com/package/mcp-remote"><code>mcp-remote</code></a> and create a log file. This helps because, otherwise the <code>mcp-remote</code> process, because it&rsquo;s launched by Visual Studio Code, well Gemini Code Assist agent, isn&rsquo;t trivial to debug.</p>
    </div>
    <a href="/posts/250627/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250626/" class="link black dim">
        Gemini Code Assist &#39;agent&#39; mode without `npx mcp-remote` (1/3)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Former Microsoftie and Googler:</p>
<p>Good documentation <a href="https://learn.microsoft.com/en-us/microsoft-copilot-studio/agent-extend-action-mcp">Extend your agent with Model Context Protocol</a></p>
<p>Not such good documentation: <a href="https://developers.google.com/gemini-code-assist/docs/use-agentic-chat-pair-programmer">Using agentic chat as a pair programmer</a></p>
<p>Definition of &ldquo;good&rdquo; being, I was able to follow the clear instructions and it worked first time. Well done, Microsoft!</p>
<p>This space is moving so quickly and I&rsquo;m happy to alpha test these companies&rsquo; solutions but (a) Google&rsquo;s portfolio is a mess. This week I&rsquo;ve tried (and failed) to use Gemini CLI (because I don&rsquo;t want to run Node.JS on my host machine and it doesn&rsquo;t work in a container: <a href="https://github.com/google-gemini/gemini-cli/issues/1437">issue #1437</a>) and now this.</p>
    </div>
    <a href="/posts/250626/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250616/" class="link black dim">
        Prometheus MCP Server
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was unable to find a <a href="https://modelcontextprotocol.io/">Model Context Protocol (MCP)</a> server implementation for <a href="https://prometheus.io">Prometheus</a>. I had a quiet weekend and so I&rsquo;ve been writing one: <a href="https://github.com/DazWilkin/prometheus-mcp-server"><code>prometheus-mcp-server</code></a>.</p>
<p>I used the code from the <a href="/posts/250612/">MCP for gRPC Health Checking protocol</a> that I wrote about previously as a guide.</p>
<p>I wrote a series of <code>stdin</code> and HTTP tests to have confidence that the service is working correctly but I had no MCP host.</p>
<p>I discovered that <a href="https://code.visualstudio.com/">Visual Studio Code</a> through its <a href="https://marketplace.visualstudio.com/items?itemName=GitHub.copilot">GitHub Copilot</a> extension functions has a <a href="https://code.visualstudio.com/docs/copilot/chat/mcp-servers">preview to use MCP servers</a> i.e. function as an MCP host and access MCP servers.</p>
    </div>
    <a href="/posts/250616/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250612/" class="link black dim">
        MCP for gRPC Health Checking protocol
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://modelcontextprotocol.io/introduction">Model Context Protocol (MCP)</a> is &ldquo;all the rage&rdquo; these days.</p>
<p>I stumbled upon <a href="https://github.com/redpanda-data/protoc-gen-go-mcp"><code>protoc-gen-go-mcp</code></a> and think it&rsquo;s an elegant application of two technologies: programmatically generating an MCP server from a gRPC protobuf.</p>
<p>I&rsquo;m considering building an MCP server for <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> but, thought I&rsquo;d start with something simple: <a href="https://grpc.io/docs/guides/health-checking/">gRPC Health Checking protocol</a>.</p>
<p>I was surprised to learn as I was doing this that there&rsquo;s a new <a href="https://github.com/grpc/grpc-proto/blob/23f5b568eefcb876e6ebc3b01725f1f20cff999e/grpc/health/v1/health.proto#L74"><code>List</code></a> (<a href="https://github.com/grpc/grpc-proto/pull/143">Add <code>List</code> method to gRPC Health service #143</a>) added to <code>grpc.health.v1.Health</code>. My (Ackal) healthcheck server does not yet implement it (see later).</p>
    </div>
    <a href="/posts/250612/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/gemini-code-assist/" class="link blue hover-black">
            Tag: Gemini Code Assist
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250627/" class="link black dim">
        Gemini Code Assist &#39;agent&#39; mode without `npx mcp-remote` (2/3)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Solved!</p>
<p>Ugh.</p>
<p>Before I continue, one important detail from yesterday&rsquo;s experience which I think I didn&rsquo;t clarify is that, unlike the Copilot agent, it appears (!?) that Gemini agent only supports integration with MCP servers via stdio. As a result, the only way to integrate with HTTP-based MCP servers (local or remote) is to proxy traffic through stdio as <a href="https://www.npmjs.com/package/mcp-remote"><code>mcp-remote</code></a> and the Rust example herein.</p>
<p>The most helpful change was to take a hint from the NPM <a href="https://www.npmjs.com/package/mcp-remote"><code>mcp-remote</code></a> and create a log file. This helps because, otherwise the <code>mcp-remote</code> process, because it&rsquo;s launched by Visual Studio Code, well Gemini Code Assist agent, isn&rsquo;t trivial to debug.</p>
    </div>
    <a href="/posts/250627/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250626/" class="link black dim">
        Gemini Code Assist &#39;agent&#39; mode without `npx mcp-remote` (1/3)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Former Microsoftie and Googler:</p>
<p>Good documentation <a href="https://learn.microsoft.com/en-us/microsoft-copilot-studio/agent-extend-action-mcp">Extend your agent with Model Context Protocol</a></p>
<p>Not such good documentation: <a href="https://developers.google.com/gemini-code-assist/docs/use-agentic-chat-pair-programmer">Using agentic chat as a pair programmer</a></p>
<p>Definition of &ldquo;good&rdquo; being, I was able to follow the clear instructions and it worked first time. Well done, Microsoft!</p>
<p>This space is moving so quickly and I&rsquo;m happy to alpha test these companies&rsquo; solutions but (a) Google&rsquo;s portfolio is a mess. This week I&rsquo;ve tried (and failed) to use Gemini CLI (because I don&rsquo;t want to run Node.JS on my host machine and it doesn&rsquo;t work in a container: <a href="https://github.com/google-gemini/gemini-cli/issues/1437">issue #1437</a>) and now this.</p>
    </div>
    <a href="/posts/250626/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/kube-prometheus/" class="link blue hover-black">
            Tag: Kube-Prometheus
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250620/" class="link black dim">
        Tailscale client metrics service discovery to Prometheus
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I couldn&rsquo;t summarize this in a title (even with an LLM&rsquo;s help):</p>
<p>I wanted to:</p>
<ol>
<li>Run a Tailscale service discovery agent</li>
<li>On a Tailscale node outside of the Kubernetes cluster</li>
<li>Using Podman Quadlet</li>
<li>Accessing it from the Kubernetes Cluster using the Tailscale&rsquo;s egress proxy</li>
<li>Accessing the proxy with a <code>kube-prometheus</code> <code>ScrapeConfig</code></li>
<li>In order that Prometheus would scrape the container for Tailscale client metrics</li>
</ol>
<p>Long-winded? Yes but I had an underlying need in running the Tailscale Service Discoovery remotely and this configuration helped me achieve that.</p>
    </div>
    <a href="/posts/250620/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240216/" class="link black dim">
        MicroK8s operability add-on
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Spent time today <a href="https://en.wiktionary.org/wiki/yak_shaving">yak-shaving</a> which resulted in an unplanned migration from <a href="https://microk8s.io">MicroK8s</a> &lsquo;prometheus&rsquo; <a href="https://microk8s.io/docs/addons">add-on</a> to the new and not fully-documented &lsquo;observability&rsquo; add-on:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo microk8s.enable prometheus
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>Infer repository core for addon prometheus
</span></span><span style="display:flex;"><span>DEPRECATION WARNING: &#39;prometheus&#39; is deprecated and will soon be removed. Please use &#39;observability&#39; instead.
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>The reason for the name change is unclear.</p>
<p>It&rsquo;s unclear whether there&rsquo;s a difference in the primary components that are installed too (I&rsquo;d thought Grafana wasn&rsquo;t included in &lsquo;prometheus&rsquo;), <a href="https://grafana.com/oss/loki">(Grafana) Loki</a> and <a href="https://grafana.com/oss/tempo/">(Grafana) Tempo</a> definitely weren&rsquo;t included and I don&rsquo;t want them either.</p>
    </div>
    <a href="/posts/240216/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/kubernetes/" class="link blue hover-black">
            Tag: Kubernetes
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250620/" class="link black dim">
        Tailscale client metrics service discovery to Prometheus
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I couldn&rsquo;t summarize this in a title (even with an LLM&rsquo;s help):</p>
<p>I wanted to:</p>
<ol>
<li>Run a Tailscale service discovery agent</li>
<li>On a Tailscale node outside of the Kubernetes cluster</li>
<li>Using Podman Quadlet</li>
<li>Accessing it from the Kubernetes Cluster using the Tailscale&rsquo;s egress proxy</li>
<li>Accessing the proxy with a <code>kube-prometheus</code> <code>ScrapeConfig</code></li>
<li>In order that Prometheus would scrape the container for Tailscale client metrics</li>
</ol>
<p>Long-winded? Yes but I had an underlying need in running the Tailscale Service Discoovery remotely and this configuration helped me achieve that.</p>
    </div>
    <a href="/posts/250620/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250325/" class="link black dim">
        Migrating Prometheus Exporters to Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I have built <a href="https://prometheus.io">Prometheus</a> <a href="https://prometheus.io/docs/instrumenting/exporters/">Exporters</a> for multiple cloud platforms to track resources deployed across clouds:</p>
<ul>
<li><a href="https://github.com/DazWilkin/azure-exporter">Prometheus Exporter for Azure</a></li>
<li><a href="https://github.com/DazWilkin/crtsh-exporter">Prometheus Exporter for crt.sh</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/goatcounter-exporter">Prometheus Exporter for GoatCounter</a></li>
<li><a href="https://github.com/DazWilkin/ga-exporter">Prometheus Exporter for Google Analytics</a></li>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud</a></li>
<li><a href="https://github.com/DazWilkin/koyeb-exporter">Prometheus Exporter for Koyeb</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/porkbun-exporter">Prometheus Exporter for PorkBun</a></li>
<li><a href="https://github.com/DazWilkin/updown-exporter">Prometheus Exporter for updown.io</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>Additionally, I&rsquo;ve written two status service exporters:</p>
<ul>
<li><a href="https://github.com/DazWilkin/gcp-status">Prometheus Exporter for GCP Status</a></li>
<li><a href="https://github.com/DazWilkin/vultr-status-exporter">Prometheus Exporter for Vultr Status</a></li>
</ul>
<p>These exporters are all derived from an exemplar <a href="https://github.com/metalmatze/digitalocean_exporter"><code>DigitalOcean Exporter</code></a> written by <a href="https://github.com/metalmatze">metalmatze</a> for which I maintain a <a href="https://github.com/DazWilkin/digitalocean_exporter">fork</a>.</p>
    </div>
    <a href="/posts/250325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240529/" class="link black dim">
        Using Rust to generate Kubernetes CRD
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For the first time, I chose Rust to solve a problem. Until this, I&rsquo;ve been trying to use Rust to learn the language and to rewrite existing code. But, this problem led me to Rust because my other tools wouldn&rsquo;t cut it.</p>
<p>The question was how to represent oneof fields in Kubernetes <a href="https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/">Custom Resource Definitions (CRDs)</a>.</p>
<p>CRDs use <a href="https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.0.md#schemaObject">OpenAPI</a> schema and the YAML that results can be challenging to grok.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apiextensions.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">CustomResourceDefinition</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deploymentconfigs.example.com</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">group</span>: <span style="color:#ae81ff">example.com</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">names</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">categories</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">DeploymentConfig</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">plural</span>: <span style="color:#ae81ff">deploymentconfigs</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">shortNames</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">singular</span>: <span style="color:#ae81ff">deploymentconfig</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">scope</span>: <span style="color:#ae81ff">Namespaced</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">versions</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">additionalPrinterColumns</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">v1alpha1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">schema</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">openAPIV3Schema</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">description</span>: <span style="color:#ae81ff">An example schema</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">deployment_strategy</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">oneOf</span>:
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">rolling_update</span>
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">recreate</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">recreate</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>                      <span style="color:#f92672">something</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">format</span>: <span style="color:#ae81ff">uint16</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">minimum</span>: <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">integer</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>                    - <span style="color:#ae81ff">something</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">object</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">rolling_update</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>                      <span style="color:#f92672">max_surge</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">format</span>: <span style="color:#ae81ff">uint16</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">minimum</span>: <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">integer</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#f92672">max_unavailable</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">format</span>: <span style="color:#ae81ff">uint16</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">minimum</span>: <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">integer</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>                    - <span style="color:#ae81ff">max_surge</span>
</span></span><span style="display:flex;"><span>                    - <span style="color:#ae81ff">max_unavailable</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">object</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">type</span>: <span style="color:#ae81ff">object</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">deployment_strategy</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">type</span>: <span style="color:#ae81ff">object</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">spec</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">title</span>: <span style="color:#ae81ff">DeploymentConfig</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">object</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">served</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storage</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">subresources</span>: {}
</span></span></code></pre></div><p>I&rsquo;ve developed several Kubernetes <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/operator/">Operators</a> using the <a href="https://sdk.operatorframework.io/">Operator SDK</a> in Go (which builds upon <a href="https://github.com/kubernetes-sigs/kubebuilder">Kubebuilder</a>).</p>
    </div>
    <a href="/posts/240529/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240528/" class="link black dim">
        Using Delve to debug Go containers on Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>An interesting <a href="https://stackoverflow.com/questions/78537605">question</a> on Stack overflow prompted me to understand how to use Visual Studio Code and <a href="https://github.com/go-delve/delve">Delve</a> to remotely debug a Golang app running on Kubernetes (MicroK8s).</p>
<p>The OP is using <a href="https://github.com/gin-gonic/gin">Gin</a> which was also new to me so the question gave me an opportunity to try out several things.</p>
<h2 id="sources">Sources</h2>
<p>A simple <code>healthz</code> handler:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;flag&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log/slog&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">addr</span> = <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;addr&#34;</span>, <span style="color:#e6db74">&#34;0.0.0.0:8080&#34;</span>, <span style="color:#e6db74">&#34;HTTP server endpoint&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">healthz</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">String</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusOK</span>, <span style="color:#e6db74">&#34;ok&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Parse</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/fib&#34;</span>, <span style="color:#a6e22e">handler</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;healthz&#34;</span>, <span style="color:#a6e22e">healthz</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server starting&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server error&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;err&#34;</span>, <span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">addr</span>),
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>Containerfile</code>:</p>
    </div>
    <a href="/posts/240528/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240314/" class="link black dim">
        Fly Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Interested to explore <a href="https://fly.io/docs/kubernetes/">Fly Kubernetes</a> after being accepted into the closed beta.</p>
<p>The folks at Fly are innovative in their technology uses and, having been a long-time Kubernetes user, I was intrigued to learn that Fly.io has <a href="https://fly.io/blog/fks/">implemented Kubernetes atop Fly</a>.</p>
<p>My first Deployment failed:</p>
<pre tabindex="0"><code>Authentication required to access image &#34;ghcr.io/{image}&#34;
</code></pre><p>It was confirmed to me that FKS does not support pulling from private registries. The solution is <code>pull</code>-<code>tag</code>-<code>push</code> images to <code>registry.fly.io</code> but, Fly&rsquo;s repository is app-specific and so, you need to do some querying to grab the Fly app created by FKS (for your namespace):</p>
    </div>
    <a href="/posts/240314/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240216/" class="link black dim">
        MicroK8s operability add-on
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Spent time today <a href="https://en.wiktionary.org/wiki/yak_shaving">yak-shaving</a> which resulted in an unplanned migration from <a href="https://microk8s.io">MicroK8s</a> &lsquo;prometheus&rsquo; <a href="https://microk8s.io/docs/addons">add-on</a> to the new and not fully-documented &lsquo;observability&rsquo; add-on:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo microk8s.enable prometheus
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>Infer repository core for addon prometheus
</span></span><span style="display:flex;"><span>DEPRECATION WARNING: &#39;prometheus&#39; is deprecated and will soon be removed. Please use &#39;observability&#39; instead.
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>The reason for the name change is unclear.</p>
<p>It&rsquo;s unclear whether there&rsquo;s a difference in the primary components that are installed too (I&rsquo;d thought Grafana wasn&rsquo;t included in &lsquo;prometheus&rsquo;), <a href="https://grafana.com/oss/loki">(Grafana) Loki</a> and <a href="https://grafana.com/oss/tempo/">(Grafana) Tempo</a> definitely weren&rsquo;t included and I don&rsquo;t want them either.</p>
    </div>
    <a href="/posts/240216/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230708/" class="link black dim">
        Kubernetes Python SDK w/ CRDs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Responded to <a href="https://stackoverflow.com/questions/76636443/">Get Custom K8s Resource using Python</a> and found the <a href="https://github.com/kubernetes-client/python/blob/master/kubernetes/docs/CustomObjectsApi.md"><code>CustomObjectsApi</code></a> documentation unclear.</p>
<p>If you have a cluster and a kubeconfig file with a correctly configured <code>current-context</code>, so that you can successfully:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PLURAL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checks&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl get <span style="color:#e6db74">${</span>PLURAL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--all-namespaces
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> I&rsquo;m using <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s CRDs in these examples.</p></blockquote>
<p>Then you can use the following code to access the cluster&rsquo;s REST API server to enumerate its CRDs:</p>
<p><code>main.py</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python3" data-lang="Python3"><span style="display:flex;"><span><span style="color:#f92672">from</span> __future__ <span style="color:#f92672">import</span> print_function
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> kubernetes <span style="color:#f92672">import</span> client, config
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> kubernetes.client.rest <span style="color:#f92672">import</span> ApiException
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>config<span style="color:#f92672">.</span>load_kube_config()
</span></span><span style="display:flex;"><span>api <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>CustomObjectsApi()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ackal&#39;s Group|Version and some Kinds</span>
</span></span><span style="display:flex;"><span>group <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ack.al&#39;</span>
</span></span><span style="display:flex;"><span>version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;v1&#39;</span>
</span></span><span style="display:flex;"><span>plurals <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;checks&#39;</span>,<span style="color:#e6db74">&#39;customers&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> plural <span style="color:#f92672">in</span> plurals:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        resp <span style="color:#f92672">=</span> api<span style="color:#f92672">.</span>list_cluster_custom_object(
</span></span><span style="display:flex;"><span>            group,
</span></span><span style="display:flex;"><span>            version,
</span></span><span style="display:flex;"><span>            plural,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> resp[<span style="color:#e6db74">&#34;items&#34;</span>]:
</span></span><span style="display:flex;"><span>            spec <span style="color:#f92672">=</span> item[<span style="color:#e6db74">&#34;spec&#34;</span>]
</span></span><span style="display:flex;"><span>            print(spec)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> ApiException <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(e)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 -m venv venv
</span></span><span style="display:flex;"><span>source venv/bin/activate
</span></span><span style="display:flex;"><span>python3 -m pip install kubernetes<span style="color:#f92672">==</span>26.1.0
</span></span><span style="display:flex;"><span>python3 main.py
</span></span></code></pre></div><p>That&rsquo;s all!</p>
    </div>
    <a href="/posts/230708/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230530/" class="link black dim">
        Routing Firestore events to GKE with Eventarc
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google announced <a href="https://cloud.google.com/blog/products/databases/firestore-triggers-for-cloud-run-and-google-kubernetes-engine/">Firestore &hellip; integration with Eventarc</a>. <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> uses <a href="https://cloud.google.com/firestore">Firestore</a> to persist Customer and Check information and it uses <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore-1st-gen">Google Cloud Firestore Triggers</a> to handle events on these document types.</p>
<p><a href="https://cloud.google.com/eventarc">Eventarc</a> feels like the strategic future of eventing in Google Cloud and I&rsquo;ve been concerned since adopting the technology that Google would abandon Google Cloud Firestore Triggers.</p>
<p>For this reason, when I saw last week&rsquo;s announcement, I thought I should evaluate the mechanism and this blog post is a summary of that work.</p>
    </div>
    <a href="/posts/230530/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230427/" class="link black dim">
        Robusta KRR w/ GMP
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been spending time recently optimizing <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s use of Google <a href="https://cloud.google.com/logging">Cloud Logging</a> and <a href="https://cloud.google.com/monitoring">Cloud Monitoring</a> in posts:</p>
<ul>
<li><a href="/posts/230413/">Filtering metrics w/ Google Managed Prometheus</a></li>
<li><a href="/posts/230419/">Kubernetes metrics, metrics everywhere</a></li>
<li><a href="/posts/230425/">Google Metric Diagnostics and Metric Data Ingested</a></li>
</ul>
<p>Yesterday, I read that <a href="https://home.robusta.dev/">Robusta</a> has a new open source project <a href="https://github.com/robusta-dev/krr">Kubernetes Resource Recommendations (KRR)</a> so I took some time to evaluate it.</p>
<p>This post describes the changes I had to make to get KRR working with <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Google Managed Prometheus (GMP)</a>:</p>
    </div>
    <a href="/posts/230427/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230425/" class="link black dim">
        Google Metric Diagnostics and Metric Data Ingested
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been on an efficiency drive with <a href="https://cloud.google.com/logging">Cloud Logging</a> and <a href="https://cloud.google.com/monitoring">Cloud Monitoring</a>.</p>
<p>With regards Cloud Logging, I&rsquo;m contemplating (!) eliminating almost all log storage. As it is I&rsquo;ve buzz cut log storage with a <code>_Default</code> sink that has comprehensive sets of <code>NOT LOG_ID(X)</code> inclusion and exclusion filters. As I was doing so, I began to wonder why I need to pay for the storage of much logging. There&rsquo;s the comfort from knowing that everything you may ever need is being logged (at least for 30 days) but there&rsquo;s also the costs that that entails. I use logs exclusively for debugging which got me thinking, couldn&rsquo;t I just capture logs when I&rsquo;m debugging (rather thna all the time?). I&rsquo;ve not taken that leap yet but I&rsquo;m noodling on it.</p>
    </div>
    <a href="/posts/230425/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230419/" class="link black dim">
        Kubernetes metrics, metrics everywhere
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been tinkering with ways to &ldquo;unit-test&rdquo; my assumptions when using cloud platforms. I recently wrote about good posts by Google describing achieving cost savings with Cloud Monitoring and Cloud Logging:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/management-tools/learn-to-understand-and-reduce-cloud-monitoring-costs/">How to identify and reduce costs of your Google Cloud observability in Cloud Monitoring</a></li>
<li><a href="https://cloud.google.com/blog/topics/cost-management/how-to-approach-cloud-logging-pricing-for-cloud-admins">Cloud Logging pricing for Cloud Admins: How to approach it &amp; save cost</a></li>
</ul>
<p>With Cloud Monitoring, I&rsquo;ve restricted the <code>prometheus.googleapis.com</code> metrics that are being ingested but realized I wanted to track the number of Pods (and Containers) deployed to a GKE cluster.</p>
    </div>
    <a href="/posts/230419/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230310/" class="link black dim">
        Kubernetes Operators
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> uses a Kubernetes Operator to orchestrate the lifecycle of its health checks. Ackal&rsquo;s Operator is written in Go using <a href="https://github.com/kubernetes-sigs/kubebuilder"><code>kubebuilder</code></a>.</p>
<p>Yesterday, my interest was piqued by a <a href="https://metalbear.co">MetalBear</a> blog post <a href="https://metalbear.co/blog/writing-a-kubernetes-operator/">Writing a Kubernetes Operator [in Rust]</a>. I spent some time reimplementing one of Ackal&rsquo;s CRDs (<code>Check</code>) using <a href="https://github.com/kube-rs/kube"><code>kube-rs</code></a> and not only refreshed my Rust knowledge but learned a bunch more about Kubernetes and Operators.</p>
<p>While rummaging around the Kubernetes documentation, I discovered flant&rsquo;s <a href="https://github.com/flant/shell-operator"><code>Shell-operator</code></a> and spent some time today exploring its potential.</p>
    </div>
    <a href="/posts/230310/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230215/" class="link black dim">
        Secure (TLS) gRPC services with LKE
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>NOTE</strong> <a href="https://cert-manager.io"><code>cert-manager</code></a> is a better solution to what follows.</p></blockquote>
<p>I wrote about deploying <a href="/posts/220603/">Secure (TLS) gRPC services with Vultr Kubernetes Engine (VKE)</a>. This week, I&rsquo;ve reproduced this deployment using Linode Kubernetes Engine (LKE).</p>
<p>Thanks to the consistency provided by Kubernetes, the Kubernetes programming is almost identical. The main differences are between the CLI&rsquo;s provided by these platforms. Both are good. They&rsquo;re just different.</p>
<p>I&rsquo;m going to include the <code>linode-cli</code> commands I&rsquo;m using in this post as I found it slightly more quirky.</p>
    </div>
    <a href="/posts/230215/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220603/" class="link black dim">
        Secure (TLS) gRPC services with VKE
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>NOTE</strong> <a href="https://cert-manager.io"><code>cert-manager</code></a> is a better solution to what follows.</p></blockquote>
<p>I&rsquo;ve a need to deploy a Vultr Kubernetes Engine (VKE) cluster on a daily basis (create and delete within a few hours) and expose (securely|TLS) a gRPC service.</p>
<p>I have an existing solution <a href="/posts/211130/">Automatic Certs w/ Golang gRPC service on Compute Engine</a> that combines a gRPC Healthchecking and an ACME service and decided to reuse this.</p>
<p>In order for it work, we need:</p>
    </div>
    <a href="/posts/220603/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220602/" class="link black dim">
        Vultr CLI and JSON output
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve begun exploring <a href="https://vultr.com">Vultr</a> after the company announced a managed Kubernetes offering <a href="https://www.vultr.com/kubernetes/">Vultr Kubernetes Engine (VKE)</a>.</p>
<p>In my brief experience, it&rsquo;s a decent platform and its CLI <a href="https://github.com/vultr/vultr-cli"><code>vultr-cli</code></a> is mostly (!) good. The CLI has a limitation in that command output is text formatted and this makes it challenging to parse the output when scripting.</p>
<blockquote>
<p><strong>NOTE</strong> The Vultr developers have a branch <a href="https://github.com/vultr/vultr-cli/tree/rewrite"><code>rewrite</code></a> that includes a solution to this problem.</p></blockquote>
<p>Example</p>
<pre tabindex="0"><code>ID              12345678-90ab-cdef-1234-567890abcdef
LABEL           test
DATE CREATED    2022-01-01T00:00:00+00:00
CLUSTER SUBNET  255.255.255.255/16
SERVICE SUBNET  255.255.255.255/12
IP              255.255.255.255
ENDPOINT        12345678-90ab-cdef-1234-567890abcdef.vultr-k8s.com
VERSION         v1.23.5+3
REGION          mars
STATUS          pending
 
NODE POOLS
ID              12345678-90ab-cdef-1234-567890abcdef
DATE CREATED    2022-01-01T00:00:00+00:00
DATE UPDATED    2022-01-01T00:00:00+00:00
LABEL           nodepool
TAG             foo
PLAN            vc2-1c-2gb
STATUS          pending
NODE QUANTITY   1
AUTO SCALER     false
MIN NODES       1
MAX NODES       1
 
NODES
ID                                      DATE CREATED                    LABEL                   STATUS
12345678-
</code></pre><p>Until that&rsquo;s available, I&rsquo;m lazy writing <strong>very simple</strong> bash scripts to parse <code>vultr-cli</code> command output as JSON. The repo is <a href="https://github.com/DazWilkin/vultr-cli-format"><code>vultr-cli-format</code></a>.</p>
    </div>
    <a href="/posts/220602/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210305/" class="link black dim">
        Prometheus VPA Recommendations
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Phew!</p>
<p><a href="https://en.wikipedia.org/wiki/For_Want_of_a_Nail">For Want of a Nail</a></p>
<p>I was interested in learning how to <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Manage Resources for Containers</a>. On the way, I learned and discovered:</p>
<ul>
<li><a href="#kubectl-top"><code>kubectl top</code></a></li>
<li><a href="#vertical-pod-autoscaler-vpa">Vertical Pod Autoscaler</a></li>
<li>A (valuable) digression through <a href="#digression-podmonitor">PodMonitor</a></li>
<li><a href="#kube-state-metrics"><code>kube-state-metrics</code></a></li>
<li><a href="#kubectl-patch">`kubectl-patch</a></li>
<li>Created a <a href="#graph">Graph</a></li>
<li><a href="#references">References</a></li>
</ul>
<h2 id="kubernetes-resources">Kubernetes Resources</h2>
<p>Visual Studio Code has begun to bug me (reasonably) to add <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/"><code>resources</code></a> to Kubernetes manifests.</p>
<p>E.g.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;512Mi&#34;</span>
</span></span></code></pre></div><p>I&rsquo;ve been spending time with Deislab&rsquo;s <a href="https://github.com/deislabs/akri">Akri</a> and decided to determine whether Akri&rsquo;s primary resources (Agent, Controller) and some of my creations HTTP Device and Discovery, were being suitably constrained.</p>
    </div>
    <a href="/posts/210305/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210122/" class="link black dim">
        Krustlet on DO Managed Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve spent time this week returning to the interesting Deislabs project <a href="https://github.com/deislabs/krustlet">Krustlet</a>. Since the last time, the bootstrapping process has been simplified using Kubernetes <a href="https://kubernetes.io/docs/reference/access-authn-authz/bootstrap-tokens/">Bootstrap Tokens</a>. I know this updated process <a href="https://github.com/deislabs/krustlet/blob/master/docs/howto/krustlet-on-microk8s.md">works</a> with <a href="https://microk8s.io">MicroK8s</a>. Unfortunately, I&rsquo;m struggling with it on <a href="cloud.google.com/kubernetes-engine">GKE</a> and thought I&rsquo;d try DigitalOcean Managed Kubernetes.</p>
<p>It worked first time!</p>
<p>In the following, we run both the Kubernetes cluster and the Krustlet Droplet on DigitalOcean but, as long as the cluster and the VM are able to communicate with one another, you should be able to run these anywhere.</p>
    </div>
    <a href="/posts/210122/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210108/" class="link black dim">
        Kubernetes cert-manager
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I developed an <a href="/posts/201229/">admission webhook</a> for Akri, twice (<a href="https://github.com/DazWilkin/akri-webhook">Golang</a>, <a href="https://github.com/DazWilkin/akri-webhook-rust">Rust</a>). I naively followed other examples for the generation of the certificates, created a 1.20 cluster and <a href="https://stackoverflow.com/questions/65587904/">broke</a> that process.</p>
<p>I&rsquo;d briefly considered using <a href="https://cert-manager.io"><code>cert-manager</code></a> recently but quickly abandoned the idea thinking it would be onerous and unnecessary complexity for little-old-me. I was wrong. It&rsquo;s excellent and I recommend it highly.</p>
<p>I won&rsquo;t reproduce the <code>v1beta1</code> and <code>v1</code> examples from the Stackoverflow question as they should be self-explanatory. I suspect (!?) that I should not have used Kubernete&rsquo;s (API Server&rsquo;s) CA for the Webhook but it could well be that I just don&rsquo;t understand the correct approach.</p>
    </div>
    <a href="/posts/210108/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201229/" class="link black dim">
        Kubernetes Webhooks
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I spent some time last week writing my first <a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/">admission webhook</a> for Kubernetes. I wrote the handler in Golang because I&rsquo;m most familiar with Golang and because, as Kubernetes&rsquo; native language, I was more confident that the necessary SDKs would exist and that the documentation would likely use Golang by default. I struggled to find useful documentation and so this post is to help you (and me!) remember how to do this next time!</p>
    </div>
    <a href="/posts/201229/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201217/" class="link black dim">
        Kubernetes Device Plugins
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m debugging an <a href="https://github.com/deislabs/akri/issues/177">issue</a> with Akri <code>Zeroconf</code> <a href="https://github.com/DazWilkin/akri/tree/protocol-zeroconf">protocol</a> in which Instance environment variables are no longer (!) being surfaced within the Broker pods. In my adventures, it seemed useful to better understand how Akri works and specifically, how Akri uses Kubernetes <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/device-plugins/">Device Plugins</a>.</p>
<p>IIUC plugins register with the Kubelet (!) via a gRPC service (<code>Registration</code>) that the Kubelet exposes on a UNIX socket at <code>/var/lib/kubelet/device-plugins/kubelet.sock</code></p>
<p>Then (!) if successful, devices should be reported by the Node&rsquo;s metadata (spec) and available to be bound to Pods.</p>
    </div>
    <a href="/posts/201217/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201113/" class="link black dim">
        Akri
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For the past couple of weeks, I&rsquo;ve been playing around with <a href="http://github.com/deislabs/akri">Akri</a>, a Microsoft (DeisLabs) project for <a href="https://cloudblogs.microsoft.com/opensource/2020/10/20/announcing-akri-open-source-project-building-connected-edge-kubernetes/">building a connected edge with Kubernetes</a>. Kubernetes, IoT, Rust (and Golang) make this all compelling to me.</p>
<p>Initially, I deployed an Akri <a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo.md">End-to-End</a> to <a href="https://microk8s.io/">MicroK8s</a> on Google Compute Engine (<a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo-gce.md">link</a>) and Digital Ocean (<a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo-do.md">link</a>). But I was interested to create me own example and so have proposed a very (!) simple <a href="https://github.com/DazWilkin/akri/blob/protocol-http/docs/extensibility-http.md">HTTP-based protocol</a>.</p>
<p>This blog summarizes my thoughts about Akri and an explanation of the HTTP protocol implementation in the hope that this helps others.</p>
    </div>
    <a href="/posts/201113/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201022/" class="link black dim">
        akri
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was very interested to read about Microsoft&rsquo;s DeisLab&rsquo;s latest (rust-based) Kubernetes project: <a href="https://cloudblogs.microsoft.com/opensource/2020/10/20/announcing-akri-open-source-project-building-connected-edge-kubernetes/">akri</a>. If I understand it correctly, it provides a mechanism to make any (IoT) device accessible to containers running within a cluster. I need to spend more time playing around with it so that I can fully understand it. I had some problems getting the <a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo.md">End-to-End</a> demo running on Google Compute Engine (and then I tried DigitalOcean droplet) instances. So, here&rsquo;s a two-ways solution to get you going.</p>
    </div>
    <a href="/posts/201022/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200207/" class="link black dim">
        Accessing GCR repos from Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Until today, I&rsquo;d not accessed a <a href="https://cloud.google.com/container-registry">Google Container Registry</a> repo from a <strong>non-GKE</strong> Kubernetes deployment.</p>
<p>It turns out that it&rsquo;s pretty well-documented (<a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/">link</a>) but, here&rsquo;s an end-end example.</p>
<p>Assuming:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BILLING<span style="color:#f92672">=[[</span>YOUR-BILLING<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=[[</span>YOUR-PROJECT<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>SERVER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;us.gcr.io&#34;</span>
</span></span></code></pre></div><p>If not already:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud projects create <span style="color:#f92672">{</span>$PROJECT<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud beta billing projects link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud services enable containerregistry.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><h2 id="container-registry">Container Registry</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>IMAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;busybox&#34;</span> <span style="color:#75715e"># Or ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker pull <span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker tag <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">${</span>SERVER<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker push <span style="color:#e6db74">${</span>SERVER<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud container images list-tags <span style="color:#e6db74">${</span>SERVER<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span></code></pre></div><h2 id="service-account">Service Account</h2>
<p>Create a service account that&rsquo;s permitted to download (read-only) images from this project&rsquo;s registry</p>
    </div>
    <a href="/posts/200207/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191211/" class="link black dim">
        NGINX Ingress
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a couple of deployment options (Google Compute Engine; Kubernetes) for an open-source project. The Kubernetes deployment provides <code>NodePort</code> and (TCP) <code>LoadBalancer</code> options and I&rsquo;ve been trying (unsuccessfully) to add HTTPS Load-balancing.</p>
<p>I should (!) try to deploy to <a href="https://cloud.google.com/kubernetes-engine/">Google Kubernetes Engine (GKE)</a> but I&rsquo;ve been using <a href="https://microk8s.io">microk8s</a>, Digital Ocean <a href="https://www.digitalocean.com/products/kubernetes/">Managed Kubernetes</a> and the Linode <a href="https://www.linode.com/products/kubernetes/">LKE</a> Beta. Each of these requires an implementation of Ingress controller. For GKE, GCP&rsquo;s HTTP/S Load-balancer (GCLB) is used. But, for the other services, NGINX Ingress is a good option and so I&rsquo;ve been exploring NGINX Ingress (Controller) <a href="https://kubernetes.github.io/ingress-nginx/">link</a>. This Ingress appears to work except that I&rsquo;ve been unable to get it to work with mutual TLS between the (NGINX) proxy and my backend services.</p>
    </div>
    <a href="/posts/191211/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190924/" class="link black dim">
        Kubernetes Engine and Free Tier
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google Cloud Platform <a href="https://cloud.google.com/free/">Free Tier</a> appears (<span style="color:red">please verify this for yourself</span>) to provide the ability to run a(n admittedly miniscule) Kubernetes cluster for free. So, why do this? It provides a definitive Kubernetes (Engine) experience on Google Cloud Platform that you may use for learning and testing.</p>
<p>Kubernetes Engine the master node(s) and the control plane are <a href="https://cloud.google.com/kubernetes-engine/pricing">free</a>.</p>
<p>Kubernetes (i.e. Compute Engine) nodes potentially incur charges including for the VM runtime and any attached storage, snapshots etc. However, charges for these resources can be partially covered by the Free Tier.</p>
    </div>
    <a href="/posts/190924/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/operator/" class="link blue hover-black">
            Tag: Operator
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250620/" class="link black dim">
        Tailscale client metrics service discovery to Prometheus
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I couldn&rsquo;t summarize this in a title (even with an LLM&rsquo;s help):</p>
<p>I wanted to:</p>
<ol>
<li>Run a Tailscale service discovery agent</li>
<li>On a Tailscale node outside of the Kubernetes cluster</li>
<li>Using Podman Quadlet</li>
<li>Accessing it from the Kubernetes Cluster using the Tailscale&rsquo;s egress proxy</li>
<li>Accessing the proxy with a <code>kube-prometheus</code> <code>ScrapeConfig</code></li>
<li>In order that Prometheus would scrape the container for Tailscale client metrics</li>
</ol>
<p>Long-winded? Yes but I had an underlying need in running the Tailscale Service Discoovery remotely and this configuration helped me achieve that.</p>
    </div>
    <a href="/posts/250620/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/tailscale/" class="link blue hover-black">
            Tag: Tailscale
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250620/" class="link black dim">
        Tailscale client metrics service discovery to Prometheus
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I couldn&rsquo;t summarize this in a title (even with an LLM&rsquo;s help):</p>
<p>I wanted to:</p>
<ol>
<li>Run a Tailscale service discovery agent</li>
<li>On a Tailscale node outside of the Kubernetes cluster</li>
<li>Using Podman Quadlet</li>
<li>Accessing it from the Kubernetes Cluster using the Tailscale&rsquo;s egress proxy</li>
<li>Accessing the proxy with a <code>kube-prometheus</code> <code>ScrapeConfig</code></li>
<li>In order that Prometheus would scrape the container for Tailscale client metrics</li>
</ol>
<p>Long-winded? Yes but I had an underlying need in running the Tailscale Service Discoovery remotely and this configuration helped me achieve that.</p>
    </div>
    <a href="/posts/250620/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240811/" class="link black dim">
        XML-RPC in Rust and Python
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A lazy Sunday afternoon and my interest was piqued by <a href="https://en.wikipedia.org/wiki/XML-RPC">XML-RPC</a></p>
<h2 id="client">Client</h2>
<p>A very basic XML-RPC client wrapped in a Cloud Functions function:</p>
<p><code>main.py</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python3" data-lang="python3"><span style="display:flex;"><span><span style="color:#f92672">import</span> functions_framework
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> xmlrpc.client
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>endpoint <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>get_env(<span style="color:#e6db74">&#34;ENDPOINT&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>proxy <span style="color:#f92672">=</span> xmlrpc<span style="color:#f92672">.</span>client<span style="color:#f92672">.</span>ServerProxy(endpoint)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@functions_framework.http</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add</span>(request):
</span></span><span style="display:flex;"><span>    print(request)
</span></span><span style="display:flex;"><span>    rqst <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>get_json(silent<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    resp <span style="color:#f92672">=</span> proxy<span style="color:#f92672">.</span>add(
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#34;x&#34;</span>:{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;real&#34;</span>:rqst[<span style="color:#e6db74">&#34;x&#34;</span>][<span style="color:#e6db74">&#34;real&#34;</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;imag&#34;</span>:rqst[<span style="color:#e6db74">&#34;x&#34;</span>][<span style="color:#e6db74">&#34;imag&#34;</span>]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;y&#34;</span>:{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;real&#34;</span>:rqst[<span style="color:#e6db74">&#34;y&#34;</span>][<span style="color:#e6db74">&#34;real&#34;</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;imag&#34;</span>:rqst[<span style="color:#e6db74">&#34;y&#34;</span>][<span style="color:#e6db74">&#34;imag&#34;</span>]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> resp
</span></span></code></pre></div><p><code>requirements.txt</code>:</p>
<pre tabindex="0"><code>functions-framework==3.*
</code></pre><p>Run it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 -m venv venv
</span></span><span style="display:flex;"><span>source venv/bin/activate
</span></span><span style="display:flex;"><span>python3 -m pip install --requirement requirements.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>python3 main.py
</span></span></code></pre></div><h2 id="server">Server</h2>
<p>Forcing myself to go Rust first and there&rsquo;s an (old) <a href="https://crates.io/crates/xml-rpc">xml-rpc</a> crate.</p>
    </div>
    <a href="/posts/240811/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240430/" class="link black dim">
        Securing gRPC services using Tailscale
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This is <strong>so</strong> useful that it&rsquo;s worth its own post.</p>
<p>I write many gRPC services. As these generally run securely, it&rsquo;s best to test them that way too but, even with e.g. <a href="https://letsencrypt.org/">Let&rsquo;s Encrypt</a>, it can be challenging to generate appropriate TLS certs.</p>
<p><a href="https://tailscale.com">Tailscale</a> makes this trivial.</p>
<p>Assuming there&rsquo;s a gRPC service running on <code>localhost:50051</code>, we want to avoid <code>-plaintext</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PORT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;50051&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>grpcurl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-plaintext 0.0.0.0:<span style="color:#e6db74">${</span>PORT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>list
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> I&rsquo;m using <code>list</code> and assuming your service has reflection enabled but you can, of course, use relevant methods.</p>
    </div>
    <a href="/posts/240430/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221114/" class="link black dim">
        `curl`&#39;ing a Tailscale Webhook
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>[Tailscale] is <strong>really</strong> good. I&rsquo;ve been using it as a virtual private network to span 2 home networks and to securely (!) access my hosts when I&rsquo;m remote.</p>
<p>Recently Tailscale added <a href="https://tailscale.com/kb/1213/webhooks/">Webhook</a> functionality to permit processing subscribed-to (Tailscale) events. I&rsquo;m always a sucker for a webhook ;-)</p>
<p>Here&rsquo;s a <code>curl</code> command to send a test event to  a Tailscale Webhook:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># From Tailscale&#39;s docs</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://tailscale.com/kb/1213/webhooks/#events-payload</span>
</span></span><span style="display:flex;"><span>BODY<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;timestamp&#34;: &#34;2022-09-21T13:37:51.658918-04:00&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;version&#34;: 1,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;type&#34;: &#34;test&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;tailnet&#34;: &#34;example.com&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;message&#34;: &#34;This is a test event&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;data&#34;: null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>T<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>date +%s<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>V<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  printf <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>T<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">${</span>BODY<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  | openssl dgst -sha256 -hmac <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SECRET<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> -hex -r <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  | head --bytes<span style="color:#f92672">=</span>64<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request POST <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Tailscale-Webhook-Signature:t=</span><span style="color:#e6db74">${</span>T<span style="color:#e6db74">}</span><span style="color:#e6db74">,v1=</span><span style="color:#e6db74">${</span>V<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--data <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>BODY<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>URL<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>There must be a better way of extracting the hashed value from the <code>openssl</code> output.</p>
    </div>
    <a href="/posts/221114/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/prometheus/" class="link blue hover-black">
            Tag: Prometheus
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250616/" class="link black dim">
        Prometheus MCP Server
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was unable to find a <a href="https://modelcontextprotocol.io/">Model Context Protocol (MCP)</a> server implementation for <a href="https://prometheus.io">Prometheus</a>. I had a quiet weekend and so I&rsquo;ve been writing one: <a href="https://github.com/DazWilkin/prometheus-mcp-server"><code>prometheus-mcp-server</code></a>.</p>
<p>I used the code from the <a href="/posts/250612/">MCP for gRPC Health Checking protocol</a> that I wrote about previously as a guide.</p>
<p>I wrote a series of <code>stdin</code> and HTTP tests to have confidence that the service is working correctly but I had no MCP host.</p>
<p>I discovered that <a href="https://code.visualstudio.com/">Visual Studio Code</a> through its <a href="https://marketplace.visualstudio.com/items?itemName=GitHub.copilot">GitHub Copilot</a> extension functions has a <a href="https://code.visualstudio.com/docs/copilot/chat/mcp-servers">preview to use MCP servers</a> i.e. function as an MCP host and access MCP servers.</p>
    </div>
    <a href="/posts/250616/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250325/" class="link black dim">
        Migrating Prometheus Exporters to Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I have built <a href="https://prometheus.io">Prometheus</a> <a href="https://prometheus.io/docs/instrumenting/exporters/">Exporters</a> for multiple cloud platforms to track resources deployed across clouds:</p>
<ul>
<li><a href="https://github.com/DazWilkin/azure-exporter">Prometheus Exporter for Azure</a></li>
<li><a href="https://github.com/DazWilkin/crtsh-exporter">Prometheus Exporter for crt.sh</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/goatcounter-exporter">Prometheus Exporter for GoatCounter</a></li>
<li><a href="https://github.com/DazWilkin/ga-exporter">Prometheus Exporter for Google Analytics</a></li>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud</a></li>
<li><a href="https://github.com/DazWilkin/koyeb-exporter">Prometheus Exporter for Koyeb</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/porkbun-exporter">Prometheus Exporter for PorkBun</a></li>
<li><a href="https://github.com/DazWilkin/updown-exporter">Prometheus Exporter for updown.io</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>Additionally, I&rsquo;ve written two status service exporters:</p>
<ul>
<li><a href="https://github.com/DazWilkin/gcp-status">Prometheus Exporter for GCP Status</a></li>
<li><a href="https://github.com/DazWilkin/vultr-status-exporter">Prometheus Exporter for Vultr Status</a></li>
</ul>
<p>These exporters are all derived from an exemplar <a href="https://github.com/metalmatze/digitalocean_exporter"><code>DigitalOcean Exporter</code></a> written by <a href="https://github.com/metalmatze">metalmatze</a> for which I maintain a <a href="https://github.com/DazWilkin/digitalocean_exporter">fork</a>.</p>
    </div>
    <a href="/posts/250325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250227/" class="link black dim">
        Prometheus Exporter for USGS Water Data service
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m a little obsessed with creating Prometheus Exporters:</p>
<ul>
<li><a href="https://github.com/DazWilkin/azure-exporter">Prometheus Exporter for Azure</a></li>
<li><a href="https://github.com/DazWilkin/crtsh-exporter">Prometheus Exporter for crt.sh</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/goatcounter-exporter">Prometheus Exporter for GoatCounter</a></li>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud</a></li>
<li><a href="https://github.com/DazWilkin/koyeb-exporter">Prometheus Exporter for Koyeb</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/porkbun-exporter">Prometheus Exporter for PorkBun</a></li>
<li><a href="https://github.com/DazWilkin/updown-exporter">Prometheus Exporter for updown.io</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>All of these were written to scratch an itch.</p>
<p>In the case of the cloud platform exporters (Azure, Fly, Google, Linode, Vultr etc.), it&rsquo;s an overriding anxiety that I&rsquo;ll leave resources deployed on these platforms and, running an exporter that ships alerts to <a href="https://pushover.net/">Pushover</a> and Gmail, provides me a support mechanism for me.</p>
    </div>
    <a href="/posts/250227/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240307/" class="link black dim">
        Prometheus Protobufs and Native Histograms
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I responded to a question <a href="https://stackoverflow.com/questions/78112323/prometheus-metric-protocol-buffer-in-grpc#comment137716337_78112323">Prometheus metric protocol buffer in gRPC</a> on Stackoverflow and it piqued my curiosity and got me yak shaving.</p>
<p>Prometheus used to support two exposition formats including Protocol Buffers, then dropped Protocol Buffer and has since re-added it (see <a href="https://github.com/prometheus/docs/blob/main/content/docs/instrumenting/exposition_formats.md#protobuf-format">Protobuf format</a>). The Protobuf format has returned to support the experimental <a href="https://prometheus.io/docs/prometheus/latest/feature_flags/#native-histograms">Native Histograms</a> feature.</p>
<p>I&rsquo;m interested in adding Native Histogram support to <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> so thought I&rsquo;d learn more about this metric.</p>
    </div>
    <a href="/posts/240307/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240104/" class="link black dim">
        Capturing e.g. CronJob metrics with GMP
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The deployment of <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus/exporters/kube_state_metrics">Kube State Metrics</a> for Google Managed Prometheus creates both a <code>PodMonitoring</code> and <code>ClusterPodMonitoring</code>.</p>
<p>The <code>PodMonitoring</code> resource exposes metrics published on <code>metric-self</code> port (8081).</p>
<p>The <code>ClusterPodMonitoring</code> exposes metrics published on <code>metric</code> port (8080) <strong>but</strong> this doesn&rsquo;t include <code>cronjob</code>-related metrics:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get clusterpodmonitoring/kube-state-metrics <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output<span style="color:#f92672">=</span>jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.spec.endpoints[0].metricRelabeling}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| jq -r .
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;action&#34;</span>: <span style="color:#e6db74">&#34;keep&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;regex&#34;</span>: <span style="color:#e6db74">&#34;kube_(daemonset|deployment|replicaset|pod|namespace|node|statefulset|persistentvolume|horizontalpodautoscaler|job_created)(_.+)?&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;sourceLabels&#34;</span>: [
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;__name__&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> The <code>regex</code> does <strong>not</strong> include <code>kube_cronjob</code> and only includes <code>kube_job_created</code> patterns.</p>
    </div>
    <a href="/posts/240104/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/231018/" class="link black dim">
        Prometheus Operator support an auth proxy for Service Discovery
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>CRD <a href="https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/user-guides/linting.md">linting</a></p>
<p>Returning to yesterday&rsquo;s failing tests, it&rsquo;s unclear how to introspect the E2E tests.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get namespaces
</span></span></code></pre></div><pre tabindex="0"><code>NAME                      STATUS   AGE
...
allns-s2os2u-0-90f56669   Active   22h
allns-s2qhuw-0-6b33d5eb   Active   4m23s
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--namespace<span style="color:#f92672">=</span>allns-s2os2u-0-90f56669
</span></span></code></pre></div><pre tabindex="0"><code>No resources found in allns-s2os2u-0-90f56669 namespace.
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--namespace<span style="color:#f92672">=</span>allns-s2qhuw-0-6b33d5eb
</span></span></code></pre></div><pre tabindex="0"><code>NAME                                                        READY   STATUS             RESTARTS   AGE
pod/prometheus-operator-6c96477b9c-q6qm2                    1/1     Running            0          4m12s
pod/prometheus-operator-admission-webhook-68bc9f885-nq6r8   0/1     ImagePullBackOff   0          4m7s

NAME                          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
service/prometheus-operator   ClusterIP   10.152.183.247   &lt;none&gt;        443/TCP   4m9s

NAME                                                    READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/prometheus-operator                     1/1     1            1           4m12s
deployment.apps/prometheus-operator-admission-webhook   0/1     1            0           4m7s

NAME                                                              DESIRED   CURRENT   READY   AGE
replicaset.apps/prometheus-operator-6c96477b9c                    1         1         1       4m13s
replicaset.apps/prometheus-operator-admission-webhook-68bc9f885   1         1         0       4m8s
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl logs deployment/prometheus-operator-admission-webhook <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--namespace<span style="color:#f92672">=</span>allns-s2qhuw-0-6b33d5eb
</span></span></code></pre></div><pre tabindex="0"><code>Error from server (BadRequest): container &#34;prometheus-operator-admission-webhook&#34; in pod &#34;prometheus-operator-admission-webhook-68bc9f885-nq6r8&#34; is waiting to start: trying and failing to pull image
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;prometheus-operator-admission-webhook&#34;</span>
</span></span><span style="display:flex;"><span>FILTER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.spec.template.spec.containers[?(@.name==\&#34;</span><span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;)].image}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl get deployment/prometheus-operator-admission-webhook <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--namespace<span style="color:#f92672">=</span>allns-s2qjz2-0-fad82c03 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output<span style="color:#f92672">=</span>jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>FILTER<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><pre tabindex="0"><code>quay.io/prometheus-operator/admission-webhook:52d1e55af
</code></pre><p>Want:</p>
    </div>
    <a href="/posts/231018/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/231017/" class="link black dim">
        Prometheus Operator support an auth proxy for Service Discovery
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For <code>ackalctld</code> to be deployable to Kubernetes with <a href="github.com/prometheus-operator/prometheus-operator">Prometheus Operator</a>, it is necessary to <a href="https://github.com/prometheus-operator/prometheus-operator/issues/5966">Enable <code>ScrapeConfig</code> to use (discovery|target) proxies #5966</a>. While I&rsquo;m familiar with Kubernetes, Kubernetes operators (<a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> uses one built with the <a href="">Operator SDK</a>) and <a href="https://sdk.operatorframework.io/">Prometheus Operator</a>, I&rsquo;m unfamiliar with developing Prometheus Operator. This (and subsequent) posts will document some preliminary work on this.</p>
<p>Cloned <a href="github.com/prometheus-operator/prometheus-operator">Prometheus Operator</a></p>
<p>Branched <code>scrape-config-url-proxy</code></p>
<p>I&rsquo;m unsure how to effect these changes and unsure whether documentation exists.</p>
<p>Clearly, I will need to revise the <code>ScrapeConfig</code> CRD to add the <code>proxy_url</code> fields (one <code>proxy_url</code> defines a proxy for the Service Discovery endpoint; the second defines a proxy for the targets themselves) and it would be useful for this to closely mirror the existing <a href="https://prometheus.io/docs/prometheus/latest/http_sd/">Prometheus HTTP Service Discovery</a> use, namely <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#http_sd_config"><code>,http_sd_config&gt;</code></a>:</p>
    </div>
    <a href="/posts/231017/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/231013/" class="link black dim">
        Prometheus Operator `ScrapeConfig`
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>TL;DR <a href="https://github.com/prometheus-operator/prometheus-operator/issues/5966#issuecomment-1754317247">Enable <code>ScrapeConfig</code> to use (discovery|target) proxies</a></p>
<p>I&rsquo;ve developed a companion, local daemon (called <code>ackalctld</code>) for <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> that provides a functionally close version of the service.</p>
<p>One way to deploy <code>ackalctld</code> is to use Kubernetes and it would be convenient if the Prometheus metrics were scrapeable by <a href="https://github.com/prometheus-operator/prometheus-operator">Prometheus Operator</a>.</p>
<p>In order for this to work, Prometheus Operator needs to be able to scrape Google <a href="https://cloud.google.com/run">Cloud Run</a> targets because <code>ackalctld</code> creates Cloud Run services for its health check clients.</p>
    </div>
    <a href="/posts/231013/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230709/" class="link black dim">
        Prometheus Exporter for Koyeb
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Yet another cloud platform exporter for resource|cost management. This time for <a href="https://www.koyeb.com/">Koyeb</a> with <a href="https://github.com/DazWilkin/koyeb-exporter">Koyeb Exporter</a>.</p>
<p>Deploying resources to cloud platforms generally incurs cost based on the number of resources deployed, the time each resource is deployed and the cost (per period of time) that the resource is deployed. It is useful to be able to automatically measure and alert on all the resources deployed on all the platforms that you&rsquo;re using and this is an intent of these exporters.</p>
    </div>
    <a href="/posts/230709/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230427/" class="link black dim">
        Robusta KRR w/ GMP
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been spending time recently optimizing <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s use of Google <a href="https://cloud.google.com/logging">Cloud Logging</a> and <a href="https://cloud.google.com/monitoring">Cloud Monitoring</a> in posts:</p>
<ul>
<li><a href="/posts/230413/">Filtering metrics w/ Google Managed Prometheus</a></li>
<li><a href="/posts/230419/">Kubernetes metrics, metrics everywhere</a></li>
<li><a href="/posts/230425/">Google Metric Diagnostics and Metric Data Ingested</a></li>
</ul>
<p>Yesterday, I read that <a href="https://home.robusta.dev/">Robusta</a> has a new open source project <a href="https://github.com/robusta-dev/krr">Kubernetes Resource Recommendations (KRR)</a> so I took some time to evaluate it.</p>
<p>This post describes the changes I had to make to get KRR working with <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Google Managed Prometheus (GMP)</a>:</p>
    </div>
    <a href="/posts/230427/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230425/" class="link black dim">
        Google Metric Diagnostics and Metric Data Ingested
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been on an efficiency drive with <a href="https://cloud.google.com/logging">Cloud Logging</a> and <a href="https://cloud.google.com/monitoring">Cloud Monitoring</a>.</p>
<p>With regards Cloud Logging, I&rsquo;m contemplating (!) eliminating almost all log storage. As it is I&rsquo;ve buzz cut log storage with a <code>_Default</code> sink that has comprehensive sets of <code>NOT LOG_ID(X)</code> inclusion and exclusion filters. As I was doing so, I began to wonder why I need to pay for the storage of much logging. There&rsquo;s the comfort from knowing that everything you may ever need is being logged (at least for 30 days) but there&rsquo;s also the costs that that entails. I use logs exclusively for debugging which got me thinking, couldn&rsquo;t I just capture logs when I&rsquo;m debugging (rather thna all the time?). I&rsquo;ve not taken that leap yet but I&rsquo;m noodling on it.</p>
    </div>
    <a href="/posts/230425/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230420/" class="link black dim">
        Prometheus Exporter for Azure (Container Apps)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written Prometheus Exporters for various cloud platforms. My motivation for writing these Exporters is that I want a unified mechanism to track my usage of these platform&rsquo;s services. It&rsquo;s easy to deploy a service on a platform and inadvertently leave it running (up a bill). The set of exporters is:</p>
<ul>
<li><a href="https://github.com/DazWilkin/azure-exporter">Prometheus Exporter for Azure</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for GCP</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>This post describes the recently-added Azure Exporter which only provides metrics for Container Apps and Resource Groups.</p>
    </div>
    <a href="/posts/230420/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230419/" class="link black dim">
        Kubernetes metrics, metrics everywhere
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been tinkering with ways to &ldquo;unit-test&rdquo; my assumptions when using cloud platforms. I recently wrote about good posts by Google describing achieving cost savings with Cloud Monitoring and Cloud Logging:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/management-tools/learn-to-understand-and-reduce-cloud-monitoring-costs/">How to identify and reduce costs of your Google Cloud observability in Cloud Monitoring</a></li>
<li><a href="https://cloud.google.com/blog/topics/cost-management/how-to-approach-cloud-logging-pricing-for-cloud-admins">Cloud Logging pricing for Cloud Admins: How to approach it &amp; save cost</a></li>
</ul>
<p>With Cloud Monitoring, I&rsquo;ve restricted the <code>prometheus.googleapis.com</code> metrics that are being ingested but realized I wanted to track the number of Pods (and Containers) deployed to a GKE cluster.</p>
    </div>
    <a href="/posts/230419/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230413/" class="link black dim">
        Filtering metrics w/ Google Managed Prometheus
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google has published two, very good blog posts on cost management:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/management-tools/learn-to-understand-and-reduce-cloud-monitoring-costs/">How to identify and reduce costs of your Google Cloud observability in Cloud Monitoring</a></li>
<li><a href="https://cloud.google.com/blog/topics/cost-management/how-to-approach-cloud-logging-pricing-for-cloud-admins">Cloud Logging pricing for Cloud Admins: How to approach it &amp; save cost</a></li>
</ul>
<p>This post is about my application cost reductions for Cloud Monitoring for <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>.</p>
<p>I&rsquo;m pleased with <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Google Cloud Managed Service for Prometheus</a> (hereinafter GMP). I&rsquo;ve a strong preference for letting service providers run components of <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> that I consider important but non-differentiating.</p>
    </div>
    <a href="/posts/230413/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230310/" class="link black dim">
        Kubernetes Operators
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> uses a Kubernetes Operator to orchestrate the lifecycle of its health checks. Ackal&rsquo;s Operator is written in Go using <a href="https://github.com/kubernetes-sigs/kubebuilder"><code>kubebuilder</code></a>.</p>
<p>Yesterday, my interest was piqued by a <a href="https://metalbear.co">MetalBear</a> blog post <a href="https://metalbear.co/blog/writing-a-kubernetes-operator/">Writing a Kubernetes Operator [in Rust]</a>. I spent some time reimplementing one of Ackal&rsquo;s CRDs (<code>Check</code>) using <a href="https://github.com/kube-rs/kube"><code>kube-rs</code></a> and not only refreshed my Rust knowledge but learned a bunch more about Kubernetes and Operators.</p>
<p>While rummaging around the Kubernetes documentation, I discovered flant&rsquo;s <a href="https://github.com/flant/shell-operator"><code>Shell-operator</code></a> and spent some time today exploring its potential.</p>
    </div>
    <a href="/posts/230310/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230104/" class="link black dim">
        Authenticate PromLens to Google Managed Prometheus
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Google Managed Service for Prometheus (GMP)</a> and liking it.</p>
<p>Sometime ago, I tried using <a href="https://promlens.com/">PromLens</a> with GMP but GMP&rsquo;s Prometheus HTTP API endpoint requires auth and I&rsquo;ve battled Prometheus&rsquo; somewhat limited auth mechanism before (<a href="/posts/211005/">Scraping metrics exposed by Google Cloud Run services that require authentication</a>).</p>
<p>Listening to <a href="https://promcon.io/2022-munich/schedule/">PromCon EU 2022</a> videos, I learned that PromLens has been <a href="https://promlabs.com/blog/2022/10/25/promlabs-and-chronosphere-open-source-the-promlens-query-builder">open sourced</a> and contributed to the Prometheus project. Eventually, the functionality of PromLens should be combined into the Prometheus UI.</p>
    </div>
    <a href="/posts/230104/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220520/" class="link black dim">
        Prometheus Exporters for fly.io and Vultr
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been on a roll building utilities this week. I developed a Service Health dashboard for my &ldquo;thing&rdquo;, a <a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a> and today, a <a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a>. This is motivated by the fear that I will forget a deployed Cloud resource and incur a horrible bill.</p>
<p>I&rsquo;ve no written several Prometheus Exporters for cloud platforms:</p>
<ul>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for GCP</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>Each of them monitors resource deployments and produces resource count metrics that can be scraped by Prometheus and alerted with Alertmanager. I have Alertmanager <a href="https://prometheus.io/docs/alerting/latest/configuration/#pushover_config">configured</a> to send notifications to <a href="https://pushover.net">Pushover</a>. Last week I wrote an integration between <a href="/posts/220514/">Google Cloud Monitoring to send notifications to Pushover</a> too.</p>
    </div>
    <a href="/posts/220520/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220225/" class="link black dim">
        Prometheus HTTP Service Discovery of Cloud Run services
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Some time ago, I wrote about using <a href="https://pretired.dazwilkin.com/posts/210419/">Prometheus Service Discovery w/ Consul for Cloud Run</a> and also <a href="https://pretired.dazwilkin.com/posts/211005/">Scraping metrics exposed by Google Cloud Run services that require authentication</a>. Both solutions remain viable but they didn&rsquo;t address another use case for Prometheus and Cloud Run services that I have with a &ldquo;thing&rdquo; that I&rsquo;ve been building.</p>
<p>In this scenario, I want to:</p>
<ol>
<li>Configure Prometheus to scrape Cloud Run service metrics</li>
<li>Discover Cloud Run services dynamically</li>
<li>Authenticate to Cloud Run using Firebase Auth ID tokens</li>
</ol>
<p>These requirements and &ndash; one other &ndash; present several challenges:</p>
    </div>
    <a href="/posts/220225/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211005/" class="link black dim">
        Scraping metrics exposed by Google Cloud Run services that require authentication
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a solution (<a href="https://github.com/DazWilkin/gcp-oidc-token-proxy"><code>gcp-oidc-token-proxy</code></a>) that can be used in conjunction with Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#oauth2">OAuth2</a> to authenticate requests so that Prometheus can scrape metrics exposed by e.g. Cloud Run services that require authentication. The solution resulted from my <a href="https://stackoverflow.com/questions/69411584/is-there-a-way-to-configure-prometheus-to-use-a-google-service-account-to-auth">question</a> on Stack overflow.</p>
<p>Problem #1: Endpoint requires authentication</p>
<p>Given a Cloud Run service URL for which:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;my-server-blahblah-wl.a.run.app&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Returns 200 when authentication w/ an ID token</span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>gcloud auth print-identity-token<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request GET <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--write-out <span style="color:#e6db74">&#34;%{response_code}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output /dev/null <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span>/metrics
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Returns 403 otherwise</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request GET <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--write-out <span style="color:#e6db74">&#34;%{response_code}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output /dev/null <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span>/metrics
</span></span></code></pre></div><p>Problem #2: Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#oauth2">OAuth2</a> configuration is constrained</p>
    </div>
    <a href="/posts/211005/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210520/" class="link black dim">
        Consul discovers Google Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a basic <code>discoverer</code> of Google <a href="https://cloud.google.com/run">Cloud Run</a> services. This is for a project and it extends work done in some previous posts to <a href="/posts/210519/">Multiplex gRPC and Prometheus with Cloud Run</a> and to use <a href="/posts/210419/">Consul for Prometheus service discovery</a>.</p>
<p>This solution:</p>
<ul>
<li>Accepts a set of Google Cloud Platform (GCP) projects</li>
<li>Trawls them for Cloud Run services</li>
<li>Assumes that the services expose Prometheus metrics on <code>:443/metrics</code></li>
<li>Relabels the services</li>
<li>Surfaces any discovered Cloud Run services&rsquo; metrics in Prometheus</li>
</ul>
<p>You&rsquo;ll need Docker and Docker Compose.</p>
    </div>
    <a href="/posts/210520/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210519/" class="link black dim">
        Multiplexing gRPC and HTTP (Prometheus) endpoints with Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google <a href="https://cloud.google.com/run">Cloud Run</a> is useful but, each service is limited to exposing a single port. This caused me problems with a gRPC service that serves (non-gRPC) Prometheus metrics because customarily, you would serve gRPC on one port and the Prometheus metrics on another.</p>
<p>Fortunately, <a href="https://github.com/soheilhy/cmux">cmux</a> provides a solution by providing a mechanism that multiplexes both services (gRPC and HTTP) on a single port!</p>
<blockquote>
<p><strong>TL;DR</strong> See the cmux <a href="https://github.com/soheilhy/cmux#limitations">Limitations</a> and use:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#a6e22e">grpcl</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">MatchWithWriters</span>(
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">cmux</span>.<span style="color:#a6e22e">HTTP2MatchHeaderFieldSendSettings</span>(<span style="color:#e6db74">&#34;content-type&#34;</span>, <span style="color:#e6db74">&#34;application/grpc&#34;</span>))
</span></span></code></pre></div></blockquote>
<p>Extending the <a href="https://github.com/soheilhy/cmux#how-to">example</a> from the cmux repo:</p>
    </div>
    <a href="/posts/210519/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210419/" class="link black dim">
        Prometheus Service Discovery w/ Consul for Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m working on a project that will programmatically create Google <a href="https://cloud.google.com/run">Cloud Run</a> services and I want to be able to dynamically discover these services using Prometheus.</p>
<p>This is one solution.</p>
<blockquote>
<p><strong>NOTE</strong> Google Cloud Run is the service I&rsquo;m using, but the principle described herein applies to any runtime service that you&rsquo;d wish to use.</p></blockquote>
<p>Why is this challenging? IIUC, it&rsquo;s primarily because Prometheus has a limited set of plugins for service discovery, see the sections that include <code>_sd_</code> in Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/">Configuration</a> documentation. Unfortunately, Cloud Run is not explicitly supported. The alternative appears to be to use file-based discovery but this seems &lsquo;challenging&rsquo;; it requires, for example, reloading Prometheus on file changes.</p>
    </div>
    <a href="/posts/210419/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210305/" class="link black dim">
        Prometheus VPA Recommendations
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Phew!</p>
<p><a href="https://en.wikipedia.org/wiki/For_Want_of_a_Nail">For Want of a Nail</a></p>
<p>I was interested in learning how to <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Manage Resources for Containers</a>. On the way, I learned and discovered:</p>
<ul>
<li><a href="#kubectl-top"><code>kubectl top</code></a></li>
<li><a href="#vertical-pod-autoscaler-vpa">Vertical Pod Autoscaler</a></li>
<li>A (valuable) digression through <a href="#digression-podmonitor">PodMonitor</a></li>
<li><a href="#kube-state-metrics"><code>kube-state-metrics</code></a></li>
<li><a href="#kubectl-patch">`kubectl-patch</a></li>
<li>Created a <a href="#graph">Graph</a></li>
<li><a href="#references">References</a></li>
</ul>
<h2 id="kubernetes-resources">Kubernetes Resources</h2>
<p>Visual Studio Code has begun to bug me (reasonably) to add <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/"><code>resources</code></a> to Kubernetes manifests.</p>
<p>E.g.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;512Mi&#34;</span>
</span></span></code></pre></div><p>I&rsquo;ve been spending time with Deislab&rsquo;s <a href="https://github.com/deislabs/akri">Akri</a> and decided to determine whether Akri&rsquo;s primary resources (Agent, Controller) and some of my creations HTTP Device and Discovery, were being suitably constrained.</p>
    </div>
    <a href="/posts/210305/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201008/" class="link black dim">
        Deploying a Rust HTTP server to DigitalOcean App Platform
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://digitalocean.com">DigitalOcean</a> launched an <a href="https://www.digitalocean.com/blog/introducing-digitalocean-app-platform-reimagining-paas-to-make-it-simpler-for-you-to-build-deploy-and-scale-apps">App Platform</a> with many <a href="https://www.digitalocean.com/docs/app-platform/languages-frameworks/">Supported Languages and Frameworks</a>. I used <a href="https://www.digitalocean.com/docs/app-platform/languages-frameworks/go/">Golang</a> first, then wondered how to use non-natively-supported languages, i.e. Rust.</p>
<p>The good news is that <a href="https://www.digitalocean.com/docs/app-platform/languages-frameworks/docker/">Docker</a> is a supported framework and so, you can run pretty much anything.</p>
<p>Repo: <a href="https://github.com/DazWilkin/do-apps-rust">https://github.com/DazWilkin/do-apps-rust</a></p>
<h2 id="rust">Rust</h2>
<p>I&rsquo;m a Rust noob. I&rsquo;m always receptive to feedback on improvements to the code. I looked to mirror the Golang example. I&rsquo;m using <a href="https://crates.io/crates/rocket">rocket</a> and <a href="https://crates.io/crates/rocket-prometheus">rocket-prometheus</a> for the first time:</p>
<p>You will want to install rust nightly (as Rocket has a dependency that requires it) and then you can override the default toolchain for the current project using:</p>
    </div>
    <a href="/posts/201008/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200107/" class="link black dim">
        Google Home Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m obsessing over Prometheus exporters. First came <a href="/posts/191218/">Linode Exporter</a>, then <a href="/posts/191220/">GCP Exporter</a> and, on Sunday, I stumbled upon a reverse-engineered <a href="https://rithvikvibhu.github.io/GHLocalApi/">API for Google Home</a> devices and so wrote a very basic <a href="https://github.com/DazWilkin/gohome">Google Home SDK</a> and a similarly basic <a href="https://github.com/DazWilkin/home-exporter">Google Home Exporter</a>:</p>
<p><img src="/images/200107.home-exporter.png" alt="Prometheus Graphs"></p>
<p>The SDK only implements <code>/setup/eureka_info</code> and then only some of the returned properties. There&rsquo;s not a lot of metric-like data to use besides <code>SignalLevel</code> (<code>signal_level</code>) and <code>NoiseLevel</code> (<code>noise_level</code>). I&rsquo;m not clear on the meaning of some of the properties.</p>
    </div>
    <a href="/posts/200107/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191220/" class="link black dim">
        Google Cloud Platform (GCP) Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Earlier this week I discussed a <a href="/posts/191218/">Linode Prometheus Exporter</a>.</p>
<p>I <a href="https://github.com/metalmatze/digitalocean_exporter/pull/5">added</a> metrics for <a href="https://www.digitalocean.com/products/kubernetes/">Digital Ocean&rsquo;s Managed Kubernetes service</a> to <a href="https://github.com/metalmatze">@metalmatze</a>&rsquo;s <a href="https://github.com/metalmatze/digitalocean_exporter">Digital Ocean Exporter</a>.</p>
<p>This left, metrics for <a href="https://cloud.google.com">Google Cloud Platform (GCP)</a> which has, for many years, been my primary cloud platform. So, today I wrote <a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud Platform</a>.</p>
<p>All 3 of these exporters follow the template laid down by @metalmatze and, because each of these services has a well-written Golang SDK, it&rsquo;s straightforward to implement an exporter for each of them.</p>
    </div>
    <a href="/posts/191220/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191219/" class="link black dim">
        Prometheus AlertManager
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Yesterday I discussed a <a href="/posts/191218/">Linode Prometheus Exporter</a> and tantalized use of Prometheus AlertManager.</p>
<p>Success:</p>
<p><img src="/images/191219.alertmanager.gmail.png" alt="Gmail Alert"></p>
<h2 id="configure">Configure</h2>
<p>The process is straightforward although I found the Prometheus (config) documentation slightly unwieldy to navigate :-(</p>
<p>The overall process is <a href="https://prometheus.io/docs/alerting/overview/">documented</a>.</p>
<p>Here are the steps I took:</p>
<ul>
<li><a href="#configure-prometheus">Configure Prometheus</a></li>
<li><a href="#configure-alertmanager">Configure AlertManager</a></li>
<li><a href="#revise-docker-compose">Revise Docker Compose</a></li>
</ul>
<h3 id="configure-prometheus">Configure Prometheus</h3>
<p>Added the following to <code>prometheus.yml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#f92672">rule_files</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#e6db74">&#34;/etc/alertmanager/rules/linode.yml&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">alerting</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">alertmanagers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">http</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">static_configs</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">targets</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#e6db74">&#34;alertmanager:9093&#34;</span>
</span></span></code></pre></div><p>Rules must be defined in separate rules files. See below for the content for <code>linode.yml</code> and an explanation.</p>
    </div>
    <a href="/posts/191219/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191218/" class="link black dim">
        Linode Prometheus Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I enjoy using <a href="https://prometheus.io">Prometheus</a> and have toyed around with it for some time particularly in combination with Kubernetes. I signed up with <a href="https://www.linode.com/?r=9ab7d75b764e143a1b3b467390c852b2c56cd704">Linode</a> [referral] compelled by the addition of a managed Kubernetes service called <a href="https://www.linode.com/products/kubernetes/">Linode Kubernetes Engine (LKE)</a>. I have an anxiety that I&rsquo;ll inadvertently leave resources running (unused) on a cloud platform. Instead of refreshing the relevant billing page, it struck me that Prometheus may (not yet proven) help.</p>
<p>The hypothesis is that a combination of a cloud-specific Prometheus <a href="https://prometheus.io/docs/instrumenting/exporters/">exporter</a> reporting aggregate uses of e.g. Linodes (instances), NodeBalancers, Kubernetes clusters etc., could form the basis of an alert mechanism using Prometheus&rsquo; <a href="https://prometheus.io/docs/alerting/overview/">alerting</a>.</p>
    </div>
    <a href="/posts/191218/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/grpc/" class="link blue hover-black">
            Tag: GRPC
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250612/" class="link black dim">
        MCP for gRPC Health Checking protocol
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://modelcontextprotocol.io/introduction">Model Context Protocol (MCP)</a> is &ldquo;all the rage&rdquo; these days.</p>
<p>I stumbled upon <a href="https://github.com/redpanda-data/protoc-gen-go-mcp"><code>protoc-gen-go-mcp</code></a> and think it&rsquo;s an elegant application of two technologies: programmatically generating an MCP server from a gRPC protobuf.</p>
<p>I&rsquo;m considering building an MCP server for <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> but, thought I&rsquo;d start with something simple: <a href="https://grpc.io/docs/guides/health-checking/">gRPC Health Checking protocol</a>.</p>
<p>I was surprised to learn as I was doing this that there&rsquo;s a new <a href="https://github.com/grpc/grpc-proto/blob/23f5b568eefcb876e6ebc3b01725f1f20cff999e/grpc/health/v1/health.proto#L74"><code>List</code></a> (<a href="https://github.com/grpc/grpc-proto/pull/143">Add <code>List</code> method to gRPC Health service #143</a>) added to <code>grpc.health.v1.Health</code>. My (Ackal) healthcheck server does not yet implement it (see later).</p>
    </div>
    <a href="/posts/250612/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250429/" class="link black dim">
        Configuring Envoy to proxy Google Cloud Run v2
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m building an emulator for <a href="https://cloud.google.com/run">Cloud Run</a>. As I considered the solution, I assumed (more later) that I could implement Google&rsquo;s gRPC interface for <a href="https://github.com/googleapis/googleapis/tree/83df85b45a5d3e85b48f2571e1c8e57cdfd57e6c/google/cloud/run">Cloud Run</a> and use <a href="https://www.envoyproxy.io/">Envoy</a> to proxy HTTP/REST requests to the gRPC service using Envoy&rsquo;s <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/grpc_json_transcoder_filter">gRPC-JSON transcoder</a>.</p>
<p>Google calls this process <a href="https://cloud.google.com/endpoints/docs/grpc/transcoding">Transcoding HTTP/JSON to gRPC</a> which I think it a better description.</p>
<p>Google&rsquo;s Cloud Run <code>v2</code> (<code>v1</code> is no longer published to the <a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a> repo) <a href="https://github.com/googleapis/googleapis/blob/83df85b45a5d3e85b48f2571e1c8e57cdfd57e6c/google/cloud/run/v2/service.proto"><code>service.proto</code></a> includes the following <code>Services</code> definition for <code>CreateService</code>:</p>
    </div>
    <a href="/posts/250429/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250213/" class="link black dim">
        gRPC Firestore `Listen` in Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Obsessing on <a href="/posts/250210/">gRPC Firestore <code>Listen</code></a> somewhat but it&rsquo;s also a good learning opportunity for me to write stuff in Rust. This doesn&rsquo;t work against Google&rsquo;s public endpoint (possibly for the same reason that gRPCurl doesn&rsquo;t work either) but this does work against the Go server described in the other post.</p>
<p>I&rsquo;m also documenting here because I always encounter challenges using TLS with Rust (and this documents 2 working ways to do this with gRPC) as well as references two interesting (rust) examples that use Google services.</p>
    </div>
    <a href="/posts/250213/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250210/" class="link black dim">
        gRPC Firestore `Listen`
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A question on Stack overflow <a href="https://stackoverflow.com/questions/79422094">Firestore gRPC Listen does not send deletions</a> piqued by interest but created a second problem for me: I&rsquo;m unable to get its <a href="https://cloud.google.com/firestore/docs/reference/rpc/google.firestore.v1#google.firestore.v1.Firestore.Listen"><code>Listen</code></a> method to work using <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a>.</p>
<p>For what follows, you will need:</p>
<ol>
<li>a Google Project with Firestore enabled and a database (default: <code>(default)</code>) containing a Collection (e.g. <code>Dogs</code>) with at least one Document (e.g. <code>freddie</code>)</li>
<li><a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a> cloned locally in order to access Protobufs</li>
</ol>
<h2 id="summary">Summary</h2>
<table>
  <thead>
      <tr>
          <th>client</th>
          <th>server</th>
          <th>R</th>
          <th>See</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>gRPCurl</code></td>
          <td><code>firestore.googleapis.com:443</code></td>
          <td>✅</td>
          <td><a href="#grpcurl-listen-against-google-endpoint">link</a></td>
      </tr>
      <tr>
          <td>Go client</td>
          <td><code>firestore.googleapis.com:443</code></td>
          <td>✅</td>
          <td><a href="#go-client-listen-against-google-endpoint">link</a></td>
      </tr>
      <tr>
          <td><code>gRPCurl</code></td>
          <td>Go server</td>
          <td>✅</td>
          <td><a href="#grpcurl-listen-against-go-server">link</a></td>
      </tr>
      <tr>
          <td>Go client</td>
          <td>Go server</td>
          <td>✅</td>
          <td><a href="#go-client-listen-against-go-server">link</a></td>
      </tr>
  </tbody>
</table>
<p>I subsequently tried this using <a href="https://www.postman.com/">Postman</a> and it also works (✅).</p>
    </div>
    <a href="/posts/250210/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240927/" class="link black dim">
        Cloud Run with a gRPC probe
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Cloud Run supports <a href="https://cloud.google.com/run/docs/configuring/healthchecks">gRPC startup|liveness probes</a> which I&rsquo;d not used before.</p>
<p>I&rsquo;m using <a href="https://cloud.google.com/run/docs/reference/rest">Cloud Run</a> v2 and specifically <a href="https://cloud.google.com/run/docs/reference/rest/v2/projects.locations.services/create"><code>projects.locations.services.create</code></a> and <a href="https://cloud.google.com/run/docs/reference/rest/v2/projects.locations.services#Service"><code>Service</code></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>REGION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>REPO<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;..&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Must be in an Artifact Registry repo</span>
</span></span><span style="display:flex;"><span>IMAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span><span style="color:#e6db74">-docker.pkg.dev/</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>REPO<span style="color:#e6db74">}</span><span style="color:#e6db74">/...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Run v2</span>
</span></span><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://run.googleapis.com/v2&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PARENT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;projects/</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">/locations/</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SERVICE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span></code></pre></div><p>I like to use <a href="https://jsonnet.org/">Jsonnet</a> (specifically <a href="https://github.com/google/go-jsonnet"><code>go-jsonnet</code></a>) to help templating Kubernetes(-like) deployments.</p>
<p><code>cloudrun.jsonnet</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsonnet" data-lang="jsonnet"><span style="display:flex;"><span><span style="color:#66d9ef">local</span> project <span style="color:#f92672">=</span> std.extVar(<span style="color:#e6db74">&#34;project&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> region <span style="color:#f92672">=</span> std.extVar(<span style="color:#e6db74">&#34;region&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> service <span style="color:#f92672">=</span> std.extVar(<span style="color:#e6db74">&#34;service&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> image <span style="color:#f92672">=</span> std.extVar(<span style="color:#e6db74">&#34;image&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> port <span style="color:#f92672">=</span> <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> health_checking_service <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;labels&#34;:{
</span></span><span style="display:flex;"><span>        &#34;type&#34;: <span style="color:#e6db74">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;annotations&#34;: {
</span></span><span style="display:flex;"><span>        &#34;type&#34;: <span style="color:#e6db74">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;template&#34;:{
</span></span><span style="display:flex;"><span>        &#34;containers&#34;: {
</span></span><span style="display:flex;"><span>            &#34;name&#34;: service,
</span></span><span style="display:flex;"><span>            &#34;image&#34;: image,
</span></span><span style="display:flex;"><span>            &#34;args&#34;: [],
</span></span><span style="display:flex;"><span>            &#34;resources&#34;: {
</span></span><span style="display:flex;"><span>                &#34;limits&#34;: {
</span></span><span style="display:flex;"><span>                    &#34;cpu&#34;: <span style="color:#e6db74">&#34;1000m&#34;</span>,
</span></span><span style="display:flex;"><span>                    &#34;memory&#34;: <span style="color:#e6db74">&#34;512Mi&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            &#34;ports&#34;: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    &#34;name&#34;: <span style="color:#e6db74">&#34;http1&#34;</span>,
</span></span><span style="display:flex;"><span>                    &#34;containerPort&#34;: port
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            &#34;startupProbe&#34;: {
</span></span><span style="display:flex;"><span>                &#34;grpc&#34;: {
</span></span><span style="display:flex;"><span>                    &#34;port&#34;: port,
</span></span><span style="display:flex;"><span>                    &#34;service&#34;: health_checking_service
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;scaling&#34;: {
</span></span><span style="display:flex;"><span>            &#34;maxInstanceCount&#34;: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And deploy it using:</p>
    </div>
    <a href="/posts/240927/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240430/" class="link black dim">
        Securing gRPC services using Tailscale
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This is <strong>so</strong> useful that it&rsquo;s worth its own post.</p>
<p>I write many gRPC services. As these generally run securely, it&rsquo;s best to test them that way too but, even with e.g. <a href="https://letsencrypt.org/">Let&rsquo;s Encrypt</a>, it can be challenging to generate appropriate TLS certs.</p>
<p><a href="https://tailscale.com">Tailscale</a> makes this trivial.</p>
<p>Assuming there&rsquo;s a gRPC service running on <code>localhost:50051</code>, we want to avoid <code>-plaintext</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PORT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;50051&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>grpcurl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-plaintext 0.0.0.0:<span style="color:#e6db74">${</span>PORT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>list
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> I&rsquo;m using <code>list</code> and assuming your service has reflection enabled but you can, of course, use relevant methods.</p>
    </div>
    <a href="/posts/240430/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240409/" class="link black dim">
        Google Cloud Translation w/ gRPC 3 ways
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="general">General</h2>
<p>You&rsquo;ll need a Google Cloud project with Cloud Translation (<code>translate.googleapis.com</code>) enabled and a Service Account (and key) with suitable permissions in order to run the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BILLING<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Billing ID (gcloud billing accounts list)</span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Project ID</span>
</span></span><span style="display:flex;"><span>ACCOUNT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tester&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>EMAIL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span><span style="color:#e6db74">@</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">.iam.gserviceaccount.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ROLES<span style="color:#f92672">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/cloudtranslate.user&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/serviceusage.serviceUsageConsumer&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Project</span>
</span></span><span style="display:flex;"><span>gcloud projects create <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Associate Project with your Billing Account</span>
</span></span><span style="display:flex;"><span>gcloud billing accounts link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Enable Cloud Translation</span>
</span></span><span style="display:flex;"><span>gcloud services enable translate.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts create <span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account Key</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts keys create <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--iam-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update Project IAM permissions</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ROLE in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ROLES[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  gcloud projects add-iam-policy-binding <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --member<span style="color:#f92672">=</span>serviceAccount:<span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>ROLE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>For the code, you&rsquo;ll need to install <a href="https://github.com/protocolbuffers/protobuf"><code>protoc</code></a> and preferably have it in your path.</p>
    </div>
    <a href="/posts/240409/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240307/" class="link black dim">
        Prometheus Protobufs and Native Histograms
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I responded to a question <a href="https://stackoverflow.com/questions/78112323/prometheus-metric-protocol-buffer-in-grpc#comment137716337_78112323">Prometheus metric protocol buffer in gRPC</a> on Stackoverflow and it piqued my curiosity and got me yak shaving.</p>
<p>Prometheus used to support two exposition formats including Protocol Buffers, then dropped Protocol Buffer and has since re-added it (see <a href="https://github.com/prometheus/docs/blob/main/content/docs/instrumenting/exposition_formats.md#protobuf-format">Protobuf format</a>). The Protobuf format has returned to support the experimental <a href="https://prometheus.io/docs/prometheus/latest/feature_flags/#native-histograms">Native Histograms</a> feature.</p>
<p>I&rsquo;m interested in adding Native Histogram support to <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> so thought I&rsquo;d learn more about this metric.</p>
    </div>
    <a href="/posts/240307/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240117/" class="link black dim">
        Gnarly Protocol Buffers compilation
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This Stackoverflow question piqued my interest:</p>
<p><a href="https://stackoverflow.com/questions/77829333/retry-policy-configuration-for-grpc-not-working">retry policy configuration for grpc not working</a></p>
<p><a href="https://github.com/grpc/grpc/blob/master/doc/service_config.md">Service Config in gRPC</a> is new to me but, my initial suspicion (albeit incorrect) was that the JSON types were incorrect.</p>
<p>I decided to try using the Protocol Buffer source <a href="https://github.com/grpc/grpc-proto/blob/master/grpc/service_config/service_config.proto"><code>service_config.proto</code></a> to verify the JSON.</p>
<p>To do so I needed to compile the source&hellip;. it was gnarly.</p>
<p>There are 2 repos used:</p>
<ul>
<li><a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a></li>
<li><a href="https://github.com/grpc/grpc-proto"><code>grpc-proto</code></a></li>
</ul>
<p>The <code>service_config.proto</code> includes <code>options</code> for <code>java_package</code> but no <code>go_package</code>.</p>
    </div>
    <a href="/posts/240117/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/231222/" class="link black dim">
        Listing Cloud Logging log-based metrics using gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Referring to <a href="/posts/230314/">Accessing Google Services using gRPC</a>, I wanted to query a project&rsquo;s <a href="https://cloud.google.com/logging">Cloud Logging</a> for <a href="https://cloud.google.com/logging/docs/logs-based-metrics">log-based metrics</a> using gRPC.</p>
<p>In summary:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;logging.googleapis.com:443&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ROOT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/googleapis&#34;</span> <span style="color:#75715e"># https://github.com/googleapis/googleapis</span>
</span></span><span style="display:flex;"><span>PACKAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;google/logging/v2&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># NB Not logging.proto</span>
</span></span><span style="display:flex;"><span>PROTO<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ROOT<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>PACKAGE<span style="color:#e6db74">}</span><span style="color:#e6db74">/logging_metrics.proto&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>gcloud auth print-access-token<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PACKAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;google.logging.v2&#34;</span>
</span></span><span style="display:flex;"><span>SERVICE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MetricsServiceV2&#34;</span>
</span></span><span style="display:flex;"><span>METHOD<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>PACKAGE<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">${</span>SERVICE<span style="color:#e6db74">}</span><span style="color:#e6db74">/ListLogMetrics&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ListLogMetricsRequest fields</span>
</span></span><span style="display:flex;"><span>PARENT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;projects/</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>grpcurl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--import-path<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>ROOT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--proto<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROTO<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-H <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-d <span style="color:#e6db74">&#34;{\&#34;parent\&#34;: \&#34;</span><span style="color:#e6db74">${</span>PARENT<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span> <span style="color:#e6db74">${</span>METHOD<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>From <a href="https://developers.google.com/apis-explorer">APIs Explorer</a>, <a href="https://cloud.google.com/logging/docs/reference/api-overview">Cloud Logging API v2</a>, instead of the <a href="https://cloud.google.com/logging/docs/reference/v2/rest">REST reference</a>, browse the <a href="https://cloud.google.com/logging/docs/reference/v2/rpc">gRPC reference</a> specifically the package <a href="https://cloud.google.com/logging/docs/reference/v2/rpc/google.logging.v2"><code>google.logging.v2</code></a> which includes <a href="https://cloud.google.com/logging/docs/reference/v2/rpc/google.logging.v2#google.logging.v2.MetricsServiceV2"><code>MetricsServiceV2</code></a>. We&rsquo;re interested in the <code>ListLogMetrics</code> method (which unfortunately isn&rsquo;t directly hyperlinkable) but is defined to be:</p>
    </div>
    <a href="/posts/231222/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230404/" class="link black dim">
        Azure Container Apps
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The majority of <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s components are deployed to <a href="https://cloud.google.com">Google Cloud</a>. However, by its nature, Ackal benefits from deployments that span cloud platforms. I&rsquo;ve deployed Ackal&rsquo;s <a href="https://grpc.io">gRPC</a> <a href="https://github.com/grpc/grpc/blob/master/doc/health-checking.md">health checks</a> to <a href="https://fly.io">Fly</a>, and managed Kubernetes services on <a href="https://linode.com">Linode</a> and <a href="https://vultr.com">Vultr</a>.</p>
<p>Today, I decided to revisit<a href="#microsoft">¹</a> <a href="https://azure.microsoft.com">Azure</a>. Ackal uses Azure (Active Directory) for one of its OAuth providers. This time, I wanted to deploy a containerized gRPC service. Azure provides <a href="https://azure.microsoft.com/en-us/products/category/containers/">several</a> container-oriented services. I decided to use <a href="https://azure.microsoft.com/en-us/products/container-apps/">Azure Container Apps</a> and, in hindsight, find it analogous to Google <a href="https://cloud.google.com/run">Cloud Run</a>.</p>
    </div>
    <a href="/posts/230404/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230314/" class="link black dim">
        Access Google Services using gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google publishes interface definitions of Google APIs (services) that support REST and gRPC in a repo called <a href="https://github.com/googleapis/googleapis">Google APIs</a>. Google&rsquo;s SDKs uses gRPC to access these services but, how to do this using e.g. <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a>?</p>
<p>I wanted to debug <a href="https://cloud.google.com/profiler/docs">Cloud Profiler</a> and its agent makes <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L83"><code>UpdateProfile</code></a> RPCs to <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L41"><code>cloudprofiler.googleapis.com</code></a>. Cloud Profiler is more challenging service to debug because (a) it&rsquo;s publicly &ldquo;write-only&rdquo;; and (b) it has complex messages. <code>UpdateProfile</code> sends <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L123"><code>UpdateProfileRequest</code></a> messages that include <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L123"><code>Profile</code></a> messages that include <code>profile_bytes</code> which are gzip compressed serialized protos of <a href="https://github.com/google/pprof">pprof</a>&rsquo;s <a href="https://github.com/google/pprof/blob/d61513b1440d93d62aad023cc60d7a33f3917b70/proto/profile.proto#L46"><code>Profile</code></a>.</p>
    </div>
    <a href="/posts/230314/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230215/" class="link black dim">
        Secure (TLS) gRPC services with LKE
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>NOTE</strong> <a href="https://cert-manager.io"><code>cert-manager</code></a> is a better solution to what follows.</p></blockquote>
<p>I wrote about deploying <a href="/posts/220603/">Secure (TLS) gRPC services with Vultr Kubernetes Engine (VKE)</a>. This week, I&rsquo;ve reproduced this deployment using Linode Kubernetes Engine (LKE).</p>
<p>Thanks to the consistency provided by Kubernetes, the Kubernetes programming is almost identical. The main differences are between the CLI&rsquo;s provided by these platforms. Both are good. They&rsquo;re just different.</p>
<p>I&rsquo;m going to include the <code>linode-cli</code> commands I&rsquo;m using in this post as I found it slightly more quirky.</p>
    </div>
    <a href="/posts/230215/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220603/" class="link black dim">
        Secure (TLS) gRPC services with VKE
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>NOTE</strong> <a href="https://cert-manager.io"><code>cert-manager</code></a> is a better solution to what follows.</p></blockquote>
<p>I&rsquo;ve a need to deploy a Vultr Kubernetes Engine (VKE) cluster on a daily basis (create and delete within a few hours) and expose (securely|TLS) a gRPC service.</p>
<p>I have an existing solution <a href="/posts/211130/">Automatic Certs w/ Golang gRPC service on Compute Engine</a> that combines a gRPC Healthchecking and an ACME service and decided to reuse this.</p>
<p>In order for it work, we need:</p>
    </div>
    <a href="/posts/220603/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220421/" class="link black dim">
        Using Google&#39;s Public Certificate Authority with Golang autocert
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Last year, I wrote about using <a href="/posts/211130/">Automatic Certs w/ Golang gRPC service on Compute Engine</a>. That solution uses <a href="https://en.wikipedia.org/wiki/Automatic_Certificate_Management_Environment">ACME</a> with (the wonderful) <a href="https://letsencrypt.org">Let&rsquo;s Encrypt</a>. Google is offering a private preview of <a href="https://cloud.google.com/blog/products/identity-security/automate-public-certificate-lifecycle-management-via--acme-client-api">Automate Public Certificates Lifecycle Management via RFC 8555 (ACME)</a> and, because I&rsquo;m using Google Cloud Platform extensively to build a &ldquo;thing&rdquo; and I think it would be useful to have a backup to Let&rsquo;s Encrypt, I thought I&rsquo;d give the solution a try. You&rsquo;ll need to sign-up for the private preview, for what follows to work.</p>
    </div>
    <a href="/posts/220421/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211130/" class="link black dim">
        Automatic Certs w/ Golang gRPC service on Compute Engine
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I needed to deploy a <a href="https://github.com/grpc/grpc/blob/master/src/proto/grpc/health/v1/health.proto">healthcheck</a>-enabled gRPC TLS-enabled service. Fortunately, most (all?) of the SDKs include an implementation, e.g. Golang has <a href="https://github.com/grpc/grpc-go/tree/master/health"><code>grpc-go/health</code></a>.</p>
<p>I learned in my travels that:</p>
<ul>
<li>DigitalOcean [App] platform does not (<a href="https://www.digitalocean.com/community/questions/app-platform-http-2-support">link</a>) work with TLS-based gRPC apps.</li>
<li><a href="https://fly.io">Fly</a> has a regression (<a href="https://community.fly.io/t/urgent-grpc-server-unreachable-via-grpcurl/2694/5">link</a>) that breaks gRPC</li>
</ul>
<p>So, I resorted to Google Cloud Platform (GCP). Although Cloud Run would be well-suited to running the gRPC app, it uses a proxy|sidecar to provision a cert for the app and I wanted to be able to (easily use a custom domain) and give myself a somewhat general-purpose solution.</p>
    </div>
    <a href="/posts/211130/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210730/" class="link black dim">
        Renewing Firebase Authentication ID tokens with gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written before about a project in which I&rsquo;m using Firebase Authentication in combination with Google Cloud Endpoints and a gRPC service running on Cloud Run:</p>
<ul>
<li><a href="/posts/210614/">Firebase Authentication, Cloud Endpoints and gRPC (1of2)</a></li>
<li><a href="/posts/210618/">Firebase Authentication, Cloud Endpoints and gRPC (2of2)</a></li>
</ul>
<p>This works well with one caveat, the ID tokens (JWTs) minted by Firebase Authentication have a 3600 second (one hour) lifetime.</p>
<p>The user flow in my app is that whenever the user invokes the app&rsquo;s CLI:</p>
    </div>
    <a href="/posts/210730/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210724/" class="link black dim">
        gRPC Interceptors and in-memory gRPC connections
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For&hellip; reasons, I wanted to pre-filter gRPC requests to check for authorization. Authorization is implemented as a &lsquo;micro-service&rsquo; and I wanted the authorization server to run in the same process as the gRPC client.</p>
<p>TL;DR:</p>
<ul>
<li>Shiju&rsquo;s <a href="https://shijuvar.medium.com/writing-grpc-interceptors-in-go-bf3e7671fe48">&ldquo;Writing gRPC Interceptors in Go&rdquo;</a> is great</li>
<li>This Stack overflow <a href="https://stackoverflow.com/a/52080545/609290">answer</a> ostensibly for writing unit tests for gRPC got me an in-process server</li>
</ul>
<p>What follows stands on these folks&rsquo; shoulders&hellip;</p>
<p>A key motivator for me to write blog posts is that helps me ensure that I understand things. Writing this post, I realized I&rsquo;d not researched gRPC Interceptors and, as luck would have it, I found some interesting content, not on <a href="https://grpc.io"><code>grpc.io</code></a> but on the <a href="https://github.com/grpc-ecosystem"><code>grpc-ecosystem</code></a> repo, specifically <a href="https://github.com/grpc-ecosystem/go-grpc-middleware">Go gRPC middleware</a>. But, I refer again to Shiju&rsquo;s clear and helpful <a href="https://shijuvar.medium.com/writing-grpc-interceptors-in-go-bf3e7671fe48">&ldquo;Writing gRPC Interceptors in Go&rdquo;</a></p>
    </div>
    <a href="/posts/210724/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210618/" class="link black dim">
        Firebase Authentication, Cloud Endpoints and gRPC (2of2)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Earlier this week, I wrote about using <a href="/posts/210614/">Firebase Authentcation, Cloud Endpoints and gRPC (1of2)</a>. Since then, I <a href="https://github.com/GoogleCloudPlatform/esp-v2/issues/542">learned some more</a> and added a gRPC interceptor to implement basic authorization for the service.</p>
<h2 id="espv2---allow-unauthenticated">ESPv2 <code>--allow-unauthenticated</code></h2>
<p>The Cloud Enpoints (ESPv2) proxy must be run as <code>--allow-unauthenticated</code> on Cloud Run to ensure that requests make it to the proxy where the request is authenticated and only authenticated requests make it on to the backend service. Thanks Google&rsquo;s <a href="https://github.com/nareddyt">Teju Nareddy</a>!</p>
    </div>
    <a href="/posts/210618/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210614/" class="link black dim">
        Firebase Authentication, Cloud Endpoints and gRPC (1of2)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m building a service that requires user authentication. The primary endpoint is a gRPC-based service. I would like to consider using certificate-based auth but this feels&hellip; challenging. Instead, I have been aware of, but never used, <a href="https://firebase.google.com/products/auth">Firebase Authentication</a> and was interested to see that <a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> includes Firebase Authentication as one of its supported auth mechanisms. Curiosity piqued, I confirmed that gRPC supports <a href="https://grpc.io/docs/guides/auth/#using-google-token-based-authentication">Google token-based authentication</a>.</p>
<p>The following is a summary of what I did but I&rsquo;ll leave the extensive documentation to Google, (Google&rsquo;s) Firebase and gRPC, all of which, in this case, provide really good explanations.</p>
    </div>
    <a href="/posts/210614/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210608/" class="link black dim">
        Cloud Endpoints combine OpenAPI and gRPC... or not!
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>See:</p>
<ul>
<li><a href="/posts/210519/">Multiplexing gRPC and HTTP endpoints with Cloud Run</a></li>
<li><a href="/posts/200325/">gRPC, Cloud Run &amp; Endpoints</a></li>
<li><a href="https://github.com/GoogleCloudPlatform/esp-v2/issues/523">ESPv2: Configure Cloud Endpoints to proxy traffic to a Cloud Run multiplexed (gRPC|HTTP) service</a></li>
</ul>
<p>Challenges:</p>
<ul>
<li>Cloud Run permits single port</li>
<li>Cloud Run services publishing e.g. gRPC and Prometheus, must multiplex transports</li>
<li>Cloud Run services publishing multiplexed transports are <em>challenging</em> to expose using Cloud Endpoints</li>
</ul>
<h2 id="hypothesis-1-multiplexed-transports-work-with-cloud-run">Hypothesis #1: Multiplexed transports work with Cloud Run</h2>
<p>See: <a href="/posts/210519/">Multiplexing gRPC and HTTP endpoints with Cloud Run</a></p>
    </div>
    <a href="/posts/210608/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210519/" class="link black dim">
        Multiplexing gRPC and HTTP (Prometheus) endpoints with Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google <a href="https://cloud.google.com/run">Cloud Run</a> is useful but, each service is limited to exposing a single port. This caused me problems with a gRPC service that serves (non-gRPC) Prometheus metrics because customarily, you would serve gRPC on one port and the Prometheus metrics on another.</p>
<p>Fortunately, <a href="https://github.com/soheilhy/cmux">cmux</a> provides a solution by providing a mechanism that multiplexes both services (gRPC and HTTP) on a single port!</p>
<blockquote>
<p><strong>TL;DR</strong> See the cmux <a href="https://github.com/soheilhy/cmux#limitations">Limitations</a> and use:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#a6e22e">grpcl</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">MatchWithWriters</span>(
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">cmux</span>.<span style="color:#a6e22e">HTTP2MatchHeaderFieldSendSettings</span>(<span style="color:#e6db74">&#34;content-type&#34;</span>, <span style="color:#e6db74">&#34;application/grpc&#34;</span>))
</span></span></code></pre></div></blockquote>
<p>Extending the <a href="https://github.com/soheilhy/cmux#how-to">example</a> from the cmux repo:</p>
    </div>
    <a href="/posts/210519/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210412/" class="link black dim">
        Fly.io
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I spent some time over the weekend understanding <a href="https://fly.io">Fly.io</a>. It&rsquo;s always fascinating to me how many smart people are building really neat solutions. Fly.io is subtly different to other platforms that I use (Kubernetes, GCP, DO, Linode) and I&rsquo;ve found the Fly.io team to be highly responsive and helpful to my noob questions.</p>
<p>One of the team&rsquo;s posts, <a href="https://fly.io/blog/docker-without-docker/">Docker without Docker</a> surfaced in my Feedly feed (<a href="https://news.ycombinator.com/item?id=26746280">hackernews</a>) and it piqued my interest.</p>
    </div>
    <a href="/posts/210412/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210222/" class="link black dim">
        Dapr
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>It&rsquo;s a good name, I read it as &ldquo;dapper&rdquo; but I frequently type &ldquo;darp&rdquo; :-(</p>
<p>Was interested to <a href="https://blog.dapr.io/posts/2021/02/17/announcing-dapr-v1.0/">read</a> that <a href="https://dapr.io/">Dapr</a> is now v1.0 and decided to check it out. I was initially confused between Dapr and service mesh functionality. But, having used Dapr, it appears to be more focused in aiding the development of (cloud-native) (distributed) apps by providing developers with abstractions for e.g. service discovery, eventing, observability whereas service meshes feel (!) more oriented towards simplifying the deployment of existing apps. Both use the concept of proxies, deployed alongside app components (as sidecars on Kubernetes) to provide their functionality to apps.</p>
    </div>
    <a href="/posts/210222/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200717/" class="link black dim">
        Remotely invoking WASM functions using gRPC and waPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Following on from <a href="/posts/200612/">waPC &amp; Protobufs</a>, I can now remotely invoke (arbitrary) WASM functions:</p>
<p>Client:</p>
<p>The logging isn&rsquo;t perfectly clear but, the client gets (a previously added) WASM binary from the server (using the SHA-256 of the WASM binary as a unique identifier). The result includes metadata that includes a protobuf descriptor of the WASM binary&rsquo;s functions. The descriptor defines gRPC services (that represent the WASM functions) with input (parameters) and output (results) messages.</p>
    </div>
    <a href="/posts/200717/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200429/" class="link black dim">
        Rust implementation of Crate Transparency using Google Trillian
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been hacking on a Rust-based transparent application for Google Trillian. As appears to be my fixation, this personality is for another package manager. This time, Rust&rsquo;s <a href="https://doc.rust-lang.org/1.0.0/book/crates-and-modules.html">Crates</a> often found in <a href="https://crates.io"><code>crates.io</code></a> which is Rust&rsquo;s Package Registry. I discussed this project earlier this month <a href="/posts/200403/">Rust Crate Transparency &amp;&amp; Rust SDK for Google Trillian</a> and and earlier approach for Python&rsquo;s packages with <a href="/posts/190907/">pypi-transparency</a>.</p>
<p>This time, of course, I&rsquo;m using Rust. And, by way of a first for me, for the gRPC server implementation (aka &ldquo;personality&rdquo;). I&rsquo;ve been lazy thanks to the excellent <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a> and have been using it way of a client. Because I&rsquo;m more familiar with Golang and because I&rsquo;ve written (most) other Trillian personalities in Golang, I resorted to quickly implementing Crate Transparency in Golang too in order to uncover bugs with the Rust implementation. I&rsquo;ll write a follow-up post on the complexity I seem to struggle with when using protobufs and gRPC [in Golang].</p>
    </div>
    <a href="/posts/200429/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200403/" class="link black dim">
        Rust Crate Transparency &amp;&amp; Rust SDK for Google Trillian
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m noodling the utility of a Transparency solution for Rust Crates. When developers push crates to Cargo, a bunch of metadata is associated with the crate. E.g. <a href="https://crates.io/crates/protobuf"><code>protobuf</code></a>. As with Golang Modules, Python packages on PyPi etc., there appears to be utility in making tamperproof recordings of these publications. Then, other developers may confirm that a crate pulled from cates.io is highly unlikely to have been changed.</p>
<p>On Linux, Cargo stores downloaded crates under <code>${HOME}/.crates/registry</code>. In the case of the latest version (<code>2.12.0</code>) of <code>protobuf</code>, on my machine, I have:</p>
    </div>
    <a href="/posts/200403/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200326/" class="link black dim">
        Google Trillian on Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written previously (<a href="https://medium.com/google-cloud/google-trillian-for-noobs-1a-c87a78e5e585">Google Trillian for Noobs</a>) about Google&rsquo;s interesting project <a href="https://github.com/google/trillian">Trillian</a> and about some of the &ldquo;personalities&rdquo; (e.g. <a href="/posts/190907/">PyPi Transparency</a>) that I&rsquo;ve build using it.</p>
<p>Having gone slight cra-cra on <a href="https://cloud.google.com/run">Cloud Run</a> and <a href="https://grpc.io">gRPC</a> this week with <a href="/posts/200320/">Golang gRPC Cloud Run</a> and <a href="/posts/200325/">gRPC, Cloud Run &amp; Endpoints</a>, I thought it&rsquo;d be fun to deploy Trillian and a personality to Cloud Run.</p>
<p>It mostly (!) works :-)</p>
<p>At the end of the post, I&rsquo;ve summarized creating a Cloud SQL instance to host the Trillian data(base).</p>
    </div>
    <a href="/posts/200326/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200325/" class="link black dim">
        gRPC, Cloud Run &amp; Endpoints
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>&lt;3 Google but there&rsquo;s quite often an assumption that we&rsquo;re all sitting around the engineering table and, of course, we&rsquo;re not.</p>
<p><a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> is a powerful offering but &ndash; IMO &ndash; it&rsquo;s <strong>super</strong> confusing to understand and complex to deploy.</p>
<p>If you&rsquo;re familiar with the motivations behind service meshes (e.g. <a href="https://istio.io">Istio</a>), Cloud Endpoints fits in a similar niche (&ldquo;neesh&rdquo; or &ldquo;nitch&rdquo;?). The underlying ambition is that, developers can take <strong>existing</strong> code and by adding a proxy (or sidecar), general-purpose abstractions, security, logging etc. may be added.</p>
    </div>
    <a href="/posts/200325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200320/" class="link black dim">
        Golang gRPC Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>Update: 2020-03-24</strong>: Since writing this post, I&rsquo;ve contributed <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/12">Golang</a> and <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/15">Rust</a> samples to Google&rsquo;s project. I recommend you start there.</p></blockquote>
<p>Google explained how to run gRPC servers with Cloud Run. The examples are good but only Python and Node.JS:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/compute/serve-cloud-run-requests-with-grpc-not-just-http">gRPC comes to Cloud Run</a></li>
<li><a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example">gRPC in Google Cloud Run</a></li>
</ul>
<p>Missing Golang&hellip;. until now ;-)</p>
<p>I had problems with 1.14 and so I&rsquo;m using 1.13.</p>
<h2 id="project-structure">Project structure</h2>
<p>I&rsquo;ll tidy up my repo but the code may be found:</p>
    </div>
    <a href="/posts/200320/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190918/" class="link black dim">
        Cloud Functions Simple(st) HTTP Multi-host Proxy
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Tweaked yesterday&rsquo;s solution so that it will randomly select one from several hosts with which it&rsquo;s configured.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Golang" data-lang="Golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">proxy</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;math/rand&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/url&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;strings&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">robin</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">hostsList</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;PROXY_HOST&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">hostsList</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#e6db74">&#34;&#39;PROXY_HOST&#39; environment variable should contain comma-separated list of hosts&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Comma-separated lists of hosts</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hosts</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Split</span>(<span style="color:#a6e22e">hostsList</span>, <span style="color:#e6db74">&#34;,&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">urls</span> <span style="color:#f92672">:=</span> make([]<span style="color:#f92672">*</span><span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">URL</span>, len(<span style="color:#a6e22e">hosts</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">host</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">hosts</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">origin</span> = <span style="color:#a6e22e">Endpoint</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Host</span>: <span style="color:#a6e22e">host</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Port</span>: <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;PROXY_PORT&#34;</span>),
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">origin</span>.<span style="color:#a6e22e">URL</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">urls</span>[<span style="color:#a6e22e">i</span>] = <span style="color:#a6e22e">url</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">NewSource</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">UnixNano</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">q</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">s</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Handler</span> = <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Pick one of the URLs at random</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">url</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">urls</span>[<span style="color:#a6e22e">q</span>.<span style="color:#a6e22e">Int31n</span>(int32(len(<span style="color:#a6e22e">urls</span>)))]
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;[Handler] Forwarding: %s&#34;</span>, <span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">String</span>())
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Forward to it</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">reverseproxy</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This requires a minor tweak to the deployment to escape the commas within the <code>PROXY_HOST</code> string to disambiguate these for <code>gcloud</code>:</p>
    </div>
    <a href="/posts/190918/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190917/" class="link black dim">
        Cloud Functions Simple(st) HTTP Proxy
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m investigating the use of <a href="https://letsencrypt.org/">LetsEncrypt</a> for gRPC services. I found this straightforward <a href="https://www.d3void.net/post/acme/">post</a> by Scott Devoid and am going to try this approach.</p>
<p>Before I can do that, I need to be able to publish services (make them Internet-accessible) and would like to try to continue to use GCP for <a href="https://cloud.google.com/free/">free</a>.</p>
<p>Some time ago, I <a href="https://medium.com/google-cloud/microk8s-on-google-cloud-platform-d8b7a71a3ef">wrote</a> about using the excellent <a href="https://microk8s.io/">Microk8s</a> on GCP. Using an <code>f1-micro</code>, I&rsquo;m hoping (!) to stay within the Compute Engine free tier. I&rsquo;ll also try to be diligent and delete the instance when it&rsquo;s not needed. This gives me a runtime platform and I can expose services to the Instance&rsquo;s (Node)Ports but, I&rsquo;d prefer to not be billed for a simple proxy.</p>
    </div>
    <a href="/posts/190917/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/healthcheck/" class="link blue hover-black">
            Tag: Healthcheck
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250612/" class="link black dim">
        MCP for gRPC Health Checking protocol
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://modelcontextprotocol.io/introduction">Model Context Protocol (MCP)</a> is &ldquo;all the rage&rdquo; these days.</p>
<p>I stumbled upon <a href="https://github.com/redpanda-data/protoc-gen-go-mcp"><code>protoc-gen-go-mcp</code></a> and think it&rsquo;s an elegant application of two technologies: programmatically generating an MCP server from a gRPC protobuf.</p>
<p>I&rsquo;m considering building an MCP server for <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> but, thought I&rsquo;d start with something simple: <a href="https://grpc.io/docs/guides/health-checking/">gRPC Health Checking protocol</a>.</p>
<p>I was surprised to learn as I was doing this that there&rsquo;s a new <a href="https://github.com/grpc/grpc-proto/blob/23f5b568eefcb876e6ebc3b01725f1f20cff999e/grpc/health/v1/health.proto#L74"><code>List</code></a> (<a href="https://github.com/grpc/grpc-proto/pull/143">Add <code>List</code> method to gRPC Health service #143</a>) added to <code>grpc.health.v1.Health</code>. My (Ackal) healthcheck server does not yet implement it (see later).</p>
    </div>
    <a href="/posts/250612/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210412/" class="link black dim">
        Fly.io
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I spent some time over the weekend understanding <a href="https://fly.io">Fly.io</a>. It&rsquo;s always fascinating to me how many smart people are building really neat solutions. Fly.io is subtly different to other platforms that I use (Kubernetes, GCP, DO, Linode) and I&rsquo;ve found the Fly.io team to be highly responsive and helpful to my noob questions.</p>
<p>One of the team&rsquo;s posts, <a href="https://fly.io/blog/docker-without-docker/">Docker without Docker</a> surfaced in my Feedly feed (<a href="https://news.ycombinator.com/item?id=26746280">hackernews</a>) and it piqued my interest.</p>
    </div>
    <a href="/posts/210412/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cloud-run/" class="link blue hover-black">
            Tag: Cloud-Run
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250429/" class="link black dim">
        Configuring Envoy to proxy Google Cloud Run v2
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m building an emulator for <a href="https://cloud.google.com/run">Cloud Run</a>. As I considered the solution, I assumed (more later) that I could implement Google&rsquo;s gRPC interface for <a href="https://github.com/googleapis/googleapis/tree/83df85b45a5d3e85b48f2571e1c8e57cdfd57e6c/google/cloud/run">Cloud Run</a> and use <a href="https://www.envoyproxy.io/">Envoy</a> to proxy HTTP/REST requests to the gRPC service using Envoy&rsquo;s <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/grpc_json_transcoder_filter">gRPC-JSON transcoder</a>.</p>
<p>Google calls this process <a href="https://cloud.google.com/endpoints/docs/grpc/transcoding">Transcoding HTTP/JSON to gRPC</a> which I think it a better description.</p>
<p>Google&rsquo;s Cloud Run <code>v2</code> (<code>v1</code> is no longer published to the <a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a> repo) <a href="https://github.com/googleapis/googleapis/blob/83df85b45a5d3e85b48f2571e1c8e57cdfd57e6c/google/cloud/run/v2/service.proto"><code>service.proto</code></a> includes the following <code>Services</code> definition for <code>CreateService</code>:</p>
    </div>
    <a href="/posts/250429/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240927/" class="link black dim">
        Cloud Run with a gRPC probe
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Cloud Run supports <a href="https://cloud.google.com/run/docs/configuring/healthchecks">gRPC startup|liveness probes</a> which I&rsquo;d not used before.</p>
<p>I&rsquo;m using <a href="https://cloud.google.com/run/docs/reference/rest">Cloud Run</a> v2 and specifically <a href="https://cloud.google.com/run/docs/reference/rest/v2/projects.locations.services/create"><code>projects.locations.services.create</code></a> and <a href="https://cloud.google.com/run/docs/reference/rest/v2/projects.locations.services#Service"><code>Service</code></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>REGION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>REPO<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;..&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Must be in an Artifact Registry repo</span>
</span></span><span style="display:flex;"><span>IMAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span><span style="color:#e6db74">-docker.pkg.dev/</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>REPO<span style="color:#e6db74">}</span><span style="color:#e6db74">/...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Run v2</span>
</span></span><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://run.googleapis.com/v2&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PARENT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;projects/</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">/locations/</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SERVICE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span></code></pre></div><p>I like to use <a href="https://jsonnet.org/">Jsonnet</a> (specifically <a href="https://github.com/google/go-jsonnet"><code>go-jsonnet</code></a>) to help templating Kubernetes(-like) deployments.</p>
<p><code>cloudrun.jsonnet</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsonnet" data-lang="jsonnet"><span style="display:flex;"><span><span style="color:#66d9ef">local</span> project <span style="color:#f92672">=</span> std.extVar(<span style="color:#e6db74">&#34;project&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> region <span style="color:#f92672">=</span> std.extVar(<span style="color:#e6db74">&#34;region&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> service <span style="color:#f92672">=</span> std.extVar(<span style="color:#e6db74">&#34;service&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> image <span style="color:#f92672">=</span> std.extVar(<span style="color:#e6db74">&#34;image&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> port <span style="color:#f92672">=</span> <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> health_checking_service <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;labels&#34;:{
</span></span><span style="display:flex;"><span>        &#34;type&#34;: <span style="color:#e6db74">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;annotations&#34;: {
</span></span><span style="display:flex;"><span>        &#34;type&#34;: <span style="color:#e6db74">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;template&#34;:{
</span></span><span style="display:flex;"><span>        &#34;containers&#34;: {
</span></span><span style="display:flex;"><span>            &#34;name&#34;: service,
</span></span><span style="display:flex;"><span>            &#34;image&#34;: image,
</span></span><span style="display:flex;"><span>            &#34;args&#34;: [],
</span></span><span style="display:flex;"><span>            &#34;resources&#34;: {
</span></span><span style="display:flex;"><span>                &#34;limits&#34;: {
</span></span><span style="display:flex;"><span>                    &#34;cpu&#34;: <span style="color:#e6db74">&#34;1000m&#34;</span>,
</span></span><span style="display:flex;"><span>                    &#34;memory&#34;: <span style="color:#e6db74">&#34;512Mi&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            &#34;ports&#34;: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    &#34;name&#34;: <span style="color:#e6db74">&#34;http1&#34;</span>,
</span></span><span style="display:flex;"><span>                    &#34;containerPort&#34;: port
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            &#34;startupProbe&#34;: {
</span></span><span style="display:flex;"><span>                &#34;grpc&#34;: {
</span></span><span style="display:flex;"><span>                    &#34;port&#34;: port,
</span></span><span style="display:flex;"><span>                    &#34;service&#34;: health_checking_service
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;scaling&#34;: {
</span></span><span style="display:flex;"><span>            &#34;maxInstanceCount&#34;: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And deploy it using:</p>
    </div>
    <a href="/posts/240927/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220506/" class="link black dim">
        Cloud Run custom domain mappings
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I have several Cloud Run services that I want to map to a domain.</p>
<p>During development, I create a Google Cloud Platform (GCP) project each day into which everything is deployed. This means that, every day, the Cloud Run services have newly non-inferable (to me) URLs. I thought this would be tedious to manage because:</p>
<ol>
<li>My DNS service isn&rsquo;t programmable (I know!)</li>
<li>Cloud Run services have non-inferable (by me) URLs</li>
</ol>
<p>i.e. I thought I&rsquo;d have to manually update the DNS entries each day.</p>
    </div>
    <a href="/posts/220506/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220225/" class="link black dim">
        Prometheus HTTP Service Discovery of Cloud Run services
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Some time ago, I wrote about using <a href="https://pretired.dazwilkin.com/posts/210419/">Prometheus Service Discovery w/ Consul for Cloud Run</a> and also <a href="https://pretired.dazwilkin.com/posts/211005/">Scraping metrics exposed by Google Cloud Run services that require authentication</a>. Both solutions remain viable but they didn&rsquo;t address another use case for Prometheus and Cloud Run services that I have with a &ldquo;thing&rdquo; that I&rsquo;ve been building.</p>
<p>In this scenario, I want to:</p>
<ol>
<li>Configure Prometheus to scrape Cloud Run service metrics</li>
<li>Discover Cloud Run services dynamically</li>
<li>Authenticate to Cloud Run using Firebase Auth ID tokens</li>
</ol>
<p>These requirements and &ndash; one other &ndash; present several challenges:</p>
    </div>
    <a href="/posts/220225/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211026/" class="link black dim">
        Firebase Auth authorized domains
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using Firebase Authentication in a project to authenticate users of various OAuth2 identity systems. Firebase Authentication requires a set of Authorized Domains.</p>
<p>The (web) app that interacts with Firebase Authentication is deployed to Cloud Run.  The Authorized Domains list must include the app&rsquo;s Cloud Run service URL.</p>
<p>Cloud Run service URLs vary by Project (ID). They are a combination of the service name, a hash (?) of the Project (ID) and <code>.a.run.app</code>.</p>
    </div>
    <a href="/posts/211026/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211005/" class="link black dim">
        Scraping metrics exposed by Google Cloud Run services that require authentication
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a solution (<a href="https://github.com/DazWilkin/gcp-oidc-token-proxy"><code>gcp-oidc-token-proxy</code></a>) that can be used in conjunction with Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#oauth2">OAuth2</a> to authenticate requests so that Prometheus can scrape metrics exposed by e.g. Cloud Run services that require authentication. The solution resulted from my <a href="https://stackoverflow.com/questions/69411584/is-there-a-way-to-configure-prometheus-to-use-a-google-service-account-to-auth">question</a> on Stack overflow.</p>
<p>Problem #1: Endpoint requires authentication</p>
<p>Given a Cloud Run service URL for which:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;my-server-blahblah-wl.a.run.app&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Returns 200 when authentication w/ an ID token</span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>gcloud auth print-identity-token<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request GET <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--write-out <span style="color:#e6db74">&#34;%{response_code}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output /dev/null <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span>/metrics
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Returns 403 otherwise</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request GET <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--write-out <span style="color:#e6db74">&#34;%{response_code}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output /dev/null <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span>/metrics
</span></span></code></pre></div><p>Problem #2: Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#oauth2">OAuth2</a> configuration is constrained</p>
    </div>
    <a href="/posts/211005/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210907/" class="link black dim">
        `gcloud beta run services replace`
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>TL;DR</strong> I&rsquo;m working on a project that includes multiple Cloud Run services. I&rsquo;ve been putting my <code>gcloud</code> head on to deploy these services thinking that it&rsquo;s curious there&rsquo;s no way to write the specs as YAML configs. Today, I learned that there is: <a href="https://cloud.google.com/sdk/gcloud/reference/beta/run/services/replace"><code>gcloud beta run services replace</code></a>.</p></blockquote>
<p>What prompted the discovery was some frustration trying to deploy a JSON-valued environment variable to Cloud Run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  local FIREBASE_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    apiKey: </span><span style="color:#e6db74">${</span>FIREBASE_API_KEY<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    authDomain: </span><span style="color:#e6db74">${</span>FIREBASE_AUTH_DOMAIN<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    projectId: </span><span style="color:#e6db74">${</span>FIREBASE_PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    storageBucket: </span><span style="color:#e6db74">${</span>FIREBASE_STORAGE_BUCKET<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    messagingSenderId: </span><span style="color:#e6db74">${</span>FIREBASE_MESSAGING_SENDER<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    appId: </span><span style="color:#e6db74">${</span>FIREBASE_APP<span style="color:#e6db74">}</span><span style="color:#e6db74">}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  gcloud run deploy <span style="color:#e6db74">${</span>SRV_NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --image<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --command<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/server&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --args<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;--endpoint=:</span><span style="color:#e6db74">${</span>PORT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --set-env-vars<span style="color:#f92672">=</span>FIREBASE_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>FIREBASE_CONFIG<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --max-instances<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --memory<span style="color:#f92672">=</span>256Mi <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --ingress<span style="color:#f92672">=</span>all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --platform<span style="color:#f92672">=</span>managed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --port<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PORT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --allow-unauthenticated <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --region<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p><code>gcloud</code> balks at this.</p>
    </div>
    <a href="/posts/210907/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210608/" class="link black dim">
        Cloud Endpoints combine OpenAPI and gRPC... or not!
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>See:</p>
<ul>
<li><a href="/posts/210519/">Multiplexing gRPC and HTTP endpoints with Cloud Run</a></li>
<li><a href="/posts/200325/">gRPC, Cloud Run &amp; Endpoints</a></li>
<li><a href="https://github.com/GoogleCloudPlatform/esp-v2/issues/523">ESPv2: Configure Cloud Endpoints to proxy traffic to a Cloud Run multiplexed (gRPC|HTTP) service</a></li>
</ul>
<p>Challenges:</p>
<ul>
<li>Cloud Run permits single port</li>
<li>Cloud Run services publishing e.g. gRPC and Prometheus, must multiplex transports</li>
<li>Cloud Run services publishing multiplexed transports are <em>challenging</em> to expose using Cloud Endpoints</li>
</ul>
<h2 id="hypothesis-1-multiplexed-transports-work-with-cloud-run">Hypothesis #1: Multiplexed transports work with Cloud Run</h2>
<p>See: <a href="/posts/210519/">Multiplexing gRPC and HTTP endpoints with Cloud Run</a></p>
    </div>
    <a href="/posts/210608/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210520/" class="link black dim">
        Consul discovers Google Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a basic <code>discoverer</code> of Google <a href="https://cloud.google.com/run">Cloud Run</a> services. This is for a project and it extends work done in some previous posts to <a href="/posts/210519/">Multiplex gRPC and Prometheus with Cloud Run</a> and to use <a href="/posts/210419/">Consul for Prometheus service discovery</a>.</p>
<p>This solution:</p>
<ul>
<li>Accepts a set of Google Cloud Platform (GCP) projects</li>
<li>Trawls them for Cloud Run services</li>
<li>Assumes that the services expose Prometheus metrics on <code>:443/metrics</code></li>
<li>Relabels the services</li>
<li>Surfaces any discovered Cloud Run services&rsquo; metrics in Prometheus</li>
</ul>
<p>You&rsquo;ll need Docker and Docker Compose.</p>
    </div>
    <a href="/posts/210520/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210519/" class="link black dim">
        Multiplexing gRPC and HTTP (Prometheus) endpoints with Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google <a href="https://cloud.google.com/run">Cloud Run</a> is useful but, each service is limited to exposing a single port. This caused me problems with a gRPC service that serves (non-gRPC) Prometheus metrics because customarily, you would serve gRPC on one port and the Prometheus metrics on another.</p>
<p>Fortunately, <a href="https://github.com/soheilhy/cmux">cmux</a> provides a solution by providing a mechanism that multiplexes both services (gRPC and HTTP) on a single port!</p>
<blockquote>
<p><strong>TL;DR</strong> See the cmux <a href="https://github.com/soheilhy/cmux#limitations">Limitations</a> and use:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#a6e22e">grpcl</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">MatchWithWriters</span>(
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">cmux</span>.<span style="color:#a6e22e">HTTP2MatchHeaderFieldSendSettings</span>(<span style="color:#e6db74">&#34;content-type&#34;</span>, <span style="color:#e6db74">&#34;application/grpc&#34;</span>))
</span></span></code></pre></div></blockquote>
<p>Extending the <a href="https://github.com/soheilhy/cmux#how-to">example</a> from the cmux repo:</p>
    </div>
    <a href="/posts/210519/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210419/" class="link black dim">
        Prometheus Service Discovery w/ Consul for Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m working on a project that will programmatically create Google <a href="https://cloud.google.com/run">Cloud Run</a> services and I want to be able to dynamically discover these services using Prometheus.</p>
<p>This is one solution.</p>
<blockquote>
<p><strong>NOTE</strong> Google Cloud Run is the service I&rsquo;m using, but the principle described herein applies to any runtime service that you&rsquo;d wish to use.</p></blockquote>
<p>Why is this challenging? IIUC, it&rsquo;s primarily because Prometheus has a limited set of plugins for service discovery, see the sections that include <code>_sd_</code> in Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/">Configuration</a> documentation. Unfortunately, Cloud Run is not explicitly supported. The alternative appears to be to use file-based discovery but this seems &lsquo;challenging&rsquo;; it requires, for example, reloading Prometheus on file changes.</p>
    </div>
    <a href="/posts/210419/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210316/" class="link black dim">
        Programmatically deploying Cloud Run services (Golang|Python)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Phew! Programmitcally deploying Cloud Run services should be easy but it didn&rsquo;t find it so.</p>
<p>My issues were that the Cloud Run Admin (!) API is poorly documented and it uses non-standard endpoints (thanks Sal!). Here, for others who may struggle with this, is how I got this to work.</p>
<h2 id="goal">Goal</h2>
<p>Programmatically (have Golang, Python, want Rust) deploy services to Cloud Run.</p>
<p>i.e. achieve this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud run deploy <span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--image<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--platform<span style="color:#f92672">=</span>managed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--no-allow-unauthenticated <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--region<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><blockquote>
<p><strong>TRICK</strong> <a href="https://cloud.google.com/sdk/gcloud/reference#--log-http"><code>--log-http</code></a> is your friend</p>
    </div>
    <a href="/posts/210316/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200326/" class="link black dim">
        Google Trillian on Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written previously (<a href="https://medium.com/google-cloud/google-trillian-for-noobs-1a-c87a78e5e585">Google Trillian for Noobs</a>) about Google&rsquo;s interesting project <a href="https://github.com/google/trillian">Trillian</a> and about some of the &ldquo;personalities&rdquo; (e.g. <a href="/posts/190907/">PyPi Transparency</a>) that I&rsquo;ve build using it.</p>
<p>Having gone slight cra-cra on <a href="https://cloud.google.com/run">Cloud Run</a> and <a href="https://grpc.io">gRPC</a> this week with <a href="/posts/200320/">Golang gRPC Cloud Run</a> and <a href="/posts/200325/">gRPC, Cloud Run &amp; Endpoints</a>, I thought it&rsquo;d be fun to deploy Trillian and a personality to Cloud Run.</p>
<p>It mostly (!) works :-)</p>
<p>At the end of the post, I&rsquo;ve summarized creating a Cloud SQL instance to host the Trillian data(base).</p>
    </div>
    <a href="/posts/200326/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200325/" class="link black dim">
        gRPC, Cloud Run &amp; Endpoints
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>&lt;3 Google but there&rsquo;s quite often an assumption that we&rsquo;re all sitting around the engineering table and, of course, we&rsquo;re not.</p>
<p><a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> is a powerful offering but &ndash; IMO &ndash; it&rsquo;s <strong>super</strong> confusing to understand and complex to deploy.</p>
<p>If you&rsquo;re familiar with the motivations behind service meshes (e.g. <a href="https://istio.io">Istio</a>), Cloud Endpoints fits in a similar niche (&ldquo;neesh&rdquo; or &ldquo;nitch&rdquo;?). The underlying ambition is that, developers can take <strong>existing</strong> code and by adding a proxy (or sidecar), general-purpose abstractions, security, logging etc. may be added.</p>
    </div>
    <a href="/posts/200325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200320/" class="link black dim">
        Golang gRPC Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>Update: 2020-03-24</strong>: Since writing this post, I&rsquo;ve contributed <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/12">Golang</a> and <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/15">Rust</a> samples to Google&rsquo;s project. I recommend you start there.</p></blockquote>
<p>Google explained how to run gRPC servers with Cloud Run. The examples are good but only Python and Node.JS:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/compute/serve-cloud-run-requests-with-grpc-not-just-http">gRPC comes to Cloud Run</a></li>
<li><a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example">gRPC in Google Cloud Run</a></li>
</ul>
<p>Missing Golang&hellip;. until now ;-)</p>
<p>I had problems with 1.14 and so I&rsquo;m using 1.13.</p>
<h2 id="project-structure">Project structure</h2>
<p>I&rsquo;ll tidy up my repo but the code may be found:</p>
    </div>
    <a href="/posts/200320/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/envoy/" class="link blue hover-black">
            Tag: Envoy
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250429/" class="link black dim">
        Configuring Envoy to proxy Google Cloud Run v2
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m building an emulator for <a href="https://cloud.google.com/run">Cloud Run</a>. As I considered the solution, I assumed (more later) that I could implement Google&rsquo;s gRPC interface for <a href="https://github.com/googleapis/googleapis/tree/83df85b45a5d3e85b48f2571e1c8e57cdfd57e6c/google/cloud/run">Cloud Run</a> and use <a href="https://www.envoyproxy.io/">Envoy</a> to proxy HTTP/REST requests to the gRPC service using Envoy&rsquo;s <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/grpc_json_transcoder_filter">gRPC-JSON transcoder</a>.</p>
<p>Google calls this process <a href="https://cloud.google.com/endpoints/docs/grpc/transcoding">Transcoding HTTP/JSON to gRPC</a> which I think it a better description.</p>
<p>Google&rsquo;s Cloud Run <code>v2</code> (<code>v1</code> is no longer published to the <a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a> repo) <a href="https://github.com/googleapis/googleapis/blob/83df85b45a5d3e85b48f2571e1c8e57cdfd57e6c/google/cloud/run/v2/service.proto"><code>service.proto</code></a> includes the following <code>Services</code> definition for <code>CreateService</code>:</p>
    </div>
    <a href="/posts/250429/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200723/" class="link black dim">
        Envoy WASM filters in Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A digression thanks to <a href="https://blog.salrashid.me/">Sal Rashid</a> who&rsquo;s exploring WASM filters w/ Envoy.</p>
<p>The documentation is sparse but:</p>
<ul>
<li><a href="https://banzaicloud.com/blog/envoy-wasm-filter/">How to write WASM filters for Envoy&hellip;</a></li>
</ul>
<p>There is a Rust SDK but it&rsquo;s not documented:</p>
<ul>
<li><a href="https://github.com/proxy-wasm/proxy-wasm-rust-sdk">proxy-wasm-rust-sdk</a></li>
</ul>
<p>I found two useful posts by Rustaceans who were able to make use of it:</p>
<ul>
<li><a href="https://antweiss.com/blog/extending-envoy-with-wasm-and-rust/">Extending Envoy with WASM and Rust</a></li>
<li><a href="https://blog.red-badger.com/extending-istio-with-rust-and-webassembly">Extending Istio with Rust and WebAssembly</a></li>
</ul>
<p>Here&rsquo;s my simple use of the SDK&rsquo;s examples.</p>
<h2 id="wasme">wasme</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -sL https://run.solo.io/wasme/install | sh
</span></span><span style="display:flex;"><span>PATH<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PATH<span style="color:#e6db74">}</span>:<span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.wasme/bin
</span></span><span style="display:flex;"><span>wasme --version
</span></span></code></pre></div><p>It may be possible to avoid creating an account on WebAssemblyHub if you&rsquo;re staying local.</p>
    </div>
    <a href="/posts/200723/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/fauxrpc/" class="link blue hover-black">
            Tag: FauxRPC
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250429/" class="link black dim">
        Configuring Envoy to proxy Google Cloud Run v2
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m building an emulator for <a href="https://cloud.google.com/run">Cloud Run</a>. As I considered the solution, I assumed (more later) that I could implement Google&rsquo;s gRPC interface for <a href="https://github.com/googleapis/googleapis/tree/83df85b45a5d3e85b48f2571e1c8e57cdfd57e6c/google/cloud/run">Cloud Run</a> and use <a href="https://www.envoyproxy.io/">Envoy</a> to proxy HTTP/REST requests to the gRPC service using Envoy&rsquo;s <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/grpc_json_transcoder_filter">gRPC-JSON transcoder</a>.</p>
<p>Google calls this process <a href="https://cloud.google.com/endpoints/docs/grpc/transcoding">Transcoding HTTP/JSON to gRPC</a> which I think it a better description.</p>
<p>Google&rsquo;s Cloud Run <code>v2</code> (<code>v1</code> is no longer published to the <a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a> repo) <a href="https://github.com/googleapis/googleapis/blob/83df85b45a5d3e85b48f2571e1c8e57cdfd57e6c/google/cloud/run/v2/service.proto"><code>service.proto</code></a> includes the following <code>Services</code> definition for <code>CreateService</code>:</p>
    </div>
    <a href="/posts/250429/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/241113/" class="link black dim">
        gRPC-Web w/ FauxRPC and Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>After <a href="/posts/241025/">recently</a> discovering <a href="https://github.com/sudorandom/fauxrpc">FauxRPC</a>, I was sufficiently impressed that I decided to use it to test <a href="https://www.ack.al">Ackal</a>&rsquo;s gRPC services using rust.</p>
<p>FauxRPC provides <a href="https://fauxrpc.com/docs/server/multi-protocol-support/">multi-protocol support</a> and so, after successfully implementing the <em>faux</em> gRPC client tests, I was compelled to try gRPC-Web too. For no immediate benefit other than, it&rsquo;s there, it&rsquo;s free and it&rsquo;s interesting. As an aside, the <em>faux</em> REST client tests worked without issue using <a href="https://crates.io/crates/reqwest">Reqwest</a>.</p>
<p>Unfortunately, my optimism hit a wall with gRPC-Web and what follows is a summary of my unresolved issue.</p>
    </div>
    <a href="/posts/241113/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/241025/" class="link black dim">
        FauxRPC using gRPCurl, Golang and rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Read <a href="https://kmcd.dev/posts/fauxrpc-testcontainers/">FauxRPC + Testcontainers</a> on Hacker News and was intrigued. I spent a little more time &ldquo;evaluating&rdquo; this than I&rsquo;d planned because I&rsquo;m forcing myself to use rust as much as possible and my ignorance (see below) caused me some challenges.</p>
<p>The technology is interesting and works well. The experience helped me explore <a href="https://testcontainers.com/">Testcontainers</a> too which I&rsquo;d heard about but not explored until this week.</p>
<p>For my future self:</p>
<table>
  <thead>
      <tr>
          <th>What</th>
          <th>What?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="https://fauxrpc.com/">FauxRPC</a></td>
          <td>A general-purpose tool (built using <a href="https://buf.build/">Buf</a>&rsquo;s <a href="https://connectrpc.com/">Connect</a>) that includes registry and stub (gRPC) services that can be (programmatically) configured (using a Protobuf descriptor) and stubs (example method responses) to help test gRPC implementations.</td>
      </tr>
      <tr>
          <td><a href="https://testcontainers.com/">Testcontainers</a></td>
          <td>Write code (e.g. rust) to create and interact (test)services (running in [Docker] containers).</td>
      </tr>
      <tr>
          <td><a href="https://connectrpc.com/">Connect</a></td>
          <td>(More than a) gRPC implementation used by FauxRPC</td>
      </tr>
      <tr>
          <td><a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a></td>
          <td>A command-line gRPC tool.</td>
      </tr>
  </tbody>
</table>
<p>I started following along with FauxRPC&rsquo;s <a href="https://fauxrpc.com/docs/testcontainers/">Testcontainers</a> example but, being unfamiliar with Connect, I wasn&rsquo;t familiar with its Eliza service. The service is available on <code>demo.connectrpc.com:443</code> and is described using <a href="https://github.com/connectrpc/examples-go/blob/main/proto/connectrpc/eliza/v1/eliza.proto"><code>eliza.proto</code></a> as part of <a href="https://github.com/connectrpc/examples-go"><code>examples-go</code></a>. Had I realized this sooner, I would have used this example rather than the Health Checking protocol.</p>
    </div>
    <a href="/posts/241025/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/google/" class="link blue hover-black">
            Tag: Google
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250429/" class="link black dim">
        Configuring Envoy to proxy Google Cloud Run v2
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m building an emulator for <a href="https://cloud.google.com/run">Cloud Run</a>. As I considered the solution, I assumed (more later) that I could implement Google&rsquo;s gRPC interface for <a href="https://github.com/googleapis/googleapis/tree/83df85b45a5d3e85b48f2571e1c8e57cdfd57e6c/google/cloud/run">Cloud Run</a> and use <a href="https://www.envoyproxy.io/">Envoy</a> to proxy HTTP/REST requests to the gRPC service using Envoy&rsquo;s <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/grpc_json_transcoder_filter">gRPC-JSON transcoder</a>.</p>
<p>Google calls this process <a href="https://cloud.google.com/endpoints/docs/grpc/transcoding">Transcoding HTTP/JSON to gRPC</a> which I think it a better description.</p>
<p>Google&rsquo;s Cloud Run <code>v2</code> (<code>v1</code> is no longer published to the <a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a> repo) <a href="https://github.com/googleapis/googleapis/blob/83df85b45a5d3e85b48f2571e1c8e57cdfd57e6c/google/cloud/run/v2/service.proto"><code>service.proto</code></a> includes the following <code>Services</code> definition for <code>CreateService</code>:</p>
    </div>
    <a href="/posts/250429/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250213/" class="link black dim">
        gRPC Firestore `Listen` in Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Obsessing on <a href="/posts/250210/">gRPC Firestore <code>Listen</code></a> somewhat but it&rsquo;s also a good learning opportunity for me to write stuff in Rust. This doesn&rsquo;t work against Google&rsquo;s public endpoint (possibly for the same reason that gRPCurl doesn&rsquo;t work either) but this does work against the Go server described in the other post.</p>
<p>I&rsquo;m also documenting here because I always encounter challenges using TLS with Rust (and this documents 2 working ways to do this with gRPC) as well as references two interesting (rust) examples that use Google services.</p>
    </div>
    <a href="/posts/250213/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250210/" class="link black dim">
        gRPC Firestore `Listen`
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A question on Stack overflow <a href="https://stackoverflow.com/questions/79422094">Firestore gRPC Listen does not send deletions</a> piqued by interest but created a second problem for me: I&rsquo;m unable to get its <a href="https://cloud.google.com/firestore/docs/reference/rpc/google.firestore.v1#google.firestore.v1.Firestore.Listen"><code>Listen</code></a> method to work using <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a>.</p>
<p>For what follows, you will need:</p>
<ol>
<li>a Google Project with Firestore enabled and a database (default: <code>(default)</code>) containing a Collection (e.g. <code>Dogs</code>) with at least one Document (e.g. <code>freddie</code>)</li>
<li><a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a> cloned locally in order to access Protobufs</li>
</ol>
<h2 id="summary">Summary</h2>
<table>
  <thead>
      <tr>
          <th>client</th>
          <th>server</th>
          <th>R</th>
          <th>See</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>gRPCurl</code></td>
          <td><code>firestore.googleapis.com:443</code></td>
          <td>✅</td>
          <td><a href="#grpcurl-listen-against-google-endpoint">link</a></td>
      </tr>
      <tr>
          <td>Go client</td>
          <td><code>firestore.googleapis.com:443</code></td>
          <td>✅</td>
          <td><a href="#go-client-listen-against-google-endpoint">link</a></td>
      </tr>
      <tr>
          <td><code>gRPCurl</code></td>
          <td>Go server</td>
          <td>✅</td>
          <td><a href="#grpcurl-listen-against-go-server">link</a></td>
      </tr>
      <tr>
          <td>Go client</td>
          <td>Go server</td>
          <td>✅</td>
          <td><a href="#go-client-listen-against-go-server">link</a></td>
      </tr>
  </tbody>
</table>
<p>I subsequently tried this using <a href="https://www.postman.com/">Postman</a> and it also works (✅).</p>
    </div>
    <a href="/posts/250210/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240409/" class="link black dim">
        Google Cloud Translation w/ gRPC 3 ways
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="general">General</h2>
<p>You&rsquo;ll need a Google Cloud project with Cloud Translation (<code>translate.googleapis.com</code>) enabled and a Service Account (and key) with suitable permissions in order to run the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BILLING<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Billing ID (gcloud billing accounts list)</span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Project ID</span>
</span></span><span style="display:flex;"><span>ACCOUNT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tester&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>EMAIL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span><span style="color:#e6db74">@</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">.iam.gserviceaccount.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ROLES<span style="color:#f92672">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/cloudtranslate.user&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/serviceusage.serviceUsageConsumer&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Project</span>
</span></span><span style="display:flex;"><span>gcloud projects create <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Associate Project with your Billing Account</span>
</span></span><span style="display:flex;"><span>gcloud billing accounts link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Enable Cloud Translation</span>
</span></span><span style="display:flex;"><span>gcloud services enable translate.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts create <span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account Key</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts keys create <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--iam-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update Project IAM permissions</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ROLE in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ROLES[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  gcloud projects add-iam-policy-binding <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --member<span style="color:#f92672">=</span>serviceAccount:<span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>ROLE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>For the code, you&rsquo;ll need to install <a href="https://github.com/protocolbuffers/protobuf"><code>protoc</code></a> and preferably have it in your path.</p>
    </div>
    <a href="/posts/240409/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230413/" class="link black dim">
        Filtering metrics w/ Google Managed Prometheus
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google has published two, very good blog posts on cost management:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/management-tools/learn-to-understand-and-reduce-cloud-monitoring-costs/">How to identify and reduce costs of your Google Cloud observability in Cloud Monitoring</a></li>
<li><a href="https://cloud.google.com/blog/topics/cost-management/how-to-approach-cloud-logging-pricing-for-cloud-admins">Cloud Logging pricing for Cloud Admins: How to approach it &amp; save cost</a></li>
</ul>
<p>This post is about my application cost reductions for Cloud Monitoring for <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>.</p>
<p>I&rsquo;m pleased with <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Google Cloud Managed Service for Prometheus</a> (hereinafter GMP). I&rsquo;ve a strong preference for letting service providers run components of <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> that I consider important but non-differentiating.</p>
    </div>
    <a href="/posts/230413/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221128/" class="link black dim">
        Maintaining Container Images
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>As I contemplate moving my &ldquo;thing&rdquo; into production, I&rsquo;m anticipating aspects of the application that need maintenance and how this can be automated.</p>
<p>I&rsquo;d been negligent in the maintenance of some of my container images.</p>
<p>I&rsquo;m using mostly Go and some Rust as the basis of static(ally-compiled) binaries that run in these containers <strong>but</strong> not every container has a base image of <a href="https://hub.docker.com/_/scratch"><code>scratch</code></a>. <code>scratch</code> is the <strong>only</strong> base image that doesn&rsquo;t change and thus the only base image that doesn&rsquo;t require that container images buit <code>FROM</code> it, be maintained.</p>
    </div>
    <a href="/posts/221128/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221117/" class="link black dim">
        Delegate domain-wide authority using Golang
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;d not used Google&rsquo;s <a href="https://developers.google.com/identity/protocols/oauth2/service-account#delegatingauthority">Domain-wide Delegation</a> from Golang and struggled to find example code.</p>
<p>Google provides Java and Python <a href="https://developers.google.com/identity/protocols/oauth2/service-account#authorizingrequests">samples</a>.</p>
<p>Google has a myriad packages implementing its OAuth security and it&rsquo;s always daunting trying to determine which one to use.</p>
<p>As it happens, I backed into the solution through <code>client.Options</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Google Workspace APIS don&#39;t use IAM do use OAuth scopes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Scopes used here must be reflected in the scopes on the</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Google Workspace Domain-wide Delegate client</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">scopes</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{ <span style="color:#f92672">...</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Delegates on behalf of this Google Workspace user</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">subject</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;a@google-workspace-email.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">creds</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">FindDefaultCredentialsWithParams</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ctx</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">CredentialsParams</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Scopes</span>: <span style="color:#a6e22e">scopes</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Subject</span>: <span style="color:#a6e22e">subject</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">opts</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">option</span>.<span style="color:#a6e22e">WithCredentials</span>(<span style="color:#a6e22e">creds</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">service</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">admin</span>.<span style="color:#a6e22e">NewService</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">opts</span>)
</span></span></code></pre></div><p>In this case <code>NewService</code> applies to Google&rsquo;s Golang <a href="https://pkg.go.dev/google.golang.org/api/admin/directory/v1">Admin SDK API</a> although the pattern of <code>NewService(ctx)</code> or <code>NewService(ctx, opts)</code> where <code>opts</code> is a <a href="https://pkg.go.dev/google.golang.org/api@v0.103.0/option#ClientOption"><code>option.ClientOption</code></a> is consistent across Google&rsquo;s Golang libraries.</p>
    </div>
    <a href="/posts/221117/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221110/" class="link black dim">
        Firestore Export &amp; Import
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using Firestore to maintain state in my &ldquo;thing&rdquo;.</p>
<p>In an attempt to ensure that I&rsquo;m able to restore the database, I run (Cloud Scheduler) scheduled backups (see <a href="/posts/220503/">Automating Scheduled Firestore Exports</a> and I&rsquo;ve been testing imports to ensure that the process works.</p>
<p>It does.</p>
<p>I thought I&rsquo;d document an important but subtle consideration with Firestore exports (which I&rsquo;d not initially understood).</p>
<p>Google facilitates that backup process with the sibling commands:</p>
    </div>
    <a href="/posts/221110/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211130/" class="link black dim">
        Automatic Certs w/ Golang gRPC service on Compute Engine
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I needed to deploy a <a href="https://github.com/grpc/grpc/blob/master/src/proto/grpc/health/v1/health.proto">healthcheck</a>-enabled gRPC TLS-enabled service. Fortunately, most (all?) of the SDKs include an implementation, e.g. Golang has <a href="https://github.com/grpc/grpc-go/tree/master/health"><code>grpc-go/health</code></a>.</p>
<p>I learned in my travels that:</p>
<ul>
<li>DigitalOcean [App] platform does not (<a href="https://www.digitalocean.com/community/questions/app-platform-http-2-support">link</a>) work with TLS-based gRPC apps.</li>
<li><a href="https://fly.io">Fly</a> has a regression (<a href="https://community.fly.io/t/urgent-grpc-server-unreachable-via-grpcurl/2694/5">link</a>) that breaks gRPC</li>
</ul>
<p>So, I resorted to Google Cloud Platform (GCP). Although Cloud Run would be well-suited to running the gRPC app, it uses a proxy|sidecar to provision a cert for the app and I wanted to be able to (easily use a custom domain) and give myself a somewhat general-purpose solution.</p>
    </div>
    <a href="/posts/211130/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210520/" class="link black dim">
        Consul discovers Google Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a basic <code>discoverer</code> of Google <a href="https://cloud.google.com/run">Cloud Run</a> services. This is for a project and it extends work done in some previous posts to <a href="/posts/210519/">Multiplex gRPC and Prometheus with Cloud Run</a> and to use <a href="/posts/210419/">Consul for Prometheus service discovery</a>.</p>
<p>This solution:</p>
<ul>
<li>Accepts a set of Google Cloud Platform (GCP) projects</li>
<li>Trawls them for Cloud Run services</li>
<li>Assumes that the services expose Prometheus metrics on <code>:443/metrics</code></li>
<li>Relabels the services</li>
<li>Surfaces any discovered Cloud Run services&rsquo; metrics in Prometheus</li>
</ul>
<p>You&rsquo;ll need Docker and Docker Compose.</p>
    </div>
    <a href="/posts/210520/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210519/" class="link black dim">
        Multiplexing gRPC and HTTP (Prometheus) endpoints with Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google <a href="https://cloud.google.com/run">Cloud Run</a> is useful but, each service is limited to exposing a single port. This caused me problems with a gRPC service that serves (non-gRPC) Prometheus metrics because customarily, you would serve gRPC on one port and the Prometheus metrics on another.</p>
<p>Fortunately, <a href="https://github.com/soheilhy/cmux">cmux</a> provides a solution by providing a mechanism that multiplexes both services (gRPC and HTTP) on a single port!</p>
<blockquote>
<p><strong>TL;DR</strong> See the cmux <a href="https://github.com/soheilhy/cmux#limitations">Limitations</a> and use:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#a6e22e">grpcl</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">MatchWithWriters</span>(
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">cmux</span>.<span style="color:#a6e22e">HTTP2MatchHeaderFieldSendSettings</span>(<span style="color:#e6db74">&#34;content-type&#34;</span>, <span style="color:#e6db74">&#34;application/grpc&#34;</span>))
</span></span></code></pre></div></blockquote>
<p>Extending the <a href="https://github.com/soheilhy/cmux#how-to">example</a> from the cmux repo:</p>
    </div>
    <a href="/posts/210519/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210506/" class="link black dim">
        Firestore Golang Timestamps &amp; Merging
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using Google&rsquo;s <a href="https://pkg.go.dev/cloud.google.com/go/firestore#DocumentRef">Golang SDK for Firestore</a>. The experience is excellent and I&rsquo;m quickly becoming a fan of Firestore. However, as a Golang Firestore developer, I&rsquo;m feeling less loved and some of the concepts in the database were causing me a conundrum.</p>
<p>I&rsquo;m still not entirely certain that I have Timestamps nailed but&hellip; I learned an important lesson on the auto-creation of Timestamps in documents and how to retain these values.</p>
    </div>
    <a href="/posts/210506/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210413/" class="link black dim">
        Cloud Firestore Triggers in Golang
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was pleased to discover that Google provides a non-Node.JS mechanism to subscribe to and act upon Firestore triggers, <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Google Cloud Firestore Triggers</a>. I&rsquo;ve nothing against Node.JS but, for the project i&rsquo;m developing, everything else is written in Golang. It&rsquo;s good to keep it all in one language.</p>
<p>I&rsquo;m perplexed that Cloud Functions still (!) only supports Go 1.13 (03-Sep-2019). Even <a href="https://golang.org/doc/devel/release.html#go1.14">Go 1.14</a> (25-Feb-2020) was released pre-pandemic and we&rsquo;re now running on 1.16. Come on Google!</p>
    </div>
    <a href="/posts/210413/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210317/" class="link black dim">
        Using Golang with the Firestore Emulator
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><img src="/images/210317.firebase.firestore.docs.png" alt="Firestore"></p>
<p>This works great but it wasn&rsquo;t clearly documented for non-Firebase users. I assume it will work, as well, for any of the client libraries (not just Golang).</p>
<p>Assuming you have some (Golang) code (in this case using the Google Cloud Client Library) that interacts with a Firestore database. Something of the form:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Golang" data-lang="Golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;crypto/sha256&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;cloud.google.com/go/firestore&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sha256</span>.<span style="color:#a6e22e">New</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#a6e22e">s</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%x&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Sum</span>(<span style="color:#66d9ef">nil</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Dog</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Name</span>    <span style="color:#66d9ef">string</span>                 <span style="color:#e6db74">`firestore:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Age</span>     <span style="color:#66d9ef">int</span>                    <span style="color:#e6db74">`firestore:&#34;age&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Human</span>   <span style="color:#f92672">*</span><span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">DocumentRef</span> <span style="color:#e6db74">`firestore:&#34;human&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Created</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>              <span style="color:#e6db74">`firestore:&#34;created&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewDog</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">age</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">human</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">DocumentRef</span>) <span style="color:#a6e22e">Dog</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Dog</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>:    <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Age</span>:     <span style="color:#a6e22e">age</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Human</span>:   <span style="color:#a6e22e">human</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Created</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(),
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">d</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Dog</span>) <span style="color:#a6e22e">ID</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Human</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`firestore:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">h</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Human</span>) <span style="color:#a6e22e">ID</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">project</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;PROJECT&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">NewClient</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">project</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;FIRESTORE_EMULATOR_HOST&#34;</span>); <span style="color:#a6e22e">value</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Using Firestore Emulator: %s&#34;</span>, <span style="color:#a6e22e">value</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">me</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Human</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;me&#34;</span>,
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">meDocRef</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Collection</span>(<span style="color:#e6db74">&#34;humans&#34;</span>).<span style="color:#a6e22e">Doc</span>(<span style="color:#a6e22e">me</span>.<span style="color:#a6e22e">ID</span>())
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">meDocRef</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">me</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">freddie</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewDog</span>(<span style="color:#e6db74">&#34;Freddie&#34;</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">meDocRef</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">freddieDocRef</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Collection</span>(<span style="color:#e6db74">&#34;dogs&#34;</span>).<span style="color:#a6e22e">Doc</span>(<span style="color:#a6e22e">freddie</span>.<span style="color:#a6e22e">ID</span>())
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">freddieDocRef</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">freddie</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Then you can interact instead with the Firestore Emulator.</p>
    </div>
    <a href="/posts/210317/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210316/" class="link black dim">
        Programmatically deploying Cloud Run services (Golang|Python)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Phew! Programmitcally deploying Cloud Run services should be easy but it didn&rsquo;t find it so.</p>
<p>My issues were that the Cloud Run Admin (!) API is poorly documented and it uses non-standard endpoints (thanks Sal!). Here, for others who may struggle with this, is how I got this to work.</p>
<h2 id="goal">Goal</h2>
<p>Programmatically (have Golang, Python, want Rust) deploy services to Cloud Run.</p>
<p>i.e. achieve this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud run deploy <span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--image<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--platform<span style="color:#f92672">=</span>managed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--no-allow-unauthenticated <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--region<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><blockquote>
<p><strong>TRICK</strong> <a href="https://cloud.google.com/sdk/gcloud/reference#--log-http"><code>--log-http</code></a> is your friend</p>
    </div>
    <a href="/posts/210316/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201203/" class="link black dim">
        webmention
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Let&rsquo;s see if this works!?</p>
<p>I&rsquo;ve added the following link to this site&rsquo;s <code>baseof.html</code> so that it is now rendered for each page:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-HTML" data-lang="HTML"><span style="display:flex;"><span>&lt;<span style="color:#f92672">link</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://us-central1-webmention.cloudfunctions.net/webmention&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;webmention&#34;</span> /&gt;
</span></span></code></pre></div><p>I discovered <a href="https://indieweb.org/">indieweb</a> yesterday reading about <a href="https://aaronparecki.com/2018/06/30/11/your-first-webmention">webmention</a>. Who knows what got me to webmention!?</p>
<p>The principles of both are sound. Instead of relying on come-go behemoths to run our digital world, indieweb seeks to provide technologies that enable us to achieve things without them. webmention is a cross-walled-garden mechanism to perform an evolved form of pingbacks. If X references one of Y&rsquo;s posts, X&rsquo;s server notifies Y&rsquo;s server during publication through a webmention service and, Y can then decide to add reference counts of copies of the referring link to their page. Clever.</p>
    </div>
    <a href="/posts/201203/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200930/" class="link black dim">
        Hugo and Google Cloud Storage
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using <a href="https://gohugo.io">Hugo</a> as a static site generator for <a href="https://pretired.dazwilkin.com">this</a> blog. I&rsquo;m using <a href="https://firebase.google.com">Firebase</a> (for free) to host <a href="https://lefsilver.com">lefsilver</a>.</p>
<p>I have other domains that I want to promote and decided to use Google Cloud Storage buckets for these sites. Using <a href="https://cloud.google.com/storage">Google Cloud Storage</a> for <a href="https://cloud.google.com/storage/docs/hosting-static-website">Hosting a static website</a> and using Hugo to deploy sites to <a href="https://gohugo.io/hosting-and-deployment/hugo-deploy/#google-cloud-storage-gcs">Google Cloud Storage (GCS)</a> are documented but, I didn&rsquo;t find a location where this is combined into a single tutorial and I wanted to add an explanation for ensuring your sites are included in Google&rsquo;s and Bing&rsquo;s search indexes.</p>
    </div>
    <a href="/posts/200930/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200916/" class="link black dim">
        Actions SDK Conversational Quickstart
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google&rsquo;s tutorial didn&rsquo;t work for me.</p>
<p>In this post, I&rsquo;ll help you get this working.</p>
<p><a href="https://developers.google.com/assistant/conversational/quickstart">https://developers.google.com/assistant/conversational/quickstart</a></p>
<h2 id="create-and-set-up-a-project"><a href="https://developers.google.com/assistant/conversational/quickstart">Create and set up a project</a></h2>
<p>This mostly works.</p>
<p>I recommend using the <a href="https://console.actions.google.com">Actions Console</a> as described to create the project.</p>
<p>I chose &ldquo;Custom&rdquo; and &ldquo;Blank Project&rdquo;</p>
<p>You need <strong>not</strong> enable <a href="https://console.developers.google.com/apis/library/actions.googleapis.com?q=actions">Actions API</a> as this is done automatically:</p>
<p><img src="/images/200916.api_library.png" alt="Actions API"></p>
<p>For the console work, I&rsquo;m going to use Google&rsquo;s excellent Cloud Shell. You may access this through the browser <strong>or</strong> through a terminal:</p>
    </div>
    <a href="/posts/200916/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200617/" class="link black dim">
        WASM Cloud Functions
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Following on from <a href="/posts/200612/">waPC &amp; Protobufs</a> and a question on Stack Overflow about Cloud Functions, I was compelled to try running WASM on Cloud Functions no JavaScript.</p>
<p>I wanted to reuse the WASM waPC functions that I&rsquo;d written in Rust as described in the other post. Cloud Functions does not (yet!?) provide a Rust runtime and so I&rsquo;m using the <a href="https://github.com/wapc/wapc-go">waPC Host for Go</a> in this example.</p>
<p>It works!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PARAMS<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>printf <span style="color:#e6db74">&#39;{&#34;a&#34;:{&#34;real&#34;:39,&#34;imag&#34;:3},&#34;b&#34;:{&#34;real&#34;:39,&#34;imag&#34;:3}}&#39;</span> | base64<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>gcloud auth print-identity-token<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;filename\&#34;:\&#34;complex.wasm\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;function\&#34;:\&#34;c:mul\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;params\&#34;:\&#34;</span><span style="color:#e6db74">${</span>PARAMS<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#34;</span> |<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request POST <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--data @- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span>-<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>.cloudfunctions.net/invoker
</span></span></code></pre></div><p>yields (correctly):</p>
    </div>
    <a href="/posts/200617/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200403/" class="link black dim">
        Rust Crate Transparency &amp;&amp; Rust SDK for Google Trillian
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m noodling the utility of a Transparency solution for Rust Crates. When developers push crates to Cargo, a bunch of metadata is associated with the crate. E.g. <a href="https://crates.io/crates/protobuf"><code>protobuf</code></a>. As with Golang Modules, Python packages on PyPi etc., there appears to be utility in making tamperproof recordings of these publications. Then, other developers may confirm that a crate pulled from cates.io is highly unlikely to have been changed.</p>
<p>On Linux, Cargo stores downloaded crates under <code>${HOME}/.crates/registry</code>. In the case of the latest version (<code>2.12.0</code>) of <code>protobuf</code>, on my machine, I have:</p>
    </div>
    <a href="/posts/200403/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200326/" class="link black dim">
        Google Trillian on Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written previously (<a href="https://medium.com/google-cloud/google-trillian-for-noobs-1a-c87a78e5e585">Google Trillian for Noobs</a>) about Google&rsquo;s interesting project <a href="https://github.com/google/trillian">Trillian</a> and about some of the &ldquo;personalities&rdquo; (e.g. <a href="/posts/190907/">PyPi Transparency</a>) that I&rsquo;ve build using it.</p>
<p>Having gone slight cra-cra on <a href="https://cloud.google.com/run">Cloud Run</a> and <a href="https://grpc.io">gRPC</a> this week with <a href="/posts/200320/">Golang gRPC Cloud Run</a> and <a href="/posts/200325/">gRPC, Cloud Run &amp; Endpoints</a>, I thought it&rsquo;d be fun to deploy Trillian and a personality to Cloud Run.</p>
<p>It mostly (!) works :-)</p>
<p>At the end of the post, I&rsquo;ve summarized creating a Cloud SQL instance to host the Trillian data(base).</p>
    </div>
    <a href="/posts/200326/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200325/" class="link black dim">
        gRPC, Cloud Run &amp; Endpoints
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>&lt;3 Google but there&rsquo;s quite often an assumption that we&rsquo;re all sitting around the engineering table and, of course, we&rsquo;re not.</p>
<p><a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> is a powerful offering but &ndash; IMO &ndash; it&rsquo;s <strong>super</strong> confusing to understand and complex to deploy.</p>
<p>If you&rsquo;re familiar with the motivations behind service meshes (e.g. <a href="https://istio.io">Istio</a>), Cloud Endpoints fits in a similar niche (&ldquo;neesh&rdquo; or &ldquo;nitch&rdquo;?). The underlying ambition is that, developers can take <strong>existing</strong> code and by adding a proxy (or sidecar), general-purpose abstractions, security, logging etc. may be added.</p>
    </div>
    <a href="/posts/200325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200320/" class="link black dim">
        Golang gRPC Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>Update: 2020-03-24</strong>: Since writing this post, I&rsquo;ve contributed <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/12">Golang</a> and <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/15">Rust</a> samples to Google&rsquo;s project. I recommend you start there.</p></blockquote>
<p>Google explained how to run gRPC servers with Cloud Run. The examples are good but only Python and Node.JS:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/compute/serve-cloud-run-requests-with-grpc-not-just-http">gRPC comes to Cloud Run</a></li>
<li><a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example">gRPC in Google Cloud Run</a></li>
</ul>
<p>Missing Golang&hellip;. until now ;-)</p>
<p>I had problems with 1.14 and so I&rsquo;m using 1.13.</p>
<h2 id="project-structure">Project structure</h2>
<p>I&rsquo;ll tidy up my repo but the code may be found:</p>
    </div>
    <a href="/posts/200320/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200207/" class="link black dim">
        Accessing GCR repos from Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Until today, I&rsquo;d not accessed a <a href="https://cloud.google.com/container-registry">Google Container Registry</a> repo from a <strong>non-GKE</strong> Kubernetes deployment.</p>
<p>It turns out that it&rsquo;s pretty well-documented (<a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/">link</a>) but, here&rsquo;s an end-end example.</p>
<p>Assuming:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BILLING<span style="color:#f92672">=[[</span>YOUR-BILLING<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=[[</span>YOUR-PROJECT<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>SERVER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;us.gcr.io&#34;</span>
</span></span></code></pre></div><p>If not already:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud projects create <span style="color:#f92672">{</span>$PROJECT<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud beta billing projects link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud services enable containerregistry.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><h2 id="container-registry">Container Registry</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>IMAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;busybox&#34;</span> <span style="color:#75715e"># Or ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker pull <span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker tag <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">${</span>SERVER<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker push <span style="color:#e6db74">${</span>SERVER<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud container images list-tags <span style="color:#e6db74">${</span>SERVER<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span></code></pre></div><h2 id="service-account">Service Account</h2>
<p>Create a service account that&rsquo;s permitted to download (read-only) images from this project&rsquo;s registry</p>
    </div>
    <a href="/posts/200207/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200206/" class="link black dim">
        Cloud Build wishlist: Mountable Golang Modules Proxy
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I think it would be valuable if Google were to provide volumes in <a href="https://cloud.google.com/cloud-build">Cloud Build</a> of package registries (e.g. <a href="https://proxy.golang.org">Go Modules</a>; <a href="https://pypi.org">PyPi</a>; <a href="https://search.maven.org/">Maven</a>; <a href="https://www.npmjs.com/">NPM</a> etc.).</p>
<p>Google provides a <a href="https://cloud.google.com/container-registry/docs/using-dockerhub-mirroring">mirror</a> of a subset of Docker Hub. This confers several benefits: Google&rsquo;s imprimatur; speed (latency); bandwidth; and convenience.</p>
<p>The same benefits would apply to package registries.</p>
<p>In the meantime, there&rsquo;s a hacky way to gain some of the benefits of these when using Cloud Build.</p>
<p>In the following example, I&rsquo;ll show an approach using Golang Modules and Google&rsquo;s module proxy aka <code>proxy.golang.org</code>.</p>
    </div>
    <a href="/posts/200206/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/exporter/" class="link blue hover-black">
            Tag: Exporter
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250227/" class="link black dim">
        Prometheus Exporter for USGS Water Data service
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m a little obsessed with creating Prometheus Exporters:</p>
<ul>
<li><a href="https://github.com/DazWilkin/azure-exporter">Prometheus Exporter for Azure</a></li>
<li><a href="https://github.com/DazWilkin/crtsh-exporter">Prometheus Exporter for crt.sh</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/goatcounter-exporter">Prometheus Exporter for GoatCounter</a></li>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud</a></li>
<li><a href="https://github.com/DazWilkin/koyeb-exporter">Prometheus Exporter for Koyeb</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/porkbun-exporter">Prometheus Exporter for PorkBun</a></li>
<li><a href="https://github.com/DazWilkin/updown-exporter">Prometheus Exporter for updown.io</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>All of these were written to scratch an itch.</p>
<p>In the case of the cloud platform exporters (Azure, Fly, Google, Linode, Vultr etc.), it&rsquo;s an overriding anxiety that I&rsquo;ll leave resources deployed on these platforms and, running an exporter that ships alerts to <a href="https://pushover.net/">Pushover</a> and Gmail, provides me a support mechanism for me.</p>
    </div>
    <a href="/posts/250227/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230709/" class="link black dim">
        Prometheus Exporter for Koyeb
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Yet another cloud platform exporter for resource|cost management. This time for <a href="https://www.koyeb.com/">Koyeb</a> with <a href="https://github.com/DazWilkin/koyeb-exporter">Koyeb Exporter</a>.</p>
<p>Deploying resources to cloud platforms generally incurs cost based on the number of resources deployed, the time each resource is deployed and the cost (per period of time) that the resource is deployed. It is useful to be able to automatically measure and alert on all the resources deployed on all the platforms that you&rsquo;re using and this is an intent of these exporters.</p>
    </div>
    <a href="/posts/230709/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230420/" class="link black dim">
        Prometheus Exporter for Azure (Container Apps)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written Prometheus Exporters for various cloud platforms. My motivation for writing these Exporters is that I want a unified mechanism to track my usage of these platform&rsquo;s services. It&rsquo;s easy to deploy a service on a platform and inadvertently leave it running (up a bill). The set of exporters is:</p>
<ul>
<li><a href="https://github.com/DazWilkin/azure-exporter">Prometheus Exporter for Azure</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for GCP</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>This post describes the recently-added Azure Exporter which only provides metrics for Container Apps and Resource Groups.</p>
    </div>
    <a href="/posts/230420/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220520/" class="link black dim">
        Prometheus Exporters for fly.io and Vultr
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been on a roll building utilities this week. I developed a Service Health dashboard for my &ldquo;thing&rdquo;, a <a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a> and today, a <a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a>. This is motivated by the fear that I will forget a deployed Cloud resource and incur a horrible bill.</p>
<p>I&rsquo;ve no written several Prometheus Exporters for cloud platforms:</p>
<ul>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for GCP</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>Each of them monitors resource deployments and produces resource count metrics that can be scraped by Prometheus and alerted with Alertmanager. I have Alertmanager <a href="https://prometheus.io/docs/alerting/latest/configuration/#pushover_config">configured</a> to send notifications to <a href="https://pushover.net">Pushover</a>. Last week I wrote an integration between <a href="/posts/220514/">Google Cloud Monitoring to send notifications to Pushover</a> too.</p>
    </div>
    <a href="/posts/220520/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200107/" class="link black dim">
        Google Home Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m obsessing over Prometheus exporters. First came <a href="/posts/191218/">Linode Exporter</a>, then <a href="/posts/191220/">GCP Exporter</a> and, on Sunday, I stumbled upon a reverse-engineered <a href="https://rithvikvibhu.github.io/GHLocalApi/">API for Google Home</a> devices and so wrote a very basic <a href="https://github.com/DazWilkin/gohome">Google Home SDK</a> and a similarly basic <a href="https://github.com/DazWilkin/home-exporter">Google Home Exporter</a>:</p>
<p><img src="/images/200107.home-exporter.png" alt="Prometheus Graphs"></p>
<p>The SDK only implements <code>/setup/eureka_info</code> and then only some of the returned properties. There&rsquo;s not a lot of metric-like data to use besides <code>SignalLevel</code> (<code>signal_level</code>) and <code>NoiseLevel</code> (<code>noise_level</code>). I&rsquo;m not clear on the meaning of some of the properties.</p>
    </div>
    <a href="/posts/200107/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191220/" class="link black dim">
        Google Cloud Platform (GCP) Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Earlier this week I discussed a <a href="/posts/191218/">Linode Prometheus Exporter</a>.</p>
<p>I <a href="https://github.com/metalmatze/digitalocean_exporter/pull/5">added</a> metrics for <a href="https://www.digitalocean.com/products/kubernetes/">Digital Ocean&rsquo;s Managed Kubernetes service</a> to <a href="https://github.com/metalmatze">@metalmatze</a>&rsquo;s <a href="https://github.com/metalmatze/digitalocean_exporter">Digital Ocean Exporter</a>.</p>
<p>This left, metrics for <a href="https://cloud.google.com">Google Cloud Platform (GCP)</a> which has, for many years, been my primary cloud platform. So, today I wrote <a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud Platform</a>.</p>
<p>All 3 of these exporters follow the template laid down by @metalmatze and, because each of these services has a well-written Golang SDK, it&rsquo;s straightforward to implement an exporter for each of them.</p>
    </div>
    <a href="/posts/191220/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191218/" class="link black dim">
        Linode Prometheus Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I enjoy using <a href="https://prometheus.io">Prometheus</a> and have toyed around with it for some time particularly in combination with Kubernetes. I signed up with <a href="https://www.linode.com/?r=9ab7d75b764e143a1b3b467390c852b2c56cd704">Linode</a> [referral] compelled by the addition of a managed Kubernetes service called <a href="https://www.linode.com/products/kubernetes/">Linode Kubernetes Engine (LKE)</a>. I have an anxiety that I&rsquo;ll inadvertently leave resources running (unused) on a cloud platform. Instead of refreshing the relevant billing page, it struck me that Prometheus may (not yet proven) help.</p>
<p>The hypothesis is that a combination of a cloud-specific Prometheus <a href="https://prometheus.io/docs/instrumenting/exporters/">exporter</a> reporting aggregate uses of e.g. Linodes (instances), NodeBalancers, Kubernetes clusters etc., could form the basis of an alert mechanism using Prometheus&rsquo; <a href="https://prometheus.io/docs/alerting/overview/">alerting</a>.</p>
    </div>
    <a href="/posts/191218/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/golang/" class="link blue hover-black">
            Tag: Golang
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250227/" class="link black dim">
        Prometheus Exporter for USGS Water Data service
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m a little obsessed with creating Prometheus Exporters:</p>
<ul>
<li><a href="https://github.com/DazWilkin/azure-exporter">Prometheus Exporter for Azure</a></li>
<li><a href="https://github.com/DazWilkin/crtsh-exporter">Prometheus Exporter for crt.sh</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/goatcounter-exporter">Prometheus Exporter for GoatCounter</a></li>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud</a></li>
<li><a href="https://github.com/DazWilkin/koyeb-exporter">Prometheus Exporter for Koyeb</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/porkbun-exporter">Prometheus Exporter for PorkBun</a></li>
<li><a href="https://github.com/DazWilkin/updown-exporter">Prometheus Exporter for updown.io</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>All of these were written to scratch an itch.</p>
<p>In the case of the cloud platform exporters (Azure, Fly, Google, Linode, Vultr etc.), it&rsquo;s an overriding anxiety that I&rsquo;ll leave resources deployed on these platforms and, running an exporter that ships alerts to <a href="https://pushover.net/">Pushover</a> and Gmail, provides me a support mechanism for me.</p>
    </div>
    <a href="/posts/250227/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/241025/" class="link black dim">
        FauxRPC using gRPCurl, Golang and rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Read <a href="https://kmcd.dev/posts/fauxrpc-testcontainers/">FauxRPC + Testcontainers</a> on Hacker News and was intrigued. I spent a little more time &ldquo;evaluating&rdquo; this than I&rsquo;d planned because I&rsquo;m forcing myself to use rust as much as possible and my ignorance (see below) caused me some challenges.</p>
<p>The technology is interesting and works well. The experience helped me explore <a href="https://testcontainers.com/">Testcontainers</a> too which I&rsquo;d heard about but not explored until this week.</p>
<p>For my future self:</p>
<table>
  <thead>
      <tr>
          <th>What</th>
          <th>What?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="https://fauxrpc.com/">FauxRPC</a></td>
          <td>A general-purpose tool (built using <a href="https://buf.build/">Buf</a>&rsquo;s <a href="https://connectrpc.com/">Connect</a>) that includes registry and stub (gRPC) services that can be (programmatically) configured (using a Protobuf descriptor) and stubs (example method responses) to help test gRPC implementations.</td>
      </tr>
      <tr>
          <td><a href="https://testcontainers.com/">Testcontainers</a></td>
          <td>Write code (e.g. rust) to create and interact (test)services (running in [Docker] containers).</td>
      </tr>
      <tr>
          <td><a href="https://connectrpc.com/">Connect</a></td>
          <td>(More than a) gRPC implementation used by FauxRPC</td>
      </tr>
      <tr>
          <td><a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a></td>
          <td>A command-line gRPC tool.</td>
      </tr>
  </tbody>
</table>
<p>I started following along with FauxRPC&rsquo;s <a href="https://fauxrpc.com/docs/testcontainers/">Testcontainers</a> example but, being unfamiliar with Connect, I wasn&rsquo;t familiar with its Eliza service. The service is available on <code>demo.connectrpc.com:443</code> and is described using <a href="https://github.com/connectrpc/examples-go/blob/main/proto/connectrpc/eliza/v1/eliza.proto"><code>eliza.proto</code></a> as part of <a href="https://github.com/connectrpc/examples-go"><code>examples-go</code></a>. Had I realized this sooner, I would have used this example rather than the Health Checking protocol.</p>
    </div>
    <a href="/posts/241025/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240528/" class="link black dim">
        Using Delve to debug Go containers on Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>An interesting <a href="https://stackoverflow.com/questions/78537605">question</a> on Stack overflow prompted me to understand how to use Visual Studio Code and <a href="https://github.com/go-delve/delve">Delve</a> to remotely debug a Golang app running on Kubernetes (MicroK8s).</p>
<p>The OP is using <a href="https://github.com/gin-gonic/gin">Gin</a> which was also new to me so the question gave me an opportunity to try out several things.</p>
<h2 id="sources">Sources</h2>
<p>A simple <code>healthz</code> handler:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;flag&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log/slog&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">addr</span> = <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;addr&#34;</span>, <span style="color:#e6db74">&#34;0.0.0.0:8080&#34;</span>, <span style="color:#e6db74">&#34;HTTP server endpoint&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">healthz</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">String</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusOK</span>, <span style="color:#e6db74">&#34;ok&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Parse</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/fib&#34;</span>, <span style="color:#a6e22e">handler</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;healthz&#34;</span>, <span style="color:#a6e22e">healthz</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server starting&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server error&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;err&#34;</span>, <span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">addr</span>),
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>Containerfile</code>:</p>
    </div>
    <a href="/posts/240528/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240409/" class="link black dim">
        Google Cloud Translation w/ gRPC 3 ways
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="general">General</h2>
<p>You&rsquo;ll need a Google Cloud project with Cloud Translation (<code>translate.googleapis.com</code>) enabled and a Service Account (and key) with suitable permissions in order to run the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BILLING<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Billing ID (gcloud billing accounts list)</span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Project ID</span>
</span></span><span style="display:flex;"><span>ACCOUNT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tester&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>EMAIL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span><span style="color:#e6db74">@</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">.iam.gserviceaccount.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ROLES<span style="color:#f92672">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/cloudtranslate.user&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/serviceusage.serviceUsageConsumer&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Project</span>
</span></span><span style="display:flex;"><span>gcloud projects create <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Associate Project with your Billing Account</span>
</span></span><span style="display:flex;"><span>gcloud billing accounts link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Enable Cloud Translation</span>
</span></span><span style="display:flex;"><span>gcloud services enable translate.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts create <span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account Key</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts keys create <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--iam-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update Project IAM permissions</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ROLE in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ROLES[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  gcloud projects add-iam-policy-binding <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --member<span style="color:#f92672">=</span>serviceAccount:<span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>ROLE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>For the code, you&rsquo;ll need to install <a href="https://github.com/protocolbuffers/protobuf"><code>protoc</code></a> and preferably have it in your path.</p>
    </div>
    <a href="/posts/240409/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240405/" class="link black dim">
        Google Cloud Events protobufs and SDKs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written before about <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s use of <a href="https://cloud.google.com/firestore">Firestore</a> and subscribing to Firestore document CRUD events:</p>
<ul>
<li><a href="/posts/230530/">Routing Firestore events to GKE with Eventarc</a></li>
<li><a href="/posts/210413/">Cloud Firestore Triggers in Golang</a> using <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Firestore triggers</a></li>
</ul>
<p>I find Google&rsquo;s <a href="cloud.google.com/eventarc">Eventarc</a> documentation to be confusing and, in typical Google fashion, even though open-sourced, you often need to do some legwork to find relevant sources, viz:</p>
<ul>
<li>Google&rsquo;s Protobufs for Eventarc (using <a href="https://cloudevents.io/">cloudevents</a>) <a href="https://github.com/googleapis/google-cloudevents"><code>google-cloudevents</code></a><sup>1</sup></li>
<li>Convenience (since you can generate these using <code>protoc</code>) language-specific types generated from the above e.g. <a href="https://github.com/googleapis/google-cloudevents-go"><code>google-cloudevents-go</code></a>; <a href="https://github.com/googleapis/google-cloudevents-python"><code>google-cloudevents-python</code></a> etc.</li>
</ul>
<p><sup>1</sup> &ndash; IIUC EventArc is the Google service. It carries Google Events that are CloudEvents. These are defined by protocol buffers schemas.</p>
    </div>
    <a href="/posts/240405/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240325/" class="link black dim">
        Prost! Tonic w/ a dash of JSON
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I naively (!) began exploring JSON marshaling of Protobufs in rust. Other protobuf language SDKs include JSON marshaling making the process straightforward. I was to learn that, in rust, it&rsquo;s not so simple. Unfortunately, for me, this continues to discourage my further use of rust (rust is just hard).</p>
<p>My goal was to marshal an arbitrary protocol buffer message that included a <a href="https://protobuf.dev/programming-guides/proto3/#oneof"><code>oneof</code></a> feature. I was unable to JSON marshal the rust generated by <code>tonic</code> for such a message.</p>
    </div>
    <a href="/posts/240325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240105/" class="link black dim">
        Navigating Koyeb&#39;s Golang SDK
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> deploys gRPC <a href="https://grpc.io/docs/guides/health-checking/">Health Checking</a> clients in locations around the World in order to health check services that are representative of customer need.</p>
<p><a href="https://koyeb.com">Koyeb</a> offers multiple locations and I spent time today writing a client for Ackal to integrate with Koyeb using the <a href="https://github.com/koyeb/koyeb-api-client-go">Golang client for the Koyeb API</a>.</p>
<p>The SDK is generated from Koyeb&rsquo;s OpenAPI (nee Swagger) <a href="https://developer.koyeb.com/public.swagger.json">endpoint</a> using <a href="https://github.com/OpenAPITools/openapi-generator-cli"><code>openapi-generator-cli</code></a>. This is a smart, programmatic solution to ensuring that the SDK always matches the API definition <strong>but</strong> I found the result is idiosyncratic and therefore a little gnarly.</p>
    </div>
    <a href="/posts/240105/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230314/" class="link black dim">
        Access Google Services using gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google publishes interface definitions of Google APIs (services) that support REST and gRPC in a repo called <a href="https://github.com/googleapis/googleapis">Google APIs</a>. Google&rsquo;s SDKs uses gRPC to access these services but, how to do this using e.g. <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a>?</p>
<p>I wanted to debug <a href="https://cloud.google.com/profiler/docs">Cloud Profiler</a> and its agent makes <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L83"><code>UpdateProfile</code></a> RPCs to <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L41"><code>cloudprofiler.googleapis.com</code></a>. Cloud Profiler is more challenging service to debug because (a) it&rsquo;s publicly &ldquo;write-only&rdquo;; and (b) it has complex messages. <code>UpdateProfile</code> sends <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L123"><code>UpdateProfileRequest</code></a> messages that include <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L123"><code>Profile</code></a> messages that include <code>profile_bytes</code> which are gzip compressed serialized protos of <a href="https://github.com/google/pprof">pprof</a>&rsquo;s <a href="https://github.com/google/pprof/blob/d61513b1440d93d62aad023cc60d7a33f3917b70/proto/profile.proto#L46"><code>Profile</code></a>.</p>
    </div>
    <a href="/posts/230314/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221128/" class="link black dim">
        Maintaining Container Images
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>As I contemplate moving my &ldquo;thing&rdquo; into production, I&rsquo;m anticipating aspects of the application that need maintenance and how this can be automated.</p>
<p>I&rsquo;d been negligent in the maintenance of some of my container images.</p>
<p>I&rsquo;m using mostly Go and some Rust as the basis of static(ally-compiled) binaries that run in these containers <strong>but</strong> not every container has a base image of <a href="https://hub.docker.com/_/scratch"><code>scratch</code></a>. <code>scratch</code> is the <strong>only</strong> base image that doesn&rsquo;t change and thus the only base image that doesn&rsquo;t require that container images buit <code>FROM</code> it, be maintained.</p>
    </div>
    <a href="/posts/221128/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221117/" class="link black dim">
        Delegate domain-wide authority using Golang
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;d not used Google&rsquo;s <a href="https://developers.google.com/identity/protocols/oauth2/service-account#delegatingauthority">Domain-wide Delegation</a> from Golang and struggled to find example code.</p>
<p>Google provides Java and Python <a href="https://developers.google.com/identity/protocols/oauth2/service-account#authorizingrequests">samples</a>.</p>
<p>Google has a myriad packages implementing its OAuth security and it&rsquo;s always daunting trying to determine which one to use.</p>
<p>As it happens, I backed into the solution through <code>client.Options</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Google Workspace APIS don&#39;t use IAM do use OAuth scopes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Scopes used here must be reflected in the scopes on the</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Google Workspace Domain-wide Delegate client</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">scopes</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{ <span style="color:#f92672">...</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Delegates on behalf of this Google Workspace user</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">subject</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;a@google-workspace-email.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">creds</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">FindDefaultCredentialsWithParams</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ctx</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">CredentialsParams</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Scopes</span>: <span style="color:#a6e22e">scopes</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Subject</span>: <span style="color:#a6e22e">subject</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">opts</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">option</span>.<span style="color:#a6e22e">WithCredentials</span>(<span style="color:#a6e22e">creds</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">service</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">admin</span>.<span style="color:#a6e22e">NewService</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">opts</span>)
</span></span></code></pre></div><p>In this case <code>NewService</code> applies to Google&rsquo;s Golang <a href="https://pkg.go.dev/google.golang.org/api/admin/directory/v1">Admin SDK API</a> although the pattern of <code>NewService(ctx)</code> or <code>NewService(ctx, opts)</code> where <code>opts</code> is a <a href="https://pkg.go.dev/google.golang.org/api@v0.103.0/option#ClientOption"><code>option.ClientOption</code></a> is consistent across Google&rsquo;s Golang libraries.</p>
    </div>
    <a href="/posts/221117/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221106/" class="link black dim">
        Basic programmatic access to GitHub Issues
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>It&rsquo;s been a while!</p>
<p>I&rsquo;ve been spending time writing Bash scripts and a web site but neither has been sufficiently creative that I&rsquo;ve felt worth a blog post.</p>
<p>As I&rsquo;ve been finalizing the web site, I needed an Issue Tracker and decided to leverage GitHub(&rsquo;s <a href="https://docs.github.com/en/issues">Issues</a>).</p>
<p>As a former Googler, I&rsquo;m familiar with Google&rsquo;s (excellent) internal issue tracking tool (Buganizer) and it&rsquo;s public manifestation <a href="https://issuetracker.google.com">Issue Tracker</a>. Google documents Issue Tracker and its <a href="https://developers.google.com/issue-tracker/concepts/issues">Issue</a> type which I&rsquo;ve mercilessly plagiarized in my implementation.</p>
    </div>
    <a href="/posts/221106/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211018/" class="link black dim">
        Golang Structured Logging w/ Google Cloud Logging (2)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>UPDATE</strong> There&rsquo;s an issue with my naive implementation of <code>RenderValuesHook</code> as described in this post. I summarized the problem in this <a href="https://github.com/go-logr/logr/issues/120">issue</a> where I&rsquo;ve outlined (hopefully) a more robust solution.</p></blockquote>
<p>Recently, I <a href="/posts/210928/">described</a> how to configure Golang logging so that user-defined key-values applied to the logs are parsed when ingested by <a href="https://cloud.google.com/logging">Google Cloud Logging</a>.</p>
<p>Here&rsquo;s an example of what we&rsquo;re trying to achieve. This is an example Cloud Logging log entry that incorporates user-defined labels (see <code>dog:freddie</code> and <code>foo:bar</code>) and a readily-querable <code>jsonPayload</code>:</p>
    </div>
    <a href="/posts/211018/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210928/" class="link black dim">
        Golang Structured Logging w/ Google Cloud Logging
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve multiple components in an app and these are deployed across multiple Google Cloud Platform (GCP) services: Kubernetes Engine, Cloud Functions, Cloud Run, etc. Almost everything is written in Golang and I started the project using <a href="https://github.com/go-logr/logr"><code>go-logr</code></a>.</p>
<p><code>logr</code> is in two parts: a <code>Logger</code> that you use to write log entries; a <code>LogSink</code> (adaptor) that consumes log entries and outputs them to a specific log implementation.</p>
<p>Initially, I defaulted to using <code>stdr</code> which is a <code>LogSink</code> for Go&rsquo;s standard logging implementation. Something similar to the module&rsquo;s <a href="https://github.com/go-logr/stdr/blob/master/example/main.go">example</a>:</p>
    </div>
    <a href="/posts/210928/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210924/" class="link black dim">
        GitHub help with dependency management
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This is very useful:</p>
<p><img src="/images/210924.notifications.png" alt="GitHub Notifications"></p>
<p>I am building an application that comprises multiple repos. I continue to procrastinate on whether using multiple repos vs. a monorepo was a good idea but, an issue that I have (had) is the need to ensure that the repos&rsquo; contents are using current|latest modules. GitHub can help.</p>
<p>Most of the application is written in Golang with a smattering of Rust and some JavaScript.</p>
    </div>
    <a href="/posts/210924/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210724/" class="link black dim">
        gRPC Interceptors and in-memory gRPC connections
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For&hellip; reasons, I wanted to pre-filter gRPC requests to check for authorization. Authorization is implemented as a &lsquo;micro-service&rsquo; and I wanted the authorization server to run in the same process as the gRPC client.</p>
<p>TL;DR:</p>
<ul>
<li>Shiju&rsquo;s <a href="https://shijuvar.medium.com/writing-grpc-interceptors-in-go-bf3e7671fe48">&ldquo;Writing gRPC Interceptors in Go&rdquo;</a> is great</li>
<li>This Stack overflow <a href="https://stackoverflow.com/a/52080545/609290">answer</a> ostensibly for writing unit tests for gRPC got me an in-process server</li>
</ul>
<p>What follows stands on these folks&rsquo; shoulders&hellip;</p>
<p>A key motivator for me to write blog posts is that helps me ensure that I understand things. Writing this post, I realized I&rsquo;d not researched gRPC Interceptors and, as luck would have it, I found some interesting content, not on <a href="https://grpc.io"><code>grpc.io</code></a> but on the <a href="https://github.com/grpc-ecosystem"><code>grpc-ecosystem</code></a> repo, specifically <a href="https://github.com/grpc-ecosystem/go-grpc-middleware">Go gRPC middleware</a>. But, I refer again to Shiju&rsquo;s clear and helpful <a href="https://shijuvar.medium.com/writing-grpc-interceptors-in-go-bf3e7671fe48">&ldquo;Writing gRPC Interceptors in Go&rdquo;</a></p>
    </div>
    <a href="/posts/210724/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210716/" class="link black dim">
        Stripe
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>It&rsquo;s been almost a month since my last post. I&rsquo;ve been occupied learning <a href="https://stripe.com">Stripe</a> and integrating it into an application that I&rsquo;m developing. The app benefits from a billing mechanism for prospective customers and, as far as I can tell, Stripe is the solution. I&rsquo;d be interested in hearing perspectives on alternatives.</p>
<p>As with any platform, there&rsquo;s good and bad and I&rsquo;ll summarize my perspective on Stripe here. It&rsquo;s been some time since I developed in JavaScript and this lack of familiarity has meant that the solution took longer than I wanted to develop. That said, before this component, I developed integration with <a href="https://firebase.google.com/products/auth">Firebase Authentication</a> and that required JavaScript&rsquo;ing too and that was much easier (and more enjoyable).</p>
    </div>
    <a href="/posts/210716/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210527/" class="link black dim">
        Struggling with Golang structs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Julia&rsquo;s post <a href="https://jvns.ca/blog/2021/05/24/blog-about-what-you-ve-struggled-with/">Blog about what you&rsquo;ve struggled with</a> resonates because I&rsquo;ve been struggling with Golang structs in a project. Not the definitions of structs but seemingly needing to reproduce them across the project. I realize that each instance of these resources differs from the others but I&rsquo;m particularly concerned by having to duplicate method implementations on them.</p>
<p>I&rsquo;m kinda hoping that I see the solution to my problem by writing it out. If you&rsquo;re reading this, I didn&rsquo;t :-(</p>
    </div>
    <a href="/posts/210527/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210506/" class="link black dim">
        Firestore Golang Timestamps &amp; Merging
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using Google&rsquo;s <a href="https://pkg.go.dev/cloud.google.com/go/firestore#DocumentRef">Golang SDK for Firestore</a>. The experience is excellent and I&rsquo;m quickly becoming a fan of Firestore. However, as a Golang Firestore developer, I&rsquo;m feeling less loved and some of the concepts in the database were causing me a conundrum.</p>
<p>I&rsquo;m still not entirely certain that I have Timestamps nailed but&hellip; I learned an important lesson on the auto-creation of Timestamps in documents and how to retain these values.</p>
    </div>
    <a href="/posts/210506/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210413/" class="link black dim">
        Cloud Firestore Triggers in Golang
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was pleased to discover that Google provides a non-Node.JS mechanism to subscribe to and act upon Firestore triggers, <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Google Cloud Firestore Triggers</a>. I&rsquo;ve nothing against Node.JS but, for the project i&rsquo;m developing, everything else is written in Golang. It&rsquo;s good to keep it all in one language.</p>
<p>I&rsquo;m perplexed that Cloud Functions still (!) only supports Go 1.13 (03-Sep-2019). Even <a href="https://golang.org/doc/devel/release.html#go1.14">Go 1.14</a> (25-Feb-2020) was released pre-pandemic and we&rsquo;re now running on 1.16. Come on Google!</p>
    </div>
    <a href="/posts/210413/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210317/" class="link black dim">
        Using Golang with the Firestore Emulator
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><img src="/images/210317.firebase.firestore.docs.png" alt="Firestore"></p>
<p>This works great but it wasn&rsquo;t clearly documented for non-Firebase users. I assume it will work, as well, for any of the client libraries (not just Golang).</p>
<p>Assuming you have some (Golang) code (in this case using the Google Cloud Client Library) that interacts with a Firestore database. Something of the form:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Golang" data-lang="Golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;crypto/sha256&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;cloud.google.com/go/firestore&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sha256</span>.<span style="color:#a6e22e">New</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#a6e22e">s</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%x&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Sum</span>(<span style="color:#66d9ef">nil</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Dog</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Name</span>    <span style="color:#66d9ef">string</span>                 <span style="color:#e6db74">`firestore:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Age</span>     <span style="color:#66d9ef">int</span>                    <span style="color:#e6db74">`firestore:&#34;age&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Human</span>   <span style="color:#f92672">*</span><span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">DocumentRef</span> <span style="color:#e6db74">`firestore:&#34;human&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Created</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>              <span style="color:#e6db74">`firestore:&#34;created&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewDog</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">age</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">human</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">DocumentRef</span>) <span style="color:#a6e22e">Dog</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Dog</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>:    <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Age</span>:     <span style="color:#a6e22e">age</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Human</span>:   <span style="color:#a6e22e">human</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Created</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(),
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">d</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Dog</span>) <span style="color:#a6e22e">ID</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Human</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`firestore:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">h</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Human</span>) <span style="color:#a6e22e">ID</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">project</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;PROJECT&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">NewClient</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">project</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;FIRESTORE_EMULATOR_HOST&#34;</span>); <span style="color:#a6e22e">value</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Using Firestore Emulator: %s&#34;</span>, <span style="color:#a6e22e">value</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">me</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Human</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;me&#34;</span>,
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">meDocRef</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Collection</span>(<span style="color:#e6db74">&#34;humans&#34;</span>).<span style="color:#a6e22e">Doc</span>(<span style="color:#a6e22e">me</span>.<span style="color:#a6e22e">ID</span>())
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">meDocRef</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">me</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">freddie</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewDog</span>(<span style="color:#e6db74">&#34;Freddie&#34;</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">meDocRef</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">freddieDocRef</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Collection</span>(<span style="color:#e6db74">&#34;dogs&#34;</span>).<span style="color:#a6e22e">Doc</span>(<span style="color:#a6e22e">freddie</span>.<span style="color:#a6e22e">ID</span>())
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">freddieDocRef</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">freddie</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Then you can interact instead with the Firestore Emulator.</p>
    </div>
    <a href="/posts/210317/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210316/" class="link black dim">
        Programmatically deploying Cloud Run services (Golang|Python)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Phew! Programmitcally deploying Cloud Run services should be easy but it didn&rsquo;t find it so.</p>
<p>My issues were that the Cloud Run Admin (!) API is poorly documented and it uses non-standard endpoints (thanks Sal!). Here, for others who may struggle with this, is how I got this to work.</p>
<h2 id="goal">Goal</h2>
<p>Programmatically (have Golang, Python, want Rust) deploy services to Cloud Run.</p>
<p>i.e. achieve this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud run deploy <span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--image<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--platform<span style="color:#f92672">=</span>managed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--no-allow-unauthenticated <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--region<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><blockquote>
<p><strong>TRICK</strong> <a href="https://cloud.google.com/sdk/gcloud/reference#--log-http"><code>--log-http</code></a> is your friend</p>
    </div>
    <a href="/posts/210316/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210222/" class="link black dim">
        Dapr
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>It&rsquo;s a good name, I read it as &ldquo;dapper&rdquo; but I frequently type &ldquo;darp&rdquo; :-(</p>
<p>Was interested to <a href="https://blog.dapr.io/posts/2021/02/17/announcing-dapr-v1.0/">read</a> that <a href="https://dapr.io/">Dapr</a> is now v1.0 and decided to check it out. I was initially confused between Dapr and service mesh functionality. But, having used Dapr, it appears to be more focused in aiding the development of (cloud-native) (distributed) apps by providing developers with abstractions for e.g. service discovery, eventing, observability whereas service meshes feel (!) more oriented towards simplifying the deployment of existing apps. Both use the concept of proxies, deployed alongside app components (as sidecars on Kubernetes) to provide their functionality to apps.</p>
    </div>
    <a href="/posts/210222/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201229/" class="link black dim">
        Kubernetes Webhooks
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I spent some time last week writing my first <a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/">admission webhook</a> for Kubernetes. I wrote the handler in Golang because I&rsquo;m most familiar with Golang and because, as Kubernetes&rsquo; native language, I was more confident that the necessary SDKs would exist and that the documentation would likely use Golang by default. I struggled to find useful documentation and so this post is to help you (and me!) remember how to do this next time!</p>
    </div>
    <a href="/posts/201229/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201113/" class="link black dim">
        Akri
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For the past couple of weeks, I&rsquo;ve been playing around with <a href="http://github.com/deislabs/akri">Akri</a>, a Microsoft (DeisLabs) project for <a href="https://cloudblogs.microsoft.com/opensource/2020/10/20/announcing-akri-open-source-project-building-connected-edge-kubernetes/">building a connected edge with Kubernetes</a>. Kubernetes, IoT, Rust (and Golang) make this all compelling to me.</p>
<p>Initially, I deployed an Akri <a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo.md">End-to-End</a> to <a href="https://microk8s.io/">MicroK8s</a> on Google Compute Engine (<a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo-gce.md">link</a>) and Digital Ocean (<a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo-do.md">link</a>). But I was interested to create me own example and so have proposed a very (!) simple <a href="https://github.com/DazWilkin/akri/blob/protocol-http/docs/extensibility-http.md">HTTP-based protocol</a>.</p>
<p>This blog summarizes my thoughts about Akri and an explanation of the HTTP protocol implementation in the hope that this helps others.</p>
    </div>
    <a href="/posts/201113/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201029/" class="link black dim">
        GitHub Actions &amp;&amp; GitHub Container Registry
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>You know when you start something and then regret it!? I think I&rsquo;ll be sticking with <a href="https://cloud.google.com/cloud-build">Google Cloud Build</a>; <a href="https://github.com/features/actions">GitHub Actions</a> appears functional and useful but I found the documentation to be confusing and limited and struggled to get a simple container image build|push working.</p>
<p>I&rsquo;ve long used <a href="https://hub.docker.com">Docker Hub</a> but am planning to use it less as a result of the planned <a href="https://www.docker.com/blog/scaling-docker-to-serve-millions-more-developers-network-egress/">changes</a>. I want to see Docker succeed and to do so it needs to find a way to make money but, there are free alternatives including the new <a href="https://github.blog/2020-09-01-introducing-github-container-registry/">GitHub Container Registry</a> and the very very cheap <a href="https://cloud.google.com/container-registry">Google Container Registry</a>.</p>
    </div>
    <a href="/posts/201029/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200908/" class="link black dim">
        Trillian Map Mode
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Chatting with one of Google&rsquo;s Trillian team, I was encouraged to explore Trillian&rsquo;s <a href="https://github.com/google/trillian#map-mode">Map Mode</a>. The following is the result of some spelunking through this unfamiliar cave. I can&rsquo;t provide any guarantee that this usage is correct or sufficient.</p>
<p>Here&rsquo;s the repo: <a href="https://github.com/DazWilkin/go-trillian-map">https://github.com/DazWilkin/go-trillian-map</a></p>
<p>I&rsquo;ve written about Trillian <a href="https://github.com/google/trillian#log-mode">Log Mode</a> <a href="/tags/trillian/">elsewhere</a>.</p>
<p>I uncovered use of Trillian Map Mode through Trillian&rsquo;s integration <a href="https://github.com/google/trillian/blob/master/integration/maptest/map.go">tests</a>. I&rsquo;m unclear on the distinction between <code>TrillianMapClient</code> and <code>TrillianMapWriteClient</code> but the latter served most of my needs.</p>
    </div>
    <a href="/posts/200908/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200817/" class="link black dim">
        WASM Transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been playing around with a proof-of-concept combining WASM and <a href="https://github.com/google/trillian">Trillian</a>. The hypothesis was to explore using WASM as a form of chaincode with Trillian. The project works but it&rsquo;s far from being a chaincode-like solution.</p>
<p>Let&rsquo;s start with a couple of (trivial) examples and then I&rsquo;ll explain what&rsquo;s going on and how it&rsquo;s implemented.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Method: mul
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [Client:Invoke] Metadata: complex.wasm
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Success: result:{real:0.036980484 imag:0.3898267}
</span></span></code></pre></div><p>After shipping a Rust-sourced WASM solution (<code>complex.wasm</code>) to the WASM transparency server, the client invokes a method <code>mul</code> that&rsquo;s exposed by it using a dynamically generated request message and outputs the response. Woo hoo! Yes, an expensive way to multiple complex numbers.</p>
    </div>
    <a href="/posts/200817/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200807/" class="link black dim">
        waPC and MsgPack (Rust|Golang)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>As my reader will know (Hey Mom!), I&rsquo;ve been noodling around with WASM and <a href="https://github.com/wapc">waPC</a>. I&rsquo;ve been exploring ways to pass structured messages across the host:guest boundary.</p>
<p><a href="https://developers.google.com/protocol-buffers">Protobufs</a> was my first choice. <a href="https://medium.com/@KevinHoffman">@KevinHoffman</a> created waPC and <a href="https://github.com/wascc">waSCC</a> and he <a href="https://medium.com/@KevinHoffman/interface-types-are-basically-a-way-of-embedding-metadata-into-a-wasm-file-so-that-arbitrary-data-14965ebdfa48">explained</a> to me and that wSCC uses <a href="https://msgpack.org/">Message Pack</a>.</p>
<p>It&rsquo;s slightly surprising to me (still) that technologies like this exist with <strong>everyone</strong> else seemingly using them and I&rsquo;ve not heard of them. I don&rsquo;t expect to know everything but I&rsquo;m surprised I&rsquo;ve not stumbled upon msgpack until now.</p>
    </div>
    <a href="/posts/200807/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200630/" class="link black dim">
        Golang Protobuf APIv2
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google has a new Golang Protobuf API, APIv2 (<a href="https://pkg.go.dev/google.golang.org/protobuf?tab=overview">google.golang.org/protobuf</a>) superseding APIv1 (<a href="https://pkg.go.dev/github.com/golang/protobuf?tab=overview">github.com/golang/protobuf</a>). If your code is importing <code>github.com/golang/protobuf</code>, you&rsquo;re using APIv2. Otherwise, you should consult with the docs because Google reimplemented APIv1 atop APIv2. One challenge this caused me, as someone who does not use protobufs and gRPC on a daily basis, is that <a href="https://pkg.go.dev/github.com/golang/protobuf/protoc-gen-go/grpc?tab=doc">gRPC</a> (code-generation) is being removed from the (Golang) <code>protoc-gen-go</code>, the Golang plugin that generates gRPC service bindings.</p>
    </div>
    <a href="/posts/200630/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200417/" class="link black dim">
        Golang Xiaomi Bluetooth Temperature|Humidity (LYWSD03MMC) 2nd Gen
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Well, this became more of an adventure that I&rsquo;d originally wanted but, after learning some BLE and, with the help of others (Thanks Jonatha, JsBergbau), I&rsquo;ve sample code that connects to 4 Xiaomi 2nd gen. Thermometers, subscribes to readings and publishes the data to MQTT. From there, I&rsquo;m scraping it using Inuits <a href="">MQTTGateway</a> into Prometheus.</p>
<p>Repo: <a href="https://github.com/DazWilkin/gomijia2">https://github.com/DazWilkin/gomijia2</a></p>
<p><img src="/images/200417.prometheus.png" alt="Prometheus"></p>
<h3 id="thankscredit">Thanks|Credit:</h3>
<ul>
<li><a href="https://github.com/u1f35c">Jonathan McDowell</a> for <a href="https://github.com/u1f35c/gomijia">gomijia</a> and <a href="https://github.com/u1f35c/gomijia/issues/1">help</a></li>
<li><a href="https://github.com/JsBergbau">JsBergbau</a> for <a href="https://github.com/JsBergbau/MiTemperature2/issues/29#issuecomment-614314939">help</a></li>
</ul>
<h3 id="background">Background</h3>
<p>I&rsquo;ve been playing around with <a href="https://esphome.io">ESPHome</a> and blogged around my very positive experience <a href="/posts/200227/">ESPHome, MQTT, Prometheus and almost Cloud IoT</a>. I&rsquo;ve ordered a couple of <a href="https://www.espressif.com/en/products/hardware/esp32-devkitc-googlecloud-iot/overview">ESP32-DevKitC</a> and hope this will enable me to connect to Google <a href="https://cloud.google.com/iot-core">Cloud IoT</a>.</p>
    </div>
    <a href="/posts/200417/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200325/" class="link black dim">
        gRPC, Cloud Run &amp; Endpoints
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>&lt;3 Google but there&rsquo;s quite often an assumption that we&rsquo;re all sitting around the engineering table and, of course, we&rsquo;re not.</p>
<p><a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> is a powerful offering but &ndash; IMO &ndash; it&rsquo;s <strong>super</strong> confusing to understand and complex to deploy.</p>
<p>If you&rsquo;re familiar with the motivations behind service meshes (e.g. <a href="https://istio.io">Istio</a>), Cloud Endpoints fits in a similar niche (&ldquo;neesh&rdquo; or &ldquo;nitch&rdquo;?). The underlying ambition is that, developers can take <strong>existing</strong> code and by adding a proxy (or sidecar), general-purpose abstractions, security, logging etc. may be added.</p>
    </div>
    <a href="/posts/200325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200320/" class="link black dim">
        Golang gRPC Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>Update: 2020-03-24</strong>: Since writing this post, I&rsquo;ve contributed <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/12">Golang</a> and <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/15">Rust</a> samples to Google&rsquo;s project. I recommend you start there.</p></blockquote>
<p>Google explained how to run gRPC servers with Cloud Run. The examples are good but only Python and Node.JS:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/compute/serve-cloud-run-requests-with-grpc-not-just-http">gRPC comes to Cloud Run</a></li>
<li><a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example">gRPC in Google Cloud Run</a></li>
</ul>
<p>Missing Golang&hellip;. until now ;-)</p>
<p>I had problems with 1.14 and so I&rsquo;m using 1.13.</p>
<h2 id="project-structure">Project structure</h2>
<p>I&rsquo;ll tidy up my repo but the code may be found:</p>
    </div>
    <a href="/posts/200320/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200310/" class="link black dim">
        Google&#39;s New Golang SDK for Protobufs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google has released a new Golang SDK for protobuf. In the [announcement], a useful tool to redact properties is described. If like me, this is somewhat novel to you, here&rsquo;s a mashup using Google&rsquo;s <a href="https://developers.google.com/protocol-buffers/docs/gotutorial">Protocol Buffer Basics</a> w/ redaction.</p>
<p>To be very clear, as it&rsquo;s an important distinction:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">Version</th>
          <th>Repo</th>
          <th>Docs</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">v2</td>
          <td><a href="https://google.golang.org/protobuf">google.golang.org/protobuf</a></td>
          <td><a href="https://pkg.go.dev/google.golang.org/protobuf">Docs</a></td>
      </tr>
      <tr>
          <td style="text-align: center">v1</td>
          <td><a href="https://github.com/golang/protobuf">github.com/golang/protobuf</a></td>
          <td><a href="https://pkg.go.dev/github.com/golang/protobuf">Docs</a></td>
      </tr>
  </tbody>
</table>
<h3 id="project">Project</h3>
<p>Here&rsquo;s my project structure:</p>
<pre tabindex="0"><code>.
├── protoc-3.11.4-linux-x86_64
│   ├── bin
│   │   └── protoc
│   ├── include
│   │   └── google
│   └── readme.txt
└── src
    ├── go.mod
    ├── go.sum
    ├── main.go
    ├── protos
    │   ├── addressbook.pb.go
    │   └── addressbook.proto
    └── README.md
</code></pre><p>You may structure as you wish.</p>
    </div>
    <a href="/posts/200310/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200226/" class="link black dim">
        OriginStamp: Verifying Proofs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Recently, I <a href="/posts/200217/">wrote</a> about some initial adventures with <a href="https://originstamp.org">OriginStamp</a></p>
<p>Using OriginStamp&rsquo;s <a href="https://originstamp.org/home">UI</a> or API, submitting a hash results in transactions being submitted to Bitcoin, Ethereum and a German newspaper.</p>
<p>Using the API, it&rsquo;s possible to query OriginStamp&rsquo;s service for a proof. This post explains how to verify such a proof.</p>
<p>The diligent reader among you (Hey Mom!) will recall that I submitted a hash for the message:</p>
<pre tabindex="0"><code>Frederik Jack is a bubbly Border Collie
</code></pre><p>The SHA-256 hash of this message is:</p>
    </div>
    <a href="/posts/200226/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200219/" class="link black dim">
        FreeTSA &amp; Digitorus&#39; Timestamp SDK
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I wrote recently about some exploration of Timestamping with <a href="/posts/200217/">OriginStamp</a>. Since writing that post, I had some supportive feedback from the helpful folks at OriginStamp and plan to continue exploring that solution.</p>
<p>Meanwhile, OriginStamp exposed me to <a href="https://en.wikipedia.org/wiki/Timestamping_%28computing%29">timestamping</a> and <a href="https://en.wikipedia.org/wiki/Trusted_timestamping">trusted timestamping</a> and I discovered <a href="https://freetsa.org">freeTSA.org</a>.</p>
<p>What&rsquo;s the point? These services provide authoritative proof of the existence of a digital asset before some point in time; OriginStamp provides a richer service and uses multiple timestamp authorities including Bitcoin, Ethereum and rather interestingly a German Newspaper&rsquo;s <a href="https://blockchain.suedkurier.de/faq">Trusted Timestamp</a>.</p>
    </div>
    <a href="/posts/200219/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200217/" class="link black dim">
        OriginStamp Python|Golang SDK Examples
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A friend mentioned <a href="https://originstamp.org">OriginStamp</a> to me.</p>
<p><strong>NB</strong> There are 2 sites: <a href="https://originstamp.com">originstamp.com</a> and <a href="https://originstamp.org">originstamp.org</a>.</p>
<p>It&rsquo;s an interesting project.</p>
<p>It&rsquo;s a solution for providing auditable proof that you had a(ccess to) some digital thing before a certain date. OriginStamp provides user-|developer-friendly means to submit files|hashes (of your content) and have these bundled into transactions that are submitted to e.g. bitcoin.</p>
<p>I won&rsquo;t attempt to duplicate the narrative here, review OriginStamp&rsquo;s site and some of its content.</p>
    </div>
    <a href="/posts/200217/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200206/" class="link black dim">
        Cloud Build wishlist: Mountable Golang Modules Proxy
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I think it would be valuable if Google were to provide volumes in <a href="https://cloud.google.com/cloud-build">Cloud Build</a> of package registries (e.g. <a href="https://proxy.golang.org">Go Modules</a>; <a href="https://pypi.org">PyPi</a>; <a href="https://search.maven.org/">Maven</a>; <a href="https://www.npmjs.com/">NPM</a> etc.).</p>
<p>Google provides a <a href="https://cloud.google.com/container-registry/docs/using-dockerhub-mirroring">mirror</a> of a subset of Docker Hub. This confers several benefits: Google&rsquo;s imprimatur; speed (latency); bandwidth; and convenience.</p>
<p>The same benefits would apply to package registries.</p>
<p>In the meantime, there&rsquo;s a hacky way to gain some of the benefits of these when using Cloud Build.</p>
<p>In the following example, I&rsquo;ll show an approach using Golang Modules and Google&rsquo;s module proxy aka <code>proxy.golang.org</code>.</p>
    </div>
    <a href="/posts/200206/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200122/" class="link black dim">
        Setting up a GCE Instance as an Inlets Exit Node
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The prolific <a href="https://blog.alexellis.io/">Alex Ellis</a> has a new project, <a href="https://github.com/inlets/inlets">Inlets</a>.</p>
<p>Here&rsquo;s a quick tutorial using <a href="https://cloud.google.com/">Google Compute Platform&rsquo;s (GCP)</a> <a href="https://cloud.google.com/compute/">Compute Engine (GCE)</a>.</p>
<p><strong>NB</strong> I&rsquo;m using one of Google&rsquo;s <a href="https://cloud.google.com/free/">&ldquo;Always free&rdquo;</a> f1-micro instances <strong>but</strong> you may still pay for network *gress and storage</p>
<h2 id="assumptions">Assumptions</h2>
<p>I&rsquo;m assuming you&rsquo;ve a Google account, have used GCP and have a billing account established, i.e. the following returns at least one billing account:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud beta billing accounts list
</span></span></code></pre></div><p>If you&rsquo;ve only one billing account and it&rsquo;s the one you wish to use, then you can:</p>
    </div>
    <a href="/posts/200122/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200110/" class="link black dim">
        Google Fit
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve spent a few days exploring [Google Fit SDK] as I try to wean myself from my obsession with metrics (of all forms). A quick Googling got me to Robert&rsquo;s <a href="https://ithoughthecamewithyou.com/post/export-google-fit-daily-steps-to-a-google-sheet">Exporter Google Fit Daily Steps, Weight and Distance to a Google Sheet</a>. This works and is probably where I should have stopped&hellip; avoiding the rabbit hole that I&rsquo;ve been down&hellip;</p>
<p>I threw together a simple Golang implementation of the SDK using <a href="https://godoc.org/google.golang.org/api/fitness/v1">Google&rsquo;s Golang API Client Library</a>. Thanks to Robert&rsquo;s example, I was able to infer some of the complexity this API particularly in its use of data types, data sources and datasets. Having used Stackdriver in my previous life, Google Fit&rsquo;s structure bears more than a passing resemblance to Stackdriver&rsquo;s data model and its use of resource types and metric types.</p>
    </div>
    <a href="/posts/200110/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200107/" class="link black dim">
        Google Home Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m obsessing over Prometheus exporters. First came <a href="/posts/191218/">Linode Exporter</a>, then <a href="/posts/191220/">GCP Exporter</a> and, on Sunday, I stumbled upon a reverse-engineered <a href="https://rithvikvibhu.github.io/GHLocalApi/">API for Google Home</a> devices and so wrote a very basic <a href="https://github.com/DazWilkin/gohome">Google Home SDK</a> and a similarly basic <a href="https://github.com/DazWilkin/home-exporter">Google Home Exporter</a>:</p>
<p><img src="/images/200107.home-exporter.png" alt="Prometheus Graphs"></p>
<p>The SDK only implements <code>/setup/eureka_info</code> and then only some of the returned properties. There&rsquo;s not a lot of metric-like data to use besides <code>SignalLevel</code> (<code>signal_level</code>) and <code>NoiseLevel</code> (<code>noise_level</code>). I&rsquo;m not clear on the meaning of some of the properties.</p>
    </div>
    <a href="/posts/200107/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191220/" class="link black dim">
        Google Cloud Platform (GCP) Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Earlier this week I discussed a <a href="/posts/191218/">Linode Prometheus Exporter</a>.</p>
<p>I <a href="https://github.com/metalmatze/digitalocean_exporter/pull/5">added</a> metrics for <a href="https://www.digitalocean.com/products/kubernetes/">Digital Ocean&rsquo;s Managed Kubernetes service</a> to <a href="https://github.com/metalmatze">@metalmatze</a>&rsquo;s <a href="https://github.com/metalmatze/digitalocean_exporter">Digital Ocean Exporter</a>.</p>
<p>This left, metrics for <a href="https://cloud.google.com">Google Cloud Platform (GCP)</a> which has, for many years, been my primary cloud platform. So, today I wrote <a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud Platform</a>.</p>
<p>All 3 of these exporters follow the template laid down by @metalmatze and, because each of these services has a well-written Golang SDK, it&rsquo;s straightforward to implement an exporter for each of them.</p>
    </div>
    <a href="/posts/191220/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191218/" class="link black dim">
        Linode Prometheus Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I enjoy using <a href="https://prometheus.io">Prometheus</a> and have toyed around with it for some time particularly in combination with Kubernetes. I signed up with <a href="https://www.linode.com/?r=9ab7d75b764e143a1b3b467390c852b2c56cd704">Linode</a> [referral] compelled by the addition of a managed Kubernetes service called <a href="https://www.linode.com/products/kubernetes/">Linode Kubernetes Engine (LKE)</a>. I have an anxiety that I&rsquo;ll inadvertently leave resources running (unused) on a cloud platform. Instead of refreshing the relevant billing page, it struck me that Prometheus may (not yet proven) help.</p>
<p>The hypothesis is that a combination of a cloud-specific Prometheus <a href="https://prometheus.io/docs/instrumenting/exporters/">exporter</a> reporting aggregate uses of e.g. Linodes (instances), NodeBalancers, Kubernetes clusters etc., could form the basis of an alert mechanism using Prometheus&rsquo; <a href="https://prometheus.io/docs/alerting/overview/">alerting</a>.</p>
    </div>
    <a href="/posts/191218/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190926/" class="link black dim">
        PyPi Transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been noodling around with another <a href="https://github.com/google/trillian">Trillian</a> personality.</p>
<p>Another in a theme that interests me in providing tamperproof logs for the packages in the popular package management registries.</p>
<p>The Golang team recently announced <a href="https://proxy.golang.org/">Go Module Mirror</a> which is built atop Trillian. It seems to me that all the package registries (<a href="https://proxy.golang.org">Go Modules</a>, <a href="https://www.npmjs.com">npm</a>, <a href="https://mvnrepository.com">Maven</a>, <a href="https://nuget.org">NuGet</a> etc.) would benefit from tamperproof logs hosted by a trusted 3rd-party.</p>
<p>As you may have guessed, PyPi Transparency is a log for <a href="https://pypi.org">PyPi</a> packages. PyPi is comprehensive, definitive and trusted but, as with Go Module Mirror, it doesn&rsquo;t hurt to provide a backup of some of its data. In the case of this solution, Trillian hosts a log of self-calculated SHA-256 hashes for Python packages that are added to it.</p>
    </div>
    <a href="/posts/190926/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190918/" class="link black dim">
        Cloud Functions Simple(st) HTTP Multi-host Proxy
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Tweaked yesterday&rsquo;s solution so that it will randomly select one from several hosts with which it&rsquo;s configured.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Golang" data-lang="Golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">proxy</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;math/rand&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/url&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;strings&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">robin</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">hostsList</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;PROXY_HOST&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">hostsList</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#e6db74">&#34;&#39;PROXY_HOST&#39; environment variable should contain comma-separated list of hosts&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Comma-separated lists of hosts</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hosts</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Split</span>(<span style="color:#a6e22e">hostsList</span>, <span style="color:#e6db74">&#34;,&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">urls</span> <span style="color:#f92672">:=</span> make([]<span style="color:#f92672">*</span><span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">URL</span>, len(<span style="color:#a6e22e">hosts</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">host</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">hosts</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">origin</span> = <span style="color:#a6e22e">Endpoint</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Host</span>: <span style="color:#a6e22e">host</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Port</span>: <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;PROXY_PORT&#34;</span>),
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">origin</span>.<span style="color:#a6e22e">URL</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">urls</span>[<span style="color:#a6e22e">i</span>] = <span style="color:#a6e22e">url</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">NewSource</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">UnixNano</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">q</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">s</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Handler</span> = <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Pick one of the URLs at random</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">url</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">urls</span>[<span style="color:#a6e22e">q</span>.<span style="color:#a6e22e">Int31n</span>(int32(len(<span style="color:#a6e22e">urls</span>)))]
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;[Handler] Forwarding: %s&#34;</span>, <span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">String</span>())
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Forward to it</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">reverseproxy</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This requires a minor tweak to the deployment to escape the commas within the <code>PROXY_HOST</code> string to disambiguate these for <code>gcloud</code>:</p>
    </div>
    <a href="/posts/190918/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190917/" class="link black dim">
        Cloud Functions Simple(st) HTTP Proxy
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m investigating the use of <a href="https://letsencrypt.org/">LetsEncrypt</a> for gRPC services. I found this straightforward <a href="https://www.d3void.net/post/acme/">post</a> by Scott Devoid and am going to try this approach.</p>
<p>Before I can do that, I need to be able to publish services (make them Internet-accessible) and would like to try to continue to use GCP for <a href="https://cloud.google.com/free/">free</a>.</p>
<p>Some time ago, I <a href="https://medium.com/google-cloud/microk8s-on-google-cloud-platform-d8b7a71a3ef">wrote</a> about using the excellent <a href="https://microk8s.io/">Microk8s</a> on GCP. Using an <code>f1-micro</code>, I&rsquo;m hoping (!) to stay within the Compute Engine free tier. I&rsquo;ll also try to be diligent and delete the instance when it&rsquo;s not needed. This gives me a runtime platform and I can expose services to the Instance&rsquo;s (Node)Ports but, I&rsquo;d prefer to not be billed for a simple proxy.</p>
    </div>
    <a href="/posts/190917/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190907/" class="link black dim">
        pypi-transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The goal of pypi-transparency is very similar to the underlying motivation for the Golang team&rsquo;s <a href="https://sum.golang.org/">Checksum Database</a> (also built with Trillian).</p>
<p>Even though, <a href="https://pypi.org">PyPi</a> provides hashes of the content of packages it hosts, the developer must trust that PyPi&rsquo;s data is consistent. One ambition with pypi-transparency is to provide a companion, tamperproof log of PyPi package files in order to provide a double-check of these hashes.</p>
<p>It is important to understand what this does (and does not) provide. There&rsquo;s no validation of a package&rsquo;s content. The only calculation is that, on first observation, a SHA-256 hash is computed of the package&rsquo;s content and the hash is recorded. If the package is subsequently altered, it&rsquo;s very probable that the hash will change and this provides a signal to the user that the package&rsquo;s contents has changed. Because pypi-transparency uses a tamperproof log, it&rsquo;s very difficult to update the hash recorded in the tamperproof log, to reflect this change. Corrolary: pypi-transparency will record the hashes of packages that include malicious code.</p>
    </div>
    <a href="/posts/190907/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/usgs/" class="link blue hover-black">
            Tag: USGS
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250227/" class="link black dim">
        Prometheus Exporter for USGS Water Data service
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m a little obsessed with creating Prometheus Exporters:</p>
<ul>
<li><a href="https://github.com/DazWilkin/azure-exporter">Prometheus Exporter for Azure</a></li>
<li><a href="https://github.com/DazWilkin/crtsh-exporter">Prometheus Exporter for crt.sh</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/goatcounter-exporter">Prometheus Exporter for GoatCounter</a></li>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud</a></li>
<li><a href="https://github.com/DazWilkin/koyeb-exporter">Prometheus Exporter for Koyeb</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/porkbun-exporter">Prometheus Exporter for PorkBun</a></li>
<li><a href="https://github.com/DazWilkin/updown-exporter">Prometheus Exporter for updown.io</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>All of these were written to scratch an itch.</p>
<p>In the case of the cloud platform exporters (Azure, Fly, Google, Linode, Vultr etc.), it&rsquo;s an overriding anxiety that I&rsquo;ll leave resources deployed on these platforms and, running an exporter that ships alerts to <a href="https://pushover.net/">Pushover</a> and Gmail, provides me a support mechanism for me.</p>
    </div>
    <a href="/posts/250227/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/firesotore/" class="link blue hover-black">
            Tag: Firesotore
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250213/" class="link black dim">
        gRPC Firestore `Listen` in Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Obsessing on <a href="/posts/250210/">gRPC Firestore <code>Listen</code></a> somewhat but it&rsquo;s also a good learning opportunity for me to write stuff in Rust. This doesn&rsquo;t work against Google&rsquo;s public endpoint (possibly for the same reason that gRPCurl doesn&rsquo;t work either) but this does work against the Go server described in the other post.</p>
<p>I&rsquo;m also documenting here because I always encounter challenges using TLS with Rust (and this documents 2 working ways to do this with gRPC) as well as references two interesting (rust) examples that use Google services.</p>
    </div>
    <a href="/posts/250213/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/250210/" class="link black dim">
        gRPC Firestore `Listen`
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A question on Stack overflow <a href="https://stackoverflow.com/questions/79422094">Firestore gRPC Listen does not send deletions</a> piqued by interest but created a second problem for me: I&rsquo;m unable to get its <a href="https://cloud.google.com/firestore/docs/reference/rpc/google.firestore.v1#google.firestore.v1.Firestore.Listen"><code>Listen</code></a> method to work using <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a>.</p>
<p>For what follows, you will need:</p>
<ol>
<li>a Google Project with Firestore enabled and a database (default: <code>(default)</code>) containing a Collection (e.g. <code>Dogs</code>) with at least one Document (e.g. <code>freddie</code>)</li>
<li><a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a> cloned locally in order to access Protobufs</li>
</ol>
<h2 id="summary">Summary</h2>
<table>
  <thead>
      <tr>
          <th>client</th>
          <th>server</th>
          <th>R</th>
          <th>See</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>gRPCurl</code></td>
          <td><code>firestore.googleapis.com:443</code></td>
          <td>✅</td>
          <td><a href="#grpcurl-listen-against-google-endpoint">link</a></td>
      </tr>
      <tr>
          <td>Go client</td>
          <td><code>firestore.googleapis.com:443</code></td>
          <td>✅</td>
          <td><a href="#go-client-listen-against-google-endpoint">link</a></td>
      </tr>
      <tr>
          <td><code>gRPCurl</code></td>
          <td>Go server</td>
          <td>✅</td>
          <td><a href="#grpcurl-listen-against-go-server">link</a></td>
      </tr>
      <tr>
          <td>Go client</td>
          <td>Go server</td>
          <td>✅</td>
          <td><a href="#go-client-listen-against-go-server">link</a></td>
      </tr>
  </tbody>
</table>
<p>I subsequently tried this using <a href="https://www.postman.com/">Postman</a> and it also works (✅).</p>
    </div>
    <a href="/posts/250210/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/buf/" class="link blue hover-black">
            Tag: Buf
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/241113/" class="link black dim">
        gRPC-Web w/ FauxRPC and Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>After <a href="/posts/241025/">recently</a> discovering <a href="https://github.com/sudorandom/fauxrpc">FauxRPC</a>, I was sufficiently impressed that I decided to use it to test <a href="https://www.ack.al">Ackal</a>&rsquo;s gRPC services using rust.</p>
<p>FauxRPC provides <a href="https://fauxrpc.com/docs/server/multi-protocol-support/">multi-protocol support</a> and so, after successfully implementing the <em>faux</em> gRPC client tests, I was compelled to try gRPC-Web too. For no immediate benefit other than, it&rsquo;s there, it&rsquo;s free and it&rsquo;s interesting. As an aside, the <em>faux</em> REST client tests worked without issue using <a href="https://crates.io/crates/reqwest">Reqwest</a>.</p>
<p>Unfortunately, my optimism hit a wall with gRPC-Web and what follows is a summary of my unresolved issue.</p>
    </div>
    <a href="/posts/241113/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/tonic-web/" class="link blue hover-black">
            Tag: Tonic-Web
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/241113/" class="link black dim">
        gRPC-Web w/ FauxRPC and Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>After <a href="/posts/241025/">recently</a> discovering <a href="https://github.com/sudorandom/fauxrpc">FauxRPC</a>, I was sufficiently impressed that I decided to use it to test <a href="https://www.ack.al">Ackal</a>&rsquo;s gRPC services using rust.</p>
<p>FauxRPC provides <a href="https://fauxrpc.com/docs/server/multi-protocol-support/">multi-protocol support</a> and so, after successfully implementing the <em>faux</em> gRPC client tests, I was compelled to try gRPC-Web too. For no immediate benefit other than, it&rsquo;s there, it&rsquo;s free and it&rsquo;s interesting. As an aside, the <em>faux</em> REST client tests worked without issue using <a href="https://crates.io/crates/reqwest">Reqwest</a>.</p>
<p>Unfortunately, my optimism hit a wall with gRPC-Web and what follows is a summary of my unresolved issue.</p>
    </div>
    <a href="/posts/241113/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/grpcurl/" class="link blue hover-black">
            Tag: GRPCurl
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/241025/" class="link black dim">
        FauxRPC using gRPCurl, Golang and rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Read <a href="https://kmcd.dev/posts/fauxrpc-testcontainers/">FauxRPC + Testcontainers</a> on Hacker News and was intrigued. I spent a little more time &ldquo;evaluating&rdquo; this than I&rsquo;d planned because I&rsquo;m forcing myself to use rust as much as possible and my ignorance (see below) caused me some challenges.</p>
<p>The technology is interesting and works well. The experience helped me explore <a href="https://testcontainers.com/">Testcontainers</a> too which I&rsquo;d heard about but not explored until this week.</p>
<p>For my future self:</p>
<table>
  <thead>
      <tr>
          <th>What</th>
          <th>What?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="https://fauxrpc.com/">FauxRPC</a></td>
          <td>A general-purpose tool (built using <a href="https://buf.build/">Buf</a>&rsquo;s <a href="https://connectrpc.com/">Connect</a>) that includes registry and stub (gRPC) services that can be (programmatically) configured (using a Protobuf descriptor) and stubs (example method responses) to help test gRPC implementations.</td>
      </tr>
      <tr>
          <td><a href="https://testcontainers.com/">Testcontainers</a></td>
          <td>Write code (e.g. rust) to create and interact (test)services (running in [Docker] containers).</td>
      </tr>
      <tr>
          <td><a href="https://connectrpc.com/">Connect</a></td>
          <td>(More than a) gRPC implementation used by FauxRPC</td>
      </tr>
      <tr>
          <td><a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a></td>
          <td>A command-line gRPC tool.</td>
      </tr>
  </tbody>
</table>
<p>I started following along with FauxRPC&rsquo;s <a href="https://fauxrpc.com/docs/testcontainers/">Testcontainers</a> example but, being unfamiliar with Connect, I wasn&rsquo;t familiar with its Eliza service. The service is available on <code>demo.connectrpc.com:443</code> and is described using <a href="https://github.com/connectrpc/examples-go/blob/main/proto/connectrpc/eliza/v1/eliza.proto"><code>eliza.proto</code></a> as part of <a href="https://github.com/connectrpc/examples-go"><code>examples-go</code></a>. Had I realized this sooner, I would have used this example rather than the Health Checking protocol.</p>
    </div>
    <a href="/posts/241025/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240409/" class="link black dim">
        Google Cloud Translation w/ gRPC 3 ways
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="general">General</h2>
<p>You&rsquo;ll need a Google Cloud project with Cloud Translation (<code>translate.googleapis.com</code>) enabled and a Service Account (and key) with suitable permissions in order to run the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BILLING<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Billing ID (gcloud billing accounts list)</span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Project ID</span>
</span></span><span style="display:flex;"><span>ACCOUNT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tester&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>EMAIL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span><span style="color:#e6db74">@</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">.iam.gserviceaccount.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ROLES<span style="color:#f92672">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/cloudtranslate.user&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/serviceusage.serviceUsageConsumer&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Project</span>
</span></span><span style="display:flex;"><span>gcloud projects create <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Associate Project with your Billing Account</span>
</span></span><span style="display:flex;"><span>gcloud billing accounts link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Enable Cloud Translation</span>
</span></span><span style="display:flex;"><span>gcloud services enable translate.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts create <span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account Key</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts keys create <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--iam-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update Project IAM permissions</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ROLE in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ROLES[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  gcloud projects add-iam-policy-binding <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --member<span style="color:#f92672">=</span>serviceAccount:<span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>ROLE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>For the code, you&rsquo;ll need to install <a href="https://github.com/protocolbuffers/protobuf"><code>protoc</code></a> and preferably have it in your path.</p>
    </div>
    <a href="/posts/240409/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/231222/" class="link black dim">
        Listing Cloud Logging log-based metrics using gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Referring to <a href="/posts/230314/">Accessing Google Services using gRPC</a>, I wanted to query a project&rsquo;s <a href="https://cloud.google.com/logging">Cloud Logging</a> for <a href="https://cloud.google.com/logging/docs/logs-based-metrics">log-based metrics</a> using gRPC.</p>
<p>In summary:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;logging.googleapis.com:443&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ROOT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/googleapis&#34;</span> <span style="color:#75715e"># https://github.com/googleapis/googleapis</span>
</span></span><span style="display:flex;"><span>PACKAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;google/logging/v2&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># NB Not logging.proto</span>
</span></span><span style="display:flex;"><span>PROTO<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ROOT<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>PACKAGE<span style="color:#e6db74">}</span><span style="color:#e6db74">/logging_metrics.proto&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>gcloud auth print-access-token<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PACKAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;google.logging.v2&#34;</span>
</span></span><span style="display:flex;"><span>SERVICE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MetricsServiceV2&#34;</span>
</span></span><span style="display:flex;"><span>METHOD<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>PACKAGE<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">${</span>SERVICE<span style="color:#e6db74">}</span><span style="color:#e6db74">/ListLogMetrics&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ListLogMetricsRequest fields</span>
</span></span><span style="display:flex;"><span>PARENT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;projects/</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>grpcurl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--import-path<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>ROOT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--proto<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROTO<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-H <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-d <span style="color:#e6db74">&#34;{\&#34;parent\&#34;: \&#34;</span><span style="color:#e6db74">${</span>PARENT<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span> <span style="color:#e6db74">${</span>METHOD<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>From <a href="https://developers.google.com/apis-explorer">APIs Explorer</a>, <a href="https://cloud.google.com/logging/docs/reference/api-overview">Cloud Logging API v2</a>, instead of the <a href="https://cloud.google.com/logging/docs/reference/v2/rest">REST reference</a>, browse the <a href="https://cloud.google.com/logging/docs/reference/v2/rpc">gRPC reference</a> specifically the package <a href="https://cloud.google.com/logging/docs/reference/v2/rpc/google.logging.v2"><code>google.logging.v2</code></a> which includes <a href="https://cloud.google.com/logging/docs/reference/v2/rpc/google.logging.v2#google.logging.v2.MetricsServiceV2"><code>MetricsServiceV2</code></a>. We&rsquo;re interested in the <code>ListLogMetrics</code> method (which unfortunately isn&rsquo;t directly hyperlinkable) but is defined to be:</p>
    </div>
    <a href="/posts/231222/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230314/" class="link black dim">
        Access Google Services using gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google publishes interface definitions of Google APIs (services) that support REST and gRPC in a repo called <a href="https://github.com/googleapis/googleapis">Google APIs</a>. Google&rsquo;s SDKs uses gRPC to access these services but, how to do this using e.g. <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a>?</p>
<p>I wanted to debug <a href="https://cloud.google.com/profiler/docs">Cloud Profiler</a> and its agent makes <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L83"><code>UpdateProfile</code></a> RPCs to <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L41"><code>cloudprofiler.googleapis.com</code></a>. Cloud Profiler is more challenging service to debug because (a) it&rsquo;s publicly &ldquo;write-only&rdquo;; and (b) it has complex messages. <code>UpdateProfile</code> sends <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L123"><code>UpdateProfileRequest</code></a> messages that include <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L123"><code>Profile</code></a> messages that include <code>profile_bytes</code> which are gzip compressed serialized protos of <a href="https://github.com/google/pprof">pprof</a>&rsquo;s <a href="https://github.com/google/pprof/blob/d61513b1440d93d62aad023cc60d7a33f3917b70/proto/profile.proto#L46"><code>Profile</code></a>.</p>
    </div>
    <a href="/posts/230314/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200326/" class="link black dim">
        Google Trillian on Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written previously (<a href="https://medium.com/google-cloud/google-trillian-for-noobs-1a-c87a78e5e585">Google Trillian for Noobs</a>) about Google&rsquo;s interesting project <a href="https://github.com/google/trillian">Trillian</a> and about some of the &ldquo;personalities&rdquo; (e.g. <a href="/posts/190907/">PyPi Transparency</a>) that I&rsquo;ve build using it.</p>
<p>Having gone slight cra-cra on <a href="https://cloud.google.com/run">Cloud Run</a> and <a href="https://grpc.io">gRPC</a> this week with <a href="/posts/200320/">Golang gRPC Cloud Run</a> and <a href="/posts/200325/">gRPC, Cloud Run &amp; Endpoints</a>, I thought it&rsquo;d be fun to deploy Trillian and a personality to Cloud Run.</p>
<p>It mostly (!) works :-)</p>
<p>At the end of the post, I&rsquo;ve summarized creating a Cloud SQL instance to host the Trillian data(base).</p>
    </div>
    <a href="/posts/200326/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200325/" class="link black dim">
        gRPC, Cloud Run &amp; Endpoints
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>&lt;3 Google but there&rsquo;s quite often an assumption that we&rsquo;re all sitting around the engineering table and, of course, we&rsquo;re not.</p>
<p><a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> is a powerful offering but &ndash; IMO &ndash; it&rsquo;s <strong>super</strong> confusing to understand and complex to deploy.</p>
<p>If you&rsquo;re familiar with the motivations behind service meshes (e.g. <a href="https://istio.io">Istio</a>), Cloud Endpoints fits in a similar niche (&ldquo;neesh&rdquo; or &ldquo;nitch&rdquo;?). The underlying ambition is that, developers can take <strong>existing</strong> code and by adding a proxy (or sidecar), general-purpose abstractions, security, logging etc. may be added.</p>
    </div>
    <a href="/posts/200325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200320/" class="link black dim">
        Golang gRPC Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>Update: 2020-03-24</strong>: Since writing this post, I&rsquo;ve contributed <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/12">Golang</a> and <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/15">Rust</a> samples to Google&rsquo;s project. I recommend you start there.</p></blockquote>
<p>Google explained how to run gRPC servers with Cloud Run. The examples are good but only Python and Node.JS:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/compute/serve-cloud-run-requests-with-grpc-not-just-http">gRPC comes to Cloud Run</a></li>
<li><a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example">gRPC in Google Cloud Run</a></li>
</ul>
<p>Missing Golang&hellip;. until now ;-)</p>
<p>I had problems with 1.14 and so I&rsquo;m using 1.13.</p>
<h2 id="project-structure">Project structure</h2>
<p>I&rsquo;ll tidy up my repo but the code may be found:</p>
    </div>
    <a href="/posts/200320/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/probe/" class="link blue hover-black">
            Tag: Probe
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240927/" class="link black dim">
        Cloud Run with a gRPC probe
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Cloud Run supports <a href="https://cloud.google.com/run/docs/configuring/healthchecks">gRPC startup|liveness probes</a> which I&rsquo;d not used before.</p>
<p>I&rsquo;m using <a href="https://cloud.google.com/run/docs/reference/rest">Cloud Run</a> v2 and specifically <a href="https://cloud.google.com/run/docs/reference/rest/v2/projects.locations.services/create"><code>projects.locations.services.create</code></a> and <a href="https://cloud.google.com/run/docs/reference/rest/v2/projects.locations.services#Service"><code>Service</code></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>REGION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>REPO<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;..&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Must be in an Artifact Registry repo</span>
</span></span><span style="display:flex;"><span>IMAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span><span style="color:#e6db74">-docker.pkg.dev/</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>REPO<span style="color:#e6db74">}</span><span style="color:#e6db74">/...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Run v2</span>
</span></span><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://run.googleapis.com/v2&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PARENT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;projects/</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">/locations/</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SERVICE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span></code></pre></div><p>I like to use <a href="https://jsonnet.org/">Jsonnet</a> (specifically <a href="https://github.com/google/go-jsonnet"><code>go-jsonnet</code></a>) to help templating Kubernetes(-like) deployments.</p>
<p><code>cloudrun.jsonnet</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsonnet" data-lang="jsonnet"><span style="display:flex;"><span><span style="color:#66d9ef">local</span> project <span style="color:#f92672">=</span> std.extVar(<span style="color:#e6db74">&#34;project&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> region <span style="color:#f92672">=</span> std.extVar(<span style="color:#e6db74">&#34;region&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> service <span style="color:#f92672">=</span> std.extVar(<span style="color:#e6db74">&#34;service&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> image <span style="color:#f92672">=</span> std.extVar(<span style="color:#e6db74">&#34;image&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> port <span style="color:#f92672">=</span> <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> health_checking_service <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;labels&#34;:{
</span></span><span style="display:flex;"><span>        &#34;type&#34;: <span style="color:#e6db74">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;annotations&#34;: {
</span></span><span style="display:flex;"><span>        &#34;type&#34;: <span style="color:#e6db74">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;template&#34;:{
</span></span><span style="display:flex;"><span>        &#34;containers&#34;: {
</span></span><span style="display:flex;"><span>            &#34;name&#34;: service,
</span></span><span style="display:flex;"><span>            &#34;image&#34;: image,
</span></span><span style="display:flex;"><span>            &#34;args&#34;: [],
</span></span><span style="display:flex;"><span>            &#34;resources&#34;: {
</span></span><span style="display:flex;"><span>                &#34;limits&#34;: {
</span></span><span style="display:flex;"><span>                    &#34;cpu&#34;: <span style="color:#e6db74">&#34;1000m&#34;</span>,
</span></span><span style="display:flex;"><span>                    &#34;memory&#34;: <span style="color:#e6db74">&#34;512Mi&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            &#34;ports&#34;: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    &#34;name&#34;: <span style="color:#e6db74">&#34;http1&#34;</span>,
</span></span><span style="display:flex;"><span>                    &#34;containerPort&#34;: port
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            &#34;startupProbe&#34;: {
</span></span><span style="display:flex;"><span>                &#34;grpc&#34;: {
</span></span><span style="display:flex;"><span>                    &#34;port&#34;: port,
</span></span><span style="display:flex;"><span>                    &#34;service&#34;: health_checking_service
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;scaling&#34;: {
</span></span><span style="display:flex;"><span>            &#34;maxInstanceCount&#34;: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And deploy it using:</p>
    </div>
    <a href="/posts/240927/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/trivy/" class="link blue hover-black">
            Tag: Trivy
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240918/" class="link black dim">
        Trivy vulnerability scanning
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I build (and therefore) manage many container images. It&rsquo;s easy (common?) to overlook that these images contain vulnerabilities, hopefully vulns that are fixed and that the images must be rebuilt to accommodate these changes.</p>
<p>I have used Google&rsquo;s <strong>very</strong> expensive container vulnerability scanning tool but wanted something cheaper. I found this <a href="https://www.reddit.com/r/selfhosted/comments/12mvpq2/comment/jgdjoqr/">list of open source solutions</a> on Reddit and decided to look into <a href="https://github.com/aquasecurity/trivy">Trivy</a>.</p>
<p>It&rsquo;s possible to <a href="https://aquasecurity.github.io/trivy/v0.55/getting-started/installation/">install</a> Trivy via a package manager, a binary or to build the Go binary locally but I prefer to use containers whenever possible:</p>
    </div>
    <a href="/posts/240918/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/vulnerability-scanning/" class="link blue hover-black">
            Tag: Vulnerability Scanning
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240918/" class="link black dim">
        Trivy vulnerability scanning
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I build (and therefore) manage many container images. It&rsquo;s easy (common?) to overlook that these images contain vulnerabilities, hopefully vulns that are fixed and that the images must be rebuilt to accommodate these changes.</p>
<p>I have used Google&rsquo;s <strong>very</strong> expensive container vulnerability scanning tool but wanted something cheaper. I found this <a href="https://www.reddit.com/r/selfhosted/comments/12mvpq2/comment/jgdjoqr/">list of open source solutions</a> on Reddit and decided to look into <a href="https://github.com/aquasecurity/trivy">Trivy</a>.</p>
<p>It&rsquo;s possible to <a href="https://aquasecurity.github.io/trivy/v0.55/getting-started/installation/">install</a> Trivy via a package manager, a binary or to build the Go binary locally but I prefer to use containers whenever possible:</p>
    </div>
    <a href="/posts/240918/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/google-cloud-functions/" class="link blue hover-black">
            Tag: Google Cloud Functions
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240811/" class="link black dim">
        XML-RPC in Rust and Python
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A lazy Sunday afternoon and my interest was piqued by <a href="https://en.wikipedia.org/wiki/XML-RPC">XML-RPC</a></p>
<h2 id="client">Client</h2>
<p>A very basic XML-RPC client wrapped in a Cloud Functions function:</p>
<p><code>main.py</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python3" data-lang="python3"><span style="display:flex;"><span><span style="color:#f92672">import</span> functions_framework
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> xmlrpc.client
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>endpoint <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>get_env(<span style="color:#e6db74">&#34;ENDPOINT&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>proxy <span style="color:#f92672">=</span> xmlrpc<span style="color:#f92672">.</span>client<span style="color:#f92672">.</span>ServerProxy(endpoint)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@functions_framework.http</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add</span>(request):
</span></span><span style="display:flex;"><span>    print(request)
</span></span><span style="display:flex;"><span>    rqst <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>get_json(silent<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    resp <span style="color:#f92672">=</span> proxy<span style="color:#f92672">.</span>add(
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#34;x&#34;</span>:{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;real&#34;</span>:rqst[<span style="color:#e6db74">&#34;x&#34;</span>][<span style="color:#e6db74">&#34;real&#34;</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;imag&#34;</span>:rqst[<span style="color:#e6db74">&#34;x&#34;</span>][<span style="color:#e6db74">&#34;imag&#34;</span>]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;y&#34;</span>:{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;real&#34;</span>:rqst[<span style="color:#e6db74">&#34;y&#34;</span>][<span style="color:#e6db74">&#34;real&#34;</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;imag&#34;</span>:rqst[<span style="color:#e6db74">&#34;y&#34;</span>][<span style="color:#e6db74">&#34;imag&#34;</span>]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> resp
</span></span></code></pre></div><p><code>requirements.txt</code>:</p>
<pre tabindex="0"><code>functions-framework==3.*
</code></pre><p>Run it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 -m venv venv
</span></span><span style="display:flex;"><span>source venv/bin/activate
</span></span><span style="display:flex;"><span>python3 -m pip install --requirement requirements.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>python3 main.py
</span></span></code></pre></div><h2 id="server">Server</h2>
<p>Forcing myself to go Rust first and there&rsquo;s an (old) <a href="https://crates.io/crates/xml-rpc">xml-rpc</a> crate.</p>
    </div>
    <a href="/posts/240811/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/python/" class="link blue hover-black">
            Tag: Python
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240811/" class="link black dim">
        XML-RPC in Rust and Python
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A lazy Sunday afternoon and my interest was piqued by <a href="https://en.wikipedia.org/wiki/XML-RPC">XML-RPC</a></p>
<h2 id="client">Client</h2>
<p>A very basic XML-RPC client wrapped in a Cloud Functions function:</p>
<p><code>main.py</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python3" data-lang="python3"><span style="display:flex;"><span><span style="color:#f92672">import</span> functions_framework
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> xmlrpc.client
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>endpoint <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>get_env(<span style="color:#e6db74">&#34;ENDPOINT&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>proxy <span style="color:#f92672">=</span> xmlrpc<span style="color:#f92672">.</span>client<span style="color:#f92672">.</span>ServerProxy(endpoint)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@functions_framework.http</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add</span>(request):
</span></span><span style="display:flex;"><span>    print(request)
</span></span><span style="display:flex;"><span>    rqst <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>get_json(silent<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    resp <span style="color:#f92672">=</span> proxy<span style="color:#f92672">.</span>add(
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#34;x&#34;</span>:{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;real&#34;</span>:rqst[<span style="color:#e6db74">&#34;x&#34;</span>][<span style="color:#e6db74">&#34;real&#34;</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;imag&#34;</span>:rqst[<span style="color:#e6db74">&#34;x&#34;</span>][<span style="color:#e6db74">&#34;imag&#34;</span>]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;y&#34;</span>:{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;real&#34;</span>:rqst[<span style="color:#e6db74">&#34;y&#34;</span>][<span style="color:#e6db74">&#34;real&#34;</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;imag&#34;</span>:rqst[<span style="color:#e6db74">&#34;y&#34;</span>][<span style="color:#e6db74">&#34;imag&#34;</span>]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> resp
</span></span></code></pre></div><p><code>requirements.txt</code>:</p>
<pre tabindex="0"><code>functions-framework==3.*
</code></pre><p>Run it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 -m venv venv
</span></span><span style="display:flex;"><span>source venv/bin/activate
</span></span><span style="display:flex;"><span>python3 -m pip install --requirement requirements.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>python3 main.py
</span></span></code></pre></div><h2 id="server">Server</h2>
<p>Forcing myself to go Rust first and there&rsquo;s an (old) <a href="https://crates.io/crates/xml-rpc">xml-rpc</a> crate.</p>
    </div>
    <a href="/posts/240811/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240325/" class="link black dim">
        Prost! Tonic w/ a dash of JSON
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I naively (!) began exploring JSON marshaling of Protobufs in rust. Other protobuf language SDKs include JSON marshaling making the process straightforward. I was to learn that, in rust, it&rsquo;s not so simple. Unfortunately, for me, this continues to discourage my further use of rust (rust is just hard).</p>
<p>My goal was to marshal an arbitrary protocol buffer message that included a <a href="https://protobuf.dev/programming-guides/proto3/#oneof"><code>oneof</code></a> feature. I was unable to JSON marshal the rust generated by <code>tonic</code> for such a message.</p>
    </div>
    <a href="/posts/240325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230708/" class="link black dim">
        Kubernetes Python SDK w/ CRDs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Responded to <a href="https://stackoverflow.com/questions/76636443/">Get Custom K8s Resource using Python</a> and found the <a href="https://github.com/kubernetes-client/python/blob/master/kubernetes/docs/CustomObjectsApi.md"><code>CustomObjectsApi</code></a> documentation unclear.</p>
<p>If you have a cluster and a kubeconfig file with a correctly configured <code>current-context</code>, so that you can successfully:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PLURAL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checks&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl get <span style="color:#e6db74">${</span>PLURAL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--all-namespaces
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> I&rsquo;m using <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s CRDs in these examples.</p></blockquote>
<p>Then you can use the following code to access the cluster&rsquo;s REST API server to enumerate its CRDs:</p>
<p><code>main.py</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python3" data-lang="Python3"><span style="display:flex;"><span><span style="color:#f92672">from</span> __future__ <span style="color:#f92672">import</span> print_function
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> kubernetes <span style="color:#f92672">import</span> client, config
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> kubernetes.client.rest <span style="color:#f92672">import</span> ApiException
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>config<span style="color:#f92672">.</span>load_kube_config()
</span></span><span style="display:flex;"><span>api <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>CustomObjectsApi()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ackal&#39;s Group|Version and some Kinds</span>
</span></span><span style="display:flex;"><span>group <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ack.al&#39;</span>
</span></span><span style="display:flex;"><span>version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;v1&#39;</span>
</span></span><span style="display:flex;"><span>plurals <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;checks&#39;</span>,<span style="color:#e6db74">&#39;customers&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> plural <span style="color:#f92672">in</span> plurals:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        resp <span style="color:#f92672">=</span> api<span style="color:#f92672">.</span>list_cluster_custom_object(
</span></span><span style="display:flex;"><span>            group,
</span></span><span style="display:flex;"><span>            version,
</span></span><span style="display:flex;"><span>            plural,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> resp[<span style="color:#e6db74">&#34;items&#34;</span>]:
</span></span><span style="display:flex;"><span>            spec <span style="color:#f92672">=</span> item[<span style="color:#e6db74">&#34;spec&#34;</span>]
</span></span><span style="display:flex;"><span>            print(spec)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> ApiException <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(e)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 -m venv venv
</span></span><span style="display:flex;"><span>source venv/bin/activate
</span></span><span style="display:flex;"><span>python3 -m pip install kubernetes<span style="color:#f92672">==</span>26.1.0
</span></span><span style="display:flex;"><span>python3 main.py
</span></span></code></pre></div><p>That&rsquo;s all!</p>
    </div>
    <a href="/posts/230708/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230607/" class="link black dim">
        Python Protobuf changes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Python&rsquo;s <a href="https://protobuf.dev/">Protocol Buffers</a> code-generation using <a href="https://github.com/protocolbuffers/protobuf/tree/main/python"><code>protoc</code></a> has had significant changes that can cause developers&hellip; &ldquo;challenges&rdquo;. This post summarizes my experience of these mostly to save me from repreatedly recreating this history for myself when I forget it.</p>
<ul>
<li>Version change</li>
<li>Generated code change</li>
<li>Implementation Backends</li>
</ul>
<p>I&rsquo;ll use this summarized table of <code>proto</code> and the Pypi library&rsquo;s history in this post. <a href="https://github.com/protocolbuffers/protobuf"><code>protoc</code></a> refers to the compiler that supports code-generation in multiple languages. <a href="https://pypi.org/project/protobuf/"><code>protobuf</code></a> refers to the corresponding Python (runtime) library on <a href="https://pypi.org">Pypi</a>:</p>
    </div>
    <a href="/posts/230607/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210316/" class="link black dim">
        Programmatically deploying Cloud Run services (Golang|Python)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Phew! Programmitcally deploying Cloud Run services should be easy but it didn&rsquo;t find it so.</p>
<p>My issues were that the Cloud Run Admin (!) API is poorly documented and it uses non-standard endpoints (thanks Sal!). Here, for others who may struggle with this, is how I got this to work.</p>
<h2 id="goal">Goal</h2>
<p>Programmatically (have Golang, Python, want Rust) deploy services to Cloud Run.</p>
<p>i.e. achieve this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud run deploy <span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--image<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--platform<span style="color:#f92672">=</span>managed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--no-allow-unauthenticated <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--region<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><blockquote>
<p><strong>TRICK</strong> <a href="https://cloud.google.com/sdk/gcloud/reference#--log-http"><code>--log-http</code></a> is your friend</p>
    </div>
    <a href="/posts/210316/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200217/" class="link black dim">
        OriginStamp Python|Golang SDK Examples
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A friend mentioned <a href="https://originstamp.org">OriginStamp</a> to me.</p>
<p><strong>NB</strong> There are 2 sites: <a href="https://originstamp.com">originstamp.com</a> and <a href="https://originstamp.org">originstamp.org</a>.</p>
<p>It&rsquo;s an interesting project.</p>
<p>It&rsquo;s a solution for providing auditable proof that you had a(ccess to) some digital thing before a certain date. OriginStamp provides user-|developer-friendly means to submit files|hashes (of your content) and have these bundled into transactions that are submitted to e.g. bitcoin.</p>
<p>I won&rsquo;t attempt to duplicate the narrative here, review OriginStamp&rsquo;s site and some of its content.</p>
    </div>
    <a href="/posts/200217/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190926/" class="link black dim">
        PyPi Transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been noodling around with another <a href="https://github.com/google/trillian">Trillian</a> personality.</p>
<p>Another in a theme that interests me in providing tamperproof logs for the packages in the popular package management registries.</p>
<p>The Golang team recently announced <a href="https://proxy.golang.org/">Go Module Mirror</a> which is built atop Trillian. It seems to me that all the package registries (<a href="https://proxy.golang.org">Go Modules</a>, <a href="https://www.npmjs.com">npm</a>, <a href="https://mvnrepository.com">Maven</a>, <a href="https://nuget.org">NuGet</a> etc.) would benefit from tamperproof logs hosted by a trusted 3rd-party.</p>
<p>As you may have guessed, PyPi Transparency is a log for <a href="https://pypi.org">PyPi</a> packages. PyPi is comprehensive, definitive and trusted but, as with Go Module Mirror, it doesn&rsquo;t hurt to provide a backup of some of its data. In the case of this solution, Trillian hosts a log of self-calculated SHA-256 hashes for Python packages that are added to it.</p>
    </div>
    <a href="/posts/190926/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/xml-rpc/" class="link blue hover-black">
            Tag: XML-RPC
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240811/" class="link black dim">
        XML-RPC in Rust and Python
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A lazy Sunday afternoon and my interest was piqued by <a href="https://en.wikipedia.org/wiki/XML-RPC">XML-RPC</a></p>
<h2 id="client">Client</h2>
<p>A very basic XML-RPC client wrapped in a Cloud Functions function:</p>
<p><code>main.py</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python3" data-lang="python3"><span style="display:flex;"><span><span style="color:#f92672">import</span> functions_framework
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> xmlrpc.client
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>endpoint <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>get_env(<span style="color:#e6db74">&#34;ENDPOINT&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>proxy <span style="color:#f92672">=</span> xmlrpc<span style="color:#f92672">.</span>client<span style="color:#f92672">.</span>ServerProxy(endpoint)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@functions_framework.http</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add</span>(request):
</span></span><span style="display:flex;"><span>    print(request)
</span></span><span style="display:flex;"><span>    rqst <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>get_json(silent<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    resp <span style="color:#f92672">=</span> proxy<span style="color:#f92672">.</span>add(
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#34;x&#34;</span>:{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;real&#34;</span>:rqst[<span style="color:#e6db74">&#34;x&#34;</span>][<span style="color:#e6db74">&#34;real&#34;</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;imag&#34;</span>:rqst[<span style="color:#e6db74">&#34;x&#34;</span>][<span style="color:#e6db74">&#34;imag&#34;</span>]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;y&#34;</span>:{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;real&#34;</span>:rqst[<span style="color:#e6db74">&#34;y&#34;</span>][<span style="color:#e6db74">&#34;real&#34;</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;imag&#34;</span>:rqst[<span style="color:#e6db74">&#34;y&#34;</span>][<span style="color:#e6db74">&#34;imag&#34;</span>]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> resp
</span></span></code></pre></div><p><code>requirements.txt</code>:</p>
<pre tabindex="0"><code>functions-framework==3.*
</code></pre><p>Run it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 -m venv venv
</span></span><span style="display:flex;"><span>source venv/bin/activate
</span></span><span style="display:flex;"><span>python3 -m pip install --requirement requirements.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>python3 main.py
</span></span></code></pre></div><h2 id="server">Server</h2>
<p>Forcing myself to go Rust first and there&rsquo;s an (old) <a href="https://crates.io/crates/xml-rpc">xml-rpc</a> crate.</p>
    </div>
    <a href="/posts/240811/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/crd/" class="link blue hover-black">
            Tag: CRD
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240529/" class="link black dim">
        Using Rust to generate Kubernetes CRD
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For the first time, I chose Rust to solve a problem. Until this, I&rsquo;ve been trying to use Rust to learn the language and to rewrite existing code. But, this problem led me to Rust because my other tools wouldn&rsquo;t cut it.</p>
<p>The question was how to represent oneof fields in Kubernetes <a href="https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/">Custom Resource Definitions (CRDs)</a>.</p>
<p>CRDs use <a href="https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.0.md#schemaObject">OpenAPI</a> schema and the YAML that results can be challenging to grok.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apiextensions.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">CustomResourceDefinition</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deploymentconfigs.example.com</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">group</span>: <span style="color:#ae81ff">example.com</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">names</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">categories</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">DeploymentConfig</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">plural</span>: <span style="color:#ae81ff">deploymentconfigs</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">shortNames</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">singular</span>: <span style="color:#ae81ff">deploymentconfig</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">scope</span>: <span style="color:#ae81ff">Namespaced</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">versions</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">additionalPrinterColumns</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">v1alpha1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">schema</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">openAPIV3Schema</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">description</span>: <span style="color:#ae81ff">An example schema</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">deployment_strategy</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">oneOf</span>:
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">rolling_update</span>
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">recreate</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">recreate</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>                      <span style="color:#f92672">something</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">format</span>: <span style="color:#ae81ff">uint16</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">minimum</span>: <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">integer</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>                    - <span style="color:#ae81ff">something</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">object</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">rolling_update</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>                      <span style="color:#f92672">max_surge</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">format</span>: <span style="color:#ae81ff">uint16</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">minimum</span>: <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">integer</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#f92672">max_unavailable</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">format</span>: <span style="color:#ae81ff">uint16</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">minimum</span>: <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">integer</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>                    - <span style="color:#ae81ff">max_surge</span>
</span></span><span style="display:flex;"><span>                    - <span style="color:#ae81ff">max_unavailable</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">object</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">type</span>: <span style="color:#ae81ff">object</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">deployment_strategy</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">type</span>: <span style="color:#ae81ff">object</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">spec</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">title</span>: <span style="color:#ae81ff">DeploymentConfig</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">object</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">served</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storage</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">subresources</span>: {}
</span></span></code></pre></div><p>I&rsquo;ve developed several Kubernetes <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/operator/">Operators</a> using the <a href="https://sdk.operatorframework.io/">Operator SDK</a> in Go (which builds upon <a href="https://github.com/kubernetes-sigs/kubebuilder">Kubebuilder</a>).</p>
    </div>
    <a href="/posts/240529/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/delve/" class="link blue hover-black">
            Tag: Delve
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240528/" class="link black dim">
        Using Delve to debug Go containers on Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>An interesting <a href="https://stackoverflow.com/questions/78537605">question</a> on Stack overflow prompted me to understand how to use Visual Studio Code and <a href="https://github.com/go-delve/delve">Delve</a> to remotely debug a Golang app running on Kubernetes (MicroK8s).</p>
<p>The OP is using <a href="https://github.com/gin-gonic/gin">Gin</a> which was also new to me so the question gave me an opportunity to try out several things.</p>
<h2 id="sources">Sources</h2>
<p>A simple <code>healthz</code> handler:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;flag&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log/slog&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">addr</span> = <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;addr&#34;</span>, <span style="color:#e6db74">&#34;0.0.0.0:8080&#34;</span>, <span style="color:#e6db74">&#34;HTTP server endpoint&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">healthz</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">String</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusOK</span>, <span style="color:#e6db74">&#34;ok&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Parse</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/fib&#34;</span>, <span style="color:#a6e22e">handler</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;healthz&#34;</span>, <span style="color:#a6e22e">healthz</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server starting&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server error&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;err&#34;</span>, <span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">addr</span>),
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>Containerfile</code>:</p>
    </div>
    <a href="/posts/240528/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/dlv/" class="link blue hover-black">
            Tag: Dlv
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240528/" class="link black dim">
        Using Delve to debug Go containers on Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>An interesting <a href="https://stackoverflow.com/questions/78537605">question</a> on Stack overflow prompted me to understand how to use Visual Studio Code and <a href="https://github.com/go-delve/delve">Delve</a> to remotely debug a Golang app running on Kubernetes (MicroK8s).</p>
<p>The OP is using <a href="https://github.com/gin-gonic/gin">Gin</a> which was also new to me so the question gave me an opportunity to try out several things.</p>
<h2 id="sources">Sources</h2>
<p>A simple <code>healthz</code> handler:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;flag&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log/slog&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">addr</span> = <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;addr&#34;</span>, <span style="color:#e6db74">&#34;0.0.0.0:8080&#34;</span>, <span style="color:#e6db74">&#34;HTTP server endpoint&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">healthz</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">String</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusOK</span>, <span style="color:#e6db74">&#34;ok&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Parse</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/fib&#34;</span>, <span style="color:#a6e22e">handler</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;healthz&#34;</span>, <span style="color:#a6e22e">healthz</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server starting&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server error&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;err&#34;</span>, <span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">addr</span>),
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>Containerfile</code>:</p>
    </div>
    <a href="/posts/240528/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/gin/" class="link blue hover-black">
            Tag: Gin
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240528/" class="link black dim">
        Using Delve to debug Go containers on Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>An interesting <a href="https://stackoverflow.com/questions/78537605">question</a> on Stack overflow prompted me to understand how to use Visual Studio Code and <a href="https://github.com/go-delve/delve">Delve</a> to remotely debug a Golang app running on Kubernetes (MicroK8s).</p>
<p>The OP is using <a href="https://github.com/gin-gonic/gin">Gin</a> which was also new to me so the question gave me an opportunity to try out several things.</p>
<h2 id="sources">Sources</h2>
<p>A simple <code>healthz</code> handler:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;flag&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log/slog&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">addr</span> = <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;addr&#34;</span>, <span style="color:#e6db74">&#34;0.0.0.0:8080&#34;</span>, <span style="color:#e6db74">&#34;HTTP server endpoint&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">healthz</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">String</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusOK</span>, <span style="color:#e6db74">&#34;ok&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Parse</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/fib&#34;</span>, <span style="color:#a6e22e">handler</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;healthz&#34;</span>, <span style="color:#a6e22e">healthz</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server starting&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server error&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;err&#34;</span>, <span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">addr</span>),
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>Containerfile</code>:</p>
    </div>
    <a href="/posts/240528/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/json-rpc/" class="link blue hover-black">
            Tag: JSON-RPC
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240528/" class="link black dim">
        Using Delve to debug Go containers on Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>An interesting <a href="https://stackoverflow.com/questions/78537605">question</a> on Stack overflow prompted me to understand how to use Visual Studio Code and <a href="https://github.com/go-delve/delve">Delve</a> to remotely debug a Golang app running on Kubernetes (MicroK8s).</p>
<p>The OP is using <a href="https://github.com/gin-gonic/gin">Gin</a> which was also new to me so the question gave me an opportunity to try out several things.</p>
<h2 id="sources">Sources</h2>
<p>A simple <code>healthz</code> handler:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;flag&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log/slog&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">addr</span> = <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;addr&#34;</span>, <span style="color:#e6db74">&#34;0.0.0.0:8080&#34;</span>, <span style="color:#e6db74">&#34;HTTP server endpoint&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">healthz</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">String</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusOK</span>, <span style="color:#e6db74">&#34;ok&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Parse</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/fib&#34;</span>, <span style="color:#a6e22e">handler</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;healthz&#34;</span>, <span style="color:#a6e22e">healthz</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server starting&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server error&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;err&#34;</span>, <span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">addr</span>),
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>Containerfile</code>:</p>
    </div>
    <a href="/posts/240528/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/microk8s/" class="link blue hover-black">
            Tag: MicroK8s
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240528/" class="link black dim">
        Using Delve to debug Go containers on Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>An interesting <a href="https://stackoverflow.com/questions/78537605">question</a> on Stack overflow prompted me to understand how to use Visual Studio Code and <a href="https://github.com/go-delve/delve">Delve</a> to remotely debug a Golang app running on Kubernetes (MicroK8s).</p>
<p>The OP is using <a href="https://github.com/gin-gonic/gin">Gin</a> which was also new to me so the question gave me an opportunity to try out several things.</p>
<h2 id="sources">Sources</h2>
<p>A simple <code>healthz</code> handler:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;flag&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log/slog&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">addr</span> = <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;addr&#34;</span>, <span style="color:#e6db74">&#34;0.0.0.0:8080&#34;</span>, <span style="color:#e6db74">&#34;HTTP server endpoint&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">healthz</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">String</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusOK</span>, <span style="color:#e6db74">&#34;ok&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Parse</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/fib&#34;</span>, <span style="color:#a6e22e">handler</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;healthz&#34;</span>, <span style="color:#a6e22e">healthz</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server starting&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Server error&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;err&#34;</span>, <span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">addr</span>),
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>Containerfile</code>:</p>
    </div>
    <a href="/posts/240528/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240216/" class="link black dim">
        MicroK8s operability add-on
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Spent time today <a href="https://en.wiktionary.org/wiki/yak_shaving">yak-shaving</a> which resulted in an unplanned migration from <a href="https://microk8s.io">MicroK8s</a> &lsquo;prometheus&rsquo; <a href="https://microk8s.io/docs/addons">add-on</a> to the new and not fully-documented &lsquo;observability&rsquo; add-on:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo microk8s.enable prometheus
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>Infer repository core for addon prometheus
</span></span><span style="display:flex;"><span>DEPRECATION WARNING: &#39;prometheus&#39; is deprecated and will soon be removed. Please use &#39;observability&#39; instead.
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>The reason for the name change is unclear.</p>
<p>It&rsquo;s unclear whether there&rsquo;s a difference in the primary components that are installed too (I&rsquo;d thought Grafana wasn&rsquo;t included in &lsquo;prometheus&rsquo;), <a href="https://grafana.com/oss/loki">(Grafana) Loki</a> and <a href="https://grafana.com/oss/tempo/">(Grafana) Tempo</a> definitely weren&rsquo;t included and I don&rsquo;t want them either.</p>
    </div>
    <a href="/posts/240216/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210305/" class="link black dim">
        Prometheus VPA Recommendations
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Phew!</p>
<p><a href="https://en.wikipedia.org/wiki/For_Want_of_a_Nail">For Want of a Nail</a></p>
<p>I was interested in learning how to <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Manage Resources for Containers</a>. On the way, I learned and discovered:</p>
<ul>
<li><a href="#kubectl-top"><code>kubectl top</code></a></li>
<li><a href="#vertical-pod-autoscaler-vpa">Vertical Pod Autoscaler</a></li>
<li>A (valuable) digression through <a href="#digression-podmonitor">PodMonitor</a></li>
<li><a href="#kube-state-metrics"><code>kube-state-metrics</code></a></li>
<li><a href="#kubectl-patch">`kubectl-patch</a></li>
<li>Created a <a href="#graph">Graph</a></li>
<li><a href="#references">References</a></li>
</ul>
<h2 id="kubernetes-resources">Kubernetes Resources</h2>
<p>Visual Studio Code has begun to bug me (reasonably) to add <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/"><code>resources</code></a> to Kubernetes manifests.</p>
<p>E.g.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;512Mi&#34;</span>
</span></span></code></pre></div><p>I&rsquo;ve been spending time with Deislab&rsquo;s <a href="https://github.com/deislabs/akri">Akri</a> and decided to determine whether Akri&rsquo;s primary resources (Agent, Controller) and some of my creations HTTP Device and Discovery, were being suitably constrained.</p>
    </div>
    <a href="/posts/210305/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210222/" class="link black dim">
        Dapr
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>It&rsquo;s a good name, I read it as &ldquo;dapper&rdquo; but I frequently type &ldquo;darp&rdquo; :-(</p>
<p>Was interested to <a href="https://blog.dapr.io/posts/2021/02/17/announcing-dapr-v1.0/">read</a> that <a href="https://dapr.io/">Dapr</a> is now v1.0 and decided to check it out. I was initially confused between Dapr and service mesh functionality. But, having used Dapr, it appears to be more focused in aiding the development of (cloud-native) (distributed) apps by providing developers with abstractions for e.g. service discovery, eventing, observability whereas service meshes feel (!) more oriented towards simplifying the deployment of existing apps. Both use the concept of proxies, deployed alongside app components (as sidecars on Kubernetes) to provide their functionality to apps.</p>
    </div>
    <a href="/posts/210222/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201217/" class="link black dim">
        Kubernetes Device Plugins
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m debugging an <a href="https://github.com/deislabs/akri/issues/177">issue</a> with Akri <code>Zeroconf</code> <a href="https://github.com/DazWilkin/akri/tree/protocol-zeroconf">protocol</a> in which Instance environment variables are no longer (!) being surfaced within the Broker pods. In my adventures, it seemed useful to better understand how Akri works and specifically, how Akri uses Kubernetes <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/device-plugins/">Device Plugins</a>.</p>
<p>IIUC plugins register with the Kubelet (!) via a gRPC service (<code>Registration</code>) that the Kubelet exposes on a UNIX socket at <code>/var/lib/kubelet/device-plugins/kubelet.sock</code></p>
<p>Then (!) if successful, devices should be reported by the Node&rsquo;s metadata (spec) and available to be bound to Pods.</p>
    </div>
    <a href="/posts/201217/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201113/" class="link black dim">
        Akri
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For the past couple of weeks, I&rsquo;ve been playing around with <a href="http://github.com/deislabs/akri">Akri</a>, a Microsoft (DeisLabs) project for <a href="https://cloudblogs.microsoft.com/opensource/2020/10/20/announcing-akri-open-source-project-building-connected-edge-kubernetes/">building a connected edge with Kubernetes</a>. Kubernetes, IoT, Rust (and Golang) make this all compelling to me.</p>
<p>Initially, I deployed an Akri <a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo.md">End-to-End</a> to <a href="https://microk8s.io/">MicroK8s</a> on Google Compute Engine (<a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo-gce.md">link</a>) and Digital Ocean (<a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo-do.md">link</a>). But I was interested to create me own example and so have proposed a very (!) simple <a href="https://github.com/DazWilkin/akri/blob/protocol-http/docs/extensibility-http.md">HTTP-based protocol</a>.</p>
<p>This blog summarizes my thoughts about Akri and an explanation of the HTTP protocol implementation in the hope that this helps others.</p>
    </div>
    <a href="/posts/201113/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201022/" class="link black dim">
        akri
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was very interested to read about Microsoft&rsquo;s DeisLab&rsquo;s latest (rust-based) Kubernetes project: <a href="https://cloudblogs.microsoft.com/opensource/2020/10/20/announcing-akri-open-source-project-building-connected-edge-kubernetes/">akri</a>. If I understand it correctly, it provides a mechanism to make any (IoT) device accessible to containers running within a cluster. I need to spend more time playing around with it so that I can fully understand it. I had some problems getting the <a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo.md">End-to-End</a> demo running on Google Compute Engine (and then I tried DigitalOcean droplet) instances. So, here&rsquo;s a two-ways solution to get you going.</p>
    </div>
    <a href="/posts/201022/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/dotnet/" class="link blue hover-black">
            Tag: Dotnet
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240409/" class="link black dim">
        Google Cloud Translation w/ gRPC 3 ways
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="general">General</h2>
<p>You&rsquo;ll need a Google Cloud project with Cloud Translation (<code>translate.googleapis.com</code>) enabled and a Service Account (and key) with suitable permissions in order to run the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BILLING<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Billing ID (gcloud billing accounts list)</span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Project ID</span>
</span></span><span style="display:flex;"><span>ACCOUNT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tester&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>EMAIL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span><span style="color:#e6db74">@</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">.iam.gserviceaccount.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ROLES<span style="color:#f92672">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/cloudtranslate.user&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/serviceusage.serviceUsageConsumer&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Project</span>
</span></span><span style="display:flex;"><span>gcloud projects create <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Associate Project with your Billing Account</span>
</span></span><span style="display:flex;"><span>gcloud billing accounts link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Enable Cloud Translation</span>
</span></span><span style="display:flex;"><span>gcloud services enable translate.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts create <span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account Key</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts keys create <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--iam-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update Project IAM permissions</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ROLE in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ROLES[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  gcloud projects add-iam-policy-binding <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --member<span style="color:#f92672">=</span>serviceAccount:<span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>ROLE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>For the code, you&rsquo;ll need to install <a href="https://github.com/protocolbuffers/protobuf"><code>protoc</code></a> and preferably have it in your path.</p>
    </div>
    <a href="/posts/240409/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/translation/" class="link blue hover-black">
            Tag: Translation
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240409/" class="link black dim">
        Google Cloud Translation w/ gRPC 3 ways
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="general">General</h2>
<p>You&rsquo;ll need a Google Cloud project with Cloud Translation (<code>translate.googleapis.com</code>) enabled and a Service Account (and key) with suitable permissions in order to run the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BILLING<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Billing ID (gcloud billing accounts list)</span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Project ID</span>
</span></span><span style="display:flex;"><span>ACCOUNT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tester&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>EMAIL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span><span style="color:#e6db74">@</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">.iam.gserviceaccount.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ROLES<span style="color:#f92672">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/cloudtranslate.user&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/serviceusage.serviceUsageConsumer&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Project</span>
</span></span><span style="display:flex;"><span>gcloud projects create <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Associate Project with your Billing Account</span>
</span></span><span style="display:flex;"><span>gcloud billing accounts link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Enable Cloud Translation</span>
</span></span><span style="display:flex;"><span>gcloud services enable translate.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts create <span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account Key</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts keys create <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--iam-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update Project IAM permissions</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ROLE in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ROLES[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  gcloud projects add-iam-policy-binding <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --member<span style="color:#f92672">=</span>serviceAccount:<span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>ROLE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>For the code, you&rsquo;ll need to install <a href="https://github.com/protocolbuffers/protobuf"><code>protoc</code></a> and preferably have it in your path.</p>
    </div>
    <a href="/posts/240409/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/eventarc/" class="link blue hover-black">
            Tag: Eventarc
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240405/" class="link black dim">
        Google Cloud Events protobufs and SDKs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written before about <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s use of <a href="https://cloud.google.com/firestore">Firestore</a> and subscribing to Firestore document CRUD events:</p>
<ul>
<li><a href="/posts/230530/">Routing Firestore events to GKE with Eventarc</a></li>
<li><a href="/posts/210413/">Cloud Firestore Triggers in Golang</a> using <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Firestore triggers</a></li>
</ul>
<p>I find Google&rsquo;s <a href="cloud.google.com/eventarc">Eventarc</a> documentation to be confusing and, in typical Google fashion, even though open-sourced, you often need to do some legwork to find relevant sources, viz:</p>
<ul>
<li>Google&rsquo;s Protobufs for Eventarc (using <a href="https://cloudevents.io/">cloudevents</a>) <a href="https://github.com/googleapis/google-cloudevents"><code>google-cloudevents</code></a><sup>1</sup></li>
<li>Convenience (since you can generate these using <code>protoc</code>) language-specific types generated from the above e.g. <a href="https://github.com/googleapis/google-cloudevents-go"><code>google-cloudevents-go</code></a>; <a href="https://github.com/googleapis/google-cloudevents-python"><code>google-cloudevents-python</code></a> etc.</li>
</ul>
<p><sup>1</sup> &ndash; IIUC EventArc is the Google service. It carries Google Events that are CloudEvents. These are defined by protocol buffers schemas.</p>
    </div>
    <a href="/posts/240405/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230530/" class="link black dim">
        Routing Firestore events to GKE with Eventarc
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google announced <a href="https://cloud.google.com/blog/products/databases/firestore-triggers-for-cloud-run-and-google-kubernetes-engine/">Firestore &hellip; integration with Eventarc</a>. <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> uses <a href="https://cloud.google.com/firestore">Firestore</a> to persist Customer and Check information and it uses <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore-1st-gen">Google Cloud Firestore Triggers</a> to handle events on these document types.</p>
<p><a href="https://cloud.google.com/eventarc">Eventarc</a> feels like the strategic future of eventing in Google Cloud and I&rsquo;ve been concerned since adopting the technology that Google would abandon Google Cloud Firestore Triggers.</p>
<p>For this reason, when I saw last week&rsquo;s announcement, I thought I should evaluate the mechanism and this blog post is a summary of that work.</p>
    </div>
    <a href="/posts/230530/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/firestore/" class="link blue hover-black">
            Tag: Firestore
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240405/" class="link black dim">
        Google Cloud Events protobufs and SDKs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written before about <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s use of <a href="https://cloud.google.com/firestore">Firestore</a> and subscribing to Firestore document CRUD events:</p>
<ul>
<li><a href="/posts/230530/">Routing Firestore events to GKE with Eventarc</a></li>
<li><a href="/posts/210413/">Cloud Firestore Triggers in Golang</a> using <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Firestore triggers</a></li>
</ul>
<p>I find Google&rsquo;s <a href="cloud.google.com/eventarc">Eventarc</a> documentation to be confusing and, in typical Google fashion, even though open-sourced, you often need to do some legwork to find relevant sources, viz:</p>
<ul>
<li>Google&rsquo;s Protobufs for Eventarc (using <a href="https://cloudevents.io/">cloudevents</a>) <a href="https://github.com/googleapis/google-cloudevents"><code>google-cloudevents</code></a><sup>1</sup></li>
<li>Convenience (since you can generate these using <code>protoc</code>) language-specific types generated from the above e.g. <a href="https://github.com/googleapis/google-cloudevents-go"><code>google-cloudevents-go</code></a>; <a href="https://github.com/googleapis/google-cloudevents-python"><code>google-cloudevents-python</code></a> etc.</li>
</ul>
<p><sup>1</sup> &ndash; IIUC EventArc is the Google service. It carries Google Events that are CloudEvents. These are defined by protocol buffers schemas.</p>
    </div>
    <a href="/posts/240405/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230530/" class="link black dim">
        Routing Firestore events to GKE with Eventarc
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google announced <a href="https://cloud.google.com/blog/products/databases/firestore-triggers-for-cloud-run-and-google-kubernetes-engine/">Firestore &hellip; integration with Eventarc</a>. <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> uses <a href="https://cloud.google.com/firestore">Firestore</a> to persist Customer and Check information and it uses <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore-1st-gen">Google Cloud Firestore Triggers</a> to handle events on these document types.</p>
<p><a href="https://cloud.google.com/eventarc">Eventarc</a> feels like the strategic future of eventing in Google Cloud and I&rsquo;ve been concerned since adopting the technology that Google would abandon Google Cloud Firestore Triggers.</p>
<p>For this reason, when I saw last week&rsquo;s announcement, I thought I should evaluate the mechanism and this blog post is a summary of that work.</p>
    </div>
    <a href="/posts/230530/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221111/" class="link black dim">
        The curious cases of the `deleted:serviceaccount`
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>While testing <a href="/posts/221110/">Firestore export and import</a> yesterday and checking the IAM permissions on a Cloud Storage Bucket, I noticed some Member (<code>member</code>) values (I think Google refers to these as Principals) were logical but unfamiliar to me:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>deleted:serviceAccount:{email}?uid={uid}
</span></span></code></pre></div><p>I was using <code>gsutil iam get gs://${BUCKET}</code> because I&rsquo;d realized (and this is another useful lesson) that, as I&rsquo;ve been creating daily test projects, I&rsquo;ve been binding each project&rsquo;s Firestore Service Account (<code>service-{project-number}@gcp-sa-firestore.iam.gserviceaccount.com</code>) to a Bucket owned by another Project <strong>but</strong> I hadn&rsquo;t been deleting the binding when I deleted the Project.</p>
    </div>
    <a href="/posts/221111/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220503/" class="link black dim">
        Automating Scheduled Firestore Exports
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For my &ldquo;thing&rdquo;, I use <a href="https://cloud.google.com/firestore">Firestore</a> to persist state. I like Firestore a lot and, having been around Google for almost (!) a decade, I much prefer it to Datastore.</p>
<p>Firestore has a <a href="https://firebase.google.com/docs/firestore/manage-data/export-import">managed export|import service</a> and I use this to backup Firestore collections|documents.</p>
<p>I&rsquo;d been doing backups manually (using <code>gcloud</code>) and decided today to take the plunge and use <a href="https://cloud.google.com/scheduler">Cloud Scheduler</a> for the first time. I&rsquo;d been reluctant to do this until now because I&rsquo;d assumed <strong>incorrectly</strong> that I&rsquo;d need to write a wrapping service to invoke the export.</p>
    </div>
    <a href="/posts/220503/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210506/" class="link black dim">
        Firestore Golang Timestamps &amp; Merging
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using Google&rsquo;s <a href="https://pkg.go.dev/cloud.google.com/go/firestore#DocumentRef">Golang SDK for Firestore</a>. The experience is excellent and I&rsquo;m quickly becoming a fan of Firestore. However, as a Golang Firestore developer, I&rsquo;m feeling less loved and some of the concepts in the database were causing me a conundrum.</p>
<p>I&rsquo;m still not entirely certain that I have Timestamps nailed but&hellip; I learned an important lesson on the auto-creation of Timestamps in documents and how to retain these values.</p>
    </div>
    <a href="/posts/210506/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210413/" class="link black dim">
        Cloud Firestore Triggers in Golang
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was pleased to discover that Google provides a non-Node.JS mechanism to subscribe to and act upon Firestore triggers, <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Google Cloud Firestore Triggers</a>. I&rsquo;ve nothing against Node.JS but, for the project i&rsquo;m developing, everything else is written in Golang. It&rsquo;s good to keep it all in one language.</p>
<p>I&rsquo;m perplexed that Cloud Functions still (!) only supports Go 1.13 (03-Sep-2019). Even <a href="https://golang.org/doc/devel/release.html#go1.14">Go 1.14</a> (25-Feb-2020) was released pre-pandemic and we&rsquo;re now running on 1.16. Come on Google!</p>
    </div>
    <a href="/posts/210413/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210317/" class="link black dim">
        Using Golang with the Firestore Emulator
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><img src="/images/210317.firebase.firestore.docs.png" alt="Firestore"></p>
<p>This works great but it wasn&rsquo;t clearly documented for non-Firebase users. I assume it will work, as well, for any of the client libraries (not just Golang).</p>
<p>Assuming you have some (Golang) code (in this case using the Google Cloud Client Library) that interacts with a Firestore database. Something of the form:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Golang" data-lang="Golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;crypto/sha256&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;cloud.google.com/go/firestore&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sha256</span>.<span style="color:#a6e22e">New</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#a6e22e">s</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%x&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Sum</span>(<span style="color:#66d9ef">nil</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Dog</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Name</span>    <span style="color:#66d9ef">string</span>                 <span style="color:#e6db74">`firestore:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Age</span>     <span style="color:#66d9ef">int</span>                    <span style="color:#e6db74">`firestore:&#34;age&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Human</span>   <span style="color:#f92672">*</span><span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">DocumentRef</span> <span style="color:#e6db74">`firestore:&#34;human&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Created</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>              <span style="color:#e6db74">`firestore:&#34;created&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewDog</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">age</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">human</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">DocumentRef</span>) <span style="color:#a6e22e">Dog</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Dog</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>:    <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Age</span>:     <span style="color:#a6e22e">age</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Human</span>:   <span style="color:#a6e22e">human</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Created</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(),
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">d</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Dog</span>) <span style="color:#a6e22e">ID</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Human</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`firestore:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">h</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Human</span>) <span style="color:#a6e22e">ID</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">project</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;PROJECT&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">NewClient</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">project</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;FIRESTORE_EMULATOR_HOST&#34;</span>); <span style="color:#a6e22e">value</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Using Firestore Emulator: %s&#34;</span>, <span style="color:#a6e22e">value</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">me</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Human</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;me&#34;</span>,
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">meDocRef</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Collection</span>(<span style="color:#e6db74">&#34;humans&#34;</span>).<span style="color:#a6e22e">Doc</span>(<span style="color:#a6e22e">me</span>.<span style="color:#a6e22e">ID</span>())
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">meDocRef</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">me</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">freddie</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewDog</span>(<span style="color:#e6db74">&#34;Freddie&#34;</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">meDocRef</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">freddieDocRef</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Collection</span>(<span style="color:#e6db74">&#34;dogs&#34;</span>).<span style="color:#a6e22e">Doc</span>(<span style="color:#a6e22e">freddie</span>.<span style="color:#a6e22e">ID</span>())
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">freddieDocRef</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">freddie</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Then you can interact instead with the Firestore Emulator.</p>
    </div>
    <a href="/posts/210317/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/prost/" class="link blue hover-black">
            Tag: Prost
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240405/" class="link black dim">
        Google Cloud Events protobufs and SDKs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written before about <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s use of <a href="https://cloud.google.com/firestore">Firestore</a> and subscribing to Firestore document CRUD events:</p>
<ul>
<li><a href="/posts/230530/">Routing Firestore events to GKE with Eventarc</a></li>
<li><a href="/posts/210413/">Cloud Firestore Triggers in Golang</a> using <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Firestore triggers</a></li>
</ul>
<p>I find Google&rsquo;s <a href="cloud.google.com/eventarc">Eventarc</a> documentation to be confusing and, in typical Google fashion, even though open-sourced, you often need to do some legwork to find relevant sources, viz:</p>
<ul>
<li>Google&rsquo;s Protobufs for Eventarc (using <a href="https://cloudevents.io/">cloudevents</a>) <a href="https://github.com/googleapis/google-cloudevents"><code>google-cloudevents</code></a><sup>1</sup></li>
<li>Convenience (since you can generate these using <code>protoc</code>) language-specific types generated from the above e.g. <a href="https://github.com/googleapis/google-cloudevents-go"><code>google-cloudevents-go</code></a>; <a href="https://github.com/googleapis/google-cloudevents-python"><code>google-cloudevents-python</code></a> etc.</li>
</ul>
<p><sup>1</sup> &ndash; IIUC EventArc is the Google service. It carries Google Events that are CloudEvents. These are defined by protocol buffers schemas.</p>
    </div>
    <a href="/posts/240405/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240325/" class="link black dim">
        Prost! Tonic w/ a dash of JSON
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I naively (!) began exploring JSON marshaling of Protobufs in rust. Other protobuf language SDKs include JSON marshaling making the process straightforward. I was to learn that, in rust, it&rsquo;s not so simple. Unfortunately, for me, this continues to discourage my further use of rust (rust is just hard).</p>
<p>My goal was to marshal an arbitrary protocol buffer message that included a <a href="https://protobuf.dev/programming-guides/proto3/#oneof"><code>oneof</code></a> feature. I was unable to JSON marshal the rust generated by <code>tonic</code> for such a message.</p>
    </div>
    <a href="/posts/240325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/protobufs/" class="link blue hover-black">
            Tag: Protobufs
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240405/" class="link black dim">
        Google Cloud Events protobufs and SDKs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written before about <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s use of <a href="https://cloud.google.com/firestore">Firestore</a> and subscribing to Firestore document CRUD events:</p>
<ul>
<li><a href="/posts/230530/">Routing Firestore events to GKE with Eventarc</a></li>
<li><a href="/posts/210413/">Cloud Firestore Triggers in Golang</a> using <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Firestore triggers</a></li>
</ul>
<p>I find Google&rsquo;s <a href="cloud.google.com/eventarc">Eventarc</a> documentation to be confusing and, in typical Google fashion, even though open-sourced, you often need to do some legwork to find relevant sources, viz:</p>
<ul>
<li>Google&rsquo;s Protobufs for Eventarc (using <a href="https://cloudevents.io/">cloudevents</a>) <a href="https://github.com/googleapis/google-cloudevents"><code>google-cloudevents</code></a><sup>1</sup></li>
<li>Convenience (since you can generate these using <code>protoc</code>) language-specific types generated from the above e.g. <a href="https://github.com/googleapis/google-cloudevents-go"><code>google-cloudevents-go</code></a>; <a href="https://github.com/googleapis/google-cloudevents-python"><code>google-cloudevents-python</code></a> etc.</li>
</ul>
<p><sup>1</sup> &ndash; IIUC EventArc is the Google service. It carries Google Events that are CloudEvents. These are defined by protocol buffers schemas.</p>
    </div>
    <a href="/posts/240405/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240325/" class="link black dim">
        Prost! Tonic w/ a dash of JSON
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I naively (!) began exploring JSON marshaling of Protobufs in rust. Other protobuf language SDKs include JSON marshaling making the process straightforward. I was to learn that, in rust, it&rsquo;s not so simple. Unfortunately, for me, this continues to discourage my further use of rust (rust is just hard).</p>
<p>My goal was to marshal an arbitrary protocol buffer message that included a <a href="https://protobuf.dev/programming-guides/proto3/#oneof"><code>oneof</code></a> feature. I was unable to JSON marshal the rust generated by <code>tonic</code> for such a message.</p>
    </div>
    <a href="/posts/240325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240307/" class="link black dim">
        Prometheus Protobufs and Native Histograms
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I responded to a question <a href="https://stackoverflow.com/questions/78112323/prometheus-metric-protocol-buffer-in-grpc#comment137716337_78112323">Prometheus metric protocol buffer in gRPC</a> on Stackoverflow and it piqued my curiosity and got me yak shaving.</p>
<p>Prometheus used to support two exposition formats including Protocol Buffers, then dropped Protocol Buffer and has since re-added it (see <a href="https://github.com/prometheus/docs/blob/main/content/docs/instrumenting/exposition_formats.md#protobuf-format">Protobuf format</a>). The Protobuf format has returned to support the experimental <a href="https://prometheus.io/docs/prometheus/latest/feature_flags/#native-histograms">Native Histograms</a> feature.</p>
<p>I&rsquo;m interested in adding Native Histogram support to <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> so thought I&rsquo;d learn more about this metric.</p>
    </div>
    <a href="/posts/240307/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240117/" class="link black dim">
        Gnarly Protocol Buffers compilation
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This Stackoverflow question piqued my interest:</p>
<p><a href="https://stackoverflow.com/questions/77829333/retry-policy-configuration-for-grpc-not-working">retry policy configuration for grpc not working</a></p>
<p><a href="https://github.com/grpc/grpc/blob/master/doc/service_config.md">Service Config in gRPC</a> is new to me but, my initial suspicion (albeit incorrect) was that the JSON types were incorrect.</p>
<p>I decided to try using the Protocol Buffer source <a href="https://github.com/grpc/grpc-proto/blob/master/grpc/service_config/service_config.proto"><code>service_config.proto</code></a> to verify the JSON.</p>
<p>To do so I needed to compile the source&hellip;. it was gnarly.</p>
<p>There are 2 repos used:</p>
<ul>
<li><a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a></li>
<li><a href="https://github.com/grpc/grpc-proto"><code>grpc-proto</code></a></li>
</ul>
<p>The <code>service_config.proto</code> includes <code>options</code> for <code>java_package</code> but no <code>go_package</code>.</p>
    </div>
    <a href="/posts/240117/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230607/" class="link black dim">
        Python Protobuf changes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Python&rsquo;s <a href="https://protobuf.dev/">Protocol Buffers</a> code-generation using <a href="https://github.com/protocolbuffers/protobuf/tree/main/python"><code>protoc</code></a> has had significant changes that can cause developers&hellip; &ldquo;challenges&rdquo;. This post summarizes my experience of these mostly to save me from repreatedly recreating this history for myself when I forget it.</p>
<ul>
<li>Version change</li>
<li>Generated code change</li>
<li>Implementation Backends</li>
</ul>
<p>I&rsquo;ll use this summarized table of <code>proto</code> and the Pypi library&rsquo;s history in this post. <a href="https://github.com/protocolbuffers/protobuf"><code>protoc</code></a> refers to the compiler that supports code-generation in multiple languages. <a href="https://pypi.org/project/protobuf/"><code>protobuf</code></a> refers to the corresponding Python (runtime) library on <a href="https://pypi.org">Pypi</a>:</p>
    </div>
    <a href="/posts/230607/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230314/" class="link black dim">
        Access Google Services using gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google publishes interface definitions of Google APIs (services) that support REST and gRPC in a repo called <a href="https://github.com/googleapis/googleapis">Google APIs</a>. Google&rsquo;s SDKs uses gRPC to access these services but, how to do this using e.g. <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a>?</p>
<p>I wanted to debug <a href="https://cloud.google.com/profiler/docs">Cloud Profiler</a> and its agent makes <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L83"><code>UpdateProfile</code></a> RPCs to <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L41"><code>cloudprofiler.googleapis.com</code></a>. Cloud Profiler is more challenging service to debug because (a) it&rsquo;s publicly &ldquo;write-only&rdquo;; and (b) it has complex messages. <code>UpdateProfile</code> sends <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L123"><code>UpdateProfileRequest</code></a> messages that include <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L123"><code>Profile</code></a> messages that include <code>profile_bytes</code> which are gzip compressed serialized protos of <a href="https://github.com/google/pprof">pprof</a>&rsquo;s <a href="https://github.com/google/pprof/blob/d61513b1440d93d62aad023cc60d7a33f3917b70/proto/profile.proto#L46"><code>Profile</code></a>.</p>
    </div>
    <a href="/posts/230314/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200817/" class="link black dim">
        WASM Transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been playing around with a proof-of-concept combining WASM and <a href="https://github.com/google/trillian">Trillian</a>. The hypothesis was to explore using WASM as a form of chaincode with Trillian. The project works but it&rsquo;s far from being a chaincode-like solution.</p>
<p>Let&rsquo;s start with a couple of (trivial) examples and then I&rsquo;ll explain what&rsquo;s going on and how it&rsquo;s implemented.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Method: mul
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [Client:Invoke] Metadata: complex.wasm
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Success: result:{real:0.036980484 imag:0.3898267}
</span></span></code></pre></div><p>After shipping a Rust-sourced WASM solution (<code>complex.wasm</code>) to the WASM transparency server, the client invokes a method <code>mul</code> that&rsquo;s exposed by it using a dynamically generated request message and outputs the response. Woo hoo! Yes, an expensive way to multiple complex numbers.</p>
    </div>
    <a href="/posts/200817/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200717/" class="link black dim">
        Remotely invoking WASM functions using gRPC and waPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Following on from <a href="/posts/200612/">waPC &amp; Protobufs</a>, I can now remotely invoke (arbitrary) WASM functions:</p>
<p>Client:</p>
<p>The logging isn&rsquo;t perfectly clear but, the client gets (a previously added) WASM binary from the server (using the SHA-256 of the WASM binary as a unique identifier). The result includes metadata that includes a protobuf descriptor of the WASM binary&rsquo;s functions. The descriptor defines gRPC services (that represent the WASM functions) with input (parameters) and output (results) messages.</p>
    </div>
    <a href="/posts/200717/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200630/" class="link black dim">
        Golang Protobuf APIv2
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google has a new Golang Protobuf API, APIv2 (<a href="https://pkg.go.dev/google.golang.org/protobuf?tab=overview">google.golang.org/protobuf</a>) superseding APIv1 (<a href="https://pkg.go.dev/github.com/golang/protobuf?tab=overview">github.com/golang/protobuf</a>). If your code is importing <code>github.com/golang/protobuf</code>, you&rsquo;re using APIv2. Otherwise, you should consult with the docs because Google reimplemented APIv1 atop APIv2. One challenge this caused me, as someone who does not use protobufs and gRPC on a daily basis, is that <a href="https://pkg.go.dev/github.com/golang/protobuf/protoc-gen-go/grpc?tab=doc">gRPC</a> (code-generation) is being removed from the (Golang) <code>protoc-gen-go</code>, the Golang plugin that generates gRPC service bindings.</p>
    </div>
    <a href="/posts/200630/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200617/" class="link black dim">
        WASM Cloud Functions
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Following on from <a href="/posts/200612/">waPC &amp; Protobufs</a> and a question on Stack Overflow about Cloud Functions, I was compelled to try running WASM on Cloud Functions no JavaScript.</p>
<p>I wanted to reuse the WASM waPC functions that I&rsquo;d written in Rust as described in the other post. Cloud Functions does not (yet!?) provide a Rust runtime and so I&rsquo;m using the <a href="https://github.com/wapc/wapc-go">waPC Host for Go</a> in this example.</p>
<p>It works!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PARAMS<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>printf <span style="color:#e6db74">&#39;{&#34;a&#34;:{&#34;real&#34;:39,&#34;imag&#34;:3},&#34;b&#34;:{&#34;real&#34;:39,&#34;imag&#34;:3}}&#39;</span> | base64<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>gcloud auth print-identity-token<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;filename\&#34;:\&#34;complex.wasm\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;function\&#34;:\&#34;c:mul\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;params\&#34;:\&#34;</span><span style="color:#e6db74">${</span>PARAMS<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#34;</span> |<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request POST <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--data @- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span>-<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>.cloudfunctions.net/invoker
</span></span></code></pre></div><p>yields (correctly):</p>
    </div>
    <a href="/posts/200617/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200612/" class="link black dim">
        waPC &amp; Protobufs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m hacking around with a solution that combines WASM and Google <a href="https://github.com/google/trillian">Trillian</a>.</p>
<p>Ultimately, I&rsquo;d like to be able to ship WASM (binaries) to a Trillian personality and then invoke (exported) functions on them. Some this was borne from the interesting exploration of <a href="https://github.com/deislabs/krustlet">Krustlet</a> and its application of <a href="https://wascc.dev/">wascc</a>.</p>
<p>I&rsquo;m still booting into WASM but it&rsquo;s a <em>very</em> interesting technology that has most interesting potential outside the browser. Some folks have been trailblazing the technology and I have been reading Kevin Hoffman&rsquo;s <a href="https://medium.com/@KevinHoffman">medium</a> and <a href="https://wascc.dev/">wascc</a> (nee waxosuit) work. From this, I stumbled upon Kevin&rsquo;s <a href="https://medium.com/@KevinHoffman/introducing-wapc-dc9d8b0c2223">waPC</a> and I&rsquo;m using waPC in this prototyping as a way to exchange data between clients and servers running WASM binaries.</p>
    </div>
    <a href="/posts/200612/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200429/" class="link black dim">
        Rust implementation of Crate Transparency using Google Trillian
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been hacking on a Rust-based transparent application for Google Trillian. As appears to be my fixation, this personality is for another package manager. This time, Rust&rsquo;s <a href="https://doc.rust-lang.org/1.0.0/book/crates-and-modules.html">Crates</a> often found in <a href="https://crates.io"><code>crates.io</code></a> which is Rust&rsquo;s Package Registry. I discussed this project earlier this month <a href="/posts/200403/">Rust Crate Transparency &amp;&amp; Rust SDK for Google Trillian</a> and and earlier approach for Python&rsquo;s packages with <a href="/posts/190907/">pypi-transparency</a>.</p>
<p>This time, of course, I&rsquo;m using Rust. And, by way of a first for me, for the gRPC server implementation (aka &ldquo;personality&rdquo;). I&rsquo;ve been lazy thanks to the excellent <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a> and have been using it way of a client. Because I&rsquo;m more familiar with Golang and because I&rsquo;ve written (most) other Trillian personalities in Golang, I resorted to quickly implementing Crate Transparency in Golang too in order to uncover bugs with the Rust implementation. I&rsquo;ll write a follow-up post on the complexity I seem to struggle with when using protobufs and gRPC [in Golang].</p>
    </div>
    <a href="/posts/200429/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200325/" class="link black dim">
        gRPC, Cloud Run &amp; Endpoints
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>&lt;3 Google but there&rsquo;s quite often an assumption that we&rsquo;re all sitting around the engineering table and, of course, we&rsquo;re not.</p>
<p><a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> is a powerful offering but &ndash; IMO &ndash; it&rsquo;s <strong>super</strong> confusing to understand and complex to deploy.</p>
<p>If you&rsquo;re familiar with the motivations behind service meshes (e.g. <a href="https://istio.io">Istio</a>), Cloud Endpoints fits in a similar niche (&ldquo;neesh&rdquo; or &ldquo;nitch&rdquo;?). The underlying ambition is that, developers can take <strong>existing</strong> code and by adding a proxy (or sidecar), general-purpose abstractions, security, logging etc. may be added.</p>
    </div>
    <a href="/posts/200325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200320/" class="link black dim">
        Golang gRPC Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>Update: 2020-03-24</strong>: Since writing this post, I&rsquo;ve contributed <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/12">Golang</a> and <a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example/pull/15">Rust</a> samples to Google&rsquo;s project. I recommend you start there.</p></blockquote>
<p>Google explained how to run gRPC servers with Cloud Run. The examples are good but only Python and Node.JS:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/compute/serve-cloud-run-requests-with-grpc-not-just-http">gRPC comes to Cloud Run</a></li>
<li><a href="https://github.com/grpc-ecosystem/grpc-cloud-run-example">gRPC in Google Cloud Run</a></li>
</ul>
<p>Missing Golang&hellip;. until now ;-)</p>
<p>I had problems with 1.14 and so I&rsquo;m using 1.13.</p>
<h2 id="project-structure">Project structure</h2>
<p>I&rsquo;ll tidy up my repo but the code may be found:</p>
    </div>
    <a href="/posts/200320/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200310/" class="link black dim">
        Google&#39;s New Golang SDK for Protobufs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google has released a new Golang SDK for protobuf. In the [announcement], a useful tool to redact properties is described. If like me, this is somewhat novel to you, here&rsquo;s a mashup using Google&rsquo;s <a href="https://developers.google.com/protocol-buffers/docs/gotutorial">Protocol Buffer Basics</a> w/ redaction.</p>
<p>To be very clear, as it&rsquo;s an important distinction:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">Version</th>
          <th>Repo</th>
          <th>Docs</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">v2</td>
          <td><a href="https://google.golang.org/protobuf">google.golang.org/protobuf</a></td>
          <td><a href="https://pkg.go.dev/google.golang.org/protobuf">Docs</a></td>
      </tr>
      <tr>
          <td style="text-align: center">v1</td>
          <td><a href="https://github.com/golang/protobuf">github.com/golang/protobuf</a></td>
          <td><a href="https://pkg.go.dev/github.com/golang/protobuf">Docs</a></td>
      </tr>
  </tbody>
</table>
<h3 id="project">Project</h3>
<p>Here&rsquo;s my project structure:</p>
<pre tabindex="0"><code>.
├── protoc-3.11.4-linux-x86_64
│   ├── bin
│   │   └── protoc
│   ├── include
│   │   └── google
│   └── readme.txt
└── src
    ├── go.mod
    ├── go.sum
    ├── main.go
    ├── protos
    │   ├── addressbook.pb.go
    │   └── addressbook.proto
    └── README.md
</code></pre><p>You may structure as you wish.</p>
    </div>
    <a href="/posts/200310/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/tonic/" class="link blue hover-black">
            Tag: Tonic
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240405/" class="link black dim">
        Google Cloud Events protobufs and SDKs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written before about <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s use of <a href="https://cloud.google.com/firestore">Firestore</a> and subscribing to Firestore document CRUD events:</p>
<ul>
<li><a href="/posts/230530/">Routing Firestore events to GKE with Eventarc</a></li>
<li><a href="/posts/210413/">Cloud Firestore Triggers in Golang</a> using <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Firestore triggers</a></li>
</ul>
<p>I find Google&rsquo;s <a href="cloud.google.com/eventarc">Eventarc</a> documentation to be confusing and, in typical Google fashion, even though open-sourced, you often need to do some legwork to find relevant sources, viz:</p>
<ul>
<li>Google&rsquo;s Protobufs for Eventarc (using <a href="https://cloudevents.io/">cloudevents</a>) <a href="https://github.com/googleapis/google-cloudevents"><code>google-cloudevents</code></a><sup>1</sup></li>
<li>Convenience (since you can generate these using <code>protoc</code>) language-specific types generated from the above e.g. <a href="https://github.com/googleapis/google-cloudevents-go"><code>google-cloudevents-go</code></a>; <a href="https://github.com/googleapis/google-cloudevents-python"><code>google-cloudevents-python</code></a> etc.</li>
</ul>
<p><sup>1</sup> &ndash; IIUC EventArc is the Google service. It carries Google Events that are CloudEvents. These are defined by protocol buffers schemas.</p>
    </div>
    <a href="/posts/240405/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240325/" class="link black dim">
        Prost! Tonic w/ a dash of JSON
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I naively (!) began exploring JSON marshaling of Protobufs in rust. Other protobuf language SDKs include JSON marshaling making the process straightforward. I was to learn that, in rust, it&rsquo;s not so simple. Unfortunately, for me, this continues to discourage my further use of rust (rust is just hard).</p>
<p>My goal was to marshal an arbitrary protocol buffer message that included a <a href="https://protobuf.dev/programming-guides/proto3/#oneof"><code>oneof</code></a> feature. I was unable to JSON marshal the rust generated by <code>tonic</code> for such a message.</p>
    </div>
    <a href="/posts/240325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/json/" class="link blue hover-black">
            Tag: JSON
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240325/" class="link black dim">
        Prost! Tonic w/ a dash of JSON
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I naively (!) began exploring JSON marshaling of Protobufs in rust. Other protobuf language SDKs include JSON marshaling making the process straightforward. I was to learn that, in rust, it&rsquo;s not so simple. Unfortunately, for me, this continues to discourage my further use of rust (rust is just hard).</p>
<p>My goal was to marshal an arbitrary protocol buffer message that included a <a href="https://protobuf.dev/programming-guides/proto3/#oneof"><code>oneof</code></a> feature. I was unable to JSON marshal the rust generated by <code>tonic</code> for such a message.</p>
    </div>
    <a href="/posts/240325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220602/" class="link black dim">
        Vultr CLI and JSON output
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve begun exploring <a href="https://vultr.com">Vultr</a> after the company announced a managed Kubernetes offering <a href="https://www.vultr.com/kubernetes/">Vultr Kubernetes Engine (VKE)</a>.</p>
<p>In my brief experience, it&rsquo;s a decent platform and its CLI <a href="https://github.com/vultr/vultr-cli"><code>vultr-cli</code></a> is mostly (!) good. The CLI has a limitation in that command output is text formatted and this makes it challenging to parse the output when scripting.</p>
<blockquote>
<p><strong>NOTE</strong> The Vultr developers have a branch <a href="https://github.com/vultr/vultr-cli/tree/rewrite"><code>rewrite</code></a> that includes a solution to this problem.</p></blockquote>
<p>Example</p>
<pre tabindex="0"><code>ID              12345678-90ab-cdef-1234-567890abcdef
LABEL           test
DATE CREATED    2022-01-01T00:00:00+00:00
CLUSTER SUBNET  255.255.255.255/16
SERVICE SUBNET  255.255.255.255/12
IP              255.255.255.255
ENDPOINT        12345678-90ab-cdef-1234-567890abcdef.vultr-k8s.com
VERSION         v1.23.5+3
REGION          mars
STATUS          pending
 
NODE POOLS
ID              12345678-90ab-cdef-1234-567890abcdef
DATE CREATED    2022-01-01T00:00:00+00:00
DATE UPDATED    2022-01-01T00:00:00+00:00
LABEL           nodepool
TAG             foo
PLAN            vc2-1c-2gb
STATUS          pending
NODE QUANTITY   1
AUTO SCALER     false
MIN NODES       1
MAX NODES       1
 
NODES
ID                                      DATE CREATED                    LABEL                   STATUS
12345678-
</code></pre><p>Until that&rsquo;s available, I&rsquo;m lazy writing <strong>very simple</strong> bash scripts to parse <code>vultr-cli</code> command output as JSON. The repo is <a href="https://github.com/DazWilkin/vultr-cli-format"><code>vultr-cli-format</code></a>.</p>
    </div>
    <a href="/posts/220602/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/protoc/" class="link blue hover-black">
            Tag: Protoc
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240325/" class="link black dim">
        Prost! Tonic w/ a dash of JSON
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I naively (!) began exploring JSON marshaling of Protobufs in rust. Other protobuf language SDKs include JSON marshaling making the process straightforward. I was to learn that, in rust, it&rsquo;s not so simple. Unfortunately, for me, this continues to discourage my further use of rust (rust is just hard).</p>
<p>My goal was to marshal an arbitrary protocol buffer message that included a <a href="https://protobuf.dev/programming-guides/proto3/#oneof"><code>oneof</code></a> feature. I was unable to JSON marshal the rust generated by <code>tonic</code> for such a message.</p>
    </div>
    <a href="/posts/240325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240117/" class="link black dim">
        Gnarly Protocol Buffers compilation
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This Stackoverflow question piqued my interest:</p>
<p><a href="https://stackoverflow.com/questions/77829333/retry-policy-configuration-for-grpc-not-working">retry policy configuration for grpc not working</a></p>
<p><a href="https://github.com/grpc/grpc/blob/master/doc/service_config.md">Service Config in gRPC</a> is new to me but, my initial suspicion (albeit incorrect) was that the JSON types were incorrect.</p>
<p>I decided to try using the Protocol Buffer source <a href="https://github.com/grpc/grpc-proto/blob/master/grpc/service_config/service_config.proto"><code>service_config.proto</code></a> to verify the JSON.</p>
<p>To do so I needed to compile the source&hellip;. it was gnarly.</p>
<p>There are 2 repos used:</p>
<ul>
<li><a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a></li>
<li><a href="https://github.com/grpc/grpc-proto"><code>grpc-proto</code></a></li>
</ul>
<p>The <code>service_config.proto</code> includes <code>options</code> for <code>java_package</code> but no <code>go_package</code>.</p>
    </div>
    <a href="/posts/240117/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230607/" class="link black dim">
        Python Protobuf changes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Python&rsquo;s <a href="https://protobuf.dev/">Protocol Buffers</a> code-generation using <a href="https://github.com/protocolbuffers/protobuf/tree/main/python"><code>protoc</code></a> has had significant changes that can cause developers&hellip; &ldquo;challenges&rdquo;. This post summarizes my experience of these mostly to save me from repreatedly recreating this history for myself when I forget it.</p>
<ul>
<li>Version change</li>
<li>Generated code change</li>
<li>Implementation Backends</li>
</ul>
<p>I&rsquo;ll use this summarized table of <code>proto</code> and the Pypi library&rsquo;s history in this post. <a href="https://github.com/protocolbuffers/protobuf"><code>protoc</code></a> refers to the compiler that supports code-generation in multiple languages. <a href="https://pypi.org/project/protobuf/"><code>protobuf</code></a> refers to the corresponding Python (runtime) library on <a href="https://pypi.org">Pypi</a>:</p>
    </div>
    <a href="/posts/230607/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200310/" class="link black dim">
        Google&#39;s New Golang SDK for Protobufs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google has released a new Golang SDK for protobuf. In the [announcement], a useful tool to redact properties is described. If like me, this is somewhat novel to you, here&rsquo;s a mashup using Google&rsquo;s <a href="https://developers.google.com/protocol-buffers/docs/gotutorial">Protocol Buffer Basics</a> w/ redaction.</p>
<p>To be very clear, as it&rsquo;s an important distinction:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">Version</th>
          <th>Repo</th>
          <th>Docs</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">v2</td>
          <td><a href="https://google.golang.org/protobuf">google.golang.org/protobuf</a></td>
          <td><a href="https://pkg.go.dev/google.golang.org/protobuf">Docs</a></td>
      </tr>
      <tr>
          <td style="text-align: center">v1</td>
          <td><a href="https://github.com/golang/protobuf">github.com/golang/protobuf</a></td>
          <td><a href="https://pkg.go.dev/github.com/golang/protobuf">Docs</a></td>
      </tr>
  </tbody>
</table>
<h3 id="project">Project</h3>
<p>Here&rsquo;s my project structure:</p>
<pre tabindex="0"><code>.
├── protoc-3.11.4-linux-x86_64
│   ├── bin
│   │   └── protoc
│   ├── include
│   │   └── google
│   └── readme.txt
└── src
    ├── go.mod
    ├── go.sum
    ├── main.go
    ├── protos
    │   ├── addressbook.pb.go
    │   └── addressbook.proto
    └── README.md
</code></pre><p>You may structure as you wish.</p>
    </div>
    <a href="/posts/200310/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/fks/" class="link blue hover-black">
            Tag: Fks
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240314/" class="link black dim">
        Fly Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Interested to explore <a href="https://fly.io/docs/kubernetes/">Fly Kubernetes</a> after being accepted into the closed beta.</p>
<p>The folks at Fly are innovative in their technology uses and, having been a long-time Kubernetes user, I was intrigued to learn that Fly.io has <a href="https://fly.io/blog/fks/">implemented Kubernetes atop Fly</a>.</p>
<p>My first Deployment failed:</p>
<pre tabindex="0"><code>Authentication required to access image &#34;ghcr.io/{image}&#34;
</code></pre><p>It was confirmed to me that FKS does not support pulling from private registries. The solution is <code>pull</code>-<code>tag</code>-<code>push</code> images to <code>registry.fly.io</code> but, Fly&rsquo;s repository is app-specific and so, you need to do some querying to grab the Fly app created by FKS (for your namespace):</p>
    </div>
    <a href="/posts/240314/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/fly.io/" class="link blue hover-black">
            Tag: Fly.io
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240314/" class="link black dim">
        Fly Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Interested to explore <a href="https://fly.io/docs/kubernetes/">Fly Kubernetes</a> after being accepted into the closed beta.</p>
<p>The folks at Fly are innovative in their technology uses and, having been a long-time Kubernetes user, I was intrigued to learn that Fly.io has <a href="https://fly.io/blog/fks/">implemented Kubernetes atop Fly</a>.</p>
<p>My first Deployment failed:</p>
<pre tabindex="0"><code>Authentication required to access image &#34;ghcr.io/{image}&#34;
</code></pre><p>It was confirmed to me that FKS does not support pulling from private registries. The solution is <code>pull</code>-<code>tag</code>-<code>push</code> images to <code>registry.fly.io</code> but, Fly&rsquo;s repository is app-specific and so, you need to do some querying to grab the Fly app created by FKS (for your namespace):</p>
    </div>
    <a href="/posts/240314/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220520/" class="link black dim">
        Prometheus Exporters for fly.io and Vultr
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been on a roll building utilities this week. I developed a Service Health dashboard for my &ldquo;thing&rdquo;, a <a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a> and today, a <a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a>. This is motivated by the fear that I will forget a deployed Cloud resource and incur a horrible bill.</p>
<p>I&rsquo;ve no written several Prometheus Exporters for cloud platforms:</p>
<ul>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for GCP</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>Each of them monitors resource deployments and produces resource count metrics that can be scraped by Prometheus and alerted with Alertmanager. I have Alertmanager <a href="https://prometheus.io/docs/alerting/latest/configuration/#pushover_config">configured</a> to send notifications to <a href="https://pushover.net">Pushover</a>. Last week I wrote an integration between <a href="/posts/220514/">Google Cloud Monitoring to send notifications to Pushover</a> too.</p>
    </div>
    <a href="/posts/220520/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210412/" class="link black dim">
        Fly.io
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I spent some time over the weekend understanding <a href="https://fly.io">Fly.io</a>. It&rsquo;s always fascinating to me how many smart people are building really neat solutions. Fly.io is subtly different to other platforms that I use (Kubernetes, GCP, DO, Linode) and I&rsquo;ve found the Fly.io team to be highly responsive and helpful to my noob questions.</p>
<p>One of the team&rsquo;s posts, <a href="https://fly.io/blog/docker-without-docker/">Docker without Docker</a> surfaced in my Feedly feed (<a href="https://news.ycombinator.com/item?id=26746280">hackernews</a>) and it piqued my interest.</p>
    </div>
    <a href="/posts/210412/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/prom2json/" class="link blue hover-black">
            Tag: Prom2json
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240307/" class="link black dim">
        Prometheus Protobufs and Native Histograms
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I responded to a question <a href="https://stackoverflow.com/questions/78112323/prometheus-metric-protocol-buffer-in-grpc#comment137716337_78112323">Prometheus metric protocol buffer in gRPC</a> on Stackoverflow and it piqued my curiosity and got me yak shaving.</p>
<p>Prometheus used to support two exposition formats including Protocol Buffers, then dropped Protocol Buffer and has since re-added it (see <a href="https://github.com/prometheus/docs/blob/main/content/docs/instrumenting/exposition_formats.md#protobuf-format">Protobuf format</a>). The Protobuf format has returned to support the experimental <a href="https://prometheus.io/docs/prometheus/latest/feature_flags/#native-histograms">Native Histograms</a> feature.</p>
<p>I&rsquo;m interested in adding Native Histogram support to <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> so thought I&rsquo;d learn more about this metric.</p>
    </div>
    <a href="/posts/240307/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/protobuf-format/" class="link blue hover-black">
            Tag: Protobuf Format
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240307/" class="link black dim">
        Prometheus Protobufs and Native Histograms
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I responded to a question <a href="https://stackoverflow.com/questions/78112323/prometheus-metric-protocol-buffer-in-grpc#comment137716337_78112323">Prometheus metric protocol buffer in gRPC</a> on Stackoverflow and it piqued my curiosity and got me yak shaving.</p>
<p>Prometheus used to support two exposition formats including Protocol Buffers, then dropped Protocol Buffer and has since re-added it (see <a href="https://github.com/prometheus/docs/blob/main/content/docs/instrumenting/exposition_formats.md#protobuf-format">Protobuf format</a>). The Protobuf format has returned to support the experimental <a href="https://prometheus.io/docs/prometheus/latest/feature_flags/#native-histograms">Native Histograms</a> feature.</p>
<p>I&rsquo;m interested in adding Native Histogram support to <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> so thought I&rsquo;d learn more about this metric.</p>
    </div>
    <a href="/posts/240307/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/koyeb/" class="link blue hover-black">
            Tag: Koyeb
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240130/" class="link black dim">
        Navigating Koyeb&#39;s API with Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I wrote about <a href="/posts/240105/">Navigating Koyeb&rsquo;s Golang SDK</a>. That client is generated using the <a href="https://openapi-generator.tech/">OpenAPI Generator</a> project using Koyeb&rsquo;s Swagger (now OpenAPI) REST API <a href="https://developer.koyeb.com/public.swagger.json">spec</a>.</p>
<p>This post shows how to generate a Rust SDK using the Generator and provides a very basic example of using the SDK.</p>
<p>The Generator will create a Rust library project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>VERS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;v7.2.0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PACKAGE_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;koyeb-api-client-rs&#34;</span>
</span></span><span style="display:flex;"><span>PACKAGE_VERS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0.0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>podman run <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--interactive --tty --rm <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/local <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>docker.io/openapitools/openapi-generator-cli:<span style="color:#e6db74">${</span>VERS<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>generate <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-g<span style="color:#f92672">=</span>rust <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-i<span style="color:#f92672">=</span>https://developer.koyeb.com/public.swagger.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-o<span style="color:#f92672">=</span>/local/<span style="color:#e6db74">${</span>PACKAGE_NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--additional-properties<span style="color:#f92672">=</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>packageName<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PACKAGE_NAME<span style="color:#e6db74">}</span>,<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>packageVersion<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PACKAGE_VERS<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>This will create the project in <code>${PWD}/${PACKAGE_NAME}</code> including the documentation at:</p>
    </div>
    <a href="/posts/240130/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240105/" class="link black dim">
        Navigating Koyeb&#39;s Golang SDK
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> deploys gRPC <a href="https://grpc.io/docs/guides/health-checking/">Health Checking</a> clients in locations around the World in order to health check services that are representative of customer need.</p>
<p><a href="https://koyeb.com">Koyeb</a> offers multiple locations and I spent time today writing a client for Ackal to integrate with Koyeb using the <a href="https://github.com/koyeb/koyeb-api-client-go">Golang client for the Koyeb API</a>.</p>
<p>The SDK is generated from Koyeb&rsquo;s OpenAPI (nee Swagger) <a href="https://developer.koyeb.com/public.swagger.json">endpoint</a> using <a href="https://github.com/OpenAPITools/openapi-generator-cli"><code>openapi-generator-cli</code></a>. This is a smart, programmatic solution to ensuring that the SDK always matches the API definition <strong>but</strong> I found the result is idiosyncratic and therefore a little gnarly.</p>
    </div>
    <a href="/posts/240105/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230709/" class="link black dim">
        Prometheus Exporter for Koyeb
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Yet another cloud platform exporter for resource|cost management. This time for <a href="https://www.koyeb.com/">Koyeb</a> with <a href="https://github.com/DazWilkin/koyeb-exporter">Koyeb Exporter</a>.</p>
<p>Deploying resources to cloud platforms generally incurs cost based on the number of resources deployed, the time each resource is deployed and the cost (per period of time) that the resource is deployed. It is useful to be able to automatically measure and alert on all the resources deployed on all the platforms that you&rsquo;re using and this is an intent of these exporters.</p>
    </div>
    <a href="/posts/230709/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/openapi/" class="link blue hover-black">
            Tag: Openapi
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240130/" class="link black dim">
        Navigating Koyeb&#39;s API with Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I wrote about <a href="/posts/240105/">Navigating Koyeb&rsquo;s Golang SDK</a>. That client is generated using the <a href="https://openapi-generator.tech/">OpenAPI Generator</a> project using Koyeb&rsquo;s Swagger (now OpenAPI) REST API <a href="https://developer.koyeb.com/public.swagger.json">spec</a>.</p>
<p>This post shows how to generate a Rust SDK using the Generator and provides a very basic example of using the SDK.</p>
<p>The Generator will create a Rust library project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>VERS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;v7.2.0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PACKAGE_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;koyeb-api-client-rs&#34;</span>
</span></span><span style="display:flex;"><span>PACKAGE_VERS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0.0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>podman run <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--interactive --tty --rm <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/local <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>docker.io/openapitools/openapi-generator-cli:<span style="color:#e6db74">${</span>VERS<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>generate <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-g<span style="color:#f92672">=</span>rust <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-i<span style="color:#f92672">=</span>https://developer.koyeb.com/public.swagger.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-o<span style="color:#f92672">=</span>/local/<span style="color:#e6db74">${</span>PACKAGE_NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--additional-properties<span style="color:#f92672">=</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>packageName<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PACKAGE_NAME<span style="color:#e6db74">}</span>,<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>packageVersion<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PACKAGE_VERS<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>This will create the project in <code>${PWD}/${PACKAGE_NAME}</code> including the documentation at:</p>
    </div>
    <a href="/posts/240130/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210608/" class="link black dim">
        Cloud Endpoints combine OpenAPI and gRPC... or not!
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>See:</p>
<ul>
<li><a href="/posts/210519/">Multiplexing gRPC and HTTP endpoints with Cloud Run</a></li>
<li><a href="/posts/200325/">gRPC, Cloud Run &amp; Endpoints</a></li>
<li><a href="https://github.com/GoogleCloudPlatform/esp-v2/issues/523">ESPv2: Configure Cloud Endpoints to proxy traffic to a Cloud Run multiplexed (gRPC|HTTP) service</a></li>
</ul>
<p>Challenges:</p>
<ul>
<li>Cloud Run permits single port</li>
<li>Cloud Run services publishing e.g. gRPC and Prometheus, must multiplex transports</li>
<li>Cloud Run services publishing multiplexed transports are <em>challenging</em> to expose using Cloud Endpoints</li>
</ul>
<h2 id="hypothesis-1-multiplexed-transports-work-with-cloud-run">Hypothesis #1: Multiplexed transports work with Cloud Run</h2>
<p>See: <a href="/posts/210519/">Multiplexing gRPC and HTTP endpoints with Cloud Run</a></p>
    </div>
    <a href="/posts/210608/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/swagger/" class="link blue hover-black">
            Tag: Swagger
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240130/" class="link black dim">
        Navigating Koyeb&#39;s API with Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I wrote about <a href="/posts/240105/">Navigating Koyeb&rsquo;s Golang SDK</a>. That client is generated using the <a href="https://openapi-generator.tech/">OpenAPI Generator</a> project using Koyeb&rsquo;s Swagger (now OpenAPI) REST API <a href="https://developer.koyeb.com/public.swagger.json">spec</a>.</p>
<p>This post shows how to generate a Rust SDK using the Generator and provides a very basic example of using the SDK.</p>
<p>The Generator will create a Rust library project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>VERS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;v7.2.0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PACKAGE_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;koyeb-api-client-rs&#34;</span>
</span></span><span style="display:flex;"><span>PACKAGE_VERS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0.0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>podman run <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--interactive --tty --rm <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/local <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>docker.io/openapitools/openapi-generator-cli:<span style="color:#e6db74">${</span>VERS<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>generate <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-g<span style="color:#f92672">=</span>rust <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-i<span style="color:#f92672">=</span>https://developer.koyeb.com/public.swagger.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-o<span style="color:#f92672">=</span>/local/<span style="color:#e6db74">${</span>PACKAGE_NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--additional-properties<span style="color:#f92672">=</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>packageName<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PACKAGE_NAME<span style="color:#e6db74">}</span>,<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>packageVersion<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PACKAGE_VERS<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>This will create the project in <code>${PWD}/${PACKAGE_NAME}</code> including the documentation at:</p>
    </div>
    <a href="/posts/240130/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200312/" class="link black dim">
        OriginStamp Rust SDK Example
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I wrote <a href="/posts/200217/">recently</a> describing Python and Golang clients for OriginStamp based on OriginStamp&rsquo;s API&rsquo;s swagger spec. As a way to pursue learning rust, I&rsquo;ve been forcing myself to write examples using rust. I&rsquo;m honestly finding learning rust tough going and think I&rsquo;m probably better to revert to the &ldquo;Learning Rust&rdquo; tutorials.</p>
<p>That said, herewith an explanation of building a rust client using an OpenAPI (!) generated SDK from OriginStamp&rsquo;s swagger spec.</p>
    </div>
    <a href="/posts/200312/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200217/" class="link black dim">
        OriginStamp Python|Golang SDK Examples
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A friend mentioned <a href="https://originstamp.org">OriginStamp</a> to me.</p>
<p><strong>NB</strong> There are 2 sites: <a href="https://originstamp.com">originstamp.com</a> and <a href="https://originstamp.org">originstamp.org</a>.</p>
<p>It&rsquo;s an interesting project.</p>
<p>It&rsquo;s a solution for providing auditable proof that you had a(ccess to) some digital thing before a certain date. OriginStamp provides user-|developer-friendly means to submit files|hashes (of your content) and have these bundled into transactions that are submitted to e.g. bitcoin.</p>
<p>I won&rsquo;t attempt to duplicate the narrative here, review OriginStamp&rsquo;s site and some of its content.</p>
    </div>
    <a href="/posts/200217/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/googleapis/" class="link blue hover-black">
            Tag: Googleapis
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240117/" class="link black dim">
        Gnarly Protocol Buffers compilation
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This Stackoverflow question piqued my interest:</p>
<p><a href="https://stackoverflow.com/questions/77829333/retry-policy-configuration-for-grpc-not-working">retry policy configuration for grpc not working</a></p>
<p><a href="https://github.com/grpc/grpc/blob/master/doc/service_config.md">Service Config in gRPC</a> is new to me but, my initial suspicion (albeit incorrect) was that the JSON types were incorrect.</p>
<p>I decided to try using the Protocol Buffer source <a href="https://github.com/grpc/grpc-proto/blob/master/grpc/service_config/service_config.proto"><code>service_config.proto</code></a> to verify the JSON.</p>
<p>To do so I needed to compile the source&hellip;. it was gnarly.</p>
<p>There are 2 repos used:</p>
<ul>
<li><a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a></li>
<li><a href="https://github.com/grpc/grpc-proto"><code>grpc-proto</code></a></li>
</ul>
<p>The <code>service_config.proto</code> includes <code>options</code> for <code>java_package</code> but no <code>go_package</code>.</p>
    </div>
    <a href="/posts/240117/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/231222/" class="link black dim">
        Listing Cloud Logging log-based metrics using gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Referring to <a href="/posts/230314/">Accessing Google Services using gRPC</a>, I wanted to query a project&rsquo;s <a href="https://cloud.google.com/logging">Cloud Logging</a> for <a href="https://cloud.google.com/logging/docs/logs-based-metrics">log-based metrics</a> using gRPC.</p>
<p>In summary:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;logging.googleapis.com:443&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ROOT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/googleapis&#34;</span> <span style="color:#75715e"># https://github.com/googleapis/googleapis</span>
</span></span><span style="display:flex;"><span>PACKAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;google/logging/v2&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># NB Not logging.proto</span>
</span></span><span style="display:flex;"><span>PROTO<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ROOT<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>PACKAGE<span style="color:#e6db74">}</span><span style="color:#e6db74">/logging_metrics.proto&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>gcloud auth print-access-token<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PACKAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;google.logging.v2&#34;</span>
</span></span><span style="display:flex;"><span>SERVICE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MetricsServiceV2&#34;</span>
</span></span><span style="display:flex;"><span>METHOD<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>PACKAGE<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">${</span>SERVICE<span style="color:#e6db74">}</span><span style="color:#e6db74">/ListLogMetrics&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ListLogMetricsRequest fields</span>
</span></span><span style="display:flex;"><span>PARENT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;projects/</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>grpcurl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--import-path<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>ROOT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--proto<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROTO<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-H <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-d <span style="color:#e6db74">&#34;{\&#34;parent\&#34;: \&#34;</span><span style="color:#e6db74">${</span>PARENT<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span> <span style="color:#e6db74">${</span>METHOD<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>From <a href="https://developers.google.com/apis-explorer">APIs Explorer</a>, <a href="https://cloud.google.com/logging/docs/reference/api-overview">Cloud Logging API v2</a>, instead of the <a href="https://cloud.google.com/logging/docs/reference/v2/rest">REST reference</a>, browse the <a href="https://cloud.google.com/logging/docs/reference/v2/rpc">gRPC reference</a> specifically the package <a href="https://cloud.google.com/logging/docs/reference/v2/rpc/google.logging.v2"><code>google.logging.v2</code></a> which includes <a href="https://cloud.google.com/logging/docs/reference/v2/rpc/google.logging.v2#google.logging.v2.MetricsServiceV2"><code>MetricsServiceV2</code></a>. We&rsquo;re interested in the <code>ListLogMetrics</code> method (which unfortunately isn&rsquo;t directly hyperlinkable) but is defined to be:</p>
    </div>
    <a href="/posts/231222/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230314/" class="link black dim">
        Access Google Services using gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google publishes interface definitions of Google APIs (services) that support REST and gRPC in a repo called <a href="https://github.com/googleapis/googleapis">Google APIs</a>. Google&rsquo;s SDKs uses gRPC to access these services but, how to do this using e.g. <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a>?</p>
<p>I wanted to debug <a href="https://cloud.google.com/profiler/docs">Cloud Profiler</a> and its agent makes <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L83"><code>UpdateProfile</code></a> RPCs to <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L41"><code>cloudprofiler.googleapis.com</code></a>. Cloud Profiler is more challenging service to debug because (a) it&rsquo;s publicly &ldquo;write-only&rdquo;; and (b) it has complex messages. <code>UpdateProfile</code> sends <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L123"><code>UpdateProfileRequest</code></a> messages that include <a href="https://github.com/googleapis/googleapis/blob/42ba7e6302f5e0f10ac2b9b17f5b6d568ecae02d/google/devtools/cloudprofiler/v2/profiler.proto#L123"><code>Profile</code></a> messages that include <code>profile_bytes</code> which are gzip compressed serialized protos of <a href="https://github.com/google/pprof">pprof</a>&rsquo;s <a href="https://github.com/google/pprof/blob/d61513b1440d93d62aad023cc60d7a33f3917b70/proto/profile.proto#L46"><code>Profile</code></a>.</p>
    </div>
    <a href="/posts/230314/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/grpc-proto/" class="link blue hover-black">
            Tag: Grpc-Proto
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240117/" class="link black dim">
        Gnarly Protocol Buffers compilation
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This Stackoverflow question piqued my interest:</p>
<p><a href="https://stackoverflow.com/questions/77829333/retry-policy-configuration-for-grpc-not-working">retry policy configuration for grpc not working</a></p>
<p><a href="https://github.com/grpc/grpc/blob/master/doc/service_config.md">Service Config in gRPC</a> is new to me but, my initial suspicion (albeit incorrect) was that the JSON types were incorrect.</p>
<p>I decided to try using the Protocol Buffer source <a href="https://github.com/grpc/grpc-proto/blob/master/grpc/service_config/service_config.proto"><code>service_config.proto</code></a> to verify the JSON.</p>
<p>To do so I needed to compile the source&hellip;. it was gnarly.</p>
<p>There are 2 repos used:</p>
<ul>
<li><a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a></li>
<li><a href="https://github.com/grpc/grpc-proto"><code>grpc-proto</code></a></li>
</ul>
<p>The <code>service_config.proto</code> includes <code>options</code> for <code>java_package</code> but no <code>go_package</code>.</p>
    </div>
    <a href="/posts/240117/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/google-managed-prometheus/" class="link blue hover-black">
            Tag: Google Managed Prometheus
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240104/" class="link black dim">
        Capturing e.g. CronJob metrics with GMP
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The deployment of <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus/exporters/kube_state_metrics">Kube State Metrics</a> for Google Managed Prometheus creates both a <code>PodMonitoring</code> and <code>ClusterPodMonitoring</code>.</p>
<p>The <code>PodMonitoring</code> resource exposes metrics published on <code>metric-self</code> port (8081).</p>
<p>The <code>ClusterPodMonitoring</code> exposes metrics published on <code>metric</code> port (8080) <strong>but</strong> this doesn&rsquo;t include <code>cronjob</code>-related metrics:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get clusterpodmonitoring/kube-state-metrics <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output<span style="color:#f92672">=</span>jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.spec.endpoints[0].metricRelabeling}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| jq -r .
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;action&#34;</span>: <span style="color:#e6db74">&#34;keep&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;regex&#34;</span>: <span style="color:#e6db74">&#34;kube_(daemonset|deployment|replicaset|pod|namespace|node|statefulset|persistentvolume|horizontalpodautoscaler|job_created)(_.+)?&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;sourceLabels&#34;</span>: [
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;__name__&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> The <code>regex</code> does <strong>not</strong> include <code>kube_cronjob</code> and only includes <code>kube_job_created</code> patterns.</p>
    </div>
    <a href="/posts/240104/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230427/" class="link black dim">
        Robusta KRR w/ GMP
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been spending time recently optimizing <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s use of Google <a href="https://cloud.google.com/logging">Cloud Logging</a> and <a href="https://cloud.google.com/monitoring">Cloud Monitoring</a> in posts:</p>
<ul>
<li><a href="/posts/230413/">Filtering metrics w/ Google Managed Prometheus</a></li>
<li><a href="/posts/230419/">Kubernetes metrics, metrics everywhere</a></li>
<li><a href="/posts/230425/">Google Metric Diagnostics and Metric Data Ingested</a></li>
</ul>
<p>Yesterday, I read that <a href="https://home.robusta.dev/">Robusta</a> has a new open source project <a href="https://github.com/robusta-dev/krr">Kubernetes Resource Recommendations (KRR)</a> so I took some time to evaluate it.</p>
<p>This post describes the changes I had to make to get KRR working with <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Google Managed Prometheus (GMP)</a>:</p>
    </div>
    <a href="/posts/230427/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230425/" class="link black dim">
        Google Metric Diagnostics and Metric Data Ingested
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been on an efficiency drive with <a href="https://cloud.google.com/logging">Cloud Logging</a> and <a href="https://cloud.google.com/monitoring">Cloud Monitoring</a>.</p>
<p>With regards Cloud Logging, I&rsquo;m contemplating (!) eliminating almost all log storage. As it is I&rsquo;ve buzz cut log storage with a <code>_Default</code> sink that has comprehensive sets of <code>NOT LOG_ID(X)</code> inclusion and exclusion filters. As I was doing so, I began to wonder why I need to pay for the storage of much logging. There&rsquo;s the comfort from knowing that everything you may ever need is being logged (at least for 30 days) but there&rsquo;s also the costs that that entails. I use logs exclusively for debugging which got me thinking, couldn&rsquo;t I just capture logs when I&rsquo;m debugging (rather thna all the time?). I&rsquo;ve not taken that leap yet but I&rsquo;m noodling on it.</p>
    </div>
    <a href="/posts/230425/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230419/" class="link black dim">
        Kubernetes metrics, metrics everywhere
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been tinkering with ways to &ldquo;unit-test&rdquo; my assumptions when using cloud platforms. I recently wrote about good posts by Google describing achieving cost savings with Cloud Monitoring and Cloud Logging:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/management-tools/learn-to-understand-and-reduce-cloud-monitoring-costs/">How to identify and reduce costs of your Google Cloud observability in Cloud Monitoring</a></li>
<li><a href="https://cloud.google.com/blog/topics/cost-management/how-to-approach-cloud-logging-pricing-for-cloud-admins">Cloud Logging pricing for Cloud Admins: How to approach it &amp; save cost</a></li>
</ul>
<p>With Cloud Monitoring, I&rsquo;ve restricted the <code>prometheus.googleapis.com</code> metrics that are being ingested but realized I wanted to track the number of Pods (and Containers) deployed to a GKE cluster.</p>
    </div>
    <a href="/posts/230419/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230413/" class="link black dim">
        Filtering metrics w/ Google Managed Prometheus
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google has published two, very good blog posts on cost management:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/management-tools/learn-to-understand-and-reduce-cloud-monitoring-costs/">How to identify and reduce costs of your Google Cloud observability in Cloud Monitoring</a></li>
<li><a href="https://cloud.google.com/blog/topics/cost-management/how-to-approach-cloud-logging-pricing-for-cloud-admins">Cloud Logging pricing for Cloud Admins: How to approach it &amp; save cost</a></li>
</ul>
<p>This post is about my application cost reductions for Cloud Monitoring for <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>.</p>
<p>I&rsquo;m pleased with <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Google Cloud Managed Service for Prometheus</a> (hereinafter GMP). I&rsquo;ve a strong preference for letting service providers run components of <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> that I consider important but non-differentiating.</p>
    </div>
    <a href="/posts/230413/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230104/" class="link black dim">
        Authenticate PromLens to Google Managed Prometheus
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Google Managed Service for Prometheus (GMP)</a> and liking it.</p>
<p>Sometime ago, I tried using <a href="https://promlens.com/">PromLens</a> with GMP but GMP&rsquo;s Prometheus HTTP API endpoint requires auth and I&rsquo;ve battled Prometheus&rsquo; somewhat limited auth mechanism before (<a href="/posts/211005/">Scraping metrics exposed by Google Cloud Run services that require authentication</a>).</p>
<p>Listening to <a href="https://promcon.io/2022-munich/schedule/">PromCon EU 2022</a> videos, I learned that PromLens has been <a href="https://promlabs.com/blog/2022/10/25/promlabs-and-chronosphere-open-source-the-promlens-query-builder">open sourced</a> and contributed to the Prometheus project. Eventually, the functionality of PromLens should be combined into the Prometheus UI.</p>
    </div>
    <a href="/posts/230104/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/kube-state-metrics/" class="link blue hover-black">
            Tag: Kube State Metrics
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240104/" class="link black dim">
        Capturing e.g. CronJob metrics with GMP
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The deployment of <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus/exporters/kube_state_metrics">Kube State Metrics</a> for Google Managed Prometheus creates both a <code>PodMonitoring</code> and <code>ClusterPodMonitoring</code>.</p>
<p>The <code>PodMonitoring</code> resource exposes metrics published on <code>metric-self</code> port (8081).</p>
<p>The <code>ClusterPodMonitoring</code> exposes metrics published on <code>metric</code> port (8080) <strong>but</strong> this doesn&rsquo;t include <code>cronjob</code>-related metrics:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get clusterpodmonitoring/kube-state-metrics <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output<span style="color:#f92672">=</span>jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.spec.endpoints[0].metricRelabeling}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| jq -r .
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;action&#34;</span>: <span style="color:#e6db74">&#34;keep&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;regex&#34;</span>: <span style="color:#e6db74">&#34;kube_(daemonset|deployment|replicaset|pod|namespace|node|statefulset|persistentvolume|horizontalpodautoscaler|job_created)(_.+)?&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;sourceLabels&#34;</span>: [
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;__name__&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> The <code>regex</code> does <strong>not</strong> include <code>kube_cronjob</code> and only includes <code>kube_job_created</code> patterns.</p>
    </div>
    <a href="/posts/240104/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210305/" class="link black dim">
        Prometheus VPA Recommendations
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Phew!</p>
<p><a href="https://en.wikipedia.org/wiki/For_Want_of_a_Nail">For Want of a Nail</a></p>
<p>I was interested in learning how to <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Manage Resources for Containers</a>. On the way, I learned and discovered:</p>
<ul>
<li><a href="#kubectl-top"><code>kubectl top</code></a></li>
<li><a href="#vertical-pod-autoscaler-vpa">Vertical Pod Autoscaler</a></li>
<li>A (valuable) digression through <a href="#digression-podmonitor">PodMonitor</a></li>
<li><a href="#kube-state-metrics"><code>kube-state-metrics</code></a></li>
<li><a href="#kubectl-patch">`kubectl-patch</a></li>
<li>Created a <a href="#graph">Graph</a></li>
<li><a href="#references">References</a></li>
</ul>
<h2 id="kubernetes-resources">Kubernetes Resources</h2>
<p>Visual Studio Code has begun to bug me (reasonably) to add <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/"><code>resources</code></a> to Kubernetes manifests.</p>
<p>E.g.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;512Mi&#34;</span>
</span></span></code></pre></div><p>I&rsquo;ve been spending time with Deislab&rsquo;s <a href="https://github.com/deislabs/akri">Akri</a> and decided to determine whether Akri&rsquo;s primary resources (Agent, Controller) and some of my creations HTTP Device and Discovery, were being suitably constrained.</p>
    </div>
    <a href="/posts/210305/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/prometheus-operator/" class="link blue hover-black">
            Tag: Prometheus Operator
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/240104/" class="link black dim">
        Capturing e.g. CronJob metrics with GMP
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The deployment of <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus/exporters/kube_state_metrics">Kube State Metrics</a> for Google Managed Prometheus creates both a <code>PodMonitoring</code> and <code>ClusterPodMonitoring</code>.</p>
<p>The <code>PodMonitoring</code> resource exposes metrics published on <code>metric-self</code> port (8081).</p>
<p>The <code>ClusterPodMonitoring</code> exposes metrics published on <code>metric</code> port (8080) <strong>but</strong> this doesn&rsquo;t include <code>cronjob</code>-related metrics:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get clusterpodmonitoring/kube-state-metrics <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output<span style="color:#f92672">=</span>jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.spec.endpoints[0].metricRelabeling}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| jq -r .
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;action&#34;</span>: <span style="color:#e6db74">&#34;keep&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;regex&#34;</span>: <span style="color:#e6db74">&#34;kube_(daemonset|deployment|replicaset|pod|namespace|node|statefulset|persistentvolume|horizontalpodautoscaler|job_created)(_.+)?&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;sourceLabels&#34;</span>: [
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;__name__&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> The <code>regex</code> does <strong>not</strong> include <code>kube_cronjob</code> and only includes <code>kube_job_created</code> patterns.</p>
    </div>
    <a href="/posts/240104/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/231018/" class="link black dim">
        Prometheus Operator support an auth proxy for Service Discovery
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>CRD <a href="https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/user-guides/linting.md">linting</a></p>
<p>Returning to yesterday&rsquo;s failing tests, it&rsquo;s unclear how to introspect the E2E tests.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get namespaces
</span></span></code></pre></div><pre tabindex="0"><code>NAME                      STATUS   AGE
...
allns-s2os2u-0-90f56669   Active   22h
allns-s2qhuw-0-6b33d5eb   Active   4m23s
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--namespace<span style="color:#f92672">=</span>allns-s2os2u-0-90f56669
</span></span></code></pre></div><pre tabindex="0"><code>No resources found in allns-s2os2u-0-90f56669 namespace.
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--namespace<span style="color:#f92672">=</span>allns-s2qhuw-0-6b33d5eb
</span></span></code></pre></div><pre tabindex="0"><code>NAME                                                        READY   STATUS             RESTARTS   AGE
pod/prometheus-operator-6c96477b9c-q6qm2                    1/1     Running            0          4m12s
pod/prometheus-operator-admission-webhook-68bc9f885-nq6r8   0/1     ImagePullBackOff   0          4m7s

NAME                          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
service/prometheus-operator   ClusterIP   10.152.183.247   &lt;none&gt;        443/TCP   4m9s

NAME                                                    READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/prometheus-operator                     1/1     1            1           4m12s
deployment.apps/prometheus-operator-admission-webhook   0/1     1            0           4m7s

NAME                                                              DESIRED   CURRENT   READY   AGE
replicaset.apps/prometheus-operator-6c96477b9c                    1         1         1       4m13s
replicaset.apps/prometheus-operator-admission-webhook-68bc9f885   1         1         0       4m8s
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl logs deployment/prometheus-operator-admission-webhook <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--namespace<span style="color:#f92672">=</span>allns-s2qhuw-0-6b33d5eb
</span></span></code></pre></div><pre tabindex="0"><code>Error from server (BadRequest): container &#34;prometheus-operator-admission-webhook&#34; in pod &#34;prometheus-operator-admission-webhook-68bc9f885-nq6r8&#34; is waiting to start: trying and failing to pull image
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;prometheus-operator-admission-webhook&#34;</span>
</span></span><span style="display:flex;"><span>FILTER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.spec.template.spec.containers[?(@.name==\&#34;</span><span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;)].image}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl get deployment/prometheus-operator-admission-webhook <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--namespace<span style="color:#f92672">=</span>allns-s2qjz2-0-fad82c03 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output<span style="color:#f92672">=</span>jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>FILTER<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><pre tabindex="0"><code>quay.io/prometheus-operator/admission-webhook:52d1e55af
</code></pre><p>Want:</p>
    </div>
    <a href="/posts/231018/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/231017/" class="link black dim">
        Prometheus Operator support an auth proxy for Service Discovery
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For <code>ackalctld</code> to be deployable to Kubernetes with <a href="github.com/prometheus-operator/prometheus-operator">Prometheus Operator</a>, it is necessary to <a href="https://github.com/prometheus-operator/prometheus-operator/issues/5966">Enable <code>ScrapeConfig</code> to use (discovery|target) proxies #5966</a>. While I&rsquo;m familiar with Kubernetes, Kubernetes operators (<a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> uses one built with the <a href="">Operator SDK</a>) and <a href="https://sdk.operatorframework.io/">Prometheus Operator</a>, I&rsquo;m unfamiliar with developing Prometheus Operator. This (and subsequent) posts will document some preliminary work on this.</p>
<p>Cloned <a href="github.com/prometheus-operator/prometheus-operator">Prometheus Operator</a></p>
<p>Branched <code>scrape-config-url-proxy</code></p>
<p>I&rsquo;m unsure how to effect these changes and unsure whether documentation exists.</p>
<p>Clearly, I will need to revise the <code>ScrapeConfig</code> CRD to add the <code>proxy_url</code> fields (one <code>proxy_url</code> defines a proxy for the Service Discovery endpoint; the second defines a proxy for the targets themselves) and it would be useful for this to closely mirror the existing <a href="https://prometheus.io/docs/prometheus/latest/http_sd/">Prometheus HTTP Service Discovery</a> use, namely <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#http_sd_config"><code>,http_sd_config&gt;</code></a>:</p>
    </div>
    <a href="/posts/231017/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/231013/" class="link black dim">
        Prometheus Operator `ScrapeConfig`
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>TL;DR <a href="https://github.com/prometheus-operator/prometheus-operator/issues/5966#issuecomment-1754317247">Enable <code>ScrapeConfig</code> to use (discovery|target) proxies</a></p>
<p>I&rsquo;ve developed a companion, local daemon (called <code>ackalctld</code>) for <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> that provides a functionally close version of the service.</p>
<p>One way to deploy <code>ackalctld</code> is to use Kubernetes and it would be convenient if the Prometheus metrics were scrapeable by <a href="https://github.com/prometheus-operator/prometheus-operator">Prometheus Operator</a>.</p>
<p>In order for this to work, Prometheus Operator needs to be able to scrape Google <a href="https://cloud.google.com/run">Cloud Run</a> targets because <code>ackalctld</code> creates Cloud Run services for its health check clients.</p>
    </div>
    <a href="/posts/231013/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cloud-logging/" class="link blue hover-black">
            Tag: Cloud-Logging
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/231222/" class="link black dim">
        Listing Cloud Logging log-based metrics using gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Referring to <a href="/posts/230314/">Accessing Google Services using gRPC</a>, I wanted to query a project&rsquo;s <a href="https://cloud.google.com/logging">Cloud Logging</a> for <a href="https://cloud.google.com/logging/docs/logs-based-metrics">log-based metrics</a> using gRPC.</p>
<p>In summary:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;logging.googleapis.com:443&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ROOT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/googleapis&#34;</span> <span style="color:#75715e"># https://github.com/googleapis/googleapis</span>
</span></span><span style="display:flex;"><span>PACKAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;google/logging/v2&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># NB Not logging.proto</span>
</span></span><span style="display:flex;"><span>PROTO<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ROOT<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>PACKAGE<span style="color:#e6db74">}</span><span style="color:#e6db74">/logging_metrics.proto&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>gcloud auth print-access-token<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PACKAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;google.logging.v2&#34;</span>
</span></span><span style="display:flex;"><span>SERVICE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MetricsServiceV2&#34;</span>
</span></span><span style="display:flex;"><span>METHOD<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>PACKAGE<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">${</span>SERVICE<span style="color:#e6db74">}</span><span style="color:#e6db74">/ListLogMetrics&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ListLogMetricsRequest fields</span>
</span></span><span style="display:flex;"><span>PARENT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;projects/</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>grpcurl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--import-path<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>ROOT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--proto<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROTO<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-H <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-d <span style="color:#e6db74">&#34;{\&#34;parent\&#34;: \&#34;</span><span style="color:#e6db74">${</span>PARENT<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span> <span style="color:#e6db74">${</span>METHOD<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>From <a href="https://developers.google.com/apis-explorer">APIs Explorer</a>, <a href="https://cloud.google.com/logging/docs/reference/api-overview">Cloud Logging API v2</a>, instead of the <a href="https://cloud.google.com/logging/docs/reference/v2/rest">REST reference</a>, browse the <a href="https://cloud.google.com/logging/docs/reference/v2/rpc">gRPC reference</a> specifically the package <a href="https://cloud.google.com/logging/docs/reference/v2/rpc/google.logging.v2"><code>google.logging.v2</code></a> which includes <a href="https://cloud.google.com/logging/docs/reference/v2/rpc/google.logging.v2#google.logging.v2.MetricsServiceV2"><code>MetricsServiceV2</code></a>. We&rsquo;re interested in the <code>ListLogMetrics</code> method (which unfortunately isn&rsquo;t directly hyperlinkable) but is defined to be:</p>
    </div>
    <a href="/posts/231222/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211018/" class="link black dim">
        Golang Structured Logging w/ Google Cloud Logging (2)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>UPDATE</strong> There&rsquo;s an issue with my naive implementation of <code>RenderValuesHook</code> as described in this post. I summarized the problem in this <a href="https://github.com/go-logr/logr/issues/120">issue</a> where I&rsquo;ve outlined (hopefully) a more robust solution.</p></blockquote>
<p>Recently, I <a href="/posts/210928/">described</a> how to configure Golang logging so that user-defined key-values applied to the logs are parsed when ingested by <a href="https://cloud.google.com/logging">Google Cloud Logging</a>.</p>
<p>Here&rsquo;s an example of what we&rsquo;re trying to achieve. This is an example Cloud Logging log entry that incorporates user-defined labels (see <code>dog:freddie</code> and <code>foo:bar</code>) and a readily-querable <code>jsonPayload</code>:</p>
    </div>
    <a href="/posts/211018/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210928/" class="link black dim">
        Golang Structured Logging w/ Google Cloud Logging
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve multiple components in an app and these are deployed across multiple Google Cloud Platform (GCP) services: Kubernetes Engine, Cloud Functions, Cloud Run, etc. Almost everything is written in Golang and I started the project using <a href="https://github.com/go-logr/logr"><code>go-logr</code></a>.</p>
<p><code>logr</code> is in two parts: a <code>Logger</code> that you use to write log entries; a <code>LogSink</code> (adaptor) that consumes log entries and outputs them to a specific log implementation.</p>
<p>Initially, I defaulted to using <code>stdr</code> which is a <code>LogSink</code> for Go&rsquo;s standard logging implementation. Something similar to the module&rsquo;s <a href="https://github.com/go-logr/stdr/blob/master/example/main.go">example</a>:</p>
    </div>
    <a href="/posts/210928/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/scrape-config-url-proxy/" class="link blue hover-black">
            Tag: Scrape-Config-Url-Proxy
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/231018/" class="link black dim">
        Prometheus Operator support an auth proxy for Service Discovery
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>CRD <a href="https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/user-guides/linting.md">linting</a></p>
<p>Returning to yesterday&rsquo;s failing tests, it&rsquo;s unclear how to introspect the E2E tests.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get namespaces
</span></span></code></pre></div><pre tabindex="0"><code>NAME                      STATUS   AGE
...
allns-s2os2u-0-90f56669   Active   22h
allns-s2qhuw-0-6b33d5eb   Active   4m23s
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--namespace<span style="color:#f92672">=</span>allns-s2os2u-0-90f56669
</span></span></code></pre></div><pre tabindex="0"><code>No resources found in allns-s2os2u-0-90f56669 namespace.
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--namespace<span style="color:#f92672">=</span>allns-s2qhuw-0-6b33d5eb
</span></span></code></pre></div><pre tabindex="0"><code>NAME                                                        READY   STATUS             RESTARTS   AGE
pod/prometheus-operator-6c96477b9c-q6qm2                    1/1     Running            0          4m12s
pod/prometheus-operator-admission-webhook-68bc9f885-nq6r8   0/1     ImagePullBackOff   0          4m7s

NAME                          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
service/prometheus-operator   ClusterIP   10.152.183.247   &lt;none&gt;        443/TCP   4m9s

NAME                                                    READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/prometheus-operator                     1/1     1            1           4m12s
deployment.apps/prometheus-operator-admission-webhook   0/1     1            0           4m7s

NAME                                                              DESIRED   CURRENT   READY   AGE
replicaset.apps/prometheus-operator-6c96477b9c                    1         1         1       4m13s
replicaset.apps/prometheus-operator-admission-webhook-68bc9f885   1         1         0       4m8s
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl logs deployment/prometheus-operator-admission-webhook <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--namespace<span style="color:#f92672">=</span>allns-s2qhuw-0-6b33d5eb
</span></span></code></pre></div><pre tabindex="0"><code>Error from server (BadRequest): container &#34;prometheus-operator-admission-webhook&#34; in pod &#34;prometheus-operator-admission-webhook-68bc9f885-nq6r8&#34; is waiting to start: trying and failing to pull image
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;prometheus-operator-admission-webhook&#34;</span>
</span></span><span style="display:flex;"><span>FILTER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.spec.template.spec.containers[?(@.name==\&#34;</span><span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;)].image}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl get deployment/prometheus-operator-admission-webhook <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--namespace<span style="color:#f92672">=</span>allns-s2qjz2-0-fad82c03 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output<span style="color:#f92672">=</span>jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>FILTER<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><pre tabindex="0"><code>quay.io/prometheus-operator/admission-webhook:52d1e55af
</code></pre><p>Want:</p>
    </div>
    <a href="/posts/231018/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/231017/" class="link black dim">
        Prometheus Operator support an auth proxy for Service Discovery
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For <code>ackalctld</code> to be deployable to Kubernetes with <a href="github.com/prometheus-operator/prometheus-operator">Prometheus Operator</a>, it is necessary to <a href="https://github.com/prometheus-operator/prometheus-operator/issues/5966">Enable <code>ScrapeConfig</code> to use (discovery|target) proxies #5966</a>. While I&rsquo;m familiar with Kubernetes, Kubernetes operators (<a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> uses one built with the <a href="">Operator SDK</a>) and <a href="https://sdk.operatorframework.io/">Prometheus Operator</a>, I&rsquo;m unfamiliar with developing Prometheus Operator. This (and subsequent) posts will document some preliminary work on this.</p>
<p>Cloned <a href="github.com/prometheus-operator/prometheus-operator">Prometheus Operator</a></p>
<p>Branched <code>scrape-config-url-proxy</code></p>
<p>I&rsquo;m unsure how to effect these changes and unsure whether documentation exists.</p>
<p>Clearly, I will need to revise the <code>ScrapeConfig</code> CRD to add the <code>proxy_url</code> fields (one <code>proxy_url</code> defines a proxy for the Service Discovery endpoint; the second defines a proxy for the targets themselves) and it would be useful for this to closely mirror the existing <a href="https://prometheus.io/docs/prometheus/latest/http_sd/">Prometheus HTTP Service Discovery</a> use, namely <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#http_sd_config"><code>,http_sd_config&gt;</code></a>:</p>
    </div>
    <a href="/posts/231017/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/goatcounter/" class="link blue hover-black">
            Tag: Goatcounter
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230622/" class="link black dim">
        GoatCounter with Hugo with Ananke
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Thanks to <a href="https://discourse.gohugo.io/u/jmooring/summary">Joe Mooring</a> for his <a href="https://discourse.gohugo.io/t/goatcounter-with-gohugo-theme-ananke/44938/2">solution</a> to my <a href="https://discourse.gohugo.io/t/goatcounter-with-gohugo-theme-ananke/44938/">question</a> as to how to do this.</p>
<p>I&rsquo;ve decided to ditch <a href="https://analytics.google.com/analytics/web/">Google Analytics</a> and am evaluating using <a href="https://goatcounter.com">GoatCounter</a> with <a href="https://hugo.io">Hugo</a> with <a href="https://github.com/theNewDynamic/gohugo-theme-ananke">Ananke</a> theme.</p>
<p>This was the layout of the site:</p>
<pre tabindex="0"><code>.
├── archetypes
├── content
│   └── posts
├── go.mod
├── go.sum
├── hugo.toml
├── layouts
├── public
└── static
</code></pre><p>This is the structure (of <code>layouts</code>) with the necessary changes:</p>
<pre tabindex="0"><code>.
├── archetypes
├── content
│   └── posts
├── go.mod
├── go.sum
├── hugo.toml
├── layouts
│   ├── _default
│   │   └── baseof.html
│   └── partials
│       └── analytics.html
├── public
└── static
</code></pre><p>I copied <a href="https://github.com/theNewDynamic/gohugo-theme-ananke/blob/master/layouts/_default/baseof.html"><code>/layouts/_default/baseof.html</code></a> from the <a href="https://github.com/theNewDynamic/gohugo-theme-ananke"><code>gohugo-ananke-theme</code></a> repo into my site&rsquo;s|repo&rsquo;s <code>/layouts/_default/baseof.html</code>.</p>
    </div>
    <a href="/posts/230622/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/hugo/" class="link blue hover-black">
            Tag: Hugo
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230622/" class="link black dim">
        GoatCounter with Hugo with Ananke
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Thanks to <a href="https://discourse.gohugo.io/u/jmooring/summary">Joe Mooring</a> for his <a href="https://discourse.gohugo.io/t/goatcounter-with-gohugo-theme-ananke/44938/2">solution</a> to my <a href="https://discourse.gohugo.io/t/goatcounter-with-gohugo-theme-ananke/44938/">question</a> as to how to do this.</p>
<p>I&rsquo;ve decided to ditch <a href="https://analytics.google.com/analytics/web/">Google Analytics</a> and am evaluating using <a href="https://goatcounter.com">GoatCounter</a> with <a href="https://hugo.io">Hugo</a> with <a href="https://github.com/theNewDynamic/gohugo-theme-ananke">Ananke</a> theme.</p>
<p>This was the layout of the site:</p>
<pre tabindex="0"><code>.
├── archetypes
├── content
│   └── posts
├── go.mod
├── go.sum
├── hugo.toml
├── layouts
├── public
└── static
</code></pre><p>This is the structure (of <code>layouts</code>) with the necessary changes:</p>
<pre tabindex="0"><code>.
├── archetypes
├── content
│   └── posts
├── go.mod
├── go.sum
├── hugo.toml
├── layouts
│   ├── _default
│   │   └── baseof.html
│   └── partials
│       └── analytics.html
├── public
└── static
</code></pre><p>I copied <a href="https://github.com/theNewDynamic/gohugo-theme-ananke/blob/master/layouts/_default/baseof.html"><code>/layouts/_default/baseof.html</code></a> from the <a href="https://github.com/theNewDynamic/gohugo-theme-ananke"><code>gohugo-ananke-theme</code></a> repo into my site&rsquo;s|repo&rsquo;s <code>/layouts/_default/baseof.html</code>.</p>
    </div>
    <a href="/posts/230622/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230502/" class="link black dim">
        Deploying Hugo site to DigitalOcean Apps
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been running a <a href="https://www.digitalocean.com/go/app-platform?">DigitalOcean Apps</a> static site for Hugo using the <a href="https://docs.digitalocean.com/products/app-platform/reference/buildpacks/hugo/">Hugo Buildpack</a>.</p>
<p>I&rsquo;ve migrated a set of Hugo sites to use <a href="https://gohugo.io/hugo-modules/">Hugo Modules</a> which includes the addition of <code>go.mod</code> (and <code>go.sum</code>) files to the Hugo project in order to manage e.g. themes.</p>
<p>Unfortunately, the Hugo Buildpack used by DigitalOcean Apps does not support Hugo Modules. DigitalOcean support recommended that I switch to use a <a href="https://docs.digitalocean.com/products/app-platform/reference/dockerfile/">build with a Dockerfile</a>. Unfortunately (!) the recommended Hugo container image (<a href="https://hub.docker.com/r/klakegg/hugo"><code>klakegg/hugo</code></a>) is outdated (0.107.0). The current version is <a href="https://github.com/gohugoio/hugo/releases/tag/v0.111.3"><code>0.111.3</code></a>.</p>
    </div>
    <a href="/posts/230502/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200930/" class="link black dim">
        Hugo and Google Cloud Storage
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using <a href="https://gohugo.io">Hugo</a> as a static site generator for <a href="https://pretired.dazwilkin.com">this</a> blog. I&rsquo;m using <a href="https://firebase.google.com">Firebase</a> (for free) to host <a href="https://lefsilver.com">lefsilver</a>.</p>
<p>I have other domains that I want to promote and decided to use Google Cloud Storage buckets for these sites. Using <a href="https://cloud.google.com/storage">Google Cloud Storage</a> for <a href="https://cloud.google.com/storage/docs/hosting-static-website">Hosting a static website</a> and using Hugo to deploy sites to <a href="https://gohugo.io/hosting-and-deployment/hugo-deploy/#google-cloud-storage-gcs">Google Cloud Storage (GCS)</a> are documented but, I didn&rsquo;t find a location where this is combined into a single tutorial and I wanted to add an explanation for ensuring your sites are included in Google&rsquo;s and Bing&rsquo;s search indexes.</p>
    </div>
    <a href="/posts/200930/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/gke/" class="link blue hover-black">
            Tag: GKE
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230530/" class="link black dim">
        Routing Firestore events to GKE with Eventarc
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google announced <a href="https://cloud.google.com/blog/products/databases/firestore-triggers-for-cloud-run-and-google-kubernetes-engine/">Firestore &hellip; integration with Eventarc</a>. <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> uses <a href="https://cloud.google.com/firestore">Firestore</a> to persist Customer and Check information and it uses <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore-1st-gen">Google Cloud Firestore Triggers</a> to handle events on these document types.</p>
<p><a href="https://cloud.google.com/eventarc">Eventarc</a> feels like the strategic future of eventing in Google Cloud and I&rsquo;ve been concerned since adopting the technology that Google would abandon Google Cloud Firestore Triggers.</p>
<p>For this reason, when I saw last week&rsquo;s announcement, I thought I should evaluate the mechanism and this blog post is a summary of that work.</p>
    </div>
    <a href="/posts/230530/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190924/" class="link black dim">
        Kubernetes Engine and Free Tier
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google Cloud Platform <a href="https://cloud.google.com/free/">Free Tier</a> appears (<span style="color:red">please verify this for yourself</span>) to provide the ability to run a(n admittedly miniscule) Kubernetes cluster for free. So, why do this? It provides a definitive Kubernetes (Engine) experience on Google Cloud Platform that you may use for learning and testing.</p>
<p>Kubernetes Engine the master node(s) and the control plane are <a href="https://cloud.google.com/kubernetes-engine/pricing">free</a>.</p>
<p>Kubernetes (i.e. Compute Engine) nodes potentially incur charges including for the VM runtime and any attached storage, snapshots etc. However, charges for these resources can be partially covered by the Free Tier.</p>
    </div>
    <a href="/posts/190924/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/apps/" class="link blue hover-black">
            Tag: Apps
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230502/" class="link black dim">
        Deploying Hugo site to DigitalOcean Apps
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been running a <a href="https://www.digitalocean.com/go/app-platform?">DigitalOcean Apps</a> static site for Hugo using the <a href="https://docs.digitalocean.com/products/app-platform/reference/buildpacks/hugo/">Hugo Buildpack</a>.</p>
<p>I&rsquo;ve migrated a set of Hugo sites to use <a href="https://gohugo.io/hugo-modules/">Hugo Modules</a> which includes the addition of <code>go.mod</code> (and <code>go.sum</code>) files to the Hugo project in order to manage e.g. themes.</p>
<p>Unfortunately, the Hugo Buildpack used by DigitalOcean Apps does not support Hugo Modules. DigitalOcean support recommended that I switch to use a <a href="https://docs.digitalocean.com/products/app-platform/reference/dockerfile/">build with a Dockerfile</a>. Unfortunately (!) the recommended Hugo container image (<a href="https://hub.docker.com/r/klakegg/hugo"><code>klakegg/hugo</code></a>) is outdated (0.107.0). The current version is <a href="https://github.com/gohugoio/hugo/releases/tag/v0.111.3"><code>0.111.3</code></a>.</p>
    </div>
    <a href="/posts/230502/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/digitalocean/" class="link blue hover-black">
            Tag: Digitalocean
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230502/" class="link black dim">
        Deploying Hugo site to DigitalOcean Apps
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been running a <a href="https://www.digitalocean.com/go/app-platform?">DigitalOcean Apps</a> static site for Hugo using the <a href="https://docs.digitalocean.com/products/app-platform/reference/buildpacks/hugo/">Hugo Buildpack</a>.</p>
<p>I&rsquo;ve migrated a set of Hugo sites to use <a href="https://gohugo.io/hugo-modules/">Hugo Modules</a> which includes the addition of <code>go.mod</code> (and <code>go.sum</code>) files to the Hugo project in order to manage e.g. themes.</p>
<p>Unfortunately, the Hugo Buildpack used by DigitalOcean Apps does not support Hugo Modules. DigitalOcean support recommended that I switch to use a <a href="https://docs.digitalocean.com/products/app-platform/reference/dockerfile/">build with a Dockerfile</a>. Unfortunately (!) the recommended Hugo container image (<a href="https://hub.docker.com/r/klakegg/hugo"><code>klakegg/hugo</code></a>) is outdated (0.107.0). The current version is <a href="https://github.com/gohugoio/hugo/releases/tag/v0.111.3"><code>0.111.3</code></a>.</p>
    </div>
    <a href="/posts/230502/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220520/" class="link black dim">
        Prometheus Exporters for fly.io and Vultr
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been on a roll building utilities this week. I developed a Service Health dashboard for my &ldquo;thing&rdquo;, a <a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a> and today, a <a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a>. This is motivated by the fear that I will forget a deployed Cloud resource and incur a horrible bill.</p>
<p>I&rsquo;ve no written several Prometheus Exporters for cloud platforms:</p>
<ul>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for GCP</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>Each of them monitors resource deployments and produces resource count metrics that can be scraped by Prometheus and alerted with Alertmanager. I have Alertmanager <a href="https://prometheus.io/docs/alerting/latest/configuration/#pushover_config">configured</a> to send notifications to <a href="https://pushover.net">Pushover</a>. Last week I wrote an integration between <a href="/posts/220514/">Google Cloud Monitoring to send notifications to Pushover</a> too.</p>
    </div>
    <a href="/posts/220520/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210122/" class="link black dim">
        Krustlet on DO Managed Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve spent time this week returning to the interesting Deislabs project <a href="https://github.com/deislabs/krustlet">Krustlet</a>. Since the last time, the bootstrapping process has been simplified using Kubernetes <a href="https://kubernetes.io/docs/reference/access-authn-authz/bootstrap-tokens/">Bootstrap Tokens</a>. I know this updated process <a href="https://github.com/deislabs/krustlet/blob/master/docs/howto/krustlet-on-microk8s.md">works</a> with <a href="https://microk8s.io">MicroK8s</a>. Unfortunately, I&rsquo;m struggling with it on <a href="cloud.google.com/kubernetes-engine">GKE</a> and thought I&rsquo;d try DigitalOcean Managed Kubernetes.</p>
<p>It worked first time!</p>
<p>In the following, we run both the Kubernetes cluster and the Krustlet Droplet on DigitalOcean but, as long as the cluster and the VM are able to communicate with one another, you should be able to run these anywhere.</p>
    </div>
    <a href="/posts/210122/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201008/" class="link black dim">
        Deploying a Rust HTTP server to DigitalOcean App Platform
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://digitalocean.com">DigitalOcean</a> launched an <a href="https://www.digitalocean.com/blog/introducing-digitalocean-app-platform-reimagining-paas-to-make-it-simpler-for-you-to-build-deploy-and-scale-apps">App Platform</a> with many <a href="https://www.digitalocean.com/docs/app-platform/languages-frameworks/">Supported Languages and Frameworks</a>. I used <a href="https://www.digitalocean.com/docs/app-platform/languages-frameworks/go/">Golang</a> first, then wondered how to use non-natively-supported languages, i.e. Rust.</p>
<p>The good news is that <a href="https://www.digitalocean.com/docs/app-platform/languages-frameworks/docker/">Docker</a> is a supported framework and so, you can run pretty much anything.</p>
<p>Repo: <a href="https://github.com/DazWilkin/do-apps-rust">https://github.com/DazWilkin/do-apps-rust</a></p>
<h2 id="rust">Rust</h2>
<p>I&rsquo;m a Rust noob. I&rsquo;m always receptive to feedback on improvements to the code. I looked to mirror the Golang example. I&rsquo;m using <a href="https://crates.io/crates/rocket">rocket</a> and <a href="https://crates.io/crates/rocket-prometheus">rocket-prometheus</a> for the first time:</p>
<p>You will want to install rust nightly (as Rocket has a dependency that requires it) and then you can override the default toolchain for the current project using:</p>
    </div>
    <a href="/posts/201008/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cloud-monitoring/" class="link blue hover-black">
            Tag: Cloud-Monitoring
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230427/" class="link black dim">
        Robusta KRR w/ GMP
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been spending time recently optimizing <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s use of Google <a href="https://cloud.google.com/logging">Cloud Logging</a> and <a href="https://cloud.google.com/monitoring">Cloud Monitoring</a> in posts:</p>
<ul>
<li><a href="/posts/230413/">Filtering metrics w/ Google Managed Prometheus</a></li>
<li><a href="/posts/230419/">Kubernetes metrics, metrics everywhere</a></li>
<li><a href="/posts/230425/">Google Metric Diagnostics and Metric Data Ingested</a></li>
</ul>
<p>Yesterday, I read that <a href="https://home.robusta.dev/">Robusta</a> has a new open source project <a href="https://github.com/robusta-dev/krr">Kubernetes Resource Recommendations (KRR)</a> so I took some time to evaluate it.</p>
<p>This post describes the changes I had to make to get KRR working with <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Google Managed Prometheus (GMP)</a>:</p>
    </div>
    <a href="/posts/230427/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230425/" class="link black dim">
        Google Metric Diagnostics and Metric Data Ingested
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been on an efficiency drive with <a href="https://cloud.google.com/logging">Cloud Logging</a> and <a href="https://cloud.google.com/monitoring">Cloud Monitoring</a>.</p>
<p>With regards Cloud Logging, I&rsquo;m contemplating (!) eliminating almost all log storage. As it is I&rsquo;ve buzz cut log storage with a <code>_Default</code> sink that has comprehensive sets of <code>NOT LOG_ID(X)</code> inclusion and exclusion filters. As I was doing so, I began to wonder why I need to pay for the storage of much logging. There&rsquo;s the comfort from knowing that everything you may ever need is being logged (at least for 30 days) but there&rsquo;s also the costs that that entails. I use logs exclusively for debugging which got me thinking, couldn&rsquo;t I just capture logs when I&rsquo;m debugging (rather thna all the time?). I&rsquo;ve not taken that leap yet but I&rsquo;m noodling on it.</p>
    </div>
    <a href="/posts/230425/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220514/" class="link black dim">
        Using Google Monitoring Alerting to send Pushover notifications
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#artifacts">Artifacts</a></li>
<li><a href="#pushover">Pushover</a></li>
<li><a href="#caveat"><strong>Caveat</strong></a></li>
<li><a href="#cloud-monitoring-webhook">Cloud Monitoring Webhook</a></li>
<li><a href="#cloud-functions-2nd-gen">Cloud Functions</a></li>
<li><a href="#cloud-run">Cloud Run</a></li>
</ul>
<h2 id="artifacts">Artifacts</h2>
<ul>
<li>GitHub: <a href="https://github.com/DazWilkin/go-gcp-pushover-notificationchannel"><code>go-gcp-pushover-notificationchannel</code></a></li>
<li>Image: <code>ghcr.io/dazwilkin/go-gcp-pushover-notificationchannel:220515</code></li>
</ul>
<h2 id="pushover">Pushover</h2>
<p>Logging in to your <a href="https://pushover.net">Pushover</a> account, you will be presented with a summary|dashboard page that includes <code>Your User Key</code>. Copy the value of this key into a variable called <code>PUSHOVER_USER</code></p>
<p><a href="https://pushover.net/apps/build">Create New Application|API Token</a></p>
<p><img src="/images/220514.pushover.app.png" alt="Pushover: New API Token"></p>
<p>Pushover <a href="https://pushover.net/api">API</a> has a <a href="https://pushover.net/api#messages">Pushing Messages</a> method. The documentation describes the format of the HTTP Request. It must be a <code>POST</code> using TLS (<code>https://</code>) to <code>https://api.pushover.net/1/messages.json</code>. The <code>content-type</code> should be <code>application/json</code>. In the JSON body of the message, we must include <code>token</code> (<code>PUSHOVER_TOKEN</code>), <code>user</code> (<code>PUSHOVER_USER_KEY</code>), <code>device</code> (we&rsquo;ll use <code>cloud-monitoring</code>) and a <code>title</code> and a <code>message</code></p>
    </div>
    <a href="/posts/220514/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/robusta/" class="link blue hover-black">
            Tag: Robusta
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230427/" class="link black dim">
        Robusta KRR w/ GMP
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been spending time recently optimizing <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s use of Google <a href="https://cloud.google.com/logging">Cloud Logging</a> and <a href="https://cloud.google.com/monitoring">Cloud Monitoring</a> in posts:</p>
<ul>
<li><a href="/posts/230413/">Filtering metrics w/ Google Managed Prometheus</a></li>
<li><a href="/posts/230419/">Kubernetes metrics, metrics everywhere</a></li>
<li><a href="/posts/230425/">Google Metric Diagnostics and Metric Data Ingested</a></li>
</ul>
<p>Yesterday, I read that <a href="https://home.robusta.dev/">Robusta</a> has a new open source project <a href="https://github.com/robusta-dev/krr">Kubernetes Resource Recommendations (KRR)</a> so I took some time to evaluate it.</p>
<p>This post describes the changes I had to make to get KRR working with <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Google Managed Prometheus (GMP)</a>:</p>
    </div>
    <a href="/posts/230427/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/metrics/" class="link blue hover-black">
            Tag: Metrics
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230425/" class="link black dim">
        Google Metric Diagnostics and Metric Data Ingested
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been on an efficiency drive with <a href="https://cloud.google.com/logging">Cloud Logging</a> and <a href="https://cloud.google.com/monitoring">Cloud Monitoring</a>.</p>
<p>With regards Cloud Logging, I&rsquo;m contemplating (!) eliminating almost all log storage. As it is I&rsquo;ve buzz cut log storage with a <code>_Default</code> sink that has comprehensive sets of <code>NOT LOG_ID(X)</code> inclusion and exclusion filters. As I was doing so, I began to wonder why I need to pay for the storage of much logging. There&rsquo;s the comfort from knowing that everything you may ever need is being logged (at least for 30 days) but there&rsquo;s also the costs that that entails. I use logs exclusively for debugging which got me thinking, couldn&rsquo;t I just capture logs when I&rsquo;m debugging (rather thna all the time?). I&rsquo;ve not taken that leap yet but I&rsquo;m noodling on it.</p>
    </div>
    <a href="/posts/230425/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230419/" class="link black dim">
        Kubernetes metrics, metrics everywhere
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been tinkering with ways to &ldquo;unit-test&rdquo; my assumptions when using cloud platforms. I recently wrote about good posts by Google describing achieving cost savings with Cloud Monitoring and Cloud Logging:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/management-tools/learn-to-understand-and-reduce-cloud-monitoring-costs/">How to identify and reduce costs of your Google Cloud observability in Cloud Monitoring</a></li>
<li><a href="https://cloud.google.com/blog/topics/cost-management/how-to-approach-cloud-logging-pricing-for-cloud-admins">Cloud Logging pricing for Cloud Admins: How to approach it &amp; save cost</a></li>
</ul>
<p>With Cloud Monitoring, I&rsquo;ve restricted the <code>prometheus.googleapis.com</code> metrics that are being ingested but realized I wanted to track the number of Pods (and Containers) deployed to a GKE cluster.</p>
    </div>
    <a href="/posts/230419/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220520/" class="link black dim">
        Prometheus Exporters for fly.io and Vultr
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been on a roll building utilities this week. I developed a Service Health dashboard for my &ldquo;thing&rdquo;, a <a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a> and today, a <a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a>. This is motivated by the fear that I will forget a deployed Cloud resource and incur a horrible bill.</p>
<p>I&rsquo;ve no written several Prometheus Exporters for cloud platforms:</p>
<ul>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for GCP</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>Each of them monitors resource deployments and produces resource count metrics that can be scraped by Prometheus and alerted with Alertmanager. I have Alertmanager <a href="https://prometheus.io/docs/alerting/latest/configuration/#pushover_config">configured</a> to send notifications to <a href="https://pushover.net">Pushover</a>. Last week I wrote an integration between <a href="/posts/220514/">Google Cloud Monitoring to send notifications to Pushover</a> too.</p>
    </div>
    <a href="/posts/220520/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210519/" class="link black dim">
        Multiplexing gRPC and HTTP (Prometheus) endpoints with Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google <a href="https://cloud.google.com/run">Cloud Run</a> is useful but, each service is limited to exposing a single port. This caused me problems with a gRPC service that serves (non-gRPC) Prometheus metrics because customarily, you would serve gRPC on one port and the Prometheus metrics on another.</p>
<p>Fortunately, <a href="https://github.com/soheilhy/cmux">cmux</a> provides a solution by providing a mechanism that multiplexes both services (gRPC and HTTP) on a single port!</p>
<blockquote>
<p><strong>TL;DR</strong> See the cmux <a href="https://github.com/soheilhy/cmux#limitations">Limitations</a> and use:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#a6e22e">grpcl</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">MatchWithWriters</span>(
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">cmux</span>.<span style="color:#a6e22e">HTTP2MatchHeaderFieldSendSettings</span>(<span style="color:#e6db74">&#34;content-type&#34;</span>, <span style="color:#e6db74">&#34;application/grpc&#34;</span>))
</span></span></code></pre></div></blockquote>
<p>Extending the <a href="https://github.com/soheilhy/cmux#how-to">example</a> from the cmux repo:</p>
    </div>
    <a href="/posts/210519/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/azure/" class="link blue hover-black">
            Tag: Azure
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230420/" class="link black dim">
        Prometheus Exporter for Azure (Container Apps)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written Prometheus Exporters for various cloud platforms. My motivation for writing these Exporters is that I want a unified mechanism to track my usage of these platform&rsquo;s services. It&rsquo;s easy to deploy a service on a platform and inadvertently leave it running (up a bill). The set of exporters is:</p>
<ul>
<li><a href="https://github.com/DazWilkin/azure-exporter">Prometheus Exporter for Azure</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for GCP</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>This post describes the recently-added Azure Exporter which only provides metrics for Container Apps and Resource Groups.</p>
    </div>
    <a href="/posts/230420/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230404/" class="link black dim">
        Azure Container Apps
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The majority of <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s components are deployed to <a href="https://cloud.google.com">Google Cloud</a>. However, by its nature, Ackal benefits from deployments that span cloud platforms. I&rsquo;ve deployed Ackal&rsquo;s <a href="https://grpc.io">gRPC</a> <a href="https://github.com/grpc/grpc/blob/master/doc/health-checking.md">health checks</a> to <a href="https://fly.io">Fly</a>, and managed Kubernetes services on <a href="https://linode.com">Linode</a> and <a href="https://vultr.com">Vultr</a>.</p>
<p>Today, I decided to revisit<a href="#microsoft">¹</a> <a href="https://azure.microsoft.com">Azure</a>. Ackal uses Azure (Active Directory) for one of its OAuth providers. This time, I wanted to deploy a containerized gRPC service. Azure provides <a href="https://azure.microsoft.com/en-us/products/category/containers/">several</a> container-oriented services. I decided to use <a href="https://azure.microsoft.com/en-us/products/container-apps/">Azure Container Apps</a> and, in hindsight, find it analogous to Google <a href="https://cloud.google.com/run">Cloud Run</a>.</p>
    </div>
    <a href="/posts/230404/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/container-apps/" class="link blue hover-black">
            Tag: Container Apps
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230420/" class="link black dim">
        Prometheus Exporter for Azure (Container Apps)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written Prometheus Exporters for various cloud platforms. My motivation for writing these Exporters is that I want a unified mechanism to track my usage of these platform&rsquo;s services. It&rsquo;s easy to deploy a service on a platform and inadvertently leave it running (up a bill). The set of exporters is:</p>
<ul>
<li><a href="https://github.com/DazWilkin/azure-exporter">Prometheus Exporter for Azure</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for GCP</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>This post describes the recently-added Azure Exporter which only provides metrics for Container Apps and Resource Groups.</p>
    </div>
    <a href="/posts/230420/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230404/" class="link black dim">
        Azure Container Apps
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The majority of <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s components are deployed to <a href="https://cloud.google.com">Google Cloud</a>. However, by its nature, Ackal benefits from deployments that span cloud platforms. I&rsquo;ve deployed Ackal&rsquo;s <a href="https://grpc.io">gRPC</a> <a href="https://github.com/grpc/grpc/blob/master/doc/health-checking.md">health checks</a> to <a href="https://fly.io">Fly</a>, and managed Kubernetes services on <a href="https://linode.com">Linode</a> and <a href="https://vultr.com">Vultr</a>.</p>
<p>Today, I decided to revisit<a href="#microsoft">¹</a> <a href="https://azure.microsoft.com">Azure</a>. Ackal uses Azure (Active Directory) for one of its OAuth providers. This time, I wanted to deploy a containerized gRPC service. Azure provides <a href="https://azure.microsoft.com/en-us/products/category/containers/">several</a> container-oriented services. I decided to use <a href="https://azure.microsoft.com/en-us/products/container-apps/">Azure Container Apps</a> and, in hindsight, find it analogous to Google <a href="https://cloud.google.com/run">Cloud Run</a>.</p>
    </div>
    <a href="/posts/230404/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/kubelet/" class="link blue hover-black">
            Tag: Kubelet
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230419/" class="link black dim">
        Kubernetes metrics, metrics everywhere
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been tinkering with ways to &ldquo;unit-test&rdquo; my assumptions when using cloud platforms. I recently wrote about good posts by Google describing achieving cost savings with Cloud Monitoring and Cloud Logging:</p>
<ul>
<li><a href="https://cloud.google.com/blog/products/management-tools/learn-to-understand-and-reduce-cloud-monitoring-costs/">How to identify and reduce costs of your Google Cloud observability in Cloud Monitoring</a></li>
<li><a href="https://cloud.google.com/blog/topics/cost-management/how-to-approach-cloud-logging-pricing-for-cloud-admins">Cloud Logging pricing for Cloud Admins: How to approach it &amp; save cost</a></li>
</ul>
<p>With Cloud Monitoring, I&rsquo;ve restricted the <code>prometheus.googleapis.com</code> metrics that are being ingested but realized I wanted to track the number of Pods (and Containers) deployed to a GKE cluster.</p>
    </div>
    <a href="/posts/230419/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/apps-script/" class="link blue hover-black">
            Tag: Apps Script
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230329/" class="link black dim">
        Apps Script connecting to GCS
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m building a Google Sheet that interacts with <a href="https://cloud.google.com/storage">Google Cloud Storage (GCS)</a> objects using <a href="https://developers.google.com/apps-script">Apps Script</a>.</p>
<p>I Googled but found few examples of such integrations beyond out-of-band solutions (e.g. Python solutions) that interact with Google services and program Google Sheets using its library.</p>
<p>In my case, I&rsquo;m going to bind a Google Sheet to a specific Google Cloud project and my Google (User) account has <code>owner</code> access to the Google Cloud Storage bucket and its objects.</p>
    </div>
    <a href="/posts/230329/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/google-cloud-storage/" class="link blue hover-black">
            Tag: Google Cloud Storage
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230329/" class="link black dim">
        Apps Script connecting to GCS
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m building a Google Sheet that interacts with <a href="https://cloud.google.com/storage">Google Cloud Storage (GCS)</a> objects using <a href="https://developers.google.com/apps-script">Apps Script</a>.</p>
<p>I Googled but found few examples of such integrations beyond out-of-band solutions (e.g. Python solutions) that interact with Google services and program Google Sheets using its library.</p>
<p>In my case, I&rsquo;m going to bind a Google Sheet to a specific Google Cloud project and my Google (User) account has <code>owner</code> access to the Google Cloud Storage bucket and its objects.</p>
    </div>
    <a href="/posts/230329/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/bash/" class="link blue hover-black">
            Tag: Bash
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230310/" class="link black dim">
        Kubernetes Operators
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> uses a Kubernetes Operator to orchestrate the lifecycle of its health checks. Ackal&rsquo;s Operator is written in Go using <a href="https://github.com/kubernetes-sigs/kubebuilder"><code>kubebuilder</code></a>.</p>
<p>Yesterday, my interest was piqued by a <a href="https://metalbear.co">MetalBear</a> blog post <a href="https://metalbear.co/blog/writing-a-kubernetes-operator/">Writing a Kubernetes Operator [in Rust]</a>. I spent some time reimplementing one of Ackal&rsquo;s CRDs (<code>Check</code>) using <a href="https://github.com/kube-rs/kube"><code>kube-rs</code></a> and not only refreshed my Rust knowledge but learned a bunch more about Kubernetes and Operators.</p>
<p>While rummaging around the Kubernetes documentation, I discovered flant&rsquo;s <a href="https://github.com/flant/shell-operator"><code>Shell-operator</code></a> and spent some time today exploring its potential.</p>
    </div>
    <a href="/posts/230310/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210902/" class="link black dim">
        Infrastructure as Code
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="problem">Problem</h2>
<p>I&rsquo;m building an application that comprises:</p>
<ul>
<li>Kubernetes¹</li>
<li>Kubernetes Operator</li>
<li>Cloud Firestore</li>
<li>Cloud Functions</li>
<li>Cloud Run</li>
<li>Cloud Endpoints</li>
<li>Stripe</li>
<li>Firebase Authentication</li>
</ul>
<blockquote>
<p>¹ - I&rsquo;m using Google Kubernetes Engine (GKE) but may include other managed Kubernetes offerings (e.g. Digital Ocean, Linode, Oracle). GKE clusters are manageable by <code>gcloud</code> but other platforms require other CLI tools. All are accessible from bash but are these supported by e.g. Terraform (see below)?</p></blockquote>
<p>Many of the components are packaged as container images and, because I&rsquo;m using GitHub to host the project&rsquo;s repos (I&rsquo;ll leave the monorepo discussion for another post), I&rsquo;ve become inculcated and use GitHub Container Registry (GHCR) as the container repo.</p>
    </div>
    <a href="/posts/210902/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/operators/" class="link blue hover-black">
            Tag: Operators
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230310/" class="link black dim">
        Kubernetes Operators
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a> uses a Kubernetes Operator to orchestrate the lifecycle of its health checks. Ackal&rsquo;s Operator is written in Go using <a href="https://github.com/kubernetes-sigs/kubebuilder"><code>kubebuilder</code></a>.</p>
<p>Yesterday, my interest was piqued by a <a href="https://metalbear.co">MetalBear</a> blog post <a href="https://metalbear.co/blog/writing-a-kubernetes-operator/">Writing a Kubernetes Operator [in Rust]</a>. I spent some time reimplementing one of Ackal&rsquo;s CRDs (<code>Check</code>) using <a href="https://github.com/kube-rs/kube"><code>kube-rs</code></a> and not only refreshed my Rust knowledge but learned a bunch more about Kubernetes and Operators.</p>
<p>While rummaging around the Kubernetes documentation, I discovered flant&rsquo;s <a href="https://github.com/flant/shell-operator"><code>Shell-operator</code></a> and spent some time today exploring its potential.</p>
    </div>
    <a href="/posts/230310/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/linode/" class="link blue hover-black">
            Tag: Linode
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230215/" class="link black dim">
        Secure (TLS) gRPC services with LKE
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>NOTE</strong> <a href="https://cert-manager.io"><code>cert-manager</code></a> is a better solution to what follows.</p></blockquote>
<p>I wrote about deploying <a href="/posts/220603/">Secure (TLS) gRPC services with Vultr Kubernetes Engine (VKE)</a>. This week, I&rsquo;ve reproduced this deployment using Linode Kubernetes Engine (LKE).</p>
<p>Thanks to the consistency provided by Kubernetes, the Kubernetes programming is almost identical. The main differences are between the CLI&rsquo;s provided by these platforms. Both are good. They&rsquo;re just different.</p>
<p>I&rsquo;m going to include the <code>linode-cli</code> commands I&rsquo;m using in this post as I found it slightly more quirky.</p>
    </div>
    <a href="/posts/230215/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191219/" class="link black dim">
        Prometheus AlertManager
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Yesterday I discussed a <a href="/posts/191218/">Linode Prometheus Exporter</a> and tantalized use of Prometheus AlertManager.</p>
<p>Success:</p>
<p><img src="/images/191219.alertmanager.gmail.png" alt="Gmail Alert"></p>
<h2 id="configure">Configure</h2>
<p>The process is straightforward although I found the Prometheus (config) documentation slightly unwieldy to navigate :-(</p>
<p>The overall process is <a href="https://prometheus.io/docs/alerting/overview/">documented</a>.</p>
<p>Here are the steps I took:</p>
<ul>
<li><a href="#configure-prometheus">Configure Prometheus</a></li>
<li><a href="#configure-alertmanager">Configure AlertManager</a></li>
<li><a href="#revise-docker-compose">Revise Docker Compose</a></li>
</ul>
<h3 id="configure-prometheus">Configure Prometheus</h3>
<p>Added the following to <code>prometheus.yml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#f92672">rule_files</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#e6db74">&#34;/etc/alertmanager/rules/linode.yml&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">alerting</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">alertmanagers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">http</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">static_configs</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">targets</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#e6db74">&#34;alertmanager:9093&#34;</span>
</span></span></code></pre></div><p>Rules must be defined in separate rules files. See below for the content for <code>linode.yml</code> and an explanation.</p>
    </div>
    <a href="/posts/191219/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191218/" class="link black dim">
        Linode Prometheus Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I enjoy using <a href="https://prometheus.io">Prometheus</a> and have toyed around with it for some time particularly in combination with Kubernetes. I signed up with <a href="https://www.linode.com/?r=9ab7d75b764e143a1b3b467390c852b2c56cd704">Linode</a> [referral] compelled by the addition of a managed Kubernetes service called <a href="https://www.linode.com/products/kubernetes/">Linode Kubernetes Engine (LKE)</a>. I have an anxiety that I&rsquo;ll inadvertently leave resources running (unused) on a cloud platform. Instead of refreshing the relevant billing page, it struck me that Prometheus may (not yet proven) help.</p>
<p>The hypothesis is that a combination of a cloud-specific Prometheus <a href="https://prometheus.io/docs/instrumenting/exporters/">exporter</a> reporting aggregate uses of e.g. Linodes (instances), NodeBalancers, Kubernetes clusters etc., could form the basis of an alert mechanism using Prometheus&rsquo; <a href="https://prometheus.io/docs/alerting/overview/">alerting</a>.</p>
    </div>
    <a href="/posts/191218/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/lke/" class="link blue hover-black">
            Tag: Lke
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230215/" class="link black dim">
        Secure (TLS) gRPC services with LKE
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>NOTE</strong> <a href="https://cert-manager.io"><code>cert-manager</code></a> is a better solution to what follows.</p></blockquote>
<p>I wrote about deploying <a href="/posts/220603/">Secure (TLS) gRPC services with Vultr Kubernetes Engine (VKE)</a>. This week, I&rsquo;ve reproduced this deployment using Linode Kubernetes Engine (LKE).</p>
<p>Thanks to the consistency provided by Kubernetes, the Kubernetes programming is almost identical. The main differences are between the CLI&rsquo;s provided by these platforms. Both are good. They&rsquo;re just different.</p>
<p>I&rsquo;m going to include the <code>linode-cli</code> commands I&rsquo;m using in this post as I found it slightly more quirky.</p>
    </div>
    <a href="/posts/230215/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/ssl/" class="link blue hover-black">
            Tag: Ssl
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230215/" class="link black dim">
        Secure (TLS) gRPC services with LKE
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>NOTE</strong> <a href="https://cert-manager.io"><code>cert-manager</code></a> is a better solution to what follows.</p></blockquote>
<p>I wrote about deploying <a href="/posts/220603/">Secure (TLS) gRPC services with Vultr Kubernetes Engine (VKE)</a>. This week, I&rsquo;ve reproduced this deployment using Linode Kubernetes Engine (LKE).</p>
<p>Thanks to the consistency provided by Kubernetes, the Kubernetes programming is almost identical. The main differences are between the CLI&rsquo;s provided by these platforms. Both are good. They&rsquo;re just different.</p>
<p>I&rsquo;m going to include the <code>linode-cli</code> commands I&rsquo;m using in this post as I found it slightly more quirky.</p>
    </div>
    <a href="/posts/230215/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220603/" class="link black dim">
        Secure (TLS) gRPC services with VKE
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>NOTE</strong> <a href="https://cert-manager.io"><code>cert-manager</code></a> is a better solution to what follows.</p></blockquote>
<p>I&rsquo;ve a need to deploy a Vultr Kubernetes Engine (VKE) cluster on a daily basis (create and delete within a few hours) and expose (securely|TLS) a gRPC service.</p>
<p>I have an existing solution <a href="/posts/211130/">Automatic Certs w/ Golang gRPC service on Compute Engine</a> that combines a gRPC Healthchecking and an ACME service and decided to reuse this.</p>
<p>In order for it work, we need:</p>
    </div>
    <a href="/posts/220603/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/tls/" class="link blue hover-black">
            Tag: Tls
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230215/" class="link black dim">
        Secure (TLS) gRPC services with LKE
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>NOTE</strong> <a href="https://cert-manager.io"><code>cert-manager</code></a> is a better solution to what follows.</p></blockquote>
<p>I wrote about deploying <a href="/posts/220603/">Secure (TLS) gRPC services with Vultr Kubernetes Engine (VKE)</a>. This week, I&rsquo;ve reproduced this deployment using Linode Kubernetes Engine (LKE).</p>
<p>Thanks to the consistency provided by Kubernetes, the Kubernetes programming is almost identical. The main differences are between the CLI&rsquo;s provided by these platforms. Both are good. They&rsquo;re just different.</p>
<p>I&rsquo;m going to include the <code>linode-cli</code> commands I&rsquo;m using in this post as I found it slightly more quirky.</p>
    </div>
    <a href="/posts/230215/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220603/" class="link black dim">
        Secure (TLS) gRPC services with VKE
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>NOTE</strong> <a href="https://cert-manager.io"><code>cert-manager</code></a> is a better solution to what follows.</p></blockquote>
<p>I&rsquo;ve a need to deploy a Vultr Kubernetes Engine (VKE) cluster on a daily basis (create and delete within a few hours) and expose (securely|TLS) a gRPC service.</p>
<p>I have an existing solution <a href="/posts/211130/">Automatic Certs w/ Golang gRPC service on Compute Engine</a> that combines a gRPC Healthchecking and an ACME service and decided to reuse this.</p>
<p>In order for it work, we need:</p>
    </div>
    <a href="/posts/220603/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/gcp/" class="link blue hover-black">
            Tag: GCP
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230104/" class="link black dim">
        Authenticate PromLens to Google Managed Prometheus
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Google Managed Service for Prometheus (GMP)</a> and liking it.</p>
<p>Sometime ago, I tried using <a href="https://promlens.com/">PromLens</a> with GMP but GMP&rsquo;s Prometheus HTTP API endpoint requires auth and I&rsquo;ve battled Prometheus&rsquo; somewhat limited auth mechanism before (<a href="/posts/211005/">Scraping metrics exposed by Google Cloud Run services that require authentication</a>).</p>
<p>Listening to <a href="https://promcon.io/2022-munich/schedule/">PromCon EU 2022</a> videos, I learned that PromLens has been <a href="https://promlabs.com/blog/2022/10/25/promlabs-and-chronosphere-open-source-the-promlens-query-builder">open sourced</a> and contributed to the Prometheus project. Eventually, the functionality of PromLens should be combined into the Prometheus UI.</p>
    </div>
    <a href="/posts/230104/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220520/" class="link black dim">
        Prometheus Exporters for fly.io and Vultr
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been on a roll building utilities this week. I developed a Service Health dashboard for my &ldquo;thing&rdquo;, a <a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a> and today, a <a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a>. This is motivated by the fear that I will forget a deployed Cloud resource and incur a horrible bill.</p>
<p>I&rsquo;ve no written several Prometheus Exporters for cloud platforms:</p>
<ul>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for GCP</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>Each of them monitors resource deployments and produces resource count metrics that can be scraped by Prometheus and alerted with Alertmanager. I have Alertmanager <a href="https://prometheus.io/docs/alerting/latest/configuration/#pushover_config">configured</a> to send notifications to <a href="https://pushover.net">Pushover</a>. Last week I wrote an integration between <a href="/posts/220514/">Google Cloud Monitoring to send notifications to Pushover</a> too.</p>
    </div>
    <a href="/posts/220520/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220514/" class="link black dim">
        Using Google Monitoring Alerting to send Pushover notifications
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#artifacts">Artifacts</a></li>
<li><a href="#pushover">Pushover</a></li>
<li><a href="#caveat"><strong>Caveat</strong></a></li>
<li><a href="#cloud-monitoring-webhook">Cloud Monitoring Webhook</a></li>
<li><a href="#cloud-functions-2nd-gen">Cloud Functions</a></li>
<li><a href="#cloud-run">Cloud Run</a></li>
</ul>
<h2 id="artifacts">Artifacts</h2>
<ul>
<li>GitHub: <a href="https://github.com/DazWilkin/go-gcp-pushover-notificationchannel"><code>go-gcp-pushover-notificationchannel</code></a></li>
<li>Image: <code>ghcr.io/dazwilkin/go-gcp-pushover-notificationchannel:220515</code></li>
</ul>
<h2 id="pushover">Pushover</h2>
<p>Logging in to your <a href="https://pushover.net">Pushover</a> account, you will be presented with a summary|dashboard page that includes <code>Your User Key</code>. Copy the value of this key into a variable called <code>PUSHOVER_USER</code></p>
<p><a href="https://pushover.net/apps/build">Create New Application|API Token</a></p>
<p><img src="/images/220514.pushover.app.png" alt="Pushover: New API Token"></p>
<p>Pushover <a href="https://pushover.net/api">API</a> has a <a href="https://pushover.net/api#messages">Pushing Messages</a> method. The documentation describes the format of the HTTP Request. It must be a <code>POST</code> using TLS (<code>https://</code>) to <code>https://api.pushover.net/1/messages.json</code>. The <code>content-type</code> should be <code>application/json</code>. In the JSON body of the message, we must include <code>token</code> (<code>PUSHOVER_TOKEN</code>), <code>user</code> (<code>PUSHOVER_USER_KEY</code>), <code>device</code> (we&rsquo;ll use <code>cloud-monitoring</code>) and a <code>title</code> and a <code>message</code></p>
    </div>
    <a href="/posts/220514/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220506/" class="link black dim">
        Cloud Run custom domain mappings
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I have several Cloud Run services that I want to map to a domain.</p>
<p>During development, I create a Google Cloud Platform (GCP) project each day into which everything is deployed. This means that, every day, the Cloud Run services have newly non-inferable (to me) URLs. I thought this would be tedious to manage because:</p>
<ol>
<li>My DNS service isn&rsquo;t programmable (I know!)</li>
<li>Cloud Run services have non-inferable (by me) URLs</li>
</ol>
<p>i.e. I thought I&rsquo;d have to manually update the DNS entries each day.</p>
    </div>
    <a href="/posts/220506/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220503/" class="link black dim">
        Automating Scheduled Firestore Exports
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For my &ldquo;thing&rdquo;, I use <a href="https://cloud.google.com/firestore">Firestore</a> to persist state. I like Firestore a lot and, having been around Google for almost (!) a decade, I much prefer it to Datastore.</p>
<p>Firestore has a <a href="https://firebase.google.com/docs/firestore/manage-data/export-import">managed export|import service</a> and I use this to backup Firestore collections|documents.</p>
<p>I&rsquo;d been doing backups manually (using <code>gcloud</code>) and decided today to take the plunge and use <a href="https://cloud.google.com/scheduler">Cloud Scheduler</a> for the first time. I&rsquo;d been reluctant to do this until now because I&rsquo;d assumed <strong>incorrectly</strong> that I&rsquo;d need to write a wrapping service to invoke the export.</p>
    </div>
    <a href="/posts/220503/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220421/" class="link black dim">
        Using Google&#39;s Public Certificate Authority with Golang autocert
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Last year, I wrote about using <a href="/posts/211130/">Automatic Certs w/ Golang gRPC service on Compute Engine</a>. That solution uses <a href="https://en.wikipedia.org/wiki/Automatic_Certificate_Management_Environment">ACME</a> with (the wonderful) <a href="https://letsencrypt.org">Let&rsquo;s Encrypt</a>. Google is offering a private preview of <a href="https://cloud.google.com/blog/products/identity-security/automate-public-certificate-lifecycle-management-via--acme-client-api">Automate Public Certificates Lifecycle Management via RFC 8555 (ACME)</a> and, because I&rsquo;m using Google Cloud Platform extensively to build a &ldquo;thing&rdquo; and I think it would be useful to have a backup to Let&rsquo;s Encrypt, I thought I&rsquo;d give the solution a try. You&rsquo;ll need to sign-up for the private preview, for what follows to work.</p>
    </div>
    <a href="/posts/220421/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210902/" class="link black dim">
        Infrastructure as Code
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="problem">Problem</h2>
<p>I&rsquo;m building an application that comprises:</p>
<ul>
<li>Kubernetes¹</li>
<li>Kubernetes Operator</li>
<li>Cloud Firestore</li>
<li>Cloud Functions</li>
<li>Cloud Run</li>
<li>Cloud Endpoints</li>
<li>Stripe</li>
<li>Firebase Authentication</li>
</ul>
<blockquote>
<p>¹ - I&rsquo;m using Google Kubernetes Engine (GKE) but may include other managed Kubernetes offerings (e.g. Digital Ocean, Linode, Oracle). GKE clusters are manageable by <code>gcloud</code> but other platforms require other CLI tools. All are accessible from bash but are these supported by e.g. Terraform (see below)?</p></blockquote>
<p>Many of the components are packaged as container images and, because I&rsquo;m using GitHub to host the project&rsquo;s repos (I&rsquo;ll leave the monorepo discussion for another post), I&rsquo;ve become inculcated and use GitHub Container Registry (GHCR) as the container repo.</p>
    </div>
    <a href="/posts/210902/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210413/" class="link black dim">
        Cloud Firestore Triggers in Golang
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was pleased to discover that Google provides a non-Node.JS mechanism to subscribe to and act upon Firestore triggers, <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Google Cloud Firestore Triggers</a>. I&rsquo;ve nothing against Node.JS but, for the project i&rsquo;m developing, everything else is written in Golang. It&rsquo;s good to keep it all in one language.</p>
<p>I&rsquo;m perplexed that Cloud Functions still (!) only supports Go 1.13 (03-Sep-2019). Even <a href="https://golang.org/doc/devel/release.html#go1.14">Go 1.14</a> (25-Feb-2020) was released pre-pandemic and we&rsquo;re now running on 1.16. Come on Google!</p>
    </div>
    <a href="/posts/210413/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200617/" class="link black dim">
        WASM Cloud Functions
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Following on from <a href="/posts/200612/">waPC &amp; Protobufs</a> and a question on Stack Overflow about Cloud Functions, I was compelled to try running WASM on Cloud Functions no JavaScript.</p>
<p>I wanted to reuse the WASM waPC functions that I&rsquo;d written in Rust as described in the other post. Cloud Functions does not (yet!?) provide a Rust runtime and so I&rsquo;m using the <a href="https://github.com/wapc/wapc-go">waPC Host for Go</a> in this example.</p>
<p>It works!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PARAMS<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>printf <span style="color:#e6db74">&#39;{&#34;a&#34;:{&#34;real&#34;:39,&#34;imag&#34;:3},&#34;b&#34;:{&#34;real&#34;:39,&#34;imag&#34;:3}}&#39;</span> | base64<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>gcloud auth print-identity-token<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;filename\&#34;:\&#34;complex.wasm\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;function\&#34;:\&#34;c:mul\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;params\&#34;:\&#34;</span><span style="color:#e6db74">${</span>PARAMS<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#34;</span> |<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request POST <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--data @- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span>-<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>.cloudfunctions.net/invoker
</span></span></code></pre></div><p>yields (correctly):</p>
    </div>
    <a href="/posts/200617/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200122/" class="link black dim">
        Setting up a GCE Instance as an Inlets Exit Node
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The prolific <a href="https://blog.alexellis.io/">Alex Ellis</a> has a new project, <a href="https://github.com/inlets/inlets">Inlets</a>.</p>
<p>Here&rsquo;s a quick tutorial using <a href="https://cloud.google.com/">Google Compute Platform&rsquo;s (GCP)</a> <a href="https://cloud.google.com/compute/">Compute Engine (GCE)</a>.</p>
<p><strong>NB</strong> I&rsquo;m using one of Google&rsquo;s <a href="https://cloud.google.com/free/">&ldquo;Always free&rdquo;</a> f1-micro instances <strong>but</strong> you may still pay for network *gress and storage</p>
<h2 id="assumptions">Assumptions</h2>
<p>I&rsquo;m assuming you&rsquo;ve a Google account, have used GCP and have a billing account established, i.e. the following returns at least one billing account:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud beta billing accounts list
</span></span></code></pre></div><p>If you&rsquo;ve only one billing account and it&rsquo;s the one you wish to use, then you can:</p>
    </div>
    <a href="/posts/200122/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191220/" class="link black dim">
        Google Cloud Platform (GCP) Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Earlier this week I discussed a <a href="/posts/191218/">Linode Prometheus Exporter</a>.</p>
<p>I <a href="https://github.com/metalmatze/digitalocean_exporter/pull/5">added</a> metrics for <a href="https://www.digitalocean.com/products/kubernetes/">Digital Ocean&rsquo;s Managed Kubernetes service</a> to <a href="https://github.com/metalmatze">@metalmatze</a>&rsquo;s <a href="https://github.com/metalmatze/digitalocean_exporter">Digital Ocean Exporter</a>.</p>
<p>This left, metrics for <a href="https://cloud.google.com">Google Cloud Platform (GCP)</a> which has, for many years, been my primary cloud platform. So, today I wrote <a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud Platform</a>.</p>
<p>All 3 of these exporters follow the template laid down by @metalmatze and, because each of these services has a well-written Golang SDK, it&rsquo;s straightforward to implement an exporter for each of them.</p>
    </div>
    <a href="/posts/191220/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/promlens/" class="link blue hover-black">
            Tag: PromLens
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/230104/" class="link black dim">
        Authenticate PromLens to Google Managed Prometheus
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Google Managed Service for Prometheus (GMP)</a> and liking it.</p>
<p>Sometime ago, I tried using <a href="https://promlens.com/">PromLens</a> with GMP but GMP&rsquo;s Prometheus HTTP API endpoint requires auth and I&rsquo;ve battled Prometheus&rsquo; somewhat limited auth mechanism before (<a href="/posts/211005/">Scraping metrics exposed by Google Cloud Run services that require authentication</a>).</p>
<p>Listening to <a href="https://promcon.io/2022-munich/schedule/">PromCon EU 2022</a> videos, I learned that PromLens has been <a href="https://promlabs.com/blog/2022/10/25/promlabs-and-chronosphere-open-source-the-promlens-query-builder">open sourced</a> and contributed to the Prometheus project. Eventually, the functionality of PromLens should be combined into the Prometheus UI.</p>
    </div>
    <a href="/posts/230104/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/container/" class="link blue hover-black">
            Tag: Container
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221128/" class="link black dim">
        Maintaining Container Images
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>As I contemplate moving my &ldquo;thing&rdquo; into production, I&rsquo;m anticipating aspects of the application that need maintenance and how this can be automated.</p>
<p>I&rsquo;d been negligent in the maintenance of some of my container images.</p>
<p>I&rsquo;m using mostly Go and some Rust as the basis of static(ally-compiled) binaries that run in these containers <strong>but</strong> not every container has a base image of <a href="https://hub.docker.com/_/scratch"><code>scratch</code></a>. <code>scratch</code> is the <strong>only</strong> base image that doesn&rsquo;t change and thus the only base image that doesn&rsquo;t require that container images buit <code>FROM</code> it, be maintained.</p>
    </div>
    <a href="/posts/221128/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220422/" class="link black dim">
        Playing with GitHub Container Registry REST API
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve a day to catch up on blogging. I&rsquo;m building a &ldquo;thing&rdquo; and getting this near to the finish line consumes my time and has meant that I&rsquo;m not originating anything particularly new. However, there are a couple of tricks in my deployment process that may be of interest to others.</p>
<p>I&rsquo;ve been a long-term using of Google&rsquo;s [Cloud Build] and like the simplicity (everything&rsquo;s a container, alot!). Because I&rsquo;m using GitHub repos, I&rsquo;ve been using GitHub Actions to (re)build containers on pushes and GitHub Container registry (GHCR) to store the results. I know that Google provides analogs for GitHub repos and (forces me to use) Artifact Registry (to deploy my Cloud Run services) <strong>but</strong> even though I dislike GitHub Actions, it&rsquo;s really easy to do everything in one place.</p>
    </div>
    <a href="/posts/220422/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220421/" class="link black dim">
        Using Google&#39;s Public Certificate Authority with Golang autocert
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Last year, I wrote about using <a href="/posts/211130/">Automatic Certs w/ Golang gRPC service on Compute Engine</a>. That solution uses <a href="https://en.wikipedia.org/wiki/Automatic_Certificate_Management_Environment">ACME</a> with (the wonderful) <a href="https://letsencrypt.org">Let&rsquo;s Encrypt</a>. Google is offering a private preview of <a href="https://cloud.google.com/blog/products/identity-security/automate-public-certificate-lifecycle-management-via--acme-client-api">Automate Public Certificates Lifecycle Management via RFC 8555 (ACME)</a> and, because I&rsquo;m using Google Cloud Platform extensively to build a &ldquo;thing&rdquo; and I think it would be useful to have a backup to Let&rsquo;s Encrypt, I thought I&rsquo;d give the solution a try. You&rsquo;ll need to sign-up for the private preview, for what follows to work.</p>
    </div>
    <a href="/posts/220421/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211130/" class="link black dim">
        Automatic Certs w/ Golang gRPC service on Compute Engine
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I needed to deploy a <a href="https://github.com/grpc/grpc/blob/master/src/proto/grpc/health/v1/health.proto">healthcheck</a>-enabled gRPC TLS-enabled service. Fortunately, most (all?) of the SDKs include an implementation, e.g. Golang has <a href="https://github.com/grpc/grpc-go/tree/master/health"><code>grpc-go/health</code></a>.</p>
<p>I learned in my travels that:</p>
<ul>
<li>DigitalOcean [App] platform does not (<a href="https://www.digitalocean.com/community/questions/app-platform-http-2-support">link</a>) work with TLS-based gRPC apps.</li>
<li><a href="https://fly.io">Fly</a> has a regression (<a href="https://community.fly.io/t/urgent-grpc-server-unreachable-via-grpcurl/2694/5">link</a>) that breaks gRPC</li>
</ul>
<p>So, I resorted to Google Cloud Platform (GCP). Although Cloud Run would be well-suited to running the gRPC app, it uses a proxy|sidecar to provision a cert for the app and I wanted to be able to (easily use a custom domain) and give myself a somewhat general-purpose solution.</p>
    </div>
    <a href="/posts/211130/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/docker/" class="link blue hover-black">
            Tag: Docker
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221128/" class="link black dim">
        Maintaining Container Images
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>As I contemplate moving my &ldquo;thing&rdquo; into production, I&rsquo;m anticipating aspects of the application that need maintenance and how this can be automated.</p>
<p>I&rsquo;d been negligent in the maintenance of some of my container images.</p>
<p>I&rsquo;m using mostly Go and some Rust as the basis of static(ally-compiled) binaries that run in these containers <strong>but</strong> not every container has a base image of <a href="https://hub.docker.com/_/scratch"><code>scratch</code></a>. <code>scratch</code> is the <strong>only</strong> base image that doesn&rsquo;t change and thus the only base image that doesn&rsquo;t require that container images buit <code>FROM</code> it, be maintained.</p>
    </div>
    <a href="/posts/221128/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190925/" class="link black dim">
        Run cAdvisor when using Docker Compose
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://github.com/google/cadvisor"><code>cAdvisor</code></a> has long been a favorite monitoring tool of mine. I&rsquo;m using Docker Compose for local testing and have begun including a <code>cAdvisor</code> in my <code>docker-compose.yaml</code> files.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#f92672">cadvisor</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">google/cadvisor:${CADVISOR_VERSION}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">cadvisor</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># command:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># - --prometheus_endpoint=&#34;/metrics&#34; # Default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;/:/rootfs:ro&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;/var/run:/var/run:rw&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;/sys:/sys:ro&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;/var/snap/docker/current:/var/lib/docker:ro&#34;</span> <span style="color:#75715e">#- &#34;/var/lib/docker/:/var/lib/docker:ro&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">expose</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;8080&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">8080</span>:<span style="color:#ae81ff">8080</span>
</span></span></code></pre></div><p>I&rsquo;d not realized until recently, that <code>cAdvisor</code> also surfaces a Prometheus metrics endpoint and so, if you do follow this path and you&rsquo;re also using Prometheus, don&rsquo;t forget to add <code>cAdvisor</code> to your Prometheus targets.</p>
    </div>
    <a href="/posts/190925/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/podman/" class="link blue hover-black">
            Tag: Podman
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221128/" class="link black dim">
        Maintaining Container Images
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>As I contemplate moving my &ldquo;thing&rdquo; into production, I&rsquo;m anticipating aspects of the application that need maintenance and how this can be automated.</p>
<p>I&rsquo;d been negligent in the maintenance of some of my container images.</p>
<p>I&rsquo;m using mostly Go and some Rust as the basis of static(ally-compiled) binaries that run in these containers <strong>but</strong> not every container has a base image of <a href="https://hub.docker.com/_/scratch"><code>scratch</code></a>. <code>scratch</code> is the <strong>only</strong> base image that doesn&rsquo;t change and thus the only base image that doesn&rsquo;t require that container images buit <code>FROM</code> it, be maintained.</p>
    </div>
    <a href="/posts/221128/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211006/" class="link black dim">
        Podman
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve read about <a href="https://podman.io/">Podman</a> and been intrigued by it but never taken the time to install it and play around. This morning, walking with my dog, I listened to the almost-always-interesting <a href="https://kubernetespodcast.com">Kubernetes Podcast</a> and two of the principals behind Podman were on the show to <a href="https://kubernetespodcast.com/episode/164-podman/">discuss</a> it.</p>
<p>I decided to install it and use it in this week&rsquo;s <a href="https://github.com/DazWilkin/gcp-oidc-token-proxy">project</a>.</p>
<p>Here&rsquo;s a working Podman deployment for <code>gcp-oidc-token-proxy</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ACCOUNT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Can&#39;t match container name i.e. prometheus</span>
</span></span><span style="display:flex;"><span>POD<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;foo&#34;</span>
</span></span><span style="display:flex;"><span>SECRET<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>podman secret create <span style="color:#e6db74">${</span>SECRET<span style="color:#e6db74">}</span> <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Pod publishes pod-port:container-port</span>
</span></span><span style="display:flex;"><span>podman pod create <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--name<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>POD<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--publish<span style="color:#f92672">=</span>9091:9090 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--publish<span style="color:#f92672">=</span>7776:7777
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PROMETHEUS<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>mktemp<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Important</span>
</span></span><span style="display:flex;"><span>chmod go+r <span style="color:#e6db74">${</span>PROMETHEUS<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--expression<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;s|some-service-xxxxxxxxxx-xx.a.run.app|</span><span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span><span style="color:#e6db74">|g&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/prometheus.yml &gt; <span style="color:#e6db74">${</span>PROMETHEUS<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Prometheus</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Requires --tty</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Can&#39;t include --publish but exposes 9090</span>
</span></span><span style="display:flex;"><span>podman run <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--detach --rm --tty <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--pod<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>POD<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--name<span style="color:#f92672">=</span>prometheus <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROMETHEUS<span style="color:#e6db74">}</span>:/etc/prometheus/prometheus.yml <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>docker.io/prom/prometheus:v2.30.2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --config.file<span style="color:#f92672">=</span>/etc/prometheus/prometheus.yml <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --web.enable-lifecycle
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># GCP OIDC Token Proxy</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Can&#39;t include --publish but exposes 7777</span>
</span></span><span style="display:flex;"><span>podman run <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--detach --rm <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--pod<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>POD<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--name<span style="color:#f92672">=</span>gcp-oidc-token-proxy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--secret<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>SECRET<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--env<span style="color:#f92672">=</span>GOOGLE_APPLICATION_CREDENTIALS<span style="color:#f92672">=</span>/run/secrets/<span style="color:#e6db74">${</span>SECRET<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>ghcr.io/dazwilkin/gcp-oidc-token-proxy:ec8fa9d9ab1b7fa47448ff32e34daa0c3d211a8d <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --port<span style="color:#f92672">=</span><span style="color:#ae81ff">7777</span>
</span></span></code></pre></div><p>The <code>prometheus</code> container includes a <code>volume</code> mount.</p>
    </div>
    <a href="/posts/211006/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/domain-wide-delegation/" class="link blue hover-black">
            Tag: Domain-Wide Delegation
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221117/" class="link black dim">
        Delegate domain-wide authority using Golang
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;d not used Google&rsquo;s <a href="https://developers.google.com/identity/protocols/oauth2/service-account#delegatingauthority">Domain-wide Delegation</a> from Golang and struggled to find example code.</p>
<p>Google provides Java and Python <a href="https://developers.google.com/identity/protocols/oauth2/service-account#authorizingrequests">samples</a>.</p>
<p>Google has a myriad packages implementing its OAuth security and it&rsquo;s always daunting trying to determine which one to use.</p>
<p>As it happens, I backed into the solution through <code>client.Options</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Google Workspace APIS don&#39;t use IAM do use OAuth scopes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Scopes used here must be reflected in the scopes on the</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Google Workspace Domain-wide Delegate client</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">scopes</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{ <span style="color:#f92672">...</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Delegates on behalf of this Google Workspace user</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">subject</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;a@google-workspace-email.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">creds</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">FindDefaultCredentialsWithParams</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ctx</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">CredentialsParams</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Scopes</span>: <span style="color:#a6e22e">scopes</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Subject</span>: <span style="color:#a6e22e">subject</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">opts</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">option</span>.<span style="color:#a6e22e">WithCredentials</span>(<span style="color:#a6e22e">creds</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">service</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">admin</span>.<span style="color:#a6e22e">NewService</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">opts</span>)
</span></span></code></pre></div><p>In this case <code>NewService</code> applies to Google&rsquo;s Golang <a href="https://pkg.go.dev/google.golang.org/api/admin/directory/v1">Admin SDK API</a> although the pattern of <code>NewService(ctx)</code> or <code>NewService(ctx, opts)</code> where <code>opts</code> is a <a href="https://pkg.go.dev/google.golang.org/api@v0.103.0/option#ClientOption"><code>option.ClientOption</code></a> is consistent across Google&rsquo;s Golang libraries.</p>
    </div>
    <a href="/posts/221117/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/google-workspace/" class="link blue hover-black">
            Tag: Google Workspace
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221117/" class="link black dim">
        Delegate domain-wide authority using Golang
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;d not used Google&rsquo;s <a href="https://developers.google.com/identity/protocols/oauth2/service-account#delegatingauthority">Domain-wide Delegation</a> from Golang and struggled to find example code.</p>
<p>Google provides Java and Python <a href="https://developers.google.com/identity/protocols/oauth2/service-account#authorizingrequests">samples</a>.</p>
<p>Google has a myriad packages implementing its OAuth security and it&rsquo;s always daunting trying to determine which one to use.</p>
<p>As it happens, I backed into the solution through <code>client.Options</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Google Workspace APIS don&#39;t use IAM do use OAuth scopes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Scopes used here must be reflected in the scopes on the</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Google Workspace Domain-wide Delegate client</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">scopes</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{ <span style="color:#f92672">...</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Delegates on behalf of this Google Workspace user</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">subject</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;a@google-workspace-email.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">creds</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">FindDefaultCredentialsWithParams</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ctx</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">CredentialsParams</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Scopes</span>: <span style="color:#a6e22e">scopes</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Subject</span>: <span style="color:#a6e22e">subject</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">opts</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">option</span>.<span style="color:#a6e22e">WithCredentials</span>(<span style="color:#a6e22e">creds</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">service</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">admin</span>.<span style="color:#a6e22e">NewService</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">opts</span>)
</span></span></code></pre></div><p>In this case <code>NewService</code> applies to Google&rsquo;s Golang <a href="https://pkg.go.dev/google.golang.org/api/admin/directory/v1">Admin SDK API</a> although the pattern of <code>NewService(ctx)</code> or <code>NewService(ctx, opts)</code> where <code>opts</code> is a <a href="https://pkg.go.dev/google.golang.org/api@v0.103.0/option#ClientOption"><code>option.ClientOption</code></a> is consistent across Google&rsquo;s Golang libraries.</p>
    </div>
    <a href="/posts/221117/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/curl/" class="link blue hover-black">
            Tag: Curl
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221114/" class="link black dim">
        `curl`&#39;ing a Tailscale Webhook
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>[Tailscale] is <strong>really</strong> good. I&rsquo;ve been using it as a virtual private network to span 2 home networks and to securely (!) access my hosts when I&rsquo;m remote.</p>
<p>Recently Tailscale added <a href="https://tailscale.com/kb/1213/webhooks/">Webhook</a> functionality to permit processing subscribed-to (Tailscale) events. I&rsquo;m always a sucker for a webhook ;-)</p>
<p>Here&rsquo;s a <code>curl</code> command to send a test event to  a Tailscale Webhook:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># From Tailscale&#39;s docs</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://tailscale.com/kb/1213/webhooks/#events-payload</span>
</span></span><span style="display:flex;"><span>BODY<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;timestamp&#34;: &#34;2022-09-21T13:37:51.658918-04:00&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;version&#34;: 1,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;type&#34;: &#34;test&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;tailnet&#34;: &#34;example.com&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;message&#34;: &#34;This is a test event&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;data&#34;: null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>T<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>date +%s<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>V<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  printf <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>T<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">${</span>BODY<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  | openssl dgst -sha256 -hmac <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SECRET<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> -hex -r <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  | head --bytes<span style="color:#f92672">=</span>64<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request POST <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Tailscale-Webhook-Signature:t=</span><span style="color:#e6db74">${</span>T<span style="color:#e6db74">}</span><span style="color:#e6db74">,v1=</span><span style="color:#e6db74">${</span>V<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--data <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>BODY<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>URL<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>There must be a better way of extracting the hashed value from the <code>openssl</code> output.</p>
    </div>
    <a href="/posts/221114/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220422/" class="link black dim">
        Playing with GitHub Container Registry REST API
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve a day to catch up on blogging. I&rsquo;m building a &ldquo;thing&rdquo; and getting this near to the finish line consumes my time and has meant that I&rsquo;m not originating anything particularly new. However, there are a couple of tricks in my deployment process that may be of interest to others.</p>
<p>I&rsquo;ve been a long-term using of Google&rsquo;s [Cloud Build] and like the simplicity (everything&rsquo;s a container, alot!). Because I&rsquo;m using GitHub repos, I&rsquo;ve been using GitHub Actions to (re)build containers on pushes and GitHub Container registry (GHCR) to store the results. I know that Google provides analogs for GitHub repos and (forces me to use) Artifact Registry (to deploy my Cloud Run services) <strong>but</strong> even though I dislike GitHub Actions, it&rsquo;s really easy to do everything in one place.</p>
    </div>
    <a href="/posts/220422/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/webhook/" class="link blue hover-black">
            Tag: Webhook
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221114/" class="link black dim">
        `curl`&#39;ing a Tailscale Webhook
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>[Tailscale] is <strong>really</strong> good. I&rsquo;ve been using it as a virtual private network to span 2 home networks and to securely (!) access my hosts when I&rsquo;m remote.</p>
<p>Recently Tailscale added <a href="https://tailscale.com/kb/1213/webhooks/">Webhook</a> functionality to permit processing subscribed-to (Tailscale) events. I&rsquo;m always a sucker for a webhook ;-)</p>
<p>Here&rsquo;s a <code>curl</code> command to send a test event to  a Tailscale Webhook:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># From Tailscale&#39;s docs</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://tailscale.com/kb/1213/webhooks/#events-payload</span>
</span></span><span style="display:flex;"><span>BODY<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;timestamp&#34;: &#34;2022-09-21T13:37:51.658918-04:00&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;version&#34;: 1,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;type&#34;: &#34;test&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;tailnet&#34;: &#34;example.com&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;message&#34;: &#34;This is a test event&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;data&#34;: null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>T<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>date +%s<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>V<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  printf <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>T<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">${</span>BODY<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  | openssl dgst -sha256 -hmac <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SECRET<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> -hex -r <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  | head --bytes<span style="color:#f92672">=</span>64<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request POST <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Tailscale-Webhook-Signature:t=</span><span style="color:#e6db74">${</span>T<span style="color:#e6db74">}</span><span style="color:#e6db74">,v1=</span><span style="color:#e6db74">${</span>V<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--data <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>BODY<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>URL<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>There must be a better way of extracting the hashed value from the <code>openssl</code> output.</p>
    </div>
    <a href="/posts/221114/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220514/" class="link black dim">
        Using Google Monitoring Alerting to send Pushover notifications
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#artifacts">Artifacts</a></li>
<li><a href="#pushover">Pushover</a></li>
<li><a href="#caveat"><strong>Caveat</strong></a></li>
<li><a href="#cloud-monitoring-webhook">Cloud Monitoring Webhook</a></li>
<li><a href="#cloud-functions-2nd-gen">Cloud Functions</a></li>
<li><a href="#cloud-run">Cloud Run</a></li>
</ul>
<h2 id="artifacts">Artifacts</h2>
<ul>
<li>GitHub: <a href="https://github.com/DazWilkin/go-gcp-pushover-notificationchannel"><code>go-gcp-pushover-notificationchannel</code></a></li>
<li>Image: <code>ghcr.io/dazwilkin/go-gcp-pushover-notificationchannel:220515</code></li>
</ul>
<h2 id="pushover">Pushover</h2>
<p>Logging in to your <a href="https://pushover.net">Pushover</a> account, you will be presented with a summary|dashboard page that includes <code>Your User Key</code>. Copy the value of this key into a variable called <code>PUSHOVER_USER</code></p>
<p><a href="https://pushover.net/apps/build">Create New Application|API Token</a></p>
<p><img src="/images/220514.pushover.app.png" alt="Pushover: New API Token"></p>
<p>Pushover <a href="https://pushover.net/api">API</a> has a <a href="https://pushover.net/api#messages">Pushing Messages</a> method. The documentation describes the format of the HTTP Request. It must be a <code>POST</code> using TLS (<code>https://</code>) to <code>https://api.pushover.net/1/messages.json</code>. The <code>content-type</code> should be <code>application/json</code>. In the JSON body of the message, we must include <code>token</code> (<code>PUSHOVER_TOKEN</code>), <code>user</code> (<code>PUSHOVER_USER_KEY</code>), <code>device</code> (we&rsquo;ll use <code>cloud-monitoring</code>) and a <code>title</code> and a <code>message</code></p>
    </div>
    <a href="/posts/220514/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210108/" class="link black dim">
        Kubernetes cert-manager
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I developed an <a href="/posts/201229/">admission webhook</a> for Akri, twice (<a href="https://github.com/DazWilkin/akri-webhook">Golang</a>, <a href="https://github.com/DazWilkin/akri-webhook-rust">Rust</a>). I naively followed other examples for the generation of the certificates, created a 1.20 cluster and <a href="https://stackoverflow.com/questions/65587904/">broke</a> that process.</p>
<p>I&rsquo;d briefly considered using <a href="https://cert-manager.io"><code>cert-manager</code></a> recently but quickly abandoned the idea thinking it would be onerous and unnecessary complexity for little-old-me. I was wrong. It&rsquo;s excellent and I recommend it highly.</p>
<p>I won&rsquo;t reproduce the <code>v1beta1</code> and <code>v1</code> examples from the Stackoverflow question as they should be self-explanatory. I suspect (!?) that I should not have used Kubernete&rsquo;s (API Server&rsquo;s) CA for the Webhook but it could well be that I just don&rsquo;t understand the correct approach.</p>
    </div>
    <a href="/posts/210108/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201229/" class="link black dim">
        Kubernetes Webhooks
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I spent some time last week writing my first <a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/">admission webhook</a> for Kubernetes. I wrote the handler in Golang because I&rsquo;m most familiar with Golang and because, as Kubernetes&rsquo; native language, I was more confident that the necessary SDKs would exist and that the documentation would likely use Golang by default. I struggled to find useful documentation and so this post is to help you (and me!) remember how to do this next time!</p>
    </div>
    <a href="/posts/201229/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/google-cloud-platform/" class="link blue hover-black">
            Tag: Google-Cloud-Platform
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221111/" class="link black dim">
        The curious cases of the `deleted:serviceaccount`
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>While testing <a href="/posts/221110/">Firestore export and import</a> yesterday and checking the IAM permissions on a Cloud Storage Bucket, I noticed some Member (<code>member</code>) values (I think Google refers to these as Principals) were logical but unfamiliar to me:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>deleted:serviceAccount:{email}?uid={uid}
</span></span></code></pre></div><p>I was using <code>gsutil iam get gs://${BUCKET}</code> because I&rsquo;d realized (and this is another useful lesson) that, as I&rsquo;ve been creating daily test projects, I&rsquo;ve been binding each project&rsquo;s Firestore Service Account (<code>service-{project-number}@gcp-sa-firestore.iam.gserviceaccount.com</code>) to a Bucket owned by another Project <strong>but</strong> I hadn&rsquo;t been deleting the binding when I deleted the Project.</p>
    </div>
    <a href="/posts/221111/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221110/" class="link black dim">
        Firestore Export &amp; Import
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using Firestore to maintain state in my &ldquo;thing&rdquo;.</p>
<p>In an attempt to ensure that I&rsquo;m able to restore the database, I run (Cloud Scheduler) scheduled backups (see <a href="/posts/220503/">Automating Scheduled Firestore Exports</a> and I&rsquo;ve been testing imports to ensure that the process works.</p>
<p>It does.</p>
<p>I thought I&rsquo;d document an important but subtle consideration with Firestore exports (which I&rsquo;d not initially understood).</p>
<p>Google facilitates that backup process with the sibling commands:</p>
    </div>
    <a href="/posts/221110/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200122/" class="link black dim">
        Setting up a GCE Instance as an Inlets Exit Node
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The prolific <a href="https://blog.alexellis.io/">Alex Ellis</a> has a new project, <a href="https://github.com/inlets/inlets">Inlets</a>.</p>
<p>Here&rsquo;s a quick tutorial using <a href="https://cloud.google.com/">Google Compute Platform&rsquo;s (GCP)</a> <a href="https://cloud.google.com/compute/">Compute Engine (GCE)</a>.</p>
<p><strong>NB</strong> I&rsquo;m using one of Google&rsquo;s <a href="https://cloud.google.com/free/">&ldquo;Always free&rdquo;</a> f1-micro instances <strong>but</strong> you may still pay for network *gress and storage</p>
<h2 id="assumptions">Assumptions</h2>
<p>I&rsquo;m assuming you&rsquo;ve a Google account, have used GCP and have a billing account established, i.e. the following returns at least one billing account:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud beta billing accounts list
</span></span></code></pre></div><p>If you&rsquo;ve only one billing account and it&rsquo;s the one you wish to use, then you can:</p>
    </div>
    <a href="/posts/200122/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190924/" class="link black dim">
        Kubernetes Engine and Free Tier
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google Cloud Platform <a href="https://cloud.google.com/free/">Free Tier</a> appears (<span style="color:red">please verify this for yourself</span>) to provide the ability to run a(n admittedly miniscule) Kubernetes cluster for free. So, why do this? It provides a definitive Kubernetes (Engine) experience on Google Cloud Platform that you may use for learning and testing.</p>
<p>Kubernetes Engine the master node(s) and the control plane are <a href="https://cloud.google.com/kubernetes-engine/pricing">free</a>.</p>
<p>Kubernetes (i.e. Compute Engine) nodes potentially incur charges including for the VM runtime and any attached storage, snapshots etc. However, charges for these resources can be partially covered by the Free Tier.</p>
    </div>
    <a href="/posts/190924/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/iam/" class="link blue hover-black">
            Tag: Iam
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221111/" class="link black dim">
        The curious cases of the `deleted:serviceaccount`
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>While testing <a href="/posts/221110/">Firestore export and import</a> yesterday and checking the IAM permissions on a Cloud Storage Bucket, I noticed some Member (<code>member</code>) values (I think Google refers to these as Principals) were logical but unfamiliar to me:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>deleted:serviceAccount:{email}?uid={uid}
</span></span></code></pre></div><p>I was using <code>gsutil iam get gs://${BUCKET}</code> because I&rsquo;d realized (and this is another useful lesson) that, as I&rsquo;ve been creating daily test projects, I&rsquo;ve been binding each project&rsquo;s Firestore Service Account (<code>service-{project-number}@gcp-sa-firestore.iam.gserviceaccount.com</code>) to a Bucket owned by another Project <strong>but</strong> I hadn&rsquo;t been deleting the binding when I deleted the Project.</p>
    </div>
    <a href="/posts/221111/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/service-accounts/" class="link blue hover-black">
            Tag: Service-Accounts
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221111/" class="link black dim">
        The curious cases of the `deleted:serviceaccount`
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>While testing <a href="/posts/221110/">Firestore export and import</a> yesterday and checking the IAM permissions on a Cloud Storage Bucket, I noticed some Member (<code>member</code>) values (I think Google refers to these as Principals) were logical but unfamiliar to me:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>deleted:serviceAccount:{email}?uid={uid}
</span></span></code></pre></div><p>I was using <code>gsutil iam get gs://${BUCKET}</code> because I&rsquo;d realized (and this is another useful lesson) that, as I&rsquo;ve been creating daily test projects, I&rsquo;ve been binding each project&rsquo;s Firestore Service Account (<code>service-{project-number}@gcp-sa-firestore.iam.gserviceaccount.com</code>) to a Bucket owned by another Project <strong>but</strong> I hadn&rsquo;t been deleting the binding when I deleted the Project.</p>
    </div>
    <a href="/posts/221111/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cloud-firestore/" class="link blue hover-black">
            Tag: Cloud-Firestore
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221110/" class="link black dim">
        Firestore Export &amp; Import
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using Firestore to maintain state in my &ldquo;thing&rdquo;.</p>
<p>In an attempt to ensure that I&rsquo;m able to restore the database, I run (Cloud Scheduler) scheduled backups (see <a href="/posts/220503/">Automating Scheduled Firestore Exports</a> and I&rsquo;ve been testing imports to ensure that the process works.</p>
<p>It does.</p>
<p>I thought I&rsquo;d document an important but subtle consideration with Firestore exports (which I&rsquo;d not initially understood).</p>
<p>Google facilitates that backup process with the sibling commands:</p>
    </div>
    <a href="/posts/221110/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/github/" class="link blue hover-black">
            Tag: Github
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/221106/" class="link black dim">
        Basic programmatic access to GitHub Issues
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>It&rsquo;s been a while!</p>
<p>I&rsquo;ve been spending time writing Bash scripts and a web site but neither has been sufficiently creative that I&rsquo;ve felt worth a blog post.</p>
<p>As I&rsquo;ve been finalizing the web site, I needed an Issue Tracker and decided to leverage GitHub(&rsquo;s <a href="https://docs.github.com/en/issues">Issues</a>).</p>
<p>As a former Googler, I&rsquo;m familiar with Google&rsquo;s (excellent) internal issue tracking tool (Buganizer) and it&rsquo;s public manifestation <a href="https://issuetracker.google.com">Issue Tracker</a>. Google documents Issue Tracker and its <a href="https://developers.google.com/issue-tracker/concepts/issues">Issue</a> type which I&rsquo;ve mercilessly plagiarized in my implementation.</p>
    </div>
    <a href="/posts/221106/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210924/" class="link black dim">
        GitHub help with dependency management
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This is very useful:</p>
<p><img src="/images/210924.notifications.png" alt="GitHub Notifications"></p>
<p>I am building an application that comprises multiple repos. I continue to procrastinate on whether using multiple repos vs. a monorepo was a good idea but, an issue that I have (had) is the need to ensure that the repos&rsquo; contents are using current|latest modules. GitHub can help.</p>
<p>Most of the application is written in Golang with a smattering of Rust and some JavaScript.</p>
    </div>
    <a href="/posts/210924/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201029/" class="link black dim">
        GitHub Actions &amp;&amp; GitHub Container Registry
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>You know when you start something and then regret it!? I think I&rsquo;ll be sticking with <a href="https://cloud.google.com/cloud-build">Google Cloud Build</a>; <a href="https://github.com/features/actions">GitHub Actions</a> appears functional and useful but I found the documentation to be confusing and limited and struggled to get a simple container image build|push working.</p>
<p>I&rsquo;ve long used <a href="https://hub.docker.com">Docker Hub</a> but am planning to use it less as a result of the planned <a href="https://www.docker.com/blog/scaling-docker-to-serve-millions-more-developers-network-egress/">changes</a>. I want to see Docker succeed and to do so it needs to find a way to make money but, there are free alternatives including the new <a href="https://github.blog/2020-09-01-introducing-github-container-registry/">GitHub Container Registry</a> and the very very cheap <a href="https://cloud.google.com/container-registry">Google Container Registry</a>.</p>
    </div>
    <a href="/posts/201029/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/vke/" class="link blue hover-black">
            Tag: Vke
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220603/" class="link black dim">
        Secure (TLS) gRPC services with VKE
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>NOTE</strong> <a href="https://cert-manager.io"><code>cert-manager</code></a> is a better solution to what follows.</p></blockquote>
<p>I&rsquo;ve a need to deploy a Vultr Kubernetes Engine (VKE) cluster on a daily basis (create and delete within a few hours) and expose (securely|TLS) a gRPC service.</p>
<p>I have an existing solution <a href="/posts/211130/">Automatic Certs w/ Golang gRPC service on Compute Engine</a> that combines a gRPC Healthchecking and an ACME service and decided to reuse this.</p>
<p>In order for it work, we need:</p>
    </div>
    <a href="/posts/220603/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220602/" class="link black dim">
        Vultr CLI and JSON output
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve begun exploring <a href="https://vultr.com">Vultr</a> after the company announced a managed Kubernetes offering <a href="https://www.vultr.com/kubernetes/">Vultr Kubernetes Engine (VKE)</a>.</p>
<p>In my brief experience, it&rsquo;s a decent platform and its CLI <a href="https://github.com/vultr/vultr-cli"><code>vultr-cli</code></a> is mostly (!) good. The CLI has a limitation in that command output is text formatted and this makes it challenging to parse the output when scripting.</p>
<blockquote>
<p><strong>NOTE</strong> The Vultr developers have a branch <a href="https://github.com/vultr/vultr-cli/tree/rewrite"><code>rewrite</code></a> that includes a solution to this problem.</p></blockquote>
<p>Example</p>
<pre tabindex="0"><code>ID              12345678-90ab-cdef-1234-567890abcdef
LABEL           test
DATE CREATED    2022-01-01T00:00:00+00:00
CLUSTER SUBNET  255.255.255.255/16
SERVICE SUBNET  255.255.255.255/12
IP              255.255.255.255
ENDPOINT        12345678-90ab-cdef-1234-567890abcdef.vultr-k8s.com
VERSION         v1.23.5+3
REGION          mars
STATUS          pending
 
NODE POOLS
ID              12345678-90ab-cdef-1234-567890abcdef
DATE CREATED    2022-01-01T00:00:00+00:00
DATE UPDATED    2022-01-01T00:00:00+00:00
LABEL           nodepool
TAG             foo
PLAN            vc2-1c-2gb
STATUS          pending
NODE QUANTITY   1
AUTO SCALER     false
MIN NODES       1
MAX NODES       1
 
NODES
ID                                      DATE CREATED                    LABEL                   STATUS
12345678-
</code></pre><p>Until that&rsquo;s available, I&rsquo;m lazy writing <strong>very simple</strong> bash scripts to parse <code>vultr-cli</code> command output as JSON. The repo is <a href="https://github.com/DazWilkin/vultr-cli-format"><code>vultr-cli-format</code></a>.</p>
    </div>
    <a href="/posts/220602/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/vultr/" class="link blue hover-black">
            Tag: Vultr
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220603/" class="link black dim">
        Secure (TLS) gRPC services with VKE
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>NOTE</strong> <a href="https://cert-manager.io"><code>cert-manager</code></a> is a better solution to what follows.</p></blockquote>
<p>I&rsquo;ve a need to deploy a Vultr Kubernetes Engine (VKE) cluster on a daily basis (create and delete within a few hours) and expose (securely|TLS) a gRPC service.</p>
<p>I have an existing solution <a href="/posts/211130/">Automatic Certs w/ Golang gRPC service on Compute Engine</a> that combines a gRPC Healthchecking and an ACME service and decided to reuse this.</p>
<p>In order for it work, we need:</p>
    </div>
    <a href="/posts/220603/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220602/" class="link black dim">
        Vultr CLI and JSON output
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve begun exploring <a href="https://vultr.com">Vultr</a> after the company announced a managed Kubernetes offering <a href="https://www.vultr.com/kubernetes/">Vultr Kubernetes Engine (VKE)</a>.</p>
<p>In my brief experience, it&rsquo;s a decent platform and its CLI <a href="https://github.com/vultr/vultr-cli"><code>vultr-cli</code></a> is mostly (!) good. The CLI has a limitation in that command output is text formatted and this makes it challenging to parse the output when scripting.</p>
<blockquote>
<p><strong>NOTE</strong> The Vultr developers have a branch <a href="https://github.com/vultr/vultr-cli/tree/rewrite"><code>rewrite</code></a> that includes a solution to this problem.</p></blockquote>
<p>Example</p>
<pre tabindex="0"><code>ID              12345678-90ab-cdef-1234-567890abcdef
LABEL           test
DATE CREATED    2022-01-01T00:00:00+00:00
CLUSTER SUBNET  255.255.255.255/16
SERVICE SUBNET  255.255.255.255/12
IP              255.255.255.255
ENDPOINT        12345678-90ab-cdef-1234-567890abcdef.vultr-k8s.com
VERSION         v1.23.5+3
REGION          mars
STATUS          pending
 
NODE POOLS
ID              12345678-90ab-cdef-1234-567890abcdef
DATE CREATED    2022-01-01T00:00:00+00:00
DATE UPDATED    2022-01-01T00:00:00+00:00
LABEL           nodepool
TAG             foo
PLAN            vc2-1c-2gb
STATUS          pending
NODE QUANTITY   1
AUTO SCALER     false
MIN NODES       1
MAX NODES       1
 
NODES
ID                                      DATE CREATED                    LABEL                   STATUS
12345678-
</code></pre><p>Until that&rsquo;s available, I&rsquo;m lazy writing <strong>very simple</strong> bash scripts to parse <code>vultr-cli</code> command output as JSON. The repo is <a href="https://github.com/DazWilkin/vultr-cli-format"><code>vultr-cli-format</code></a>.</p>
    </div>
    <a href="/posts/220602/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220520/" class="link black dim">
        Prometheus Exporters for fly.io and Vultr
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been on a roll building utilities this week. I developed a Service Health dashboard for my &ldquo;thing&rdquo;, a <a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a> and today, a <a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a>. This is motivated by the fear that I will forget a deployed Cloud resource and incur a horrible bill.</p>
<p>I&rsquo;ve no written several Prometheus Exporters for cloud platforms:</p>
<ul>
<li><a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for GCP</a></li>
<li><a href="https://github.com/DazWilkin/linode-exporter">Prometheus Exporter for Linode</a></li>
<li><a href="https://github.com/DazWilkin/fly-exporter">Prometheus Exporter for Fly.io</a></li>
<li><a href="https://github.com/DazWilkin/vultr-exporter">Prometheus Exporter for Vultr</a></li>
</ul>
<p>Each of them monitors resource deployments and produces resource count metrics that can be scraped by Prometheus and alerted with Alertmanager. I have Alertmanager <a href="https://prometheus.io/docs/alerting/latest/configuration/#pushover_config">configured</a> to send notifications to <a href="https://pushover.net">Pushover</a>. Last week I wrote an integration between <a href="/posts/220514/">Google Cloud Monitoring to send notifications to Pushover</a> too.</p>
    </div>
    <a href="/posts/220520/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cli/" class="link blue hover-black">
            Tag: Cli
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220602/" class="link black dim">
        Vultr CLI and JSON output
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve begun exploring <a href="https://vultr.com">Vultr</a> after the company announced a managed Kubernetes offering <a href="https://www.vultr.com/kubernetes/">Vultr Kubernetes Engine (VKE)</a>.</p>
<p>In my brief experience, it&rsquo;s a decent platform and its CLI <a href="https://github.com/vultr/vultr-cli"><code>vultr-cli</code></a> is mostly (!) good. The CLI has a limitation in that command output is text formatted and this makes it challenging to parse the output when scripting.</p>
<blockquote>
<p><strong>NOTE</strong> The Vultr developers have a branch <a href="https://github.com/vultr/vultr-cli/tree/rewrite"><code>rewrite</code></a> that includes a solution to this problem.</p></blockquote>
<p>Example</p>
<pre tabindex="0"><code>ID              12345678-90ab-cdef-1234-567890abcdef
LABEL           test
DATE CREATED    2022-01-01T00:00:00+00:00
CLUSTER SUBNET  255.255.255.255/16
SERVICE SUBNET  255.255.255.255/12
IP              255.255.255.255
ENDPOINT        12345678-90ab-cdef-1234-567890abcdef.vultr-k8s.com
VERSION         v1.23.5+3
REGION          mars
STATUS          pending
 
NODE POOLS
ID              12345678-90ab-cdef-1234-567890abcdef
DATE CREATED    2022-01-01T00:00:00+00:00
DATE UPDATED    2022-01-01T00:00:00+00:00
LABEL           nodepool
TAG             foo
PLAN            vc2-1c-2gb
STATUS          pending
NODE QUANTITY   1
AUTO SCALER     false
MIN NODES       1
MAX NODES       1
 
NODES
ID                                      DATE CREATED                    LABEL                   STATUS
12345678-
</code></pre><p>Until that&rsquo;s available, I&rsquo;m lazy writing <strong>very simple</strong> bash scripts to parse <code>vultr-cli</code> command output as JSON. The repo is <a href="https://github.com/DazWilkin/vultr-cli-format"><code>vultr-cli-format</code></a>.</p>
    </div>
    <a href="/posts/220602/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/api/" class="link blue hover-black">
            Tag: Api
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220524/" class="link black dim">
        Automating HackMD documents
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was introduced to <a href="https://hackmd.io">HackMD</a> while working on an open-source project. It&rsquo;s a collaborative editing tool for Markdown documents <strong>and there&rsquo;s an <a href="https://hackmd.io/@hackmd-api/developer-portal">API</a></strong></p>
<p>I wanted to be able to programmatically edit one of my documents with a daily update. The <a href="https://hackmd.io/@hackmd-api/developer-portal">API</a> is easy-to-use and my only challenge was futzing with escape characters in bash strips representing the document Markdown content.</p>
<p>You&rsquo;ll need an account with HackMD and an to <a href="https://hackmd.io/settings#api">Create API Token</a> that I&rsquo;ll refer to as <code>TOKEN</code>.</p>
    </div>
    <a href="/posts/220524/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/hackmd/" class="link blue hover-black">
            Tag: Hackmd
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220524/" class="link black dim">
        Automating HackMD documents
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was introduced to <a href="https://hackmd.io">HackMD</a> while working on an open-source project. It&rsquo;s a collaborative editing tool for Markdown documents <strong>and there&rsquo;s an <a href="https://hackmd.io/@hackmd-api/developer-portal">API</a></strong></p>
<p>I wanted to be able to programmatically edit one of my documents with a daily update. The <a href="https://hackmd.io/@hackmd-api/developer-portal">API</a> is easy-to-use and my only challenge was futzing with escape characters in bash strips representing the document Markdown content.</p>
<p>You&rsquo;ll need an account with HackMD and an to <a href="https://hackmd.io/settings#api">Create API Token</a> that I&rsquo;ll refer to as <code>TOKEN</code>.</p>
    </div>
    <a href="/posts/220524/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/markdown/" class="link blue hover-black">
            Tag: Markdown
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220524/" class="link black dim">
        Automating HackMD documents
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was introduced to <a href="https://hackmd.io">HackMD</a> while working on an open-source project. It&rsquo;s a collaborative editing tool for Markdown documents <strong>and there&rsquo;s an <a href="https://hackmd.io/@hackmd-api/developer-portal">API</a></strong></p>
<p>I wanted to be able to programmatically edit one of my documents with a daily update. The <a href="https://hackmd.io/@hackmd-api/developer-portal">API</a> is easy-to-use and my only challenge was futzing with escape characters in bash strips representing the document Markdown content.</p>
<p>You&rsquo;ll need an account with HackMD and an to <a href="https://hackmd.io/settings#api">Create API Token</a> that I&rsquo;ll refer to as <code>TOKEN</code>.</p>
    </div>
    <a href="/posts/220524/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/pushover/" class="link blue hover-black">
            Tag: Pushover
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220514/" class="link black dim">
        Using Google Monitoring Alerting to send Pushover notifications
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#artifacts">Artifacts</a></li>
<li><a href="#pushover">Pushover</a></li>
<li><a href="#caveat"><strong>Caveat</strong></a></li>
<li><a href="#cloud-monitoring-webhook">Cloud Monitoring Webhook</a></li>
<li><a href="#cloud-functions-2nd-gen">Cloud Functions</a></li>
<li><a href="#cloud-run">Cloud Run</a></li>
</ul>
<h2 id="artifacts">Artifacts</h2>
<ul>
<li>GitHub: <a href="https://github.com/DazWilkin/go-gcp-pushover-notificationchannel"><code>go-gcp-pushover-notificationchannel</code></a></li>
<li>Image: <code>ghcr.io/dazwilkin/go-gcp-pushover-notificationchannel:220515</code></li>
</ul>
<h2 id="pushover">Pushover</h2>
<p>Logging in to your <a href="https://pushover.net">Pushover</a> account, you will be presented with a summary|dashboard page that includes <code>Your User Key</code>. Copy the value of this key into a variable called <code>PUSHOVER_USER</code></p>
<p><a href="https://pushover.net/apps/build">Create New Application|API Token</a></p>
<p><img src="/images/220514.pushover.app.png" alt="Pushover: New API Token"></p>
<p>Pushover <a href="https://pushover.net/api">API</a> has a <a href="https://pushover.net/api#messages">Pushing Messages</a> method. The documentation describes the format of the HTTP Request. It must be a <code>POST</code> using TLS (<code>https://</code>) to <code>https://api.pushover.net/1/messages.json</code>. The <code>content-type</code> should be <code>application/json</code>. In the JSON body of the message, we must include <code>token</code> (<code>PUSHOVER_TOKEN</code>), <code>user</code> (<code>PUSHOVER_USER_KEY</code>), <code>device</code> (we&rsquo;ll use <code>cloud-monitoring</code>) and a <code>title</code> and a <code>message</code></p>
    </div>
    <a href="/posts/220514/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/dns/" class="link blue hover-black">
            Tag: Dns
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220506/" class="link black dim">
        Cloud Run custom domain mappings
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I have several Cloud Run services that I want to map to a domain.</p>
<p>During development, I create a Google Cloud Platform (GCP) project each day into which everything is deployed. This means that, every day, the Cloud Run services have newly non-inferable (to me) URLs. I thought this would be tedious to manage because:</p>
<ol>
<li>My DNS service isn&rsquo;t programmable (I know!)</li>
<li>Cloud Run services have non-inferable (by me) URLs</li>
</ol>
<p>i.e. I thought I&rsquo;d have to manually update the DNS entries each day.</p>
    </div>
    <a href="/posts/220506/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cloud-scheduler/" class="link blue hover-black">
            Tag: Cloud-Scheduler
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220503/" class="link black dim">
        Automating Scheduled Firestore Exports
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For my &ldquo;thing&rdquo;, I use <a href="https://cloud.google.com/firestore">Firestore</a> to persist state. I like Firestore a lot and, having been around Google for almost (!) a decade, I much prefer it to Datastore.</p>
<p>Firestore has a <a href="https://firebase.google.com/docs/firestore/manage-data/export-import">managed export|import service</a> and I use this to backup Firestore collections|documents.</p>
<p>I&rsquo;d been doing backups manually (using <code>gcloud</code>) and decided today to take the plunge and use <a href="https://cloud.google.com/scheduler">Cloud Scheduler</a> for the first time. I&rsquo;d been reluctant to do this until now because I&rsquo;d assumed <strong>incorrectly</strong> that I&rsquo;d need to write a wrapping service to invoke the export.</p>
    </div>
    <a href="/posts/220503/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/ghcr/" class="link blue hover-black">
            Tag: Ghcr
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220422/" class="link black dim">
        Playing with GitHub Container Registry REST API
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve a day to catch up on blogging. I&rsquo;m building a &ldquo;thing&rdquo; and getting this near to the finish line consumes my time and has meant that I&rsquo;m not originating anything particularly new. However, there are a couple of tricks in my deployment process that may be of interest to others.</p>
<p>I&rsquo;ve been a long-term using of Google&rsquo;s [Cloud Build] and like the simplicity (everything&rsquo;s a container, alot!). Because I&rsquo;m using GitHub repos, I&rsquo;ve been using GitHub Actions to (re)build containers on pushes and GitHub Container registry (GHCR) to store the results. I know that Google provides analogs for GitHub repos and (forces me to use) Artifact Registry (to deploy my Cloud Run services) <strong>but</strong> even though I dislike GitHub Actions, it&rsquo;s really easy to do everything in one place.</p>
    </div>
    <a href="/posts/220422/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211007/" class="link black dim">
        Sigstore
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been on a digression (<a href="https://github.com/DazWilkin/gcp-oidc-token-proxy"><code>gcp-oidc-token-proxy</code></a>) this week. Yesterday I began exploring <a href="https://podman.io">Podman</a> and <a href="/posts/211006/">wrote</a> briefly about running <code>gcp-oidc-token-proxy</code> on my localhost using it.</p>
<p>This morning while walking with my dog, I <a href="https://www.heavybit.com/library/podcasts/the-kubelist-podcast/ep-20-sigstore-with-dan-lorenc-of-google/">listened</a> to Google&rsquo;s Dan Lorenc explain <a href="https://www.sigstore.dev/">Sigstore</a> (blog](<a href="https://blog.sigstore.dev/">https://blog.sigstore.dev/</a>)) on <a href="https://kubelist.com/podcast/">The Kubelist Podcast</a><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<p>The plan today is to try to sign the <code>gcp-oidc-token-proxy</code> container <a href="https://github.com/DazWilkin/gcp-oidc-token-proxy/pkgs/container/gcp-oidc-token-proxy">images</a> in GitHub Container Registry.</p>
<blockquote>
<p><strong>NOTE</strong> I decided against trying the hardware key approach. I have a Google Titan key and only Yubikeys are <a href="https://github.com/go-piv/piv-go#non-yubikey-smartcards">well-tested</a> by <a href="https://github.com/go-piv/piv-go"><code>go-piv</code></a></p>
    </div>
    <a href="/posts/211007/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201029/" class="link black dim">
        GitHub Actions &amp;&amp; GitHub Container Registry
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>You know when you start something and then regret it!? I think I&rsquo;ll be sticking with <a href="https://cloud.google.com/cloud-build">Google Cloud Build</a>; <a href="https://github.com/features/actions">GitHub Actions</a> appears functional and useful but I found the documentation to be confusing and limited and struggled to get a simple container image build|push working.</p>
<p>I&rsquo;ve long used <a href="https://hub.docker.com">Docker Hub</a> but am planning to use it less as a result of the planned <a href="https://www.docker.com/blog/scaling-docker-to-serve-millions-more-developers-network-egress/">changes</a>. I want to see Docker succeed and to do so it needs to find a way to make money but, there are free alternatives including the new <a href="https://github.blog/2020-09-01-introducing-github-container-registry/">GitHub Container Registry</a> and the very very cheap <a href="https://cloud.google.com/container-registry">Google Container Registry</a>.</p>
    </div>
    <a href="/posts/201029/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/sigstore/" class="link blue hover-black">
            Tag: Sigstore
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220422/" class="link black dim">
        Playing with GitHub Container Registry REST API
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve a day to catch up on blogging. I&rsquo;m building a &ldquo;thing&rdquo; and getting this near to the finish line consumes my time and has meant that I&rsquo;m not originating anything particularly new. However, there are a couple of tricks in my deployment process that may be of interest to others.</p>
<p>I&rsquo;ve been a long-term using of Google&rsquo;s [Cloud Build] and like the simplicity (everything&rsquo;s a container, alot!). Because I&rsquo;m using GitHub repos, I&rsquo;ve been using GitHub Actions to (re)build containers on pushes and GitHub Container registry (GHCR) to store the results. I know that Google provides analogs for GitHub repos and (forces me to use) Artifact Registry (to deploy my Cloud Run services) <strong>but</strong> even though I dislike GitHub Actions, it&rsquo;s really easy to do everything in one place.</p>
    </div>
    <a href="/posts/220422/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211007/" class="link black dim">
        Sigstore
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been on a digression (<a href="https://github.com/DazWilkin/gcp-oidc-token-proxy"><code>gcp-oidc-token-proxy</code></a>) this week. Yesterday I began exploring <a href="https://podman.io">Podman</a> and <a href="/posts/211006/">wrote</a> briefly about running <code>gcp-oidc-token-proxy</code> on my localhost using it.</p>
<p>This morning while walking with my dog, I <a href="https://www.heavybit.com/library/podcasts/the-kubelist-podcast/ep-20-sigstore-with-dan-lorenc-of-google/">listened</a> to Google&rsquo;s Dan Lorenc explain <a href="https://www.sigstore.dev/">Sigstore</a> (blog](<a href="https://blog.sigstore.dev/">https://blog.sigstore.dev/</a>)) on <a href="https://kubelist.com/podcast/">The Kubelist Podcast</a><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<p>The plan today is to try to sign the <code>gcp-oidc-token-proxy</code> container <a href="https://github.com/DazWilkin/gcp-oidc-token-proxy/pkgs/container/gcp-oidc-token-proxy">images</a> in GitHub Container Registry.</p>
<blockquote>
<p><strong>NOTE</strong> I decided against trying the hardware key approach. I have a Google Titan key and only Yubikeys are <a href="https://github.com/go-piv/piv-go#non-yubikey-smartcards">well-tested</a> by <a href="https://github.com/go-piv/piv-go"><code>go-piv</code></a></p>
    </div>
    <a href="/posts/211007/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/acme/" class="link blue hover-black">
            Tag: Acme
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220421/" class="link black dim">
        Using Google&#39;s Public Certificate Authority with Golang autocert
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Last year, I wrote about using <a href="/posts/211130/">Automatic Certs w/ Golang gRPC service on Compute Engine</a>. That solution uses <a href="https://en.wikipedia.org/wiki/Automatic_Certificate_Management_Environment">ACME</a> with (the wonderful) <a href="https://letsencrypt.org">Let&rsquo;s Encrypt</a>. Google is offering a private preview of <a href="https://cloud.google.com/blog/products/identity-security/automate-public-certificate-lifecycle-management-via--acme-client-api">Automate Public Certificates Lifecycle Management via RFC 8555 (ACME)</a> and, because I&rsquo;m using Google Cloud Platform extensively to build a &ldquo;thing&rdquo; and I think it would be useful to have a backup to Let&rsquo;s Encrypt, I thought I&rsquo;d give the solution a try. You&rsquo;ll need to sign-up for the private preview, for what follows to work.</p>
    </div>
    <a href="/posts/220421/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211130/" class="link black dim">
        Automatic Certs w/ Golang gRPC service on Compute Engine
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I needed to deploy a <a href="https://github.com/grpc/grpc/blob/master/src/proto/grpc/health/v1/health.proto">healthcheck</a>-enabled gRPC TLS-enabled service. Fortunately, most (all?) of the SDKs include an implementation, e.g. Golang has <a href="https://github.com/grpc/grpc-go/tree/master/health"><code>grpc-go/health</code></a>.</p>
<p>I learned in my travels that:</p>
<ul>
<li>DigitalOcean [App] platform does not (<a href="https://www.digitalocean.com/community/questions/app-platform-http-2-support">link</a>) work with TLS-based gRPC apps.</li>
<li><a href="https://fly.io">Fly</a> has a regression (<a href="https://community.fly.io/t/urgent-grpc-server-unreachable-via-grpcurl/2694/5">link</a>) that breaks gRPC</li>
</ul>
<p>So, I resorted to Google Cloud Platform (GCP). Although Cloud Run would be well-suited to running the gRPC app, it uses a proxy|sidecar to provision a cert for the app and I wanted to be able to (easily use a custom domain) and give myself a somewhat general-purpose solution.</p>
    </div>
    <a href="/posts/211130/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/compute-engine/" class="link blue hover-black">
            Tag: Compute-Engine
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220421/" class="link black dim">
        Using Google&#39;s Public Certificate Authority with Golang autocert
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Last year, I wrote about using <a href="/posts/211130/">Automatic Certs w/ Golang gRPC service on Compute Engine</a>. That solution uses <a href="https://en.wikipedia.org/wiki/Automatic_Certificate_Management_Environment">ACME</a> with (the wonderful) <a href="https://letsencrypt.org">Let&rsquo;s Encrypt</a>. Google is offering a private preview of <a href="https://cloud.google.com/blog/products/identity-security/automate-public-certificate-lifecycle-management-via--acme-client-api">Automate Public Certificates Lifecycle Management via RFC 8555 (ACME)</a> and, because I&rsquo;m using Google Cloud Platform extensively to build a &ldquo;thing&rdquo; and I think it would be useful to have a backup to Let&rsquo;s Encrypt, I thought I&rsquo;d give the solution a try. You&rsquo;ll need to sign-up for the private preview, for what follows to work.</p>
    </div>
    <a href="/posts/220421/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211130/" class="link black dim">
        Automatic Certs w/ Golang gRPC service on Compute Engine
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I needed to deploy a <a href="https://github.com/grpc/grpc/blob/master/src/proto/grpc/health/v1/health.proto">healthcheck</a>-enabled gRPC TLS-enabled service. Fortunately, most (all?) of the SDKs include an implementation, e.g. Golang has <a href="https://github.com/grpc/grpc-go/tree/master/health"><code>grpc-go/health</code></a>.</p>
<p>I learned in my travels that:</p>
<ul>
<li>DigitalOcean [App] platform does not (<a href="https://www.digitalocean.com/community/questions/app-platform-http-2-support">link</a>) work with TLS-based gRPC apps.</li>
<li><a href="https://fly.io">Fly</a> has a regression (<a href="https://community.fly.io/t/urgent-grpc-server-unreachable-via-grpcurl/2694/5">link</a>) that breaks gRPC</li>
</ul>
<p>So, I resorted to Google Cloud Platform (GCP). Although Cloud Run would be well-suited to running the gRPC app, it uses a proxy|sidecar to provision a cert for the app and I wanted to be able to (easily use a custom domain) and give myself a somewhat general-purpose solution.</p>
    </div>
    <a href="/posts/211130/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201113/" class="link black dim">
        Akri
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For the past couple of weeks, I&rsquo;ve been playing around with <a href="http://github.com/deislabs/akri">Akri</a>, a Microsoft (DeisLabs) project for <a href="https://cloudblogs.microsoft.com/opensource/2020/10/20/announcing-akri-open-source-project-building-connected-edge-kubernetes/">building a connected edge with Kubernetes</a>. Kubernetes, IoT, Rust (and Golang) make this all compelling to me.</p>
<p>Initially, I deployed an Akri <a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo.md">End-to-End</a> to <a href="https://microk8s.io/">MicroK8s</a> on Google Compute Engine (<a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo-gce.md">link</a>) and Digital Ocean (<a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo-do.md">link</a>). But I was interested to create me own example and so have proposed a very (!) simple <a href="https://github.com/DazWilkin/akri/blob/protocol-http/docs/extensibility-http.md">HTTP-based protocol</a>.</p>
<p>This blog summarizes my thoughts about Akri and an explanation of the HTTP protocol implementation in the hope that this helps others.</p>
    </div>
    <a href="/posts/201113/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201022/" class="link black dim">
        akri
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was very interested to read about Microsoft&rsquo;s DeisLab&rsquo;s latest (rust-based) Kubernetes project: <a href="https://cloudblogs.microsoft.com/opensource/2020/10/20/announcing-akri-open-source-project-building-connected-edge-kubernetes/">akri</a>. If I understand it correctly, it provides a mechanism to make any (IoT) device accessible to containers running within a cluster. I need to spend more time playing around with it so that I can fully understand it. I had some problems getting the <a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo.md">End-to-End</a> demo running on Google Compute Engine (and then I tried DigitalOcean droplet) instances. So, here&rsquo;s a two-ways solution to get you going.</p>
    </div>
    <a href="/posts/201022/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200122/" class="link black dim">
        Setting up a GCE Instance as an Inlets Exit Node
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The prolific <a href="https://blog.alexellis.io/">Alex Ellis</a> has a new project, <a href="https://github.com/inlets/inlets">Inlets</a>.</p>
<p>Here&rsquo;s a quick tutorial using <a href="https://cloud.google.com/">Google Compute Platform&rsquo;s (GCP)</a> <a href="https://cloud.google.com/compute/">Compute Engine (GCE)</a>.</p>
<p><strong>NB</strong> I&rsquo;m using one of Google&rsquo;s <a href="https://cloud.google.com/free/">&ldquo;Always free&rdquo;</a> f1-micro instances <strong>but</strong> you may still pay for network *gress and storage</p>
<h2 id="assumptions">Assumptions</h2>
<p>I&rsquo;m assuming you&rsquo;ve a Google account, have used GCP and have a billing account established, i.e. the following returns at least one billing account:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud beta billing accounts list
</span></span></code></pre></div><p>If you&rsquo;ve only one billing account and it&rsquo;s the one you wish to use, then you can:</p>
    </div>
    <a href="/posts/200122/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191220/" class="link black dim">
        Google Cloud Platform (GCP) Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Earlier this week I discussed a <a href="/posts/191218/">Linode Prometheus Exporter</a>.</p>
<p>I <a href="https://github.com/metalmatze/digitalocean_exporter/pull/5">added</a> metrics for <a href="https://www.digitalocean.com/products/kubernetes/">Digital Ocean&rsquo;s Managed Kubernetes service</a> to <a href="https://github.com/metalmatze">@metalmatze</a>&rsquo;s <a href="https://github.com/metalmatze/digitalocean_exporter">Digital Ocean Exporter</a>.</p>
<p>This left, metrics for <a href="https://cloud.google.com">Google Cloud Platform (GCP)</a> which has, for many years, been my primary cloud platform. So, today I wrote <a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud Platform</a>.</p>
<p>All 3 of these exporters follow the template laid down by @metalmatze and, because each of these services has a well-written Golang SDK, it&rsquo;s straightforward to implement an exporter for each of them.</p>
    </div>
    <a href="/posts/191220/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/service-discovery/" class="link blue hover-black">
            Tag: Service-Discovery
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/220225/" class="link black dim">
        Prometheus HTTP Service Discovery of Cloud Run services
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Some time ago, I wrote about using <a href="https://pretired.dazwilkin.com/posts/210419/">Prometheus Service Discovery w/ Consul for Cloud Run</a> and also <a href="https://pretired.dazwilkin.com/posts/211005/">Scraping metrics exposed by Google Cloud Run services that require authentication</a>. Both solutions remain viable but they didn&rsquo;t address another use case for Prometheus and Cloud Run services that I have with a &ldquo;thing&rdquo; that I&rsquo;ve been building.</p>
<p>In this scenario, I want to:</p>
<ol>
<li>Configure Prometheus to scrape Cloud Run service metrics</li>
<li>Discover Cloud Run services dynamically</li>
<li>Authenticate to Cloud Run using Firebase Auth ID tokens</li>
</ol>
<p>These requirements and &ndash; one other &ndash; present several challenges:</p>
    </div>
    <a href="/posts/220225/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210520/" class="link black dim">
        Consul discovers Google Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a basic <code>discoverer</code> of Google <a href="https://cloud.google.com/run">Cloud Run</a> services. This is for a project and it extends work done in some previous posts to <a href="/posts/210519/">Multiplex gRPC and Prometheus with Cloud Run</a> and to use <a href="/posts/210419/">Consul for Prometheus service discovery</a>.</p>
<p>This solution:</p>
<ul>
<li>Accepts a set of Google Cloud Platform (GCP) projects</li>
<li>Trawls them for Cloud Run services</li>
<li>Assumes that the services expose Prometheus metrics on <code>:443/metrics</code></li>
<li>Relabels the services</li>
<li>Surfaces any discovered Cloud Run services&rsquo; metrics in Prometheus</li>
</ul>
<p>You&rsquo;ll need Docker and Docker Compose.</p>
    </div>
    <a href="/posts/210520/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210419/" class="link black dim">
        Prometheus Service Discovery w/ Consul for Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m working on a project that will programmatically create Google <a href="https://cloud.google.com/run">Cloud Run</a> services and I want to be able to dynamically discover these services using Prometheus.</p>
<p>This is one solution.</p>
<blockquote>
<p><strong>NOTE</strong> Google Cloud Run is the service I&rsquo;m using, but the principle described herein applies to any runtime service that you&rsquo;d wish to use.</p></blockquote>
<p>Why is this challenging? IIUC, it&rsquo;s primarily because Prometheus has a limited set of plugins for service discovery, see the sections that include <code>_sd_</code> in Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/">Configuration</a> documentation. Unfortunately, Cloud Run is not explicitly supported. The alternative appears to be to use file-based discovery but this seems &lsquo;challenging&rsquo;; it requires, for example, reloading Prometheus on file changes.</p>
    </div>
    <a href="/posts/210419/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/lets-encrypt/" class="link blue hover-black">
            Tag: Lets-Encrypt
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211130/" class="link black dim">
        Automatic Certs w/ Golang gRPC service on Compute Engine
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I needed to deploy a <a href="https://github.com/grpc/grpc/blob/master/src/proto/grpc/health/v1/health.proto">healthcheck</a>-enabled gRPC TLS-enabled service. Fortunately, most (all?) of the SDKs include an implementation, e.g. Golang has <a href="https://github.com/grpc/grpc-go/tree/master/health"><code>grpc-go/health</code></a>.</p>
<p>I learned in my travels that:</p>
<ul>
<li>DigitalOcean [App] platform does not (<a href="https://www.digitalocean.com/community/questions/app-platform-http-2-support">link</a>) work with TLS-based gRPC apps.</li>
<li><a href="https://fly.io">Fly</a> has a regression (<a href="https://community.fly.io/t/urgent-grpc-server-unreachable-via-grpcurl/2694/5">link</a>) that breaks gRPC</li>
</ul>
<p>So, I resorted to Google Cloud Platform (GCP). Although Cloud Run would be well-suited to running the gRPC app, it uses a proxy|sidecar to provision a cert for the app and I wanted to be able to (easily use a custom domain) and give myself a somewhat general-purpose solution.</p>
    </div>
    <a href="/posts/211130/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/firebase-auth/" class="link blue hover-black">
            Tag: Firebase-Auth
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211026/" class="link black dim">
        Firebase Auth authorized domains
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using Firebase Authentication in a project to authenticate users of various OAuth2 identity systems. Firebase Authentication requires a set of Authorized Domains.</p>
<p>The (web) app that interacts with Firebase Authentication is deployed to Cloud Run.  The Authorized Domains list must include the app&rsquo;s Cloud Run service URL.</p>
<p>Cloud Run service URLs vary by Project (ID). They are a combination of the service name, a hash (?) of the Project (ID) and <code>.a.run.app</code>.</p>
    </div>
    <a href="/posts/211026/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/gcloud/" class="link blue hover-black">
            Tag: Gcloud
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211022/" class="link black dim">
        Using `gcloud ... --format` with arbitrary returned data
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>If you use <a href="https://stedolan.github.io/jq/"><code>jq</code></a>, you&rsquo;ll know that, its <a href="https://stedolan.github.io/jq/manual/">documentation</a> uses examples that you can try locally or using the excellent <a href="https://jqplay.org"><code>jqplay</code></a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>printf <span style="color:#e6db74">&#34;[1,2,3]&#34;</span> | jq .<span style="color:#f92672">[</span>1:<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>  2,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>And <a href="https://jqplay.org/s/L_n_bO9Ans">here</a></p>
<p>If you use Google Cloud Platform (GCP) CLI, <a href="https://cloud.google.com/sdk/gcloud"><code>gcloud</code></a>, this powerful tool includes JSON output formatting of results (<code>--format=json</code>) and YAML (<code>--format=yaml</code>) etc. and includes a set of so-called <a href="https://cloud.google.com/sdk/gcloud">projections</a> that you can use to format the returned data.</p>
<p>There is a comparable <a href="https://cloud.google.com/sdk/gcloud/reference/topic/projections#slice"><code>slice</code></a> projection that you may use with <code>gcloud</code> and the documentation even includes an example:</p>
    </div>
    <a href="/posts/211022/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/go-logr/" class="link blue hover-black">
            Tag: Go-Logr
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211018/" class="link black dim">
        Golang Structured Logging w/ Google Cloud Logging (2)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>UPDATE</strong> There&rsquo;s an issue with my naive implementation of <code>RenderValuesHook</code> as described in this post. I summarized the problem in this <a href="https://github.com/go-logr/logr/issues/120">issue</a> where I&rsquo;ve outlined (hopefully) a more robust solution.</p></blockquote>
<p>Recently, I <a href="/posts/210928/">described</a> how to configure Golang logging so that user-defined key-values applied to the logs are parsed when ingested by <a href="https://cloud.google.com/logging">Google Cloud Logging</a>.</p>
<p>Here&rsquo;s an example of what we&rsquo;re trying to achieve. This is an example Cloud Logging log entry that incorporates user-defined labels (see <code>dog:freddie</code> and <code>foo:bar</code>) and a readily-querable <code>jsonPayload</code>:</p>
    </div>
    <a href="/posts/211018/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/logr/" class="link blue hover-black">
            Tag: Logr
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211018/" class="link black dim">
        Golang Structured Logging w/ Google Cloud Logging (2)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>UPDATE</strong> There&rsquo;s an issue with my naive implementation of <code>RenderValuesHook</code> as described in this post. I summarized the problem in this <a href="https://github.com/go-logr/logr/issues/120">issue</a> where I&rsquo;ve outlined (hopefully) a more robust solution.</p></blockquote>
<p>Recently, I <a href="/posts/210928/">described</a> how to configure Golang logging so that user-defined key-values applied to the logs are parsed when ingested by <a href="https://cloud.google.com/logging">Google Cloud Logging</a>.</p>
<p>Here&rsquo;s an example of what we&rsquo;re trying to achieve. This is an example Cloud Logging log entry that incorporates user-defined labels (see <code>dog:freddie</code> and <code>foo:bar</code>) and a readily-querable <code>jsonPayload</code>:</p>
    </div>
    <a href="/posts/211018/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210928/" class="link black dim">
        Golang Structured Logging w/ Google Cloud Logging
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve multiple components in an app and these are deployed across multiple Google Cloud Platform (GCP) services: Kubernetes Engine, Cloud Functions, Cloud Run, etc. Almost everything is written in Golang and I started the project using <a href="https://github.com/go-logr/logr"><code>go-logr</code></a>.</p>
<p><code>logr</code> is in two parts: a <code>Logger</code> that you use to write log entries; a <code>LogSink</code> (adaptor) that consumes log entries and outputs them to a specific log implementation.</p>
<p>Initially, I defaulted to using <code>stdr</code> which is a <code>LogSink</code> for Go&rsquo;s standard logging implementation. Something similar to the module&rsquo;s <a href="https://github.com/go-logr/stdr/blob/master/example/main.go">example</a>:</p>
    </div>
    <a href="/posts/210928/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/oauth/" class="link blue hover-black">
            Tag: Oauth
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211005/" class="link black dim">
        Scraping metrics exposed by Google Cloud Run services that require authentication
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a solution (<a href="https://github.com/DazWilkin/gcp-oidc-token-proxy"><code>gcp-oidc-token-proxy</code></a>) that can be used in conjunction with Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#oauth2">OAuth2</a> to authenticate requests so that Prometheus can scrape metrics exposed by e.g. Cloud Run services that require authentication. The solution resulted from my <a href="https://stackoverflow.com/questions/69411584/is-there-a-way-to-configure-prometheus-to-use-a-google-service-account-to-auth">question</a> on Stack overflow.</p>
<p>Problem #1: Endpoint requires authentication</p>
<p>Given a Cloud Run service URL for which:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;my-server-blahblah-wl.a.run.app&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Returns 200 when authentication w/ an ID token</span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>gcloud auth print-identity-token<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request GET <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--write-out <span style="color:#e6db74">&#34;%{response_code}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output /dev/null <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span>/metrics
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Returns 403 otherwise</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request GET <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--write-out <span style="color:#e6db74">&#34;%{response_code}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output /dev/null <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span>/metrics
</span></span></code></pre></div><p>Problem #2: Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#oauth2">OAuth2</a> configuration is constrained</p>
    </div>
    <a href="/posts/211005/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/oauth2/" class="link blue hover-black">
            Tag: Oauth2
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211005/" class="link black dim">
        Scraping metrics exposed by Google Cloud Run services that require authentication
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a solution (<a href="https://github.com/DazWilkin/gcp-oidc-token-proxy"><code>gcp-oidc-token-proxy</code></a>) that can be used in conjunction with Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#oauth2">OAuth2</a> to authenticate requests so that Prometheus can scrape metrics exposed by e.g. Cloud Run services that require authentication. The solution resulted from my <a href="https://stackoverflow.com/questions/69411584/is-there-a-way-to-configure-prometheus-to-use-a-google-service-account-to-auth">question</a> on Stack overflow.</p>
<p>Problem #1: Endpoint requires authentication</p>
<p>Given a Cloud Run service URL for which:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;my-server-blahblah-wl.a.run.app&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Returns 200 when authentication w/ an ID token</span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>gcloud auth print-identity-token<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request GET <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--write-out <span style="color:#e6db74">&#34;%{response_code}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output /dev/null <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span>/metrics
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Returns 403 otherwise</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request GET <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--write-out <span style="color:#e6db74">&#34;%{response_code}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output /dev/null <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span>/metrics
</span></span></code></pre></div><p>Problem #2: Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#oauth2">OAuth2</a> configuration is constrained</p>
    </div>
    <a href="/posts/211005/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/oidc/" class="link blue hover-black">
            Tag: Oidc
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211005/" class="link black dim">
        Scraping metrics exposed by Google Cloud Run services that require authentication
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a solution (<a href="https://github.com/DazWilkin/gcp-oidc-token-proxy"><code>gcp-oidc-token-proxy</code></a>) that can be used in conjunction with Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#oauth2">OAuth2</a> to authenticate requests so that Prometheus can scrape metrics exposed by e.g. Cloud Run services that require authentication. The solution resulted from my <a href="https://stackoverflow.com/questions/69411584/is-there-a-way-to-configure-prometheus-to-use-a-google-service-account-to-auth">question</a> on Stack overflow.</p>
<p>Problem #1: Endpoint requires authentication</p>
<p>Given a Cloud Run service URL for which:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;my-server-blahblah-wl.a.run.app&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Returns 200 when authentication w/ an ID token</span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>gcloud auth print-identity-token<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request GET <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--write-out <span style="color:#e6db74">&#34;%{response_code}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output /dev/null <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span>/metrics
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Returns 403 otherwise</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request GET <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--write-out <span style="color:#e6db74">&#34;%{response_code}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output /dev/null <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span>/metrics
</span></span></code></pre></div><p>Problem #2: Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#oauth2">OAuth2</a> configuration is constrained</p>
    </div>
    <a href="/posts/211005/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/token/" class="link blue hover-black">
            Tag: Token
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/211005/" class="link black dim">
        Scraping metrics exposed by Google Cloud Run services that require authentication
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a solution (<a href="https://github.com/DazWilkin/gcp-oidc-token-proxy"><code>gcp-oidc-token-proxy</code></a>) that can be used in conjunction with Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#oauth2">OAuth2</a> to authenticate requests so that Prometheus can scrape metrics exposed by e.g. Cloud Run services that require authentication. The solution resulted from my <a href="https://stackoverflow.com/questions/69411584/is-there-a-way-to-configure-prometheus-to-use-a-google-service-account-to-auth">question</a> on Stack overflow.</p>
<p>Problem #1: Endpoint requires authentication</p>
<p>Given a Cloud Run service URL for which:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;my-server-blahblah-wl.a.run.app&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Returns 200 when authentication w/ an ID token</span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>gcloud auth print-identity-token<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request GET <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--write-out <span style="color:#e6db74">&#34;%{response_code}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output /dev/null <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span>/metrics
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Returns 403 otherwise</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request GET <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--write-out <span style="color:#e6db74">&#34;%{response_code}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--output /dev/null <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span>/metrics
</span></span></code></pre></div><p>Problem #2: Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#oauth2">OAuth2</a> configuration is constrained</p>
    </div>
    <a href="/posts/211005/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/zerolog/" class="link blue hover-black">
            Tag: Zerolog
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210928/" class="link black dim">
        Golang Structured Logging w/ Google Cloud Logging
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve multiple components in an app and these are deployed across multiple Google Cloud Platform (GCP) services: Kubernetes Engine, Cloud Functions, Cloud Run, etc. Almost everything is written in Golang and I started the project using <a href="https://github.com/go-logr/logr"><code>go-logr</code></a>.</p>
<p><code>logr</code> is in two parts: a <code>Logger</code> that you use to write log entries; a <code>LogSink</code> (adaptor) that consumes log entries and outputs them to a specific log implementation.</p>
<p>Initially, I defaulted to using <code>stdr</code> which is a <code>LogSink</code> for Go&rsquo;s standard logging implementation. Something similar to the module&rsquo;s <a href="https://github.com/go-logr/stdr/blob/master/example/main.go">example</a>:</p>
    </div>
    <a href="/posts/210928/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/dependabot/" class="link blue hover-black">
            Tag: Dependabot
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210924/" class="link black dim">
        GitHub help with dependency management
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This is very useful:</p>
<p><img src="/images/210924.notifications.png" alt="GitHub Notifications"></p>
<p>I am building an application that comprises multiple repos. I continue to procrastinate on whether using multiple repos vs. a monorepo was a good idea but, an issue that I have (had) is the need to ensure that the repos&rsquo; contents are using current|latest modules. GitHub can help.</p>
<p>Most of the application is written in Golang with a smattering of Rust and some JavaScript.</p>
    </div>
    <a href="/posts/210924/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/dependencies/" class="link blue hover-black">
            Tag: Dependencies
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210924/" class="link black dim">
        GitHub help with dependency management
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This is very useful:</p>
<p><img src="/images/210924.notifications.png" alt="GitHub Notifications"></p>
<p>I am building an application that comprises multiple repos. I continue to procrastinate on whether using multiple repos vs. a monorepo was a good idea but, an issue that I have (had) is the need to ensure that the repos&rsquo; contents are using current|latest modules. GitHub can help.</p>
<p>Most of the application is written in Golang with a smattering of Rust and some JavaScript.</p>
    </div>
    <a href="/posts/210924/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/modules/" class="link blue hover-black">
            Tag: Modules
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210924/" class="link black dim">
        GitHub help with dependency management
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>This is very useful:</p>
<p><img src="/images/210924.notifications.png" alt="GitHub Notifications"></p>
<p>I am building an application that comprises multiple repos. I continue to procrastinate on whether using multiple repos vs. a monorepo was a good idea but, an issue that I have (had) is the need to ensure that the repos&rsquo; contents are using current|latest modules. GitHub can help.</p>
<p>Most of the application is written in Golang with a smattering of Rust and some JavaScript.</p>
    </div>
    <a href="/posts/210924/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200206/" class="link black dim">
        Cloud Build wishlist: Mountable Golang Modules Proxy
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I think it would be valuable if Google were to provide volumes in <a href="https://cloud.google.com/cloud-build">Cloud Build</a> of package registries (e.g. <a href="https://proxy.golang.org">Go Modules</a>; <a href="https://pypi.org">PyPi</a>; <a href="https://search.maven.org/">Maven</a>; <a href="https://www.npmjs.com/">NPM</a> etc.).</p>
<p>Google provides a <a href="https://cloud.google.com/container-registry/docs/using-dockerhub-mirroring">mirror</a> of a subset of Docker Hub. This confers several benefits: Google&rsquo;s imprimatur; speed (latency); bandwidth; and convenience.</p>
<p>The same benefits would apply to package registries.</p>
<p>In the meantime, there&rsquo;s a hacky way to gain some of the benefits of these when using Cloud Build.</p>
<p>In the following example, I&rsquo;ll show an approach using Golang Modules and Google&rsquo;s module proxy aka <code>proxy.golang.org</code>.</p>
    </div>
    <a href="/posts/200206/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/kubectl/" class="link blue hover-black">
            Tag: Kubectl
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210907/" class="link black dim">
        `gcloud beta run services replace`
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>TL;DR</strong> I&rsquo;m working on a project that includes multiple Cloud Run services. I&rsquo;ve been putting my <code>gcloud</code> head on to deploy these services thinking that it&rsquo;s curious there&rsquo;s no way to write the specs as YAML configs. Today, I learned that there is: <a href="https://cloud.google.com/sdk/gcloud/reference/beta/run/services/replace"><code>gcloud beta run services replace</code></a>.</p></blockquote>
<p>What prompted the discovery was some frustration trying to deploy a JSON-valued environment variable to Cloud Run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  local FIREBASE_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    apiKey: </span><span style="color:#e6db74">${</span>FIREBASE_API_KEY<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    authDomain: </span><span style="color:#e6db74">${</span>FIREBASE_AUTH_DOMAIN<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    projectId: </span><span style="color:#e6db74">${</span>FIREBASE_PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    storageBucket: </span><span style="color:#e6db74">${</span>FIREBASE_STORAGE_BUCKET<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    messagingSenderId: </span><span style="color:#e6db74">${</span>FIREBASE_MESSAGING_SENDER<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    appId: </span><span style="color:#e6db74">${</span>FIREBASE_APP<span style="color:#e6db74">}</span><span style="color:#e6db74">}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  gcloud run deploy <span style="color:#e6db74">${</span>SRV_NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --image<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --command<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/server&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --args<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;--endpoint=:</span><span style="color:#e6db74">${</span>PORT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --set-env-vars<span style="color:#f92672">=</span>FIREBASE_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>FIREBASE_CONFIG<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --max-instances<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --memory<span style="color:#f92672">=</span>256Mi <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --ingress<span style="color:#f92672">=</span>all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --platform<span style="color:#f92672">=</span>managed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --port<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PORT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --allow-unauthenticated <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --region<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p><code>gcloud</code> balks at this.</p>
    </div>
    <a href="/posts/210907/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/yaml/" class="link blue hover-black">
            Tag: YAML
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210907/" class="link black dim">
        `gcloud beta run services replace`
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>TL;DR</strong> I&rsquo;m working on a project that includes multiple Cloud Run services. I&rsquo;ve been putting my <code>gcloud</code> head on to deploy these services thinking that it&rsquo;s curious there&rsquo;s no way to write the specs as YAML configs. Today, I learned that there is: <a href="https://cloud.google.com/sdk/gcloud/reference/beta/run/services/replace"><code>gcloud beta run services replace</code></a>.</p></blockquote>
<p>What prompted the discovery was some frustration trying to deploy a JSON-valued environment variable to Cloud Run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  local FIREBASE_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    apiKey: </span><span style="color:#e6db74">${</span>FIREBASE_API_KEY<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    authDomain: </span><span style="color:#e6db74">${</span>FIREBASE_AUTH_DOMAIN<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    projectId: </span><span style="color:#e6db74">${</span>FIREBASE_PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    storageBucket: </span><span style="color:#e6db74">${</span>FIREBASE_STORAGE_BUCKET<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    messagingSenderId: </span><span style="color:#e6db74">${</span>FIREBASE_MESSAGING_SENDER<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    appId: </span><span style="color:#e6db74">${</span>FIREBASE_APP<span style="color:#e6db74">}</span><span style="color:#e6db74">}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  gcloud run deploy <span style="color:#e6db74">${</span>SRV_NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --image<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --command<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/server&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --args<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;--endpoint=:</span><span style="color:#e6db74">${</span>PORT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --set-env-vars<span style="color:#f92672">=</span>FIREBASE_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>FIREBASE_CONFIG<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --max-instances<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --memory<span style="color:#f92672">=</span>256Mi <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --ingress<span style="color:#f92672">=</span>all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --platform<span style="color:#f92672">=</span>managed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --port<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PORT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --allow-unauthenticated <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --region<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p><code>gcloud</code> balks at this.</p>
    </div>
    <a href="/posts/210907/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/terraform/" class="link blue hover-black">
            Tag: Terraform
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210902/" class="link black dim">
        Infrastructure as Code
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="problem">Problem</h2>
<p>I&rsquo;m building an application that comprises:</p>
<ul>
<li>Kubernetes¹</li>
<li>Kubernetes Operator</li>
<li>Cloud Firestore</li>
<li>Cloud Functions</li>
<li>Cloud Run</li>
<li>Cloud Endpoints</li>
<li>Stripe</li>
<li>Firebase Authentication</li>
</ul>
<blockquote>
<p>¹ - I&rsquo;m using Google Kubernetes Engine (GKE) but may include other managed Kubernetes offerings (e.g. Digital Ocean, Linode, Oracle). GKE clusters are manageable by <code>gcloud</code> but other platforms require other CLI tools. All are accessible from bash but are these supported by e.g. Terraform (see below)?</p></blockquote>
<p>Many of the components are packaged as container images and, because I&rsquo;m using GitHub to host the project&rsquo;s repos (I&rsquo;ll leave the monorepo discussion for another post), I&rsquo;ve become inculcated and use GitHub Container Registry (GHCR) as the container repo.</p>
    </div>
    <a href="/posts/210902/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cloud-endpoints/" class="link blue hover-black">
            Tag: Cloud-Endpoints
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210730/" class="link black dim">
        Renewing Firebase Authentication ID tokens with gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written before about a project in which I&rsquo;m using Firebase Authentication in combination with Google Cloud Endpoints and a gRPC service running on Cloud Run:</p>
<ul>
<li><a href="/posts/210614/">Firebase Authentication, Cloud Endpoints and gRPC (1of2)</a></li>
<li><a href="/posts/210618/">Firebase Authentication, Cloud Endpoints and gRPC (2of2)</a></li>
</ul>
<p>This works well with one caveat, the ID tokens (JWTs) minted by Firebase Authentication have a 3600 second (one hour) lifetime.</p>
<p>The user flow in my app is that whenever the user invokes the app&rsquo;s CLI:</p>
    </div>
    <a href="/posts/210730/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210618/" class="link black dim">
        Firebase Authentication, Cloud Endpoints and gRPC (2of2)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Earlier this week, I wrote about using <a href="/posts/210614/">Firebase Authentcation, Cloud Endpoints and gRPC (1of2)</a>. Since then, I <a href="https://github.com/GoogleCloudPlatform/esp-v2/issues/542">learned some more</a> and added a gRPC interceptor to implement basic authorization for the service.</p>
<h2 id="espv2---allow-unauthenticated">ESPv2 <code>--allow-unauthenticated</code></h2>
<p>The Cloud Enpoints (ESPv2) proxy must be run as <code>--allow-unauthenticated</code> on Cloud Run to ensure that requests make it to the proxy where the request is authenticated and only authenticated requests make it on to the backend service. Thanks Google&rsquo;s <a href="https://github.com/nareddyt">Teju Nareddy</a>!</p>
    </div>
    <a href="/posts/210618/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210614/" class="link black dim">
        Firebase Authentication, Cloud Endpoints and gRPC (1of2)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m building a service that requires user authentication. The primary endpoint is a gRPC-based service. I would like to consider using certificate-based auth but this feels&hellip; challenging. Instead, I have been aware of, but never used, <a href="https://firebase.google.com/products/auth">Firebase Authentication</a> and was interested to see that <a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> includes Firebase Authentication as one of its supported auth mechanisms. Curiosity piqued, I confirmed that gRPC supports <a href="https://grpc.io/docs/guides/auth/#using-google-token-based-authentication">Google token-based authentication</a>.</p>
<p>The following is a summary of what I did but I&rsquo;ll leave the extensive documentation to Google, (Google&rsquo;s) Firebase and gRPC, all of which, in this case, provide really good explanations.</p>
    </div>
    <a href="/posts/210614/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210608/" class="link black dim">
        Cloud Endpoints combine OpenAPI and gRPC... or not!
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>See:</p>
<ul>
<li><a href="/posts/210519/">Multiplexing gRPC and HTTP endpoints with Cloud Run</a></li>
<li><a href="/posts/200325/">gRPC, Cloud Run &amp; Endpoints</a></li>
<li><a href="https://github.com/GoogleCloudPlatform/esp-v2/issues/523">ESPv2: Configure Cloud Endpoints to proxy traffic to a Cloud Run multiplexed (gRPC|HTTP) service</a></li>
</ul>
<p>Challenges:</p>
<ul>
<li>Cloud Run permits single port</li>
<li>Cloud Run services publishing e.g. gRPC and Prometheus, must multiplex transports</li>
<li>Cloud Run services publishing multiplexed transports are <em>challenging</em> to expose using Cloud Endpoints</li>
</ul>
<h2 id="hypothesis-1-multiplexed-transports-work-with-cloud-run">Hypothesis #1: Multiplexed transports work with Cloud Run</h2>
<p>See: <a href="/posts/210519/">Multiplexing gRPC and HTTP endpoints with Cloud Run</a></p>
    </div>
    <a href="/posts/210608/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200325/" class="link black dim">
        gRPC, Cloud Run &amp; Endpoints
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>&lt;3 Google but there&rsquo;s quite often an assumption that we&rsquo;re all sitting around the engineering table and, of course, we&rsquo;re not.</p>
<p><a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> is a powerful offering but &ndash; IMO &ndash; it&rsquo;s <strong>super</strong> confusing to understand and complex to deploy.</p>
<p>If you&rsquo;re familiar with the motivations behind service meshes (e.g. <a href="https://istio.io">Istio</a>), Cloud Endpoints fits in a similar niche (&ldquo;neesh&rdquo; or &ldquo;nitch&rdquo;?). The underlying ambition is that, developers can take <strong>existing</strong> code and by adding a proxy (or sidecar), general-purpose abstractions, security, logging etc. may be added.</p>
    </div>
    <a href="/posts/200325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/firebase-authentication/" class="link blue hover-black">
            Tag: Firebase-Authentication
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210730/" class="link black dim">
        Renewing Firebase Authentication ID tokens with gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written before about a project in which I&rsquo;m using Firebase Authentication in combination with Google Cloud Endpoints and a gRPC service running on Cloud Run:</p>
<ul>
<li><a href="/posts/210614/">Firebase Authentication, Cloud Endpoints and gRPC (1of2)</a></li>
<li><a href="/posts/210618/">Firebase Authentication, Cloud Endpoints and gRPC (2of2)</a></li>
</ul>
<p>This works well with one caveat, the ID tokens (JWTs) minted by Firebase Authentication have a 3600 second (one hour) lifetime.</p>
<p>The user flow in my app is that whenever the user invokes the app&rsquo;s CLI:</p>
    </div>
    <a href="/posts/210730/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/id-token/" class="link blue hover-black">
            Tag: Id-Token
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210730/" class="link black dim">
        Renewing Firebase Authentication ID tokens with gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written before about a project in which I&rsquo;m using Firebase Authentication in combination with Google Cloud Endpoints and a gRPC service running on Cloud Run:</p>
<ul>
<li><a href="/posts/210614/">Firebase Authentication, Cloud Endpoints and gRPC (1of2)</a></li>
<li><a href="/posts/210618/">Firebase Authentication, Cloud Endpoints and gRPC (2of2)</a></li>
</ul>
<p>This works well with one caveat, the ID tokens (JWTs) minted by Firebase Authentication have a 3600 second (one hour) lifetime.</p>
<p>The user flow in my app is that whenever the user invokes the app&rsquo;s CLI:</p>
    </div>
    <a href="/posts/210730/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/jwt/" class="link blue hover-black">
            Tag: Jwt
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210730/" class="link black dim">
        Renewing Firebase Authentication ID tokens with gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written before about a project in which I&rsquo;m using Firebase Authentication in combination with Google Cloud Endpoints and a gRPC service running on Cloud Run:</p>
<ul>
<li><a href="/posts/210614/">Firebase Authentication, Cloud Endpoints and gRPC (1of2)</a></li>
<li><a href="/posts/210618/">Firebase Authentication, Cloud Endpoints and gRPC (2of2)</a></li>
</ul>
<p>This works well with one caveat, the ID tokens (JWTs) minted by Firebase Authentication have a 3600 second (one hour) lifetime.</p>
<p>The user flow in my app is that whenever the user invokes the app&rsquo;s CLI:</p>
    </div>
    <a href="/posts/210730/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/refresh-token/" class="link blue hover-black">
            Tag: Refresh-Token
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210730/" class="link black dim">
        Renewing Firebase Authentication ID tokens with gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written before about a project in which I&rsquo;m using Firebase Authentication in combination with Google Cloud Endpoints and a gRPC service running on Cloud Run:</p>
<ul>
<li><a href="/posts/210614/">Firebase Authentication, Cloud Endpoints and gRPC (1of2)</a></li>
<li><a href="/posts/210618/">Firebase Authentication, Cloud Endpoints and gRPC (2of2)</a></li>
</ul>
<p>This works well with one caveat, the ID tokens (JWTs) minted by Firebase Authentication have a 3600 second (one hour) lifetime.</p>
<p>The user flow in my app is that whenever the user invokes the app&rsquo;s CLI:</p>
    </div>
    <a href="/posts/210730/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/in-memory/" class="link blue hover-black">
            Tag: In-Memory
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210724/" class="link black dim">
        gRPC Interceptors and in-memory gRPC connections
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For&hellip; reasons, I wanted to pre-filter gRPC requests to check for authorization. Authorization is implemented as a &lsquo;micro-service&rsquo; and I wanted the authorization server to run in the same process as the gRPC client.</p>
<p>TL;DR:</p>
<ul>
<li>Shiju&rsquo;s <a href="https://shijuvar.medium.com/writing-grpc-interceptors-in-go-bf3e7671fe48">&ldquo;Writing gRPC Interceptors in Go&rdquo;</a> is great</li>
<li>This Stack overflow <a href="https://stackoverflow.com/a/52080545/609290">answer</a> ostensibly for writing unit tests for gRPC got me an in-process server</li>
</ul>
<p>What follows stands on these folks&rsquo; shoulders&hellip;</p>
<p>A key motivator for me to write blog posts is that helps me ensure that I understand things. Writing this post, I realized I&rsquo;d not researched gRPC Interceptors and, as luck would have it, I found some interesting content, not on <a href="https://grpc.io"><code>grpc.io</code></a> but on the <a href="https://github.com/grpc-ecosystem"><code>grpc-ecosystem</code></a> repo, specifically <a href="https://github.com/grpc-ecosystem/go-grpc-middleware">Go gRPC middleware</a>. But, I refer again to Shiju&rsquo;s clear and helpful <a href="https://shijuvar.medium.com/writing-grpc-interceptors-in-go-bf3e7671fe48">&ldquo;Writing gRPC Interceptors in Go&rdquo;</a></p>
    </div>
    <a href="/posts/210724/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/interceptor/" class="link blue hover-black">
            Tag: Interceptor
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210724/" class="link black dim">
        gRPC Interceptors and in-memory gRPC connections
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For&hellip; reasons, I wanted to pre-filter gRPC requests to check for authorization. Authorization is implemented as a &lsquo;micro-service&rsquo; and I wanted the authorization server to run in the same process as the gRPC client.</p>
<p>TL;DR:</p>
<ul>
<li>Shiju&rsquo;s <a href="https://shijuvar.medium.com/writing-grpc-interceptors-in-go-bf3e7671fe48">&ldquo;Writing gRPC Interceptors in Go&rdquo;</a> is great</li>
<li>This Stack overflow <a href="https://stackoverflow.com/a/52080545/609290">answer</a> ostensibly for writing unit tests for gRPC got me an in-process server</li>
</ul>
<p>What follows stands on these folks&rsquo; shoulders&hellip;</p>
<p>A key motivator for me to write blog posts is that helps me ensure that I understand things. Writing this post, I realized I&rsquo;d not researched gRPC Interceptors and, as luck would have it, I found some interesting content, not on <a href="https://grpc.io"><code>grpc.io</code></a> but on the <a href="https://github.com/grpc-ecosystem"><code>grpc-ecosystem</code></a> repo, specifically <a href="https://github.com/grpc-ecosystem/go-grpc-middleware">Go gRPC middleware</a>. But, I refer again to Shiju&rsquo;s clear and helpful <a href="https://shijuvar.medium.com/writing-grpc-interceptors-in-go-bf3e7671fe48">&ldquo;Writing gRPC Interceptors in Go&rdquo;</a></p>
    </div>
    <a href="/posts/210724/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/javascript/" class="link blue hover-black">
            Tag: Javascript
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210716/" class="link black dim">
        Stripe
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>It&rsquo;s been almost a month since my last post. I&rsquo;ve been occupied learning <a href="https://stripe.com">Stripe</a> and integrating it into an application that I&rsquo;m developing. The app benefits from a billing mechanism for prospective customers and, as far as I can tell, Stripe is the solution. I&rsquo;d be interested in hearing perspectives on alternatives.</p>
<p>As with any platform, there&rsquo;s good and bad and I&rsquo;ll summarize my perspective on Stripe here. It&rsquo;s been some time since I developed in JavaScript and this lack of familiarity has meant that the solution took longer than I wanted to develop. That said, before this component, I developed integration with <a href="https://firebase.google.com/products/auth">Firebase Authentication</a> and that required JavaScript&rsquo;ing too and that was much easier (and more enjoyable).</p>
    </div>
    <a href="/posts/210716/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/stripe/" class="link blue hover-black">
            Tag: Stripe
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210716/" class="link black dim">
        Stripe
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>It&rsquo;s been almost a month since my last post. I&rsquo;ve been occupied learning <a href="https://stripe.com">Stripe</a> and integrating it into an application that I&rsquo;m developing. The app benefits from a billing mechanism for prospective customers and, as far as I can tell, Stripe is the solution. I&rsquo;d be interested in hearing perspectives on alternatives.</p>
<p>As with any platform, there&rsquo;s good and bad and I&rsquo;ll summarize my perspective on Stripe here. It&rsquo;s been some time since I developed in JavaScript and this lack of familiarity has meant that the solution took longer than I wanted to develop. That said, before this component, I developed integration with <a href="https://firebase.google.com/products/auth">Firebase Authentication</a> and that required JavaScript&rsquo;ing too and that was much easier (and more enjoyable).</p>
    </div>
    <a href="/posts/210716/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/firebase/" class="link blue hover-black">
            Tag: Firebase
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210618/" class="link black dim">
        Firebase Authentication, Cloud Endpoints and gRPC (2of2)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Earlier this week, I wrote about using <a href="/posts/210614/">Firebase Authentcation, Cloud Endpoints and gRPC (1of2)</a>. Since then, I <a href="https://github.com/GoogleCloudPlatform/esp-v2/issues/542">learned some more</a> and added a gRPC interceptor to implement basic authorization for the service.</p>
<h2 id="espv2---allow-unauthenticated">ESPv2 <code>--allow-unauthenticated</code></h2>
<p>The Cloud Enpoints (ESPv2) proxy must be run as <code>--allow-unauthenticated</code> on Cloud Run to ensure that requests make it to the proxy where the request is authenticated and only authenticated requests make it on to the backend service. Thanks Google&rsquo;s <a href="https://github.com/nareddyt">Teju Nareddy</a>!</p>
    </div>
    <a href="/posts/210618/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210614/" class="link black dim">
        Firebase Authentication, Cloud Endpoints and gRPC (1of2)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m building a service that requires user authentication. The primary endpoint is a gRPC-based service. I would like to consider using certificate-based auth but this feels&hellip; challenging. Instead, I have been aware of, but never used, <a href="https://firebase.google.com/products/auth">Firebase Authentication</a> and was interested to see that <a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> includes Firebase Authentication as one of its supported auth mechanisms. Curiosity piqued, I confirmed that gRPC supports <a href="https://grpc.io/docs/guides/auth/#using-google-token-based-authentication">Google token-based authentication</a>.</p>
<p>The following is a summary of what I did but I&rsquo;ll leave the extensive documentation to Google, (Google&rsquo;s) Firebase and gRPC, all of which, in this case, provide really good explanations.</p>
    </div>
    <a href="/posts/210614/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/firebase-authentication/" class="link blue hover-black">
            Tag: Firebase-Authentication&#34;
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210618/" class="link black dim">
        Firebase Authentication, Cloud Endpoints and gRPC (2of2)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Earlier this week, I wrote about using <a href="/posts/210614/">Firebase Authentcation, Cloud Endpoints and gRPC (1of2)</a>. Since then, I <a href="https://github.com/GoogleCloudPlatform/esp-v2/issues/542">learned some more</a> and added a gRPC interceptor to implement basic authorization for the service.</p>
<h2 id="espv2---allow-unauthenticated">ESPv2 <code>--allow-unauthenticated</code></h2>
<p>The Cloud Enpoints (ESPv2) proxy must be run as <code>--allow-unauthenticated</code> on Cloud Run to ensure that requests make it to the proxy where the request is authenticated and only authenticated requests make it on to the backend service. Thanks Google&rsquo;s <a href="https://github.com/nareddyt">Teju Nareddy</a>!</p>
    </div>
    <a href="/posts/210618/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210614/" class="link black dim">
        Firebase Authentication, Cloud Endpoints and gRPC (1of2)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m building a service that requires user authentication. The primary endpoint is a gRPC-based service. I would like to consider using certificate-based auth but this feels&hellip; challenging. Instead, I have been aware of, but never used, <a href="https://firebase.google.com/products/auth">Firebase Authentication</a> and was interested to see that <a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> includes Firebase Authentication as one of its supported auth mechanisms. Curiosity piqued, I confirmed that gRPC supports <a href="https://grpc.io/docs/guides/auth/#using-google-token-based-authentication">Google token-based authentication</a>.</p>
<p>The following is a summary of what I did but I&rsquo;ll leave the extensive documentation to Google, (Google&rsquo;s) Firebase and gRPC, all of which, in this case, provide really good explanations.</p>
    </div>
    <a href="/posts/210614/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/consul/" class="link blue hover-black">
            Tag: Consul
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210520/" class="link black dim">
        Consul discovers Google Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a basic <code>discoverer</code> of Google <a href="https://cloud.google.com/run">Cloud Run</a> services. This is for a project and it extends work done in some previous posts to <a href="/posts/210519/">Multiplex gRPC and Prometheus with Cloud Run</a> and to use <a href="/posts/210419/">Consul for Prometheus service discovery</a>.</p>
<p>This solution:</p>
<ul>
<li>Accepts a set of Google Cloud Platform (GCP) projects</li>
<li>Trawls them for Cloud Run services</li>
<li>Assumes that the services expose Prometheus metrics on <code>:443/metrics</code></li>
<li>Relabels the services</li>
<li>Surfaces any discovered Cloud Run services&rsquo; metrics in Prometheus</li>
</ul>
<p>You&rsquo;ll need Docker and Docker Compose.</p>
    </div>
    <a href="/posts/210520/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210419/" class="link black dim">
        Prometheus Service Discovery w/ Consul for Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m working on a project that will programmatically create Google <a href="https://cloud.google.com/run">Cloud Run</a> services and I want to be able to dynamically discover these services using Prometheus.</p>
<p>This is one solution.</p>
<blockquote>
<p><strong>NOTE</strong> Google Cloud Run is the service I&rsquo;m using, but the principle described herein applies to any runtime service that you&rsquo;d wish to use.</p></blockquote>
<p>Why is this challenging? IIUC, it&rsquo;s primarily because Prometheus has a limited set of plugins for service discovery, see the sections that include <code>_sd_</code> in Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/">Configuration</a> documentation. Unfortunately, Cloud Run is not explicitly supported. The alternative appears to be to use file-based discovery but this seems &lsquo;challenging&rsquo;; it requires, for example, reloading Prometheus on file changes.</p>
    </div>
    <a href="/posts/210419/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/http/" class="link blue hover-black">
            Tag: Http
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210519/" class="link black dim">
        Multiplexing gRPC and HTTP (Prometheus) endpoints with Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google <a href="https://cloud.google.com/run">Cloud Run</a> is useful but, each service is limited to exposing a single port. This caused me problems with a gRPC service that serves (non-gRPC) Prometheus metrics because customarily, you would serve gRPC on one port and the Prometheus metrics on another.</p>
<p>Fortunately, <a href="https://github.com/soheilhy/cmux">cmux</a> provides a solution by providing a mechanism that multiplexes both services (gRPC and HTTP) on a single port!</p>
<blockquote>
<p><strong>TL;DR</strong> See the cmux <a href="https://github.com/soheilhy/cmux#limitations">Limitations</a> and use:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#a6e22e">grpcl</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">MatchWithWriters</span>(
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">cmux</span>.<span style="color:#a6e22e">HTTP2MatchHeaderFieldSendSettings</span>(<span style="color:#e6db74">&#34;content-type&#34;</span>, <span style="color:#e6db74">&#34;application/grpc&#34;</span>))
</span></span></code></pre></div></blockquote>
<p>Extending the <a href="https://github.com/soheilhy/cmux#how-to">example</a> from the cmux repo:</p>
    </div>
    <a href="/posts/210519/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/merge/" class="link blue hover-black">
            Tag: Merge
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210506/" class="link black dim">
        Firestore Golang Timestamps &amp; Merging
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using Google&rsquo;s <a href="https://pkg.go.dev/cloud.google.com/go/firestore#DocumentRef">Golang SDK for Firestore</a>. The experience is excellent and I&rsquo;m quickly becoming a fan of Firestore. However, as a Golang Firestore developer, I&rsquo;m feeling less loved and some of the concepts in the database were causing me a conundrum.</p>
<p>I&rsquo;m still not entirely certain that I have Timestamps nailed but&hellip; I learned an important lesson on the auto-creation of Timestamps in documents and how to retain these values.</p>
    </div>
    <a href="/posts/210506/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/timestamp/" class="link blue hover-black">
            Tag: Timestamp
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210506/" class="link black dim">
        Firestore Golang Timestamps &amp; Merging
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using Google&rsquo;s <a href="https://pkg.go.dev/cloud.google.com/go/firestore#DocumentRef">Golang SDK for Firestore</a>. The experience is excellent and I&rsquo;m quickly becoming a fan of Firestore. However, as a Golang Firestore developer, I&rsquo;m feeling less loved and some of the concepts in the database were causing me a conundrum.</p>
<p>I&rsquo;m still not entirely certain that I have Timestamps nailed but&hellip; I learned an important lesson on the auto-creation of Timestamps in documents and how to retain these values.</p>
    </div>
    <a href="/posts/210506/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/coredns/" class="link blue hover-black">
            Tag: Coredns
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210419/" class="link black dim">
        Prometheus Service Discovery w/ Consul for Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m working on a project that will programmatically create Google <a href="https://cloud.google.com/run">Cloud Run</a> services and I want to be able to dynamically discover these services using Prometheus.</p>
<p>This is one solution.</p>
<blockquote>
<p><strong>NOTE</strong> Google Cloud Run is the service I&rsquo;m using, but the principle described herein applies to any runtime service that you&rsquo;d wish to use.</p></blockquote>
<p>Why is this challenging? IIUC, it&rsquo;s primarily because Prometheus has a limited set of plugins for service discovery, see the sections that include <code>_sd_</code> in Prometheus <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/">Configuration</a> documentation. Unfortunately, Cloud Run is not explicitly supported. The alternative appears to be to use file-based discovery but this seems &lsquo;challenging&rsquo;; it requires, for example, reloading Prometheus on file changes.</p>
    </div>
    <a href="/posts/210419/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cloud-functions/" class="link blue hover-black">
            Tag: Cloud-Functions
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210413/" class="link black dim">
        Cloud Firestore Triggers in Golang
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was pleased to discover that Google provides a non-Node.JS mechanism to subscribe to and act upon Firestore triggers, <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Google Cloud Firestore Triggers</a>. I&rsquo;ve nothing against Node.JS but, for the project i&rsquo;m developing, everything else is written in Golang. It&rsquo;s good to keep it all in one language.</p>
<p>I&rsquo;m perplexed that Cloud Functions still (!) only supports Go 1.13 (03-Sep-2019). Even <a href="https://golang.org/doc/devel/release.html#go1.14">Go 1.14</a> (25-Feb-2020) was released pre-pandemic and we&rsquo;re now running on 1.16. Come on Google!</p>
    </div>
    <a href="/posts/210413/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201203/" class="link black dim">
        webmention
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Let&rsquo;s see if this works!?</p>
<p>I&rsquo;ve added the following link to this site&rsquo;s <code>baseof.html</code> so that it is now rendered for each page:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-HTML" data-lang="HTML"><span style="display:flex;"><span>&lt;<span style="color:#f92672">link</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://us-central1-webmention.cloudfunctions.net/webmention&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;webmention&#34;</span> /&gt;
</span></span></code></pre></div><p>I discovered <a href="https://indieweb.org/">indieweb</a> yesterday reading about <a href="https://aaronparecki.com/2018/06/30/11/your-first-webmention">webmention</a>. Who knows what got me to webmention!?</p>
<p>The principles of both are sound. Instead of relying on come-go behemoths to run our digital world, indieweb seeks to provide technologies that enable us to achieve things without them. webmention is a cross-walled-garden mechanism to perform an evolved form of pingbacks. If X references one of Y&rsquo;s posts, X&rsquo;s server notifies Y&rsquo;s server during publication through a webmention service and, Y can then decide to add reference counts of copies of the referring link to their page. Clever.</p>
    </div>
    <a href="/posts/201203/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200617/" class="link black dim">
        WASM Cloud Functions
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Following on from <a href="/posts/200612/">waPC &amp; Protobufs</a> and a question on Stack Overflow about Cloud Functions, I was compelled to try running WASM on Cloud Functions no JavaScript.</p>
<p>I wanted to reuse the WASM waPC functions that I&rsquo;d written in Rust as described in the other post. Cloud Functions does not (yet!?) provide a Rust runtime and so I&rsquo;m using the <a href="https://github.com/wapc/wapc-go">waPC Host for Go</a> in this example.</p>
<p>It works!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PARAMS<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>printf <span style="color:#e6db74">&#39;{&#34;a&#34;:{&#34;real&#34;:39,&#34;imag&#34;:3},&#34;b&#34;:{&#34;real&#34;:39,&#34;imag&#34;:3}}&#39;</span> | base64<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>gcloud auth print-identity-token<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;filename\&#34;:\&#34;complex.wasm\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;function\&#34;:\&#34;c:mul\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;params\&#34;:\&#34;</span><span style="color:#e6db74">${</span>PARAMS<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#34;</span> |<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request POST <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--data @- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span>-<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>.cloudfunctions.net/invoker
</span></span></code></pre></div><p>yields (correctly):</p>
    </div>
    <a href="/posts/200617/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/emulator/" class="link blue hover-black">
            Tag: Emulator
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210317/" class="link black dim">
        Using Golang with the Firestore Emulator
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><img src="/images/210317.firebase.firestore.docs.png" alt="Firestore"></p>
<p>This works great but it wasn&rsquo;t clearly documented for non-Firebase users. I assume it will work, as well, for any of the client libraries (not just Golang).</p>
<p>Assuming you have some (Golang) code (in this case using the Google Cloud Client Library) that interacts with a Firestore database. Something of the form:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Golang" data-lang="Golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;crypto/sha256&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;cloud.google.com/go/firestore&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sha256</span>.<span style="color:#a6e22e">New</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#a6e22e">s</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%x&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Sum</span>(<span style="color:#66d9ef">nil</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Dog</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Name</span>    <span style="color:#66d9ef">string</span>                 <span style="color:#e6db74">`firestore:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Age</span>     <span style="color:#66d9ef">int</span>                    <span style="color:#e6db74">`firestore:&#34;age&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Human</span>   <span style="color:#f92672">*</span><span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">DocumentRef</span> <span style="color:#e6db74">`firestore:&#34;human&#34;`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Created</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>              <span style="color:#e6db74">`firestore:&#34;created&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewDog</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">age</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">human</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">DocumentRef</span>) <span style="color:#a6e22e">Dog</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Dog</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>:    <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Age</span>:     <span style="color:#a6e22e">age</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Human</span>:   <span style="color:#a6e22e">human</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Created</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(),
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">d</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Dog</span>) <span style="color:#a6e22e">ID</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Human</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`firestore:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">h</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Human</span>) <span style="color:#a6e22e">ID</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hash</span>(<span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">project</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;PROJECT&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">firestore</span>.<span style="color:#a6e22e">NewClient</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">project</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;FIRESTORE_EMULATOR_HOST&#34;</span>); <span style="color:#a6e22e">value</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Using Firestore Emulator: %s&#34;</span>, <span style="color:#a6e22e">value</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">me</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Human</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;me&#34;</span>,
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">meDocRef</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Collection</span>(<span style="color:#e6db74">&#34;humans&#34;</span>).<span style="color:#a6e22e">Doc</span>(<span style="color:#a6e22e">me</span>.<span style="color:#a6e22e">ID</span>())
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">meDocRef</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">me</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">freddie</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewDog</span>(<span style="color:#e6db74">&#34;Freddie&#34;</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">meDocRef</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">freddieDocRef</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Collection</span>(<span style="color:#e6db74">&#34;dogs&#34;</span>).<span style="color:#a6e22e">Doc</span>(<span style="color:#a6e22e">freddie</span>.<span style="color:#a6e22e">ID</span>())
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">freddieDocRef</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">freddie</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Then you can interact instead with the Firestore Emulator.</p>
    </div>
    <a href="/posts/210317/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/run/" class="link blue hover-black">
            Tag: Run
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210316/" class="link black dim">
        Programmatically deploying Cloud Run services (Golang|Python)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Phew! Programmitcally deploying Cloud Run services should be easy but it didn&rsquo;t find it so.</p>
<p>My issues were that the Cloud Run Admin (!) API is poorly documented and it uses non-standard endpoints (thanks Sal!). Here, for others who may struggle with this, is how I got this to work.</p>
<h2 id="goal">Goal</h2>
<p>Programmatically (have Golang, Python, want Rust) deploy services to Cloud Run.</p>
<p>i.e. achieve this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud run deploy <span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--image<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--platform<span style="color:#f92672">=</span>managed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--no-allow-unauthenticated <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--region<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><blockquote>
<p><strong>TRICK</strong> <a href="https://cloud.google.com/sdk/gcloud/reference#--log-http"><code>--log-http</code></a> is your friend</p>
    </div>
    <a href="/posts/210316/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/kube-metrics/" class="link blue hover-black">
            Tag: Kube-Metrics
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210305/" class="link black dim">
        Prometheus VPA Recommendations
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Phew!</p>
<p><a href="https://en.wikipedia.org/wiki/For_Want_of_a_Nail">For Want of a Nail</a></p>
<p>I was interested in learning how to <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Manage Resources for Containers</a>. On the way, I learned and discovered:</p>
<ul>
<li><a href="#kubectl-top"><code>kubectl top</code></a></li>
<li><a href="#vertical-pod-autoscaler-vpa">Vertical Pod Autoscaler</a></li>
<li>A (valuable) digression through <a href="#digression-podmonitor">PodMonitor</a></li>
<li><a href="#kube-state-metrics"><code>kube-state-metrics</code></a></li>
<li><a href="#kubectl-patch">`kubectl-patch</a></li>
<li>Created a <a href="#graph">Graph</a></li>
<li><a href="#references">References</a></li>
</ul>
<h2 id="kubernetes-resources">Kubernetes Resources</h2>
<p>Visual Studio Code has begun to bug me (reasonably) to add <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/"><code>resources</code></a> to Kubernetes manifests.</p>
<p>E.g.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;512Mi&#34;</span>
</span></span></code></pre></div><p>I&rsquo;ve been spending time with Deislab&rsquo;s <a href="https://github.com/deislabs/akri">Akri</a> and decided to determine whether Akri&rsquo;s primary resources (Agent, Controller) and some of my creations HTTP Device and Discovery, were being suitably constrained.</p>
    </div>
    <a href="/posts/210305/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/virtualpodautoscaler/" class="link blue hover-black">
            Tag: Virtualpodautoscaler
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210305/" class="link black dim">
        Prometheus VPA Recommendations
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Phew!</p>
<p><a href="https://en.wikipedia.org/wiki/For_Want_of_a_Nail">For Want of a Nail</a></p>
<p>I was interested in learning how to <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Manage Resources for Containers</a>. On the way, I learned and discovered:</p>
<ul>
<li><a href="#kubectl-top"><code>kubectl top</code></a></li>
<li><a href="#vertical-pod-autoscaler-vpa">Vertical Pod Autoscaler</a></li>
<li>A (valuable) digression through <a href="#digression-podmonitor">PodMonitor</a></li>
<li><a href="#kube-state-metrics"><code>kube-state-metrics</code></a></li>
<li><a href="#kubectl-patch">`kubectl-patch</a></li>
<li>Created a <a href="#graph">Graph</a></li>
<li><a href="#references">References</a></li>
</ul>
<h2 id="kubernetes-resources">Kubernetes Resources</h2>
<p>Visual Studio Code has begun to bug me (reasonably) to add <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/"><code>resources</code></a> to Kubernetes manifests.</p>
<p>E.g.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;512Mi&#34;</span>
</span></span></code></pre></div><p>I&rsquo;ve been spending time with Deislab&rsquo;s <a href="https://github.com/deislabs/akri">Akri</a> and decided to determine whether Akri&rsquo;s primary resources (Agent, Controller) and some of my creations HTTP Device and Discovery, were being suitably constrained.</p>
    </div>
    <a href="/posts/210305/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/dapr/" class="link blue hover-black">
            Tag: Dapr
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210222/" class="link black dim">
        Dapr
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>It&rsquo;s a good name, I read it as &ldquo;dapper&rdquo; but I frequently type &ldquo;darp&rdquo; :-(</p>
<p>Was interested to <a href="https://blog.dapr.io/posts/2021/02/17/announcing-dapr-v1.0/">read</a> that <a href="https://dapr.io/">Dapr</a> is now v1.0 and decided to check it out. I was initially confused between Dapr and service mesh functionality. But, having used Dapr, it appears to be more focused in aiding the development of (cloud-native) (distributed) apps by providing developers with abstractions for e.g. service discovery, eventing, observability whereas service meshes feel (!) more oriented towards simplifying the deployment of existing apps. Both use the concept of proxies, deployed alongside app components (as sidecars on Kubernetes) to provide their functionality to apps.</p>
    </div>
    <a href="/posts/210222/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/deislabs/" class="link blue hover-black">
            Tag: Deislabs
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210122/" class="link black dim">
        Krustlet on DO Managed Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve spent time this week returning to the interesting Deislabs project <a href="https://github.com/deislabs/krustlet">Krustlet</a>. Since the last time, the bootstrapping process has been simplified using Kubernetes <a href="https://kubernetes.io/docs/reference/access-authn-authz/bootstrap-tokens/">Bootstrap Tokens</a>. I know this updated process <a href="https://github.com/deislabs/krustlet/blob/master/docs/howto/krustlet-on-microk8s.md">works</a> with <a href="https://microk8s.io">MicroK8s</a>. Unfortunately, I&rsquo;m struggling with it on <a href="cloud.google.com/kubernetes-engine">GKE</a> and thought I&rsquo;d try DigitalOcean Managed Kubernetes.</p>
<p>It worked first time!</p>
<p>In the following, we run both the Kubernetes cluster and the Krustlet Droplet on DigitalOcean but, as long as the cluster and the VM are able to communicate with one another, you should be able to run these anywhere.</p>
    </div>
    <a href="/posts/210122/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/krustlet/" class="link blue hover-black">
            Tag: Krustlet
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210122/" class="link black dim">
        Krustlet on DO Managed Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve spent time this week returning to the interesting Deislabs project <a href="https://github.com/deislabs/krustlet">Krustlet</a>. Since the last time, the bootstrapping process has been simplified using Kubernetes <a href="https://kubernetes.io/docs/reference/access-authn-authz/bootstrap-tokens/">Bootstrap Tokens</a>. I know this updated process <a href="https://github.com/deislabs/krustlet/blob/master/docs/howto/krustlet-on-microk8s.md">works</a> with <a href="https://microk8s.io">MicroK8s</a>. Unfortunately, I&rsquo;m struggling with it on <a href="cloud.google.com/kubernetes-engine">GKE</a> and thought I&rsquo;d try DigitalOcean Managed Kubernetes.</p>
<p>It worked first time!</p>
<p>In the following, we run both the Kubernetes cluster and the Krustlet Droplet on DigitalOcean but, as long as the cluster and the VM are able to communicate with one another, you should be able to run these anywhere.</p>
    </div>
    <a href="/posts/210122/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200612/" class="link black dim">
        waPC &amp; Protobufs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m hacking around with a solution that combines WASM and Google <a href="https://github.com/google/trillian">Trillian</a>.</p>
<p>Ultimately, I&rsquo;d like to be able to ship WASM (binaries) to a Trillian personality and then invoke (exported) functions on them. Some this was borne from the interesting exploration of <a href="https://github.com/deislabs/krustlet">Krustlet</a> and its application of <a href="https://wascc.dev/">wascc</a>.</p>
<p>I&rsquo;m still booting into WASM but it&rsquo;s a <em>very</em> interesting technology that has most interesting potential outside the browser. Some folks have been trailblazing the technology and I have been reading Kevin Hoffman&rsquo;s <a href="https://medium.com/@KevinHoffman">medium</a> and <a href="https://wascc.dev/">wascc</a> (nee waxosuit) work. From this, I stumbled upon Kevin&rsquo;s <a href="https://medium.com/@KevinHoffman/introducing-wapc-dc9d8b0c2223">waPC</a> and I&rsquo;m using waPC in this prototyping as a way to exchange data between clients and servers running WASM binaries.</p>
    </div>
    <a href="/posts/200612/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/akri/" class="link blue hover-black">
            Tag: Akri
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210108/" class="link black dim">
        Kubernetes cert-manager
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I developed an <a href="/posts/201229/">admission webhook</a> for Akri, twice (<a href="https://github.com/DazWilkin/akri-webhook">Golang</a>, <a href="https://github.com/DazWilkin/akri-webhook-rust">Rust</a>). I naively followed other examples for the generation of the certificates, created a 1.20 cluster and <a href="https://stackoverflow.com/questions/65587904/">broke</a> that process.</p>
<p>I&rsquo;d briefly considered using <a href="https://cert-manager.io"><code>cert-manager</code></a> recently but quickly abandoned the idea thinking it would be onerous and unnecessary complexity for little-old-me. I was wrong. It&rsquo;s excellent and I recommend it highly.</p>
<p>I won&rsquo;t reproduce the <code>v1beta1</code> and <code>v1</code> examples from the Stackoverflow question as they should be self-explanatory. I suspect (!?) that I should not have used Kubernete&rsquo;s (API Server&rsquo;s) CA for the Webhook but it could well be that I just don&rsquo;t understand the correct approach.</p>
    </div>
    <a href="/posts/210108/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201229/" class="link black dim">
        Kubernetes Webhooks
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I spent some time last week writing my first <a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/">admission webhook</a> for Kubernetes. I wrote the handler in Golang because I&rsquo;m most familiar with Golang and because, as Kubernetes&rsquo; native language, I was more confident that the necessary SDKs would exist and that the documentation would likely use Golang by default. I struggled to find useful documentation and so this post is to help you (and me!) remember how to do this next time!</p>
    </div>
    <a href="/posts/201229/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201217/" class="link black dim">
        Kubernetes Device Plugins
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m debugging an <a href="https://github.com/deislabs/akri/issues/177">issue</a> with Akri <code>Zeroconf</code> <a href="https://github.com/DazWilkin/akri/tree/protocol-zeroconf">protocol</a> in which Instance environment variables are no longer (!) being surfaced within the Broker pods. In my adventures, it seemed useful to better understand how Akri works and specifically, how Akri uses Kubernetes <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/device-plugins/">Device Plugins</a>.</p>
<p>IIUC plugins register with the Kubelet (!) via a gRPC service (<code>Registration</code>) that the Kubelet exposes on a UNIX socket at <code>/var/lib/kubelet/device-plugins/kubelet.sock</code></p>
<p>Then (!) if successful, devices should be reported by the Node&rsquo;s metadata (spec) and available to be bound to Pods.</p>
    </div>
    <a href="/posts/201217/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201113/" class="link black dim">
        Akri
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For the past couple of weeks, I&rsquo;ve been playing around with <a href="http://github.com/deislabs/akri">Akri</a>, a Microsoft (DeisLabs) project for <a href="https://cloudblogs.microsoft.com/opensource/2020/10/20/announcing-akri-open-source-project-building-connected-edge-kubernetes/">building a connected edge with Kubernetes</a>. Kubernetes, IoT, Rust (and Golang) make this all compelling to me.</p>
<p>Initially, I deployed an Akri <a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo.md">End-to-End</a> to <a href="https://microk8s.io/">MicroK8s</a> on Google Compute Engine (<a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo-gce.md">link</a>) and Digital Ocean (<a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo-do.md">link</a>). But I was interested to create me own example and so have proposed a very (!) simple <a href="https://github.com/DazWilkin/akri/blob/protocol-http/docs/extensibility-http.md">HTTP-based protocol</a>.</p>
<p>This blog summarizes my thoughts about Akri and an explanation of the HTTP protocol implementation in the hope that this helps others.</p>
    </div>
    <a href="/posts/201113/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201029/" class="link black dim">
        GitHub Actions &amp;&amp; GitHub Container Registry
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>You know when you start something and then regret it!? I think I&rsquo;ll be sticking with <a href="https://cloud.google.com/cloud-build">Google Cloud Build</a>; <a href="https://github.com/features/actions">GitHub Actions</a> appears functional and useful but I found the documentation to be confusing and limited and struggled to get a simple container image build|push working.</p>
<p>I&rsquo;ve long used <a href="https://hub.docker.com">Docker Hub</a> but am planning to use it less as a result of the planned <a href="https://www.docker.com/blog/scaling-docker-to-serve-millions-more-developers-network-egress/">changes</a>. I want to see Docker succeed and to do so it needs to find a way to make money but, there are free alternatives including the new <a href="https://github.blog/2020-09-01-introducing-github-container-registry/">GitHub Container Registry</a> and the very very cheap <a href="https://cloud.google.com/container-registry">Google Container Registry</a>.</p>
    </div>
    <a href="/posts/201029/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201022/" class="link black dim">
        akri
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was very interested to read about Microsoft&rsquo;s DeisLab&rsquo;s latest (rust-based) Kubernetes project: <a href="https://cloudblogs.microsoft.com/opensource/2020/10/20/announcing-akri-open-source-project-building-connected-edge-kubernetes/">akri</a>. If I understand it correctly, it provides a mechanism to make any (IoT) device accessible to containers running within a cluster. I need to spend more time playing around with it so that I can fully understand it. I had some problems getting the <a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo.md">End-to-End</a> demo running on Google Compute Engine (and then I tried DigitalOcean droplet) instances. So, here&rsquo;s a two-ways solution to get you going.</p>
    </div>
    <a href="/posts/201022/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cert-manager/" class="link blue hover-black">
            Tag: Cert-Manager
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210108/" class="link black dim">
        Kubernetes cert-manager
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I developed an <a href="/posts/201229/">admission webhook</a> for Akri, twice (<a href="https://github.com/DazWilkin/akri-webhook">Golang</a>, <a href="https://github.com/DazWilkin/akri-webhook-rust">Rust</a>). I naively followed other examples for the generation of the certificates, created a 1.20 cluster and <a href="https://stackoverflow.com/questions/65587904/">broke</a> that process.</p>
<p>I&rsquo;d briefly considered using <a href="https://cert-manager.io"><code>cert-manager</code></a> recently but quickly abandoned the idea thinking it would be onerous and unnecessary complexity for little-old-me. I was wrong. It&rsquo;s excellent and I recommend it highly.</p>
<p>I won&rsquo;t reproduce the <code>v1beta1</code> and <code>v1</code> examples from the Stackoverflow question as they should be self-explanatory. I suspect (!?) that I should not have used Kubernete&rsquo;s (API Server&rsquo;s) CA for the Webhook but it could well be that I just don&rsquo;t understand the correct approach.</p>
    </div>
    <a href="/posts/210108/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/device-plugins/" class="link blue hover-black">
            Tag: Device-Plugins&#34;
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201217/" class="link black dim">
        Kubernetes Device Plugins
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m debugging an <a href="https://github.com/deislabs/akri/issues/177">issue</a> with Akri <code>Zeroconf</code> <a href="https://github.com/DazWilkin/akri/tree/protocol-zeroconf">protocol</a> in which Instance environment variables are no longer (!) being surfaced within the Broker pods. In my adventures, it seemed useful to better understand how Akri works and specifically, how Akri uses Kubernetes <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/device-plugins/">Device Plugins</a>.</p>
<p>IIUC plugins register with the Kubelet (!) via a gRPC service (<code>Registration</code>) that the Kubelet exposes on a UNIX socket at <code>/var/lib/kubelet/device-plugins/kubelet.sock</code></p>
<p>Then (!) if successful, devices should be reported by the Node&rsquo;s metadata (spec) and available to be bound to Pods.</p>
    </div>
    <a href="/posts/201217/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/indieweb/" class="link blue hover-black">
            Tag: Indieweb
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201203/" class="link black dim">
        webmention
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Let&rsquo;s see if this works!?</p>
<p>I&rsquo;ve added the following link to this site&rsquo;s <code>baseof.html</code> so that it is now rendered for each page:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-HTML" data-lang="HTML"><span style="display:flex;"><span>&lt;<span style="color:#f92672">link</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://us-central1-webmention.cloudfunctions.net/webmention&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;webmention&#34;</span> /&gt;
</span></span></code></pre></div><p>I discovered <a href="https://indieweb.org/">indieweb</a> yesterday reading about <a href="https://aaronparecki.com/2018/06/30/11/your-first-webmention">webmention</a>. Who knows what got me to webmention!?</p>
<p>The principles of both are sound. Instead of relying on come-go behemoths to run our digital world, indieweb seeks to provide technologies that enable us to achieve things without them. webmention is a cross-walled-garden mechanism to perform an evolved form of pingbacks. If X references one of Y&rsquo;s posts, X&rsquo;s server notifies Y&rsquo;s server during publication through a webmention service and, Y can then decide to add reference counts of copies of the referring link to their page. Clever.</p>
    </div>
    <a href="/posts/201203/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/webmention/" class="link blue hover-black">
            Tag: Webmention
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201203/" class="link black dim">
        webmention
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Let&rsquo;s see if this works!?</p>
<p>I&rsquo;ve added the following link to this site&rsquo;s <code>baseof.html</code> so that it is now rendered for each page:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-HTML" data-lang="HTML"><span style="display:flex;"><span>&lt;<span style="color:#f92672">link</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://us-central1-webmention.cloudfunctions.net/webmention&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;webmention&#34;</span> /&gt;
</span></span></code></pre></div><p>I discovered <a href="https://indieweb.org/">indieweb</a> yesterday reading about <a href="https://aaronparecki.com/2018/06/30/11/your-first-webmention">webmention</a>. Who knows what got me to webmention!?</p>
<p>The principles of both are sound. Instead of relying on come-go behemoths to run our digital world, indieweb seeks to provide technologies that enable us to achieve things without them. webmention is a cross-walled-garden mechanism to perform an evolved form of pingbacks. If X references one of Y&rsquo;s posts, X&rsquo;s server notifies Y&rsquo;s server during publication through a webmention service and, Y can then decide to add reference counts of copies of the referring link to their page. Clever.</p>
    </div>
    <a href="/posts/201203/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/pest/" class="link blue hover-black">
            Tag: Pest
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201202/" class="link black dim">
        pest: parsing in Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A Microsoft engineer introduced me to <a href="https://pest.rs"><code>pest</code></a> as a way to introduce service filtering in a ZeroConf plugin that I&rsquo;m prototyping for <a href="https://github.com/deislabs/akri">Akri</a>. It&rsquo;s been fun to learn but I worry that, because I won&rsquo;t use it frequently, I&rsquo;m going to quickly forget what I&rsquo;ve done. So, here are my notes.</p>
<p>Here&rsquo;s the problem, I&rsquo;d like to be able to provide users of the ZeroConf plugin with a string-based filter that permits them to filter the services discovered when the Akri agent browses a network.</p>
    </div>
    <a href="/posts/201202/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/zeroconf/" class="link blue hover-black">
            Tag: Zeroconf
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201202/" class="link black dim">
        pest: parsing in Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A Microsoft engineer introduced me to <a href="https://pest.rs"><code>pest</code></a> as a way to introduce service filtering in a ZeroConf plugin that I&rsquo;m prototyping for <a href="https://github.com/deislabs/akri">Akri</a>. It&rsquo;s been fun to learn but I worry that, because I won&rsquo;t use it frequently, I&rsquo;m going to quickly forget what I&rsquo;ve done. So, here are my notes.</p>
<p>Here&rsquo;s the problem, I&rsquo;d like to be able to provide users of the ZeroConf plugin with a string-based filter that permits them to filter the services discovered when the Akri agent browses a network.</p>
    </div>
    <a href="/posts/201202/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/github-actions/" class="link blue hover-black">
            Tag: Github-Actions
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201029/" class="link black dim">
        GitHub Actions &amp;&amp; GitHub Container Registry
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>You know when you start something and then regret it!? I think I&rsquo;ll be sticking with <a href="https://cloud.google.com/cloud-build">Google Cloud Build</a>; <a href="https://github.com/features/actions">GitHub Actions</a> appears functional and useful but I found the documentation to be confusing and limited and struggled to get a simple container image build|push working.</p>
<p>I&rsquo;ve long used <a href="https://hub.docker.com">Docker Hub</a> but am planning to use it less as a result of the planned <a href="https://www.docker.com/blog/scaling-docker-to-serve-millions-more-developers-network-egress/">changes</a>. I want to see Docker succeed and to do so it needs to find a way to make money but, there are free alternatives including the new <a href="https://github.blog/2020-09-01-introducing-github-container-registry/">GitHub Container Registry</a> and the very very cheap <a href="https://cloud.google.com/container-registry">Google Container Registry</a>.</p>
    </div>
    <a href="/posts/201029/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/microsoft/" class="link blue hover-black">
            Tag: Microsoft
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201022/" class="link black dim">
        akri
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I was very interested to read about Microsoft&rsquo;s DeisLab&rsquo;s latest (rust-based) Kubernetes project: <a href="https://cloudblogs.microsoft.com/opensource/2020/10/20/announcing-akri-open-source-project-building-connected-edge-kubernetes/">akri</a>. If I understand it correctly, it provides a mechanism to make any (IoT) device accessible to containers running within a cluster. I need to spend more time playing around with it so that I can fully understand it. I had some problems getting the <a href="https://github.com/deislabs/akri/blob/main/docs/end-to-end-demo.md">End-to-End</a> demo running on Google Compute Engine (and then I tried DigitalOcean droplet) instances. So, here&rsquo;s a two-ways solution to get you going.</p>
    </div>
    <a href="/posts/201022/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/rocket/" class="link blue hover-black">
            Tag: Rocket
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/201008/" class="link black dim">
        Deploying a Rust HTTP server to DigitalOcean App Platform
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://digitalocean.com">DigitalOcean</a> launched an <a href="https://www.digitalocean.com/blog/introducing-digitalocean-app-platform-reimagining-paas-to-make-it-simpler-for-you-to-build-deploy-and-scale-apps">App Platform</a> with many <a href="https://www.digitalocean.com/docs/app-platform/languages-frameworks/">Supported Languages and Frameworks</a>. I used <a href="https://www.digitalocean.com/docs/app-platform/languages-frameworks/go/">Golang</a> first, then wondered how to use non-natively-supported languages, i.e. Rust.</p>
<p>The good news is that <a href="https://www.digitalocean.com/docs/app-platform/languages-frameworks/docker/">Docker</a> is a supported framework and so, you can run pretty much anything.</p>
<p>Repo: <a href="https://github.com/DazWilkin/do-apps-rust">https://github.com/DazWilkin/do-apps-rust</a></p>
<h2 id="rust">Rust</h2>
<p>I&rsquo;m a Rust noob. I&rsquo;m always receptive to feedback on improvements to the code. I looked to mirror the Golang example. I&rsquo;m using <a href="https://crates.io/crates/rocket">rocket</a> and <a href="https://crates.io/crates/rocket-prometheus">rocket-prometheus</a> for the first time:</p>
<p>You will want to install rust nightly (as Rocket has a dependency that requires it) and then you can override the default toolchain for the current project using:</p>
    </div>
    <a href="/posts/201008/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cloud-storage/" class="link blue hover-black">
            Tag: Cloud-Storage
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200930/" class="link black dim">
        Hugo and Google Cloud Storage
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using <a href="https://gohugo.io">Hugo</a> as a static site generator for <a href="https://pretired.dazwilkin.com">this</a> blog. I&rsquo;m using <a href="https://firebase.google.com">Firebase</a> (for free) to host <a href="https://lefsilver.com">lefsilver</a>.</p>
<p>I have other domains that I want to promote and decided to use Google Cloud Storage buckets for these sites. Using <a href="https://cloud.google.com/storage">Google Cloud Storage</a> for <a href="https://cloud.google.com/storage/docs/hosting-static-website">Hosting a static website</a> and using Hugo to deploy sites to <a href="https://gohugo.io/hosting-and-deployment/hugo-deploy/#google-cloud-storage-gcs">Google Cloud Storage (GCS)</a> are documented but, I didn&rsquo;t find a location where this is combined into a single tutorial and I wanted to add an explanation for ensuring your sites are included in Google&rsquo;s and Bing&rsquo;s search indexes.</p>
    </div>
    <a href="/posts/200930/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/gcs/" class="link blue hover-black">
            Tag: GCS
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200930/" class="link black dim">
        Hugo and Google Cloud Storage
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m using <a href="https://gohugo.io">Hugo</a> as a static site generator for <a href="https://pretired.dazwilkin.com">this</a> blog. I&rsquo;m using <a href="https://firebase.google.com">Firebase</a> (for free) to host <a href="https://lefsilver.com">lefsilver</a>.</p>
<p>I have other domains that I want to promote and decided to use Google Cloud Storage buckets for these sites. Using <a href="https://cloud.google.com/storage">Google Cloud Storage</a> for <a href="https://cloud.google.com/storage/docs/hosting-static-website">Hosting a static website</a> and using Hugo to deploy sites to <a href="https://gohugo.io/hosting-and-deployment/hugo-deploy/#google-cloud-storage-gcs">Google Cloud Storage (GCS)</a> are documented but, I didn&rsquo;t find a location where this is combined into a single tutorial and I wanted to add an explanation for ensuring your sites are included in Google&rsquo;s and Bing&rsquo;s search indexes.</p>
    </div>
    <a href="/posts/200930/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cloud-build/" class="link blue hover-black">
            Tag: Cloud Build
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200928/" class="link black dim">
        Rube Goldberg Cloud Build machine for solving Quadratic equations
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google <a href="https://cloud.google.com/cloud-build/docs/build-config">Cloud Build</a> is described by Google as a &ldquo;CI/CD platform&rdquo; but it&rsquo;s fundamentally a service that permits a series of containers to be chained together in a pipeline, optionally leveraging shared data.</p>
<p>As a CI/CD platform, it can be used to lint, test, compile and build software but, if you were looking for a way to explain its basic awesomeness, you could&hellip; I don&rsquo;t know&hellip; build a Rube Goldberg style machine that solves Quadratic equations using it 😄</p>
    </div>
    <a href="/posts/200928/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200206/" class="link black dim">
        Cloud Build wishlist: Mountable Golang Modules Proxy
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I think it would be valuable if Google were to provide volumes in <a href="https://cloud.google.com/cloud-build">Cloud Build</a> of package registries (e.g. <a href="https://proxy.golang.org">Go Modules</a>; <a href="https://pypi.org">PyPi</a>; <a href="https://search.maven.org/">Maven</a>; <a href="https://www.npmjs.com/">NPM</a> etc.).</p>
<p>Google provides a <a href="https://cloud.google.com/container-registry/docs/using-dockerhub-mirroring">mirror</a> of a subset of Docker Hub. This confers several benefits: Google&rsquo;s imprimatur; speed (latency); bandwidth; and convenience.</p>
<p>The same benefits would apply to package registries.</p>
<p>In the meantime, there&rsquo;s a hacky way to gain some of the benefits of these when using Cloud Build.</p>
<p>In the following example, I&rsquo;ll show an approach using Golang Modules and Google&rsquo;s module proxy aka <code>proxy.golang.org</code>.</p>
    </div>
    <a href="/posts/200206/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cloud-shell/" class="link blue hover-black">
            Tag: Cloud Shell
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200917/" class="link black dim">
        Visual Studio Code plus Google Cloud Shell
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="update-2020-09-24">Update: 2020-09-24</h2>
<p>Three updates since I wrote the post:</p>
<h3 id="gcloud-alpha-cloud-shell-get-mount-command-dir"><code>gcloud alpha cloud-shell get-mount-command ${DIR}</code></h3>
<p>It&rsquo;s possible to use <code>sshfs</code> to mount the Cloud Shell home directory locally:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>DIR<span style="color:#f92672">=</span>/path/to/dir
</span></span><span style="display:flex;"><span>gcloud alpha cloud-shell get-mount-command <span style="color:#e6db74">${</span>DIR<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>Which generates something of the form:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sshfs <span style="color:#f92672">[[</span>USERNAME<span style="color:#f92672">]]</span>@<span style="color:#f92672">[[</span>HOST<span style="color:#f92672">]]</span>: <span style="color:#e6db74">${</span>DIR<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p <span style="color:#f92672">[[</span>PORT<span style="color:#f92672">]]</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-oIdentityFile<span style="color:#f92672">=</span>~/.ssh/google_compute_engine <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-oStrictHostKeyChecking<span style="color:#f92672">=</span>no
</span></span></code></pre></div><p>You may then <code>code --new-window ${DIR}</code></p>
<h3 id="curl-command-may-lack-sshhost">curl command may lack <code>.sshHost</code></h3>
<p>curl&rsquo;ing the <code>cloudshell.googleapis.com</code> endpoint will result in a null value for <code>.sshHost</code> if the Cloud Shell VM must be recreated. The <code>gcloud</code> command avoids this by using an operation to poll the endpoint until the VM exists. The hacky alternative is to run <code>gcloud alpha cloud-shell ssh</code> to force the VM to be created before running the curl command.</p>
    </div>
    <a href="/posts/200917/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/visual-studio-code/" class="link blue hover-black">
            Tag: Visual Studio Code
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200917/" class="link black dim">
        Visual Studio Code plus Google Cloud Shell
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="update-2020-09-24">Update: 2020-09-24</h2>
<p>Three updates since I wrote the post:</p>
<h3 id="gcloud-alpha-cloud-shell-get-mount-command-dir"><code>gcloud alpha cloud-shell get-mount-command ${DIR}</code></h3>
<p>It&rsquo;s possible to use <code>sshfs</code> to mount the Cloud Shell home directory locally:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>DIR<span style="color:#f92672">=</span>/path/to/dir
</span></span><span style="display:flex;"><span>gcloud alpha cloud-shell get-mount-command <span style="color:#e6db74">${</span>DIR<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>Which generates something of the form:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sshfs <span style="color:#f92672">[[</span>USERNAME<span style="color:#f92672">]]</span>@<span style="color:#f92672">[[</span>HOST<span style="color:#f92672">]]</span>: <span style="color:#e6db74">${</span>DIR<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p <span style="color:#f92672">[[</span>PORT<span style="color:#f92672">]]</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-oIdentityFile<span style="color:#f92672">=</span>~/.ssh/google_compute_engine <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-oStrictHostKeyChecking<span style="color:#f92672">=</span>no
</span></span></code></pre></div><p>You may then <code>code --new-window ${DIR}</code></p>
<h3 id="curl-command-may-lack-sshhost">curl command may lack <code>.sshHost</code></h3>
<p>curl&rsquo;ing the <code>cloudshell.googleapis.com</code> endpoint will result in a null value for <code>.sshHost</code> if the Cloud Shell VM must be recreated. The <code>gcloud</code> command avoids this by using an operation to poll the endpoint until the VM exists. The hacky alternative is to run <code>gcloud alpha cloud-shell ssh</code> to force the VM to be created before running the curl command.</p>
    </div>
    <a href="/posts/200917/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/actions/" class="link blue hover-black">
            Tag: Actions
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200916/" class="link black dim">
        Actions SDK Conversational Quickstart
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google&rsquo;s tutorial didn&rsquo;t work for me.</p>
<p>In this post, I&rsquo;ll help you get this working.</p>
<p><a href="https://developers.google.com/assistant/conversational/quickstart">https://developers.google.com/assistant/conversational/quickstart</a></p>
<h2 id="create-and-set-up-a-project"><a href="https://developers.google.com/assistant/conversational/quickstart">Create and set up a project</a></h2>
<p>This mostly works.</p>
<p>I recommend using the <a href="https://console.actions.google.com">Actions Console</a> as described to create the project.</p>
<p>I chose &ldquo;Custom&rdquo; and &ldquo;Blank Project&rdquo;</p>
<p>You need <strong>not</strong> enable <a href="https://console.developers.google.com/apis/library/actions.googleapis.com?q=actions">Actions API</a> as this is done automatically:</p>
<p><img src="/images/200916.api_library.png" alt="Actions API"></p>
<p>For the console work, I&rsquo;m going to use Google&rsquo;s excellent Cloud Shell. You may access this through the browser <strong>or</strong> through a terminal:</p>
    </div>
    <a href="/posts/200916/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/actions-sdk/" class="link blue hover-black">
            Tag: Actions-Sdk
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200916/" class="link black dim">
        Actions SDK Conversational Quickstart
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google&rsquo;s tutorial didn&rsquo;t work for me.</p>
<p>In this post, I&rsquo;ll help you get this working.</p>
<p><a href="https://developers.google.com/assistant/conversational/quickstart">https://developers.google.com/assistant/conversational/quickstart</a></p>
<h2 id="create-and-set-up-a-project"><a href="https://developers.google.com/assistant/conversational/quickstart">Create and set up a project</a></h2>
<p>This mostly works.</p>
<p>I recommend using the <a href="https://console.actions.google.com">Actions Console</a> as described to create the project.</p>
<p>I chose &ldquo;Custom&rdquo; and &ldquo;Blank Project&rdquo;</p>
<p>You need <strong>not</strong> enable <a href="https://console.developers.google.com/apis/library/actions.googleapis.com?q=actions">Actions API</a> as this is done automatically:</p>
<p><img src="/images/200916.api_library.png" alt="Actions API"></p>
<p>For the console work, I&rsquo;m going to use Google&rsquo;s excellent Cloud Shell. You may access this through the browser <strong>or</strong> through a terminal:</p>
    </div>
    <a href="/posts/200916/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/assistant/" class="link blue hover-black">
            Tag: Assistant
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200916/" class="link black dim">
        Actions SDK Conversational Quickstart
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google&rsquo;s tutorial didn&rsquo;t work for me.</p>
<p>In this post, I&rsquo;ll help you get this working.</p>
<p><a href="https://developers.google.com/assistant/conversational/quickstart">https://developers.google.com/assistant/conversational/quickstart</a></p>
<h2 id="create-and-set-up-a-project"><a href="https://developers.google.com/assistant/conversational/quickstart">Create and set up a project</a></h2>
<p>This mostly works.</p>
<p>I recommend using the <a href="https://console.actions.google.com">Actions Console</a> as described to create the project.</p>
<p>I chose &ldquo;Custom&rdquo; and &ldquo;Blank Project&rdquo;</p>
<p>You need <strong>not</strong> enable <a href="https://console.developers.google.com/apis/library/actions.googleapis.com?q=actions">Actions API</a> as this is done automatically:</p>
<p><img src="/images/200916.api_library.png" alt="Actions API"></p>
<p>For the console work, I&rsquo;m going to use Google&rsquo;s excellent Cloud Shell. You may access this through the browser <strong>or</strong> through a terminal:</p>
    </div>
    <a href="/posts/200916/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/trillian/" class="link blue hover-black">
            Tag: Trillian
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200908/" class="link black dim">
        Trillian Map Mode
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Chatting with one of Google&rsquo;s Trillian team, I was encouraged to explore Trillian&rsquo;s <a href="https://github.com/google/trillian#map-mode">Map Mode</a>. The following is the result of some spelunking through this unfamiliar cave. I can&rsquo;t provide any guarantee that this usage is correct or sufficient.</p>
<p>Here&rsquo;s the repo: <a href="https://github.com/DazWilkin/go-trillian-map">https://github.com/DazWilkin/go-trillian-map</a></p>
<p>I&rsquo;ve written about Trillian <a href="https://github.com/google/trillian#log-mode">Log Mode</a> <a href="/tags/trillian/">elsewhere</a>.</p>
<p>I uncovered use of Trillian Map Mode through Trillian&rsquo;s integration <a href="https://github.com/google/trillian/blob/master/integration/maptest/map.go">tests</a>. I&rsquo;m unclear on the distinction between <code>TrillianMapClient</code> and <code>TrillianMapWriteClient</code> but the latter served most of my needs.</p>
    </div>
    <a href="/posts/200908/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200817/" class="link black dim">
        WASM Transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been playing around with a proof-of-concept combining WASM and <a href="https://github.com/google/trillian">Trillian</a>. The hypothesis was to explore using WASM as a form of chaincode with Trillian. The project works but it&rsquo;s far from being a chaincode-like solution.</p>
<p>Let&rsquo;s start with a couple of (trivial) examples and then I&rsquo;ll explain what&rsquo;s going on and how it&rsquo;s implemented.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Method: mul
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [Client:Invoke] Metadata: complex.wasm
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Success: result:{real:0.036980484 imag:0.3898267}
</span></span></code></pre></div><p>After shipping a Rust-sourced WASM solution (<code>complex.wasm</code>) to the WASM transparency server, the client invokes a method <code>mul</code> that&rsquo;s exposed by it using a dynamically generated request message and outputs the response. Woo hoo! Yes, an expensive way to multiple complex numbers.</p>
    </div>
    <a href="/posts/200817/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200429/" class="link black dim">
        Rust implementation of Crate Transparency using Google Trillian
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been hacking on a Rust-based transparent application for Google Trillian. As appears to be my fixation, this personality is for another package manager. This time, Rust&rsquo;s <a href="https://doc.rust-lang.org/1.0.0/book/crates-and-modules.html">Crates</a> often found in <a href="https://crates.io"><code>crates.io</code></a> which is Rust&rsquo;s Package Registry. I discussed this project earlier this month <a href="/posts/200403/">Rust Crate Transparency &amp;&amp; Rust SDK for Google Trillian</a> and and earlier approach for Python&rsquo;s packages with <a href="/posts/190907/">pypi-transparency</a>.</p>
<p>This time, of course, I&rsquo;m using Rust. And, by way of a first for me, for the gRPC server implementation (aka &ldquo;personality&rdquo;). I&rsquo;ve been lazy thanks to the excellent <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a> and have been using it way of a client. Because I&rsquo;m more familiar with Golang and because I&rsquo;ve written (most) other Trillian personalities in Golang, I resorted to quickly implementing Crate Transparency in Golang too in order to uncover bugs with the Rust implementation. I&rsquo;ll write a follow-up post on the complexity I seem to struggle with when using protobufs and gRPC [in Golang].</p>
    </div>
    <a href="/posts/200429/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200403/" class="link black dim">
        Rust Crate Transparency &amp;&amp; Rust SDK for Google Trillian
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m noodling the utility of a Transparency solution for Rust Crates. When developers push crates to Cargo, a bunch of metadata is associated with the crate. E.g. <a href="https://crates.io/crates/protobuf"><code>protobuf</code></a>. As with Golang Modules, Python packages on PyPi etc., there appears to be utility in making tamperproof recordings of these publications. Then, other developers may confirm that a crate pulled from cates.io is highly unlikely to have been changed.</p>
<p>On Linux, Cargo stores downloaded crates under <code>${HOME}/.crates/registry</code>. In the case of the latest version (<code>2.12.0</code>) of <code>protobuf</code>, on my machine, I have:</p>
    </div>
    <a href="/posts/200403/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200326/" class="link black dim">
        Google Trillian on Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written previously (<a href="https://medium.com/google-cloud/google-trillian-for-noobs-1a-c87a78e5e585">Google Trillian for Noobs</a>) about Google&rsquo;s interesting project <a href="https://github.com/google/trillian">Trillian</a> and about some of the &ldquo;personalities&rdquo; (e.g. <a href="/posts/190907/">PyPi Transparency</a>) that I&rsquo;ve build using it.</p>
<p>Having gone slight cra-cra on <a href="https://cloud.google.com/run">Cloud Run</a> and <a href="https://grpc.io">gRPC</a> this week with <a href="/posts/200320/">Golang gRPC Cloud Run</a> and <a href="/posts/200325/">gRPC, Cloud Run &amp; Endpoints</a>, I thought it&rsquo;d be fun to deploy Trillian and a personality to Cloud Run.</p>
<p>It mostly (!) works :-)</p>
<p>At the end of the post, I&rsquo;ve summarized creating a Cloud SQL instance to host the Trillian data(base).</p>
    </div>
    <a href="/posts/200326/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190930/" class="link black dim">
        PyPi Transparency Client (Rust)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve finally being able to hack my way through to a working Rust gRPC client (for <a href="/posts/190926/">PyPi Transparency</a>).</p>
<p>It&rsquo;s not very good: poorly structured, hacky etc. but it serves the purpose of giving me a foothold into Rust development so that I can evolve it as I learn the language and its practices.</p>
<p>There are several Rust crates (SDK) for gRPC. There&rsquo;s no sanctioned SDK for Rust on <a href="https://grpc.io">grpc.io</a>.</p>
<p>I chose <a href="https://github.com/stepancheg">stepancheg</a>&rsquo;s <a href="https://github.com/stepancheg/grpc-rust">grpc-rust</a> because it&rsquo;s a pure Rust implementation (not built atop the C implementation).</p>
    </div>
    <a href="/posts/190930/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190926/" class="link black dim">
        PyPi Transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been noodling around with another <a href="https://github.com/google/trillian">Trillian</a> personality.</p>
<p>Another in a theme that interests me in providing tamperproof logs for the packages in the popular package management registries.</p>
<p>The Golang team recently announced <a href="https://proxy.golang.org/">Go Module Mirror</a> which is built atop Trillian. It seems to me that all the package registries (<a href="https://proxy.golang.org">Go Modules</a>, <a href="https://www.npmjs.com">npm</a>, <a href="https://mvnrepository.com">Maven</a>, <a href="https://nuget.org">NuGet</a> etc.) would benefit from tamperproof logs hosted by a trusted 3rd-party.</p>
<p>As you may have guessed, PyPi Transparency is a log for <a href="https://pypi.org">PyPi</a> packages. PyPi is comprehensive, definitive and trusted but, as with Go Module Mirror, it doesn&rsquo;t hurt to provide a backup of some of its data. In the case of this solution, Trillian hosts a log of self-calculated SHA-256 hashes for Python packages that are added to it.</p>
    </div>
    <a href="/posts/190926/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190907/" class="link black dim">
        pypi-transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The goal of pypi-transparency is very similar to the underlying motivation for the Golang team&rsquo;s <a href="https://sum.golang.org/">Checksum Database</a> (also built with Trillian).</p>
<p>Even though, <a href="https://pypi.org">PyPi</a> provides hashes of the content of packages it hosts, the developer must trust that PyPi&rsquo;s data is consistent. One ambition with pypi-transparency is to provide a companion, tamperproof log of PyPi package files in order to provide a double-check of these hashes.</p>
<p>It is important to understand what this does (and does not) provide. There&rsquo;s no validation of a package&rsquo;s content. The only calculation is that, on first observation, a SHA-256 hash is computed of the package&rsquo;s content and the hash is recorded. If the package is subsequently altered, it&rsquo;s very probable that the hash will change and this provides a signal to the user that the package&rsquo;s contents has changed. Because pypi-transparency uses a tamperproof log, it&rsquo;s very difficult to update the hash recorded in the tamperproof log, to reflect this change. Corrolary: pypi-transparency will record the hashes of packages that include malicious code.</p>
    </div>
    <a href="/posts/190907/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/binaryen/" class="link blue hover-black">
            Tag: Binaryen
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200819/" class="link black dim">
        Minimizing WASM binaries
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve spent time recently playing around with WebAssembly (WASM) and <a href="https://github.com/wapc">waPC</a>. Rust and WASM were born at Mozilla and there&rsquo;s a natural affinity with writing WASM binaries in Rust. In the WASM examples I&rsquo;ve been using for <a href="/posts/200817/">WASM Transparency</a>, <a href="/posts/200807/">waPC and MsgPack</a> and <a href="/posts/200612/">waPC and Protobufs</a>.</p>
<p>I&rsquo;ve created 3 WASM binaries: <code>complex.wasm</code>, <code>simplex.wasm</code> and <code>fabcar.wasm</code> and each is about 2.5MB when:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cargo build --target<span style="color:#f92672">=</span>wasm32-unknown-unknown --release
</span></span></code></pre></div><p>The <a href="https://rustwasm.github.io/docs/book">Rust and WebAssembly</a> book has an excellent section titled <a href="https://rustwasm.github.io/docs/book/reference/code-size.html">Shrinking <code>.wasm.</code> Code Size</a>. So, let&rsquo;s see what help that provides.</p>
    </div>
    <a href="/posts/200819/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/twiggy/" class="link blue hover-black">
            Tag: Twiggy
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200819/" class="link black dim">
        Minimizing WASM binaries
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve spent time recently playing around with WebAssembly (WASM) and <a href="https://github.com/wapc">waPC</a>. Rust and WASM were born at Mozilla and there&rsquo;s a natural affinity with writing WASM binaries in Rust. In the WASM examples I&rsquo;ve been using for <a href="/posts/200817/">WASM Transparency</a>, <a href="/posts/200807/">waPC and MsgPack</a> and <a href="/posts/200612/">waPC and Protobufs</a>.</p>
<p>I&rsquo;ve created 3 WASM binaries: <code>complex.wasm</code>, <code>simplex.wasm</code> and <code>fabcar.wasm</code> and each is about 2.5MB when:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cargo build --target<span style="color:#f92672">=</span>wasm32-unknown-unknown --release
</span></span></code></pre></div><p>The <a href="https://rustwasm.github.io/docs/book">Rust and WebAssembly</a> book has an excellent section titled <a href="https://rustwasm.github.io/docs/book/reference/code-size.html">Shrinking <code>.wasm.</code> Code Size</a>. So, let&rsquo;s see what help that provides.</p>
    </div>
    <a href="/posts/200819/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/wasm/" class="link blue hover-black">
            Tag: Wasm
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200819/" class="link black dim">
        Minimizing WASM binaries
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve spent time recently playing around with WebAssembly (WASM) and <a href="https://github.com/wapc">waPC</a>. Rust and WASM were born at Mozilla and there&rsquo;s a natural affinity with writing WASM binaries in Rust. In the WASM examples I&rsquo;ve been using for <a href="/posts/200817/">WASM Transparency</a>, <a href="/posts/200807/">waPC and MsgPack</a> and <a href="/posts/200612/">waPC and Protobufs</a>.</p>
<p>I&rsquo;ve created 3 WASM binaries: <code>complex.wasm</code>, <code>simplex.wasm</code> and <code>fabcar.wasm</code> and each is about 2.5MB when:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cargo build --target<span style="color:#f92672">=</span>wasm32-unknown-unknown --release
</span></span></code></pre></div><p>The <a href="https://rustwasm.github.io/docs/book">Rust and WebAssembly</a> book has an excellent section titled <a href="https://rustwasm.github.io/docs/book/reference/code-size.html">Shrinking <code>.wasm.</code> Code Size</a>. So, let&rsquo;s see what help that provides.</p>
    </div>
    <a href="/posts/200819/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200817/" class="link black dim">
        WASM Transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been playing around with a proof-of-concept combining WASM and <a href="https://github.com/google/trillian">Trillian</a>. The hypothesis was to explore using WASM as a form of chaincode with Trillian. The project works but it&rsquo;s far from being a chaincode-like solution.</p>
<p>Let&rsquo;s start with a couple of (trivial) examples and then I&rsquo;ll explain what&rsquo;s going on and how it&rsquo;s implemented.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Method: mul
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [Client:Invoke] Metadata: complex.wasm
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Success: result:{real:0.036980484 imag:0.3898267}
</span></span></code></pre></div><p>After shipping a Rust-sourced WASM solution (<code>complex.wasm</code>) to the WASM transparency server, the client invokes a method <code>mul</code> that&rsquo;s exposed by it using a dynamically generated request message and outputs the response. Woo hoo! Yes, an expensive way to multiple complex numbers.</p>
    </div>
    <a href="/posts/200817/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200807/" class="link black dim">
        waPC and MsgPack (Rust|Golang)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>As my reader will know (Hey Mom!), I&rsquo;ve been noodling around with WASM and <a href="https://github.com/wapc">waPC</a>. I&rsquo;ve been exploring ways to pass structured messages across the host:guest boundary.</p>
<p><a href="https://developers.google.com/protocol-buffers">Protobufs</a> was my first choice. <a href="https://medium.com/@KevinHoffman">@KevinHoffman</a> created waPC and <a href="https://github.com/wascc">waSCC</a> and he <a href="https://medium.com/@KevinHoffman/interface-types-are-basically-a-way-of-embedding-metadata-into-a-wasm-file-so-that-arbitrary-data-14965ebdfa48">explained</a> to me and that wSCC uses <a href="https://msgpack.org/">Message Pack</a>.</p>
<p>It&rsquo;s slightly surprising to me (still) that technologies like this exist with <strong>everyone</strong> else seemingly using them and I&rsquo;ve not heard of them. I don&rsquo;t expect to know everything but I&rsquo;m surprised I&rsquo;ve not stumbled upon msgpack until now.</p>
    </div>
    <a href="/posts/200807/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200723/" class="link black dim">
        Envoy WASM filters in Rust
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A digression thanks to <a href="https://blog.salrashid.me/">Sal Rashid</a> who&rsquo;s exploring WASM filters w/ Envoy.</p>
<p>The documentation is sparse but:</p>
<ul>
<li><a href="https://banzaicloud.com/blog/envoy-wasm-filter/">How to write WASM filters for Envoy&hellip;</a></li>
</ul>
<p>There is a Rust SDK but it&rsquo;s not documented:</p>
<ul>
<li><a href="https://github.com/proxy-wasm/proxy-wasm-rust-sdk">proxy-wasm-rust-sdk</a></li>
</ul>
<p>I found two useful posts by Rustaceans who were able to make use of it:</p>
<ul>
<li><a href="https://antweiss.com/blog/extending-envoy-with-wasm-and-rust/">Extending Envoy with WASM and Rust</a></li>
<li><a href="https://blog.red-badger.com/extending-istio-with-rust-and-webassembly">Extending Istio with Rust and WebAssembly</a></li>
</ul>
<p>Here&rsquo;s my simple use of the SDK&rsquo;s examples.</p>
<h2 id="wasme">wasme</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -sL https://run.solo.io/wasme/install | sh
</span></span><span style="display:flex;"><span>PATH<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PATH<span style="color:#e6db74">}</span>:<span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.wasme/bin
</span></span><span style="display:flex;"><span>wasme --version
</span></span></code></pre></div><p>It may be possible to avoid creating an account on WebAssemblyHub if you&rsquo;re staying local.</p>
    </div>
    <a href="/posts/200723/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200717/" class="link black dim">
        Remotely invoking WASM functions using gRPC and waPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Following on from <a href="/posts/200612/">waPC &amp; Protobufs</a>, I can now remotely invoke (arbitrary) WASM functions:</p>
<p>Client:</p>
<p>The logging isn&rsquo;t perfectly clear but, the client gets (a previously added) WASM binary from the server (using the SHA-256 of the WASM binary as a unique identifier). The result includes metadata that includes a protobuf descriptor of the WASM binary&rsquo;s functions. The descriptor defines gRPC services (that represent the WASM functions) with input (parameters) and output (results) messages.</p>
    </div>
    <a href="/posts/200717/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200617/" class="link black dim">
        WASM Cloud Functions
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Following on from <a href="/posts/200612/">waPC &amp; Protobufs</a> and a question on Stack Overflow about Cloud Functions, I was compelled to try running WASM on Cloud Functions no JavaScript.</p>
<p>I wanted to reuse the WASM waPC functions that I&rsquo;d written in Rust as described in the other post. Cloud Functions does not (yet!?) provide a Rust runtime and so I&rsquo;m using the <a href="https://github.com/wapc/wapc-go">waPC Host for Go</a> in this example.</p>
<p>It works!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PARAMS<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>printf <span style="color:#e6db74">&#39;{&#34;a&#34;:{&#34;real&#34;:39,&#34;imag&#34;:3},&#34;b&#34;:{&#34;real&#34;:39,&#34;imag&#34;:3}}&#39;</span> | base64<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>gcloud auth print-identity-token<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;filename\&#34;:\&#34;complex.wasm\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;function\&#34;:\&#34;c:mul\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;params\&#34;:\&#34;</span><span style="color:#e6db74">${</span>PARAMS<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#34;</span> |<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request POST <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--data @- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span>-<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>.cloudfunctions.net/invoker
</span></span></code></pre></div><p>yields (correctly):</p>
    </div>
    <a href="/posts/200617/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200612/" class="link black dim">
        waPC &amp; Protobufs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m hacking around with a solution that combines WASM and Google <a href="https://github.com/google/trillian">Trillian</a>.</p>
<p>Ultimately, I&rsquo;d like to be able to ship WASM (binaries) to a Trillian personality and then invoke (exported) functions on them. Some this was borne from the interesting exploration of <a href="https://github.com/deislabs/krustlet">Krustlet</a> and its application of <a href="https://wascc.dev/">wascc</a>.</p>
<p>I&rsquo;m still booting into WASM but it&rsquo;s a <em>very</em> interesting technology that has most interesting potential outside the browser. Some folks have been trailblazing the technology and I have been reading Kevin Hoffman&rsquo;s <a href="https://medium.com/@KevinHoffman">medium</a> and <a href="https://wascc.dev/">wascc</a> (nee waxosuit) work. From this, I stumbled upon Kevin&rsquo;s <a href="https://medium.com/@KevinHoffman/introducing-wapc-dc9d8b0c2223">waPC</a> and I&rsquo;m using waPC in this prototyping as a way to exchange data between clients and servers running WASM binaries.</p>
    </div>
    <a href="/posts/200612/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200508/" class="link black dim">
        Google Container Registry w/ OCI
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been spending some time this week with <a href="https://github.com/deislabs/krustlet">Krustlet</a>.</p>
<p>I&rsquo;m working on documenting how to run Krustlet(s) alongside <a href="https://cloud.google.com/kubernetes-engine">GKE</a>. I&rsquo;ve been running a Krustlet with <a href="https://microk8s.io">MicroK8s</a>.</p>
<p>The Krustlet demos reference WASM assemblines stored in Azure Container Registry as OCI containers. <a href="https://cloud.google.com/container-registry">Google Container Registry</a> supports <a href="https://cloud.google.com/container-registry/docs/image-formats#oci_format">OCI format</a> and so I tried (successfully) using GCR instead of AZR.</p>
<p>There may be an easier approach but this is how I got this working.</p>
<p>Krustlet uses <a href="https://github.com/engineerd/wasm-to-oci"><code>wasm-to-oci</code></a>. I was challenged by <code>wasm-to-oci</code> authentication. <code>wasm-to-oci</code> uses <a href="https://github.com/deislabs/oras"><code>ORAS</code></a>. It turns out that, after authenticating using ORAS, I&rsquo;m able to use <code>wasm-to-oci</code> to authenticate to a GCR registry!</p>
    </div>
    <a href="/posts/200508/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/gprc/" class="link blue hover-black">
            Tag: Gprc
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200817/" class="link black dim">
        WASM Transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been playing around with a proof-of-concept combining WASM and <a href="https://github.com/google/trillian">Trillian</a>. The hypothesis was to explore using WASM as a form of chaincode with Trillian. The project works but it&rsquo;s far from being a chaincode-like solution.</p>
<p>Let&rsquo;s start with a couple of (trivial) examples and then I&rsquo;ll explain what&rsquo;s going on and how it&rsquo;s implemented.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Method: mul
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [Client:Invoke] Metadata: complex.wasm
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Success: result:{real:0.036980484 imag:0.3898267}
</span></span></code></pre></div><p>After shipping a Rust-sourced WASM solution (<code>complex.wasm</code>) to the WASM transparency server, the client invokes a method <code>mul</code> that&rsquo;s exposed by it using a dynamically generated request message and outputs the response. Woo hoo! Yes, an expensive way to multiple complex numbers.</p>
    </div>
    <a href="/posts/200817/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/wapc/" class="link blue hover-black">
            Tag: Wapc
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200817/" class="link black dim">
        WASM Transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been playing around with a proof-of-concept combining WASM and <a href="https://github.com/google/trillian">Trillian</a>. The hypothesis was to explore using WASM as a form of chaincode with Trillian. The project works but it&rsquo;s far from being a chaincode-like solution.</p>
<p>Let&rsquo;s start with a couple of (trivial) examples and then I&rsquo;ll explain what&rsquo;s going on and how it&rsquo;s implemented.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Method: mul
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Message
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [random:New] Float32
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [Client:Invoke] Metadata: complex.wasm
</span></span><span style="display:flex;"><span>2020/08/14 18:42:17 [main:loop:dynamic-invoke] Success: result:{real:0.036980484 imag:0.3898267}
</span></span></code></pre></div><p>After shipping a Rust-sourced WASM solution (<code>complex.wasm</code>) to the WASM transparency server, the client invokes a method <code>mul</code> that&rsquo;s exposed by it using a dynamically generated request message and outputs the response. Woo hoo! Yes, an expensive way to multiple complex numbers.</p>
    </div>
    <a href="/posts/200817/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200807/" class="link black dim">
        waPC and MsgPack (Rust|Golang)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>As my reader will know (Hey Mom!), I&rsquo;ve been noodling around with WASM and <a href="https://github.com/wapc">waPC</a>. I&rsquo;ve been exploring ways to pass structured messages across the host:guest boundary.</p>
<p><a href="https://developers.google.com/protocol-buffers">Protobufs</a> was my first choice. <a href="https://medium.com/@KevinHoffman">@KevinHoffman</a> created waPC and <a href="https://github.com/wascc">waSCC</a> and he <a href="https://medium.com/@KevinHoffman/interface-types-are-basically-a-way-of-embedding-metadata-into-a-wasm-file-so-that-arbitrary-data-14965ebdfa48">explained</a> to me and that wSCC uses <a href="https://msgpack.org/">Message Pack</a>.</p>
<p>It&rsquo;s slightly surprising to me (still) that technologies like this exist with <strong>everyone</strong> else seemingly using them and I&rsquo;ve not heard of them. I don&rsquo;t expect to know everything but I&rsquo;m surprised I&rsquo;ve not stumbled upon msgpack until now.</p>
    </div>
    <a href="/posts/200807/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200717/" class="link black dim">
        Remotely invoking WASM functions using gRPC and waPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Following on from <a href="/posts/200612/">waPC &amp; Protobufs</a>, I can now remotely invoke (arbitrary) WASM functions:</p>
<p>Client:</p>
<p>The logging isn&rsquo;t perfectly clear but, the client gets (a previously added) WASM binary from the server (using the SHA-256 of the WASM binary as a unique identifier). The result includes metadata that includes a protobuf descriptor of the WASM binary&rsquo;s functions. The descriptor defines gRPC services (that represent the WASM functions) with input (parameters) and output (results) messages.</p>
    </div>
    <a href="/posts/200717/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200617/" class="link black dim">
        WASM Cloud Functions
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Following on from <a href="/posts/200612/">waPC &amp; Protobufs</a> and a question on Stack Overflow about Cloud Functions, I was compelled to try running WASM on Cloud Functions no JavaScript.</p>
<p>I wanted to reuse the WASM waPC functions that I&rsquo;d written in Rust as described in the other post. Cloud Functions does not (yet!?) provide a Rust runtime and so I&rsquo;m using the <a href="https://github.com/wapc/wapc-go">waPC Host for Go</a> in this example.</p>
<p>It works!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PARAMS<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>printf <span style="color:#e6db74">&#39;{&#34;a&#34;:{&#34;real&#34;:39,&#34;imag&#34;:3},&#34;b&#34;:{&#34;real&#34;:39,&#34;imag&#34;:3}}&#39;</span> | base64<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>gcloud auth print-identity-token<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;filename\&#34;:\&#34;complex.wasm\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;function\&#34;:\&#34;c:mul\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	\&#34;params\&#34;:\&#34;</span><span style="color:#e6db74">${</span>PARAMS<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#34;</span> |<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request POST <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--data @- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>https://<span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span>-<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>.cloudfunctions.net/invoker
</span></span></code></pre></div><p>yields (correctly):</p>
    </div>
    <a href="/posts/200617/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200612/" class="link black dim">
        waPC &amp; Protobufs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m hacking around with a solution that combines WASM and Google <a href="https://github.com/google/trillian">Trillian</a>.</p>
<p>Ultimately, I&rsquo;d like to be able to ship WASM (binaries) to a Trillian personality and then invoke (exported) functions on them. Some this was borne from the interesting exploration of <a href="https://github.com/deislabs/krustlet">Krustlet</a> and its application of <a href="https://wascc.dev/">wascc</a>.</p>
<p>I&rsquo;m still booting into WASM but it&rsquo;s a <em>very</em> interesting technology that has most interesting potential outside the browser. Some folks have been trailblazing the technology and I have been reading Kevin Hoffman&rsquo;s <a href="https://medium.com/@KevinHoffman">medium</a> and <a href="https://wascc.dev/">wascc</a> (nee waxosuit) work. From this, I stumbled upon Kevin&rsquo;s <a href="https://medium.com/@KevinHoffman/introducing-wapc-dc9d8b0c2223">waPC</a> and I&rsquo;m using waPC in this prototyping as a way to exchange data between clients and servers running WASM binaries.</p>
    </div>
    <a href="/posts/200612/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/messagepack/" class="link blue hover-black">
            Tag: Messagepack
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200807/" class="link black dim">
        waPC and MsgPack (Rust|Golang)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>As my reader will know (Hey Mom!), I&rsquo;ve been noodling around with WASM and <a href="https://github.com/wapc">waPC</a>. I&rsquo;ve been exploring ways to pass structured messages across the host:guest boundary.</p>
<p><a href="https://developers.google.com/protocol-buffers">Protobufs</a> was my first choice. <a href="https://medium.com/@KevinHoffman">@KevinHoffman</a> created waPC and <a href="https://github.com/wascc">waSCC</a> and he <a href="https://medium.com/@KevinHoffman/interface-types-are-basically-a-way-of-embedding-metadata-into-a-wasm-file-so-that-arbitrary-data-14965ebdfa48">explained</a> to me and that wSCC uses <a href="https://msgpack.org/">Message Pack</a>.</p>
<p>It&rsquo;s slightly surprising to me (still) that technologies like this exist with <strong>everyone</strong> else seemingly using them and I&rsquo;ve not heard of them. I don&rsquo;t expect to know everything but I&rsquo;m surprised I&rsquo;ve not stumbled upon msgpack until now.</p>
    </div>
    <a href="/posts/200807/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/msgpack/" class="link blue hover-black">
            Tag: Msgpack
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200807/" class="link black dim">
        waPC and MsgPack (Rust|Golang)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>As my reader will know (Hey Mom!), I&rsquo;ve been noodling around with WASM and <a href="https://github.com/wapc">waPC</a>. I&rsquo;ve been exploring ways to pass structured messages across the host:guest boundary.</p>
<p><a href="https://developers.google.com/protocol-buffers">Protobufs</a> was my first choice. <a href="https://medium.com/@KevinHoffman">@KevinHoffman</a> created waPC and <a href="https://github.com/wascc">waSCC</a> and he <a href="https://medium.com/@KevinHoffman/interface-types-are-basically-a-way-of-embedding-metadata-into-a-wasm-file-so-that-arbitrary-data-14965ebdfa48">explained</a> to me and that wSCC uses <a href="https://msgpack.org/">Message Pack</a>.</p>
<p>It&rsquo;s slightly surprising to me (still) that technologies like this exist with <strong>everyone</strong> else seemingly using them and I&rsquo;ve not heard of them. I don&rsquo;t expect to know everything but I&rsquo;m surprised I&rsquo;ve not stumbled upon msgpack until now.</p>
    </div>
    <a href="/posts/200807/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/wascc/" class="link blue hover-black">
            Tag: Wascc
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200612/" class="link black dim">
        waPC &amp; Protobufs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m hacking around with a solution that combines WASM and Google <a href="https://github.com/google/trillian">Trillian</a>.</p>
<p>Ultimately, I&rsquo;d like to be able to ship WASM (binaries) to a Trillian personality and then invoke (exported) functions on them. Some this was borne from the interesting exploration of <a href="https://github.com/deislabs/krustlet">Krustlet</a> and its application of <a href="https://wascc.dev/">wascc</a>.</p>
<p>I&rsquo;m still booting into WASM but it&rsquo;s a <em>very</em> interesting technology that has most interesting potential outside the browser. Some folks have been trailblazing the technology and I have been reading Kevin Hoffman&rsquo;s <a href="https://medium.com/@KevinHoffman">medium</a> and <a href="https://wascc.dev/">wascc</a> (nee waxosuit) work. From this, I stumbled upon Kevin&rsquo;s <a href="https://medium.com/@KevinHoffman/introducing-wapc-dc9d8b0c2223">waPC</a> and I&rsquo;m using waPC in this prototyping as a way to exchange data between clients and servers running WASM binaries.</p>
    </div>
    <a href="/posts/200612/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/gcr/" class="link blue hover-black">
            Tag: GCR
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200508/" class="link black dim">
        Google Container Registry w/ OCI
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been spending some time this week with <a href="https://github.com/deislabs/krustlet">Krustlet</a>.</p>
<p>I&rsquo;m working on documenting how to run Krustlet(s) alongside <a href="https://cloud.google.com/kubernetes-engine">GKE</a>. I&rsquo;ve been running a Krustlet with <a href="https://microk8s.io">MicroK8s</a>.</p>
<p>The Krustlet demos reference WASM assemblines stored in Azure Container Registry as OCI containers. <a href="https://cloud.google.com/container-registry">Google Container Registry</a> supports <a href="https://cloud.google.com/container-registry/docs/image-formats#oci_format">OCI format</a> and so I tried (successfully) using GCR instead of AZR.</p>
<p>There may be an easier approach but this is how I got this working.</p>
<p>Krustlet uses <a href="https://github.com/engineerd/wasm-to-oci"><code>wasm-to-oci</code></a>. I was challenged by <code>wasm-to-oci</code> authentication. <code>wasm-to-oci</code> uses <a href="https://github.com/deislabs/oras"><code>ORAS</code></a>. It turns out that, after authenticating using ORAS, I&rsquo;m able to use <code>wasm-to-oci</code> to authenticate to a GCR registry!</p>
    </div>
    <a href="/posts/200508/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200207/" class="link black dim">
        Accessing GCR repos from Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Until today, I&rsquo;d not accessed a <a href="https://cloud.google.com/container-registry">Google Container Registry</a> repo from a <strong>non-GKE</strong> Kubernetes deployment.</p>
<p>It turns out that it&rsquo;s pretty well-documented (<a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/">link</a>) but, here&rsquo;s an end-end example.</p>
<p>Assuming:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BILLING<span style="color:#f92672">=[[</span>YOUR-BILLING<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=[[</span>YOUR-PROJECT<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>SERVER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;us.gcr.io&#34;</span>
</span></span></code></pre></div><p>If not already:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud projects create <span style="color:#f92672">{</span>$PROJECT<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud beta billing projects link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud services enable containerregistry.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><h2 id="container-registry">Container Registry</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>IMAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;busybox&#34;</span> <span style="color:#75715e"># Or ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker pull <span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker tag <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">${</span>SERVER<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker push <span style="color:#e6db74">${</span>SERVER<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud container images list-tags <span style="color:#e6db74">${</span>SERVER<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span></code></pre></div><h2 id="service-account">Service Account</h2>
<p>Create a service account that&rsquo;s permitted to download (read-only) images from this project&rsquo;s registry</p>
    </div>
    <a href="/posts/200207/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/oci/" class="link blue hover-black">
            Tag: Oci
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200508/" class="link black dim">
        Google Container Registry w/ OCI
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been spending some time this week with <a href="https://github.com/deislabs/krustlet">Krustlet</a>.</p>
<p>I&rsquo;m working on documenting how to run Krustlet(s) alongside <a href="https://cloud.google.com/kubernetes-engine">GKE</a>. I&rsquo;ve been running a Krustlet with <a href="https://microk8s.io">MicroK8s</a>.</p>
<p>The Krustlet demos reference WASM assemblines stored in Azure Container Registry as OCI containers. <a href="https://cloud.google.com/container-registry">Google Container Registry</a> supports <a href="https://cloud.google.com/container-registry/docs/image-formats#oci_format">OCI format</a> and so I tried (successfully) using GCR instead of AZR.</p>
<p>There may be an easier approach but this is how I got this working.</p>
<p>Krustlet uses <a href="https://github.com/engineerd/wasm-to-oci"><code>wasm-to-oci</code></a>. I was challenged by <code>wasm-to-oci</code> authentication. <code>wasm-to-oci</code> uses <a href="https://github.com/deislabs/oras"><code>ORAS</code></a>. It turns out that, after authenticating using ORAS, I&rsquo;m able to use <code>wasm-to-oci</code> to authenticate to a GCR registry!</p>
    </div>
    <a href="/posts/200508/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/crate/" class="link blue hover-black">
            Tag: Crate
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200429/" class="link black dim">
        Rust implementation of Crate Transparency using Google Trillian
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve been hacking on a Rust-based transparent application for Google Trillian. As appears to be my fixation, this personality is for another package manager. This time, Rust&rsquo;s <a href="https://doc.rust-lang.org/1.0.0/book/crates-and-modules.html">Crates</a> often found in <a href="https://crates.io"><code>crates.io</code></a> which is Rust&rsquo;s Package Registry. I discussed this project earlier this month <a href="/posts/200403/">Rust Crate Transparency &amp;&amp; Rust SDK for Google Trillian</a> and and earlier approach for Python&rsquo;s packages with <a href="/posts/190907/">pypi-transparency</a>.</p>
<p>This time, of course, I&rsquo;m using Rust. And, by way of a first for me, for the gRPC server implementation (aka &ldquo;personality&rdquo;). I&rsquo;ve been lazy thanks to the excellent <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a> and have been using it way of a client. Because I&rsquo;m more familiar with Golang and because I&rsquo;ve written (most) other Trillian personalities in Golang, I resorted to quickly implementing Crate Transparency in Golang too in order to uncover bugs with the Rust implementation. I&rsquo;ll write a follow-up post on the complexity I seem to struggle with when using protobufs and gRPC [in Golang].</p>
    </div>
    <a href="/posts/200429/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/ble/" class="link blue hover-black">
            Tag: BLE
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200417/" class="link black dim">
        Golang Xiaomi Bluetooth Temperature|Humidity (LYWSD03MMC) 2nd Gen
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Well, this became more of an adventure that I&rsquo;d originally wanted but, after learning some BLE and, with the help of others (Thanks Jonatha, JsBergbau), I&rsquo;ve sample code that connects to 4 Xiaomi 2nd gen. Thermometers, subscribes to readings and publishes the data to MQTT. From there, I&rsquo;m scraping it using Inuits <a href="">MQTTGateway</a> into Prometheus.</p>
<p>Repo: <a href="https://github.com/DazWilkin/gomijia2">https://github.com/DazWilkin/gomijia2</a></p>
<p><img src="/images/200417.prometheus.png" alt="Prometheus"></p>
<h3 id="thankscredit">Thanks|Credit:</h3>
<ul>
<li><a href="https://github.com/u1f35c">Jonathan McDowell</a> for <a href="https://github.com/u1f35c/gomijia">gomijia</a> and <a href="https://github.com/u1f35c/gomijia/issues/1">help</a></li>
<li><a href="https://github.com/JsBergbau">JsBergbau</a> for <a href="https://github.com/JsBergbau/MiTemperature2/issues/29#issuecomment-614314939">help</a></li>
</ul>
<h3 id="background">Background</h3>
<p>I&rsquo;ve been playing around with <a href="https://esphome.io">ESPHome</a> and blogged around my very positive experience <a href="/posts/200227/">ESPHome, MQTT, Prometheus and almost Cloud IoT</a>. I&rsquo;ve ordered a couple of <a href="https://www.espressif.com/en/products/hardware/esp32-devkitc-googlecloud-iot/overview">ESP32-DevKitC</a> and hope this will enable me to connect to Google <a href="https://cloud.google.com/iot-core">Cloud IoT</a>.</p>
    </div>
    <a href="/posts/200417/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/lywsd03mmc/" class="link blue hover-black">
            Tag: LYWSD03MMC
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200417/" class="link black dim">
        Golang Xiaomi Bluetooth Temperature|Humidity (LYWSD03MMC) 2nd Gen
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Well, this became more of an adventure that I&rsquo;d originally wanted but, after learning some BLE and, with the help of others (Thanks Jonatha, JsBergbau), I&rsquo;ve sample code that connects to 4 Xiaomi 2nd gen. Thermometers, subscribes to readings and publishes the data to MQTT. From there, I&rsquo;m scraping it using Inuits <a href="">MQTTGateway</a> into Prometheus.</p>
<p>Repo: <a href="https://github.com/DazWilkin/gomijia2">https://github.com/DazWilkin/gomijia2</a></p>
<p><img src="/images/200417.prometheus.png" alt="Prometheus"></p>
<h3 id="thankscredit">Thanks|Credit:</h3>
<ul>
<li><a href="https://github.com/u1f35c">Jonathan McDowell</a> for <a href="https://github.com/u1f35c/gomijia">gomijia</a> and <a href="https://github.com/u1f35c/gomijia/issues/1">help</a></li>
<li><a href="https://github.com/JsBergbau">JsBergbau</a> for <a href="https://github.com/JsBergbau/MiTemperature2/issues/29#issuecomment-614314939">help</a></li>
</ul>
<h3 id="background">Background</h3>
<p>I&rsquo;ve been playing around with <a href="https://esphome.io">ESPHome</a> and blogged around my very positive experience <a href="/posts/200227/">ESPHome, MQTT, Prometheus and almost Cloud IoT</a>. I&rsquo;ve ordered a couple of <a href="https://www.espressif.com/en/products/hardware/esp32-devkitc-googlecloud-iot/overview">ESP32-DevKitC</a> and hope this will enable me to connect to Google <a href="https://cloud.google.com/iot-core">Cloud IoT</a>.</p>
    </div>
    <a href="/posts/200417/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/xiaomi/" class="link blue hover-black">
            Tag: Xiaomi
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200417/" class="link black dim">
        Golang Xiaomi Bluetooth Temperature|Humidity (LYWSD03MMC) 2nd Gen
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Well, this became more of an adventure that I&rsquo;d originally wanted but, after learning some BLE and, with the help of others (Thanks Jonatha, JsBergbau), I&rsquo;ve sample code that connects to 4 Xiaomi 2nd gen. Thermometers, subscribes to readings and publishes the data to MQTT. From there, I&rsquo;m scraping it using Inuits <a href="">MQTTGateway</a> into Prometheus.</p>
<p>Repo: <a href="https://github.com/DazWilkin/gomijia2">https://github.com/DazWilkin/gomijia2</a></p>
<p><img src="/images/200417.prometheus.png" alt="Prometheus"></p>
<h3 id="thankscredit">Thanks|Credit:</h3>
<ul>
<li><a href="https://github.com/u1f35c">Jonathan McDowell</a> for <a href="https://github.com/u1f35c/gomijia">gomijia</a> and <a href="https://github.com/u1f35c/gomijia/issues/1">help</a></li>
<li><a href="https://github.com/JsBergbau">JsBergbau</a> for <a href="https://github.com/JsBergbau/MiTemperature2/issues/29#issuecomment-614314939">help</a></li>
</ul>
<h3 id="background">Background</h3>
<p>I&rsquo;ve been playing around with <a href="https://esphome.io">ESPHome</a> and blogged around my very positive experience <a href="/posts/200227/">ESPHome, MQTT, Prometheus and almost Cloud IoT</a>. I&rsquo;ve ordered a couple of <a href="https://www.espressif.com/en/products/hardware/esp32-devkitc-googlecloud-iot/overview">ESP32-DevKitC</a> and hope this will enable me to connect to Google <a href="https://cloud.google.com/iot-core">Cloud IoT</a>.</p>
    </div>
    <a href="/posts/200417/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/esp/" class="link blue hover-black">
            Tag: ESP
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200325/" class="link black dim">
        gRPC, Cloud Run &amp; Endpoints
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>&lt;3 Google but there&rsquo;s quite often an assumption that we&rsquo;re all sitting around the engineering table and, of course, we&rsquo;re not.</p>
<p><a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> is a powerful offering but &ndash; IMO &ndash; it&rsquo;s <strong>super</strong> confusing to understand and complex to deploy.</p>
<p>If you&rsquo;re familiar with the motivations behind service meshes (e.g. <a href="https://istio.io">Istio</a>), Cloud Endpoints fits in a similar niche (&ldquo;neesh&rdquo; or &ldquo;nitch&rdquo;?). The underlying ambition is that, developers can take <strong>existing</strong> code and by adding a proxy (or sidecar), general-purpose abstractions, security, logging etc. may be added.</p>
    </div>
    <a href="/posts/200325/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200227/" class="link black dim">
        ESPHome, MQTT, Prometheus and almost Cloud IoT
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://esphome.io">ESPHome</a> is a very interesting project. I&rsquo;d not heard of it until this week and am surprised that it isn&rsquo;t more newsworthy.</p>
<p>I&rsquo;m always tinkering with IoT stuff, have a couple of <a href="https://docs.wemos.cc/en/latest/d1/index.html">Wemos D1</a> ESP8266s. They are brought out occasionally for learning. I&rsquo;ve been using them this week with ESPHome. I&rsquo;m looking to buy some Xiaomi BLE temperature sensors and thinking I could read the temperatures from these using the ESPs (thanks to ESPHome) and publish the data to MQTT. I tried (unsuccessfully) to publish to <a href="https://cloud.google.com/iot-core">Google Cloud IoT</a> (not Google&rsquo;s fault but a limitation in the current ESPHome, I think) but have been successful publishing to a <a href="https://mosquitto.org">Mosquitto</a> broker and rendering the metric data in <a href="https://prometheus.io">Prometheus</a>.</p>
    </div>
    <a href="/posts/200227/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/originstamp/" class="link blue hover-black">
            Tag: OriginStamp
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200312/" class="link black dim">
        OriginStamp Rust SDK Example
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I wrote <a href="/posts/200217/">recently</a> describing Python and Golang clients for OriginStamp based on OriginStamp&rsquo;s API&rsquo;s swagger spec. As a way to pursue learning rust, I&rsquo;ve been forcing myself to write examples using rust. I&rsquo;m honestly finding learning rust tough going and think I&rsquo;m probably better to revert to the &ldquo;Learning Rust&rdquo; tutorials.</p>
<p>That said, herewith an explanation of building a rust client using an OpenAPI (!) generated SDK from OriginStamp&rsquo;s swagger spec.</p>
    </div>
    <a href="/posts/200312/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200226/" class="link black dim">
        OriginStamp: Verifying Proofs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Recently, I <a href="/posts/200217/">wrote</a> about some initial adventures with <a href="https://originstamp.org">OriginStamp</a></p>
<p>Using OriginStamp&rsquo;s <a href="https://originstamp.org/home">UI</a> or API, submitting a hash results in transactions being submitted to Bitcoin, Ethereum and a German newspaper.</p>
<p>Using the API, it&rsquo;s possible to query OriginStamp&rsquo;s service for a proof. This post explains how to verify such a proof.</p>
<p>The diligent reader among you (Hey Mom!) will recall that I submitted a hash for the message:</p>
<pre tabindex="0"><code>Frederik Jack is a bubbly Border Collie
</code></pre><p>The SHA-256 hash of this message is:</p>
    </div>
    <a href="/posts/200226/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200219/" class="link black dim">
        FreeTSA &amp; Digitorus&#39; Timestamp SDK
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I wrote recently about some exploration of Timestamping with <a href="/posts/200217/">OriginStamp</a>. Since writing that post, I had some supportive feedback from the helpful folks at OriginStamp and plan to continue exploring that solution.</p>
<p>Meanwhile, OriginStamp exposed me to <a href="https://en.wikipedia.org/wiki/Timestamping_%28computing%29">timestamping</a> and <a href="https://en.wikipedia.org/wiki/Trusted_timestamping">trusted timestamping</a> and I discovered <a href="https://freetsa.org">freeTSA.org</a>.</p>
<p>What&rsquo;s the point? These services provide authoritative proof of the existence of a digital asset before some point in time; OriginStamp provides a richer service and uses multiple timestamp authorities including Bitcoin, Ethereum and rather interestingly a German Newspaper&rsquo;s <a href="https://blockchain.suedkurier.de/faq">Trusted Timestamp</a>.</p>
    </div>
    <a href="/posts/200219/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200217/" class="link black dim">
        OriginStamp Python|Golang SDK Examples
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>A friend mentioned <a href="https://originstamp.org">OriginStamp</a> to me.</p>
<p><strong>NB</strong> There are 2 sites: <a href="https://originstamp.com">originstamp.com</a> and <a href="https://originstamp.org">originstamp.org</a>.</p>
<p>It&rsquo;s an interesting project.</p>
<p>It&rsquo;s a solution for providing auditable proof that you had a(ccess to) some digital thing before a certain date. OriginStamp provides user-|developer-friendly means to submit files|hashes (of your content) and have these bundled into transactions that are submitted to e.g. bitcoin.</p>
<p>I won&rsquo;t attempt to duplicate the narrative here, review OriginStamp&rsquo;s site and some of its content.</p>
    </div>
    <a href="/posts/200217/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/rust/" class="link blue hover-black">
            Tag: Rust&#34;
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200312/" class="link black dim">
        OriginStamp Rust SDK Example
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I wrote <a href="/posts/200217/">recently</a> describing Python and Golang clients for OriginStamp based on OriginStamp&rsquo;s API&rsquo;s swagger spec. As a way to pursue learning rust, I&rsquo;ve been forcing myself to write examples using rust. I&rsquo;m honestly finding learning rust tough going and think I&rsquo;m probably better to revert to the &ldquo;Learning Rust&rdquo; tutorials.</p>
<p>That said, herewith an explanation of building a rust client using an OpenAPI (!) generated SDK from OriginStamp&rsquo;s swagger spec.</p>
    </div>
    <a href="/posts/200312/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cloud-iot/" class="link blue hover-black">
            Tag: Cloud IoT
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200227/" class="link black dim">
        ESPHome, MQTT, Prometheus and almost Cloud IoT
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://esphome.io">ESPHome</a> is a very interesting project. I&rsquo;d not heard of it until this week and am surprised that it isn&rsquo;t more newsworthy.</p>
<p>I&rsquo;m always tinkering with IoT stuff, have a couple of <a href="https://docs.wemos.cc/en/latest/d1/index.html">Wemos D1</a> ESP8266s. They are brought out occasionally for learning. I&rsquo;ve been using them this week with ESPHome. I&rsquo;m looking to buy some Xiaomi BLE temperature sensors and thinking I could read the temperatures from these using the ESPs (thanks to ESPHome) and publish the data to MQTT. I tried (unsuccessfully) to publish to <a href="https://cloud.google.com/iot-core">Google Cloud IoT</a> (not Google&rsquo;s fault but a limitation in the current ESPHome, I think) but have been successful publishing to a <a href="https://mosquitto.org">Mosquitto</a> broker and rendering the metric data in <a href="https://prometheus.io">Prometheus</a>.</p>
    </div>
    <a href="/posts/200227/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/esphome/" class="link blue hover-black">
            Tag: Esphome
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200227/" class="link black dim">
        ESPHome, MQTT, Prometheus and almost Cloud IoT
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://esphome.io">ESPHome</a> is a very interesting project. I&rsquo;d not heard of it until this week and am surprised that it isn&rsquo;t more newsworthy.</p>
<p>I&rsquo;m always tinkering with IoT stuff, have a couple of <a href="https://docs.wemos.cc/en/latest/d1/index.html">Wemos D1</a> ESP8266s. They are brought out occasionally for learning. I&rsquo;ve been using them this week with ESPHome. I&rsquo;m looking to buy some Xiaomi BLE temperature sensors and thinking I could read the temperatures from these using the ESPs (thanks to ESPHome) and publish the data to MQTT. I tried (unsuccessfully) to publish to <a href="https://cloud.google.com/iot-core">Google Cloud IoT</a> (not Google&rsquo;s fault but a limitation in the current ESPHome, I think) but have been successful publishing to a <a href="https://mosquitto.org">Mosquitto</a> broker and rendering the metric data in <a href="https://prometheus.io">Prometheus</a>.</p>
    </div>
    <a href="/posts/200227/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/iot/" class="link blue hover-black">
            Tag: IoT
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200227/" class="link black dim">
        ESPHome, MQTT, Prometheus and almost Cloud IoT
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://esphome.io">ESPHome</a> is a very interesting project. I&rsquo;d not heard of it until this week and am surprised that it isn&rsquo;t more newsworthy.</p>
<p>I&rsquo;m always tinkering with IoT stuff, have a couple of <a href="https://docs.wemos.cc/en/latest/d1/index.html">Wemos D1</a> ESP8266s. They are brought out occasionally for learning. I&rsquo;ve been using them this week with ESPHome. I&rsquo;m looking to buy some Xiaomi BLE temperature sensors and thinking I could read the temperatures from these using the ESPs (thanks to ESPHome) and publish the data to MQTT. I tried (unsuccessfully) to publish to <a href="https://cloud.google.com/iot-core">Google Cloud IoT</a> (not Google&rsquo;s fault but a limitation in the current ESPHome, I think) but have been successful publishing to a <a href="https://mosquitto.org">Mosquitto</a> broker and rendering the metric data in <a href="https://prometheus.io">Prometheus</a>.</p>
    </div>
    <a href="/posts/200227/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/mosquitto/" class="link blue hover-black">
            Tag: Mosquitto
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200227/" class="link black dim">
        ESPHome, MQTT, Prometheus and almost Cloud IoT
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://esphome.io">ESPHome</a> is a very interesting project. I&rsquo;d not heard of it until this week and am surprised that it isn&rsquo;t more newsworthy.</p>
<p>I&rsquo;m always tinkering with IoT stuff, have a couple of <a href="https://docs.wemos.cc/en/latest/d1/index.html">Wemos D1</a> ESP8266s. They are brought out occasionally for learning. I&rsquo;ve been using them this week with ESPHome. I&rsquo;m looking to buy some Xiaomi BLE temperature sensors and thinking I could read the temperatures from these using the ESPs (thanks to ESPHome) and publish the data to MQTT. I tried (unsuccessfully) to publish to <a href="https://cloud.google.com/iot-core">Google Cloud IoT</a> (not Google&rsquo;s fault but a limitation in the current ESPHome, I think) but have been successful publishing to a <a href="https://mosquitto.org">Mosquitto</a> broker and rendering the metric data in <a href="https://prometheus.io">Prometheus</a>.</p>
    </div>
    <a href="/posts/200227/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/mqttgateway/" class="link blue hover-black">
            Tag: Mqttgateway
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200227/" class="link black dim">
        ESPHome, MQTT, Prometheus and almost Cloud IoT
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://esphome.io">ESPHome</a> is a very interesting project. I&rsquo;d not heard of it until this week and am surprised that it isn&rsquo;t more newsworthy.</p>
<p>I&rsquo;m always tinkering with IoT stuff, have a couple of <a href="https://docs.wemos.cc/en/latest/d1/index.html">Wemos D1</a> ESP8266s. They are brought out occasionally for learning. I&rsquo;ve been using them this week with ESPHome. I&rsquo;m looking to buy some Xiaomi BLE temperature sensors and thinking I could read the temperatures from these using the ESPs (thanks to ESPHome) and publish the data to MQTT. I tried (unsuccessfully) to publish to <a href="https://cloud.google.com/iot-core">Google Cloud IoT</a> (not Google&rsquo;s fault but a limitation in the current ESPHome, I think) but have been successful publishing to a <a href="https://mosquitto.org">Mosquitto</a> broker and rendering the metric data in <a href="https://prometheus.io">Prometheus</a>.</p>
    </div>
    <a href="/posts/200227/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/bitcoin/" class="link blue hover-black">
            Tag: Bitcoin
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200226/" class="link black dim">
        OriginStamp: Verifying Proofs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Recently, I <a href="/posts/200217/">wrote</a> about some initial adventures with <a href="https://originstamp.org">OriginStamp</a></p>
<p>Using OriginStamp&rsquo;s <a href="https://originstamp.org/home">UI</a> or API, submitting a hash results in transactions being submitted to Bitcoin, Ethereum and a German newspaper.</p>
<p>Using the API, it&rsquo;s possible to query OriginStamp&rsquo;s service for a proof. This post explains how to verify such a proof.</p>
<p>The diligent reader among you (Hey Mom!) will recall that I submitted a hash for the message:</p>
<pre tabindex="0"><code>Frederik Jack is a bubbly Border Collie
</code></pre><p>The SHA-256 hash of this message is:</p>
    </div>
    <a href="/posts/200226/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/merkle/" class="link blue hover-black">
            Tag: Merkle
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200226/" class="link black dim">
        OriginStamp: Verifying Proofs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Recently, I <a href="/posts/200217/">wrote</a> about some initial adventures with <a href="https://originstamp.org">OriginStamp</a></p>
<p>Using OriginStamp&rsquo;s <a href="https://originstamp.org/home">UI</a> or API, submitting a hash results in transactions being submitted to Bitcoin, Ethereum and a German newspaper.</p>
<p>Using the API, it&rsquo;s possible to query OriginStamp&rsquo;s service for a proof. This post explains how to verify such a proof.</p>
<p>The diligent reader among you (Hey Mom!) will recall that I submitted a hash for the message:</p>
<pre tabindex="0"><code>Frederik Jack is a bubbly Border Collie
</code></pre><p>The SHA-256 hash of this message is:</p>
    </div>
    <a href="/posts/200226/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/timestamping/" class="link blue hover-black">
            Tag: Timestamping
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200226/" class="link black dim">
        OriginStamp: Verifying Proofs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Recently, I <a href="/posts/200217/">wrote</a> about some initial adventures with <a href="https://originstamp.org">OriginStamp</a></p>
<p>Using OriginStamp&rsquo;s <a href="https://originstamp.org/home">UI</a> or API, submitting a hash results in transactions being submitted to Bitcoin, Ethereum and a German newspaper.</p>
<p>Using the API, it&rsquo;s possible to query OriginStamp&rsquo;s service for a proof. This post explains how to verify such a proof.</p>
<p>The diligent reader among you (Hey Mom!) will recall that I submitted a hash for the message:</p>
<pre tabindex="0"><code>Frederik Jack is a bubbly Border Collie
</code></pre><p>The SHA-256 hash of this message is:</p>
    </div>
    <a href="/posts/200226/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200219/" class="link black dim">
        FreeTSA &amp; Digitorus&#39; Timestamp SDK
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I wrote recently about some exploration of Timestamping with <a href="/posts/200217/">OriginStamp</a>. Since writing that post, I had some supportive feedback from the helpful folks at OriginStamp and plan to continue exploring that solution.</p>
<p>Meanwhile, OriginStamp exposed me to <a href="https://en.wikipedia.org/wiki/Timestamping_%28computing%29">timestamping</a> and <a href="https://en.wikipedia.org/wiki/Trusted_timestamping">trusted timestamping</a> and I discovered <a href="https://freetsa.org">freeTSA.org</a>.</p>
<p>What&rsquo;s the point? These services provide authoritative proof of the existence of a digital asset before some point in time; OriginStamp provides a richer service and uses multiple timestamp authorities including Bitcoin, Ethereum and rather interestingly a German Newspaper&rsquo;s <a href="https://blockchain.suedkurier.de/faq">Trusted Timestamp</a>.</p>
    </div>
    <a href="/posts/200219/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/tsa/" class="link blue hover-black">
            Tag: TSA
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200219/" class="link black dim">
        FreeTSA &amp; Digitorus&#39; Timestamp SDK
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I wrote recently about some exploration of Timestamping with <a href="/posts/200217/">OriginStamp</a>. Since writing that post, I had some supportive feedback from the helpful folks at OriginStamp and plan to continue exploring that solution.</p>
<p>Meanwhile, OriginStamp exposed me to <a href="https://en.wikipedia.org/wiki/Timestamping_%28computing%29">timestamping</a> and <a href="https://en.wikipedia.org/wiki/Trusted_timestamping">trusted timestamping</a> and I discovered <a href="https://freetsa.org">freeTSA.org</a>.</p>
<p>What&rsquo;s the point? These services provide authoritative proof of the existence of a digital asset before some point in time; OriginStamp provides a richer service and uses multiple timestamp authorities including Bitcoin, Ethereum and rather interestingly a German Newspaper&rsquo;s <a href="https://blockchain.suedkurier.de/faq">Trusted Timestamp</a>.</p>
    </div>
    <a href="/posts/200219/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/container-registry/" class="link blue hover-black">
            Tag: Container Registry
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200207/" class="link black dim">
        Accessing GCR repos from Kubernetes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Until today, I&rsquo;d not accessed a <a href="https://cloud.google.com/container-registry">Google Container Registry</a> repo from a <strong>non-GKE</strong> Kubernetes deployment.</p>
<p>It turns out that it&rsquo;s pretty well-documented (<a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/">link</a>) but, here&rsquo;s an end-end example.</p>
<p>Assuming:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BILLING<span style="color:#f92672">=[[</span>YOUR-BILLING<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=[[</span>YOUR-PROJECT<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>SERVER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;us.gcr.io&#34;</span>
</span></span></code></pre></div><p>If not already:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud projects create <span style="color:#f92672">{</span>$PROJECT<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud beta billing projects link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud services enable containerregistry.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><h2 id="container-registry">Container Registry</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>IMAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;busybox&#34;</span> <span style="color:#75715e"># Or ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker pull <span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker tag <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">${</span>SERVER<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker push <span style="color:#e6db74">${</span>SERVER<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud container images list-tags <span style="color:#e6db74">${</span>SERVER<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span>
</span></span></code></pre></div><h2 id="service-account">Service Account</h2>
<p>Create a service account that&rsquo;s permitted to download (read-only) images from this project&rsquo;s registry</p>
    </div>
    <a href="/posts/200207/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/proxy.golang.org/" class="link blue hover-black">
            Tag: Proxy.golang.org
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200206/" class="link black dim">
        Cloud Build wishlist: Mountable Golang Modules Proxy
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I think it would be valuable if Google were to provide volumes in <a href="https://cloud.google.com/cloud-build">Cloud Build</a> of package registries (e.g. <a href="https://proxy.golang.org">Go Modules</a>; <a href="https://pypi.org">PyPi</a>; <a href="https://search.maven.org/">Maven</a>; <a href="https://www.npmjs.com/">NPM</a> etc.).</p>
<p>Google provides a <a href="https://cloud.google.com/container-registry/docs/using-dockerhub-mirroring">mirror</a> of a subset of Docker Hub. This confers several benefits: Google&rsquo;s imprimatur; speed (latency); bandwidth; and convenience.</p>
<p>The same benefits would apply to package registries.</p>
<p>In the meantime, there&rsquo;s a hacky way to gain some of the benefits of these when using Cloud Build.</p>
<p>In the following example, I&rsquo;ll show an approach using Golang Modules and Google&rsquo;s module proxy aka <code>proxy.golang.org</code>.</p>
    </div>
    <a href="/posts/200206/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/gce/" class="link blue hover-black">
            Tag: GCE
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200122/" class="link black dim">
        Setting up a GCE Instance as an Inlets Exit Node
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The prolific <a href="https://blog.alexellis.io/">Alex Ellis</a> has a new project, <a href="https://github.com/inlets/inlets">Inlets</a>.</p>
<p>Here&rsquo;s a quick tutorial using <a href="https://cloud.google.com/">Google Compute Platform&rsquo;s (GCP)</a> <a href="https://cloud.google.com/compute/">Compute Engine (GCE)</a>.</p>
<p><strong>NB</strong> I&rsquo;m using one of Google&rsquo;s <a href="https://cloud.google.com/free/">&ldquo;Always free&rdquo;</a> f1-micro instances <strong>but</strong> you may still pay for network *gress and storage</p>
<h2 id="assumptions">Assumptions</h2>
<p>I&rsquo;m assuming you&rsquo;ve a Google account, have used GCP and have a billing account established, i.e. the following returns at least one billing account:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud beta billing accounts list
</span></span></code></pre></div><p>If you&rsquo;ve only one billing account and it&rsquo;s the one you wish to use, then you can:</p>
    </div>
    <a href="/posts/200122/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/inlets/" class="link blue hover-black">
            Tag: Inlets
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200122/" class="link black dim">
        Setting up a GCE Instance as an Inlets Exit Node
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The prolific <a href="https://blog.alexellis.io/">Alex Ellis</a> has a new project, <a href="https://github.com/inlets/inlets">Inlets</a>.</p>
<p>Here&rsquo;s a quick tutorial using <a href="https://cloud.google.com/">Google Compute Platform&rsquo;s (GCP)</a> <a href="https://cloud.google.com/compute/">Compute Engine (GCE)</a>.</p>
<p><strong>NB</strong> I&rsquo;m using one of Google&rsquo;s <a href="https://cloud.google.com/free/">&ldquo;Always free&rdquo;</a> f1-micro instances <strong>but</strong> you may still pay for network *gress and storage</p>
<h2 id="assumptions">Assumptions</h2>
<p>I&rsquo;m assuming you&rsquo;ve a Google account, have used GCP and have a billing account established, i.e. the following returns at least one billing account:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud beta billing accounts list
</span></span></code></pre></div><p>If you&rsquo;ve only one billing account and it&rsquo;s the one you wish to use, then you can:</p>
    </div>
    <a href="/posts/200122/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/dd-wrt/" class="link blue hover-black">
            Tag: DD-WRT
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200113/" class="link black dim">
        Trendnet TEW-812DRU and DD-WRT
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The FBI Portland published an interesting <a href="https://www.fbi.gov/contact-us/field-offices/portland/news/press-releases/tech-tuesday-internet-of-things-iot">advisory</a> with several, sensible recommendations including firewalling IoT devices from other devices on a home network. I decided to deploy a redundant <a href="https://www.trendnet.com/products/wifi/AC-routers/AC1750/TEW-812DRU">Trendnet TEW-812DRU version 2.0</a> for this purpose.</p>
<p>Caveat Developer: Before I go further, I don&rsquo;t recommend installing DD-WRT on a Trendnet TEW-812DRU unless you&rsquo;re willing to brick the device irrecoverably.</p>
<p>I read the DD-WRT instructions several times (<a href="https://forum.dd-wrt.com/phpBB2/viewtopic.php?t=51486">&ldquo;peacock thread&rdquo;</a>,<a href="https://dd-wrt.com/support/router-database/?model=TEW-812DRU_v2">router database</a> &ndash; do not use v3.0 beta builds!), thought I&rsquo;d followed them and still (temporarily) bricked my router using the firmware downloaded from the DD-WRT router database. It is thanks to Justin&rsquo;s help and his <a href="https://blog.swwomm.com/2018/07/dd-wrt-firmware-for-trendnet-tew-812dru.html">post</a> that I was encouraged to try restoring my device to the Trendent firmware and then retring the DD-WRT installation with an older firmware version.</p>
    </div>
    <a href="/posts/200113/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/tew-812dru/" class="link blue hover-black">
            Tag: TEW-812DRU
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200113/" class="link black dim">
        Trendnet TEW-812DRU and DD-WRT
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The FBI Portland published an interesting <a href="https://www.fbi.gov/contact-us/field-offices/portland/news/press-releases/tech-tuesday-internet-of-things-iot">advisory</a> with several, sensible recommendations including firewalling IoT devices from other devices on a home network. I decided to deploy a redundant <a href="https://www.trendnet.com/products/wifi/AC-routers/AC1750/TEW-812DRU">Trendnet TEW-812DRU version 2.0</a> for this purpose.</p>
<p>Caveat Developer: Before I go further, I don&rsquo;t recommend installing DD-WRT on a Trendnet TEW-812DRU unless you&rsquo;re willing to brick the device irrecoverably.</p>
<p>I read the DD-WRT instructions several times (<a href="https://forum.dd-wrt.com/phpBB2/viewtopic.php?t=51486">&ldquo;peacock thread&rdquo;</a>,<a href="https://dd-wrt.com/support/router-database/?model=TEW-812DRU_v2">router database</a> &ndash; do not use v3.0 beta builds!), thought I&rsquo;d followed them and still (temporarily) bricked my router using the firmware downloaded from the DD-WRT router database. It is thanks to Justin&rsquo;s help and his <a href="https://blog.swwomm.com/2018/07/dd-wrt-firmware-for-trendnet-tew-812dru.html">post</a> that I was encouraged to try restoring my device to the Trendent firmware and then retring the DD-WRT installation with an older firmware version.</p>
    </div>
    <a href="/posts/200113/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/trendnet/" class="link blue hover-black">
            Tag: Trendnet
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200113/" class="link black dim">
        Trendnet TEW-812DRU and DD-WRT
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The FBI Portland published an interesting <a href="https://www.fbi.gov/contact-us/field-offices/portland/news/press-releases/tech-tuesday-internet-of-things-iot">advisory</a> with several, sensible recommendations including firewalling IoT devices from other devices on a home network. I decided to deploy a redundant <a href="https://www.trendnet.com/products/wifi/AC-routers/AC1750/TEW-812DRU">Trendnet TEW-812DRU version 2.0</a> for this purpose.</p>
<p>Caveat Developer: Before I go further, I don&rsquo;t recommend installing DD-WRT on a Trendnet TEW-812DRU unless you&rsquo;re willing to brick the device irrecoverably.</p>
<p>I read the DD-WRT instructions several times (<a href="https://forum.dd-wrt.com/phpBB2/viewtopic.php?t=51486">&ldquo;peacock thread&rdquo;</a>,<a href="https://dd-wrt.com/support/router-database/?model=TEW-812DRU_v2">router database</a> &ndash; do not use v3.0 beta builds!), thought I&rsquo;d followed them and still (temporarily) bricked my router using the firmware downloaded from the DD-WRT router database. It is thanks to Justin&rsquo;s help and his <a href="https://blog.swwomm.com/2018/07/dd-wrt-firmware-for-trendnet-tew-812dru.html">post</a> that I was encouraged to try restoring my device to the Trendent firmware and then retring the DD-WRT installation with an older firmware version.</p>
    </div>
    <a href="/posts/200113/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/google-fit/" class="link blue hover-black">
            Tag: Google Fit
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200110/" class="link black dim">
        Google Fit
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve spent a few days exploring [Google Fit SDK] as I try to wean myself from my obsession with metrics (of all forms). A quick Googling got me to Robert&rsquo;s <a href="https://ithoughthecamewithyou.com/post/export-google-fit-daily-steps-to-a-google-sheet">Exporter Google Fit Daily Steps, Weight and Distance to a Google Sheet</a>. This works and is probably where I should have stopped&hellip; avoiding the rabbit hole that I&rsquo;ve been down&hellip;</p>
<p>I threw together a simple Golang implementation of the SDK using <a href="https://godoc.org/google.golang.org/api/fitness/v1">Google&rsquo;s Golang API Client Library</a>. Thanks to Robert&rsquo;s example, I was able to infer some of the complexity this API particularly in its use of data types, data sources and datasets. Having used Stackdriver in my previous life, Google Fit&rsquo;s structure bears more than a passing resemblance to Stackdriver&rsquo;s data model and its use of resource types and metric types.</p>
    </div>
    <a href="/posts/200110/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/google-home/" class="link blue hover-black">
            Tag: Google Home
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/200107/" class="link black dim">
        Google Home Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m obsessing over Prometheus exporters. First came <a href="/posts/191218/">Linode Exporter</a>, then <a href="/posts/191220/">GCP Exporter</a> and, on Sunday, I stumbled upon a reverse-engineered <a href="https://rithvikvibhu.github.io/GHLocalApi/">API for Google Home</a> devices and so wrote a very basic <a href="https://github.com/DazWilkin/gohome">Google Home SDK</a> and a similarly basic <a href="https://github.com/DazWilkin/home-exporter">Google Home Exporter</a>:</p>
<p><img src="/images/200107.home-exporter.png" alt="Prometheus Graphs"></p>
<p>The SDK only implements <code>/setup/eureka_info</code> and then only some of the returned properties. There&rsquo;s not a lot of metric-like data to use besides <code>SignalLevel</code> (<code>signal_level</code>) and <code>NoiseLevel</code> (<code>noise_level</code>). I&rsquo;m not clear on the meaning of some of the properties.</p>
    </div>
    <a href="/posts/200107/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/bnf/" class="link blue hover-black">
            Tag: BNF
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191230/" class="link black dim">
        Adventures around BPF
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I think (!?) this interesting learning experience started with <a href="https://docs.cilium.io/en/v1.6/envoy/extensions/">Envoy Go Extensions</a>.</p>
<p>IIUC, Cilium contributed this mechanism (<a href="https://docs.cilium.io/en/v1.6/envoy/extensions/">Envoy Go Extensions</a>) by which it&rsquo;s possible to extend Envoy using Golang. The documentation references <a href="https://en.wikipedia.org/wiki/Berkeley_Packet_Filter">BPF</a>. Cilium and BNF were both unfamiliar technologies to me and so began my learning. This part of the journey concludes with <a href="https://www.weave.works/oss/scope/">Weave Scope</a>.</p>
<p>I learned that Cilium is a CNI implementation that may be used with Kubernetes. GKE defaults (but is not limited to) to Google&rsquo;s own CNI implementation (<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/network-overview">link</a>). From a subsequent brief exploration on CNI, I believe Digital Ocean&rsquo;s managed Kubernetes service uses Cillium and Linode Kubernetes Engine uses Calico.</p>
    </div>
    <a href="/posts/191230/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cilium/" class="link blue hover-black">
            Tag: Cilium
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191230/" class="link black dim">
        Adventures around BPF
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I think (!?) this interesting learning experience started with <a href="https://docs.cilium.io/en/v1.6/envoy/extensions/">Envoy Go Extensions</a>.</p>
<p>IIUC, Cilium contributed this mechanism (<a href="https://docs.cilium.io/en/v1.6/envoy/extensions/">Envoy Go Extensions</a>) by which it&rsquo;s possible to extend Envoy using Golang. The documentation references <a href="https://en.wikipedia.org/wiki/Berkeley_Packet_Filter">BPF</a>. Cilium and BNF were both unfamiliar technologies to me and so began my learning. This part of the journey concludes with <a href="https://www.weave.works/oss/scope/">Weave Scope</a>.</p>
<p>I learned that Cilium is a CNI implementation that may be used with Kubernetes. GKE defaults (but is not limited to) to Google&rsquo;s own CNI implementation (<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/network-overview">link</a>). From a subsequent brief exploration on CNI, I believe Digital Ocean&rsquo;s managed Kubernetes service uses Cillium and Linode Kubernetes Engine uses Calico.</p>
    </div>
    <a href="/posts/191230/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/weave-scope/" class="link blue hover-black">
            Tag: Weave Scope
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191230/" class="link black dim">
        Adventures around BPF
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I think (!?) this interesting learning experience started with <a href="https://docs.cilium.io/en/v1.6/envoy/extensions/">Envoy Go Extensions</a>.</p>
<p>IIUC, Cilium contributed this mechanism (<a href="https://docs.cilium.io/en/v1.6/envoy/extensions/">Envoy Go Extensions</a>) by which it&rsquo;s possible to extend Envoy using Golang. The documentation references <a href="https://en.wikipedia.org/wiki/Berkeley_Packet_Filter">BPF</a>. Cilium and BNF were both unfamiliar technologies to me and so began my learning. This part of the journey concludes with <a href="https://www.weave.works/oss/scope/">Weave Scope</a>.</p>
<p>I learned that Cilium is a CNI implementation that may be used with Kubernetes. GKE defaults (but is not limited to) to Google&rsquo;s own CNI implementation (<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/network-overview">link</a>). From a subsequent brief exploration on CNI, I believe Digital Ocean&rsquo;s managed Kubernetes service uses Cillium and Linode Kubernetes Engine uses Calico.</p>
    </div>
    <a href="/posts/191230/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/weaveworks/" class="link blue hover-black">
            Tag: Weaveworks
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191230/" class="link black dim">
        Adventures around BPF
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I think (!?) this interesting learning experience started with <a href="https://docs.cilium.io/en/v1.6/envoy/extensions/">Envoy Go Extensions</a>.</p>
<p>IIUC, Cilium contributed this mechanism (<a href="https://docs.cilium.io/en/v1.6/envoy/extensions/">Envoy Go Extensions</a>) by which it&rsquo;s possible to extend Envoy using Golang. The documentation references <a href="https://en.wikipedia.org/wiki/Berkeley_Packet_Filter">BPF</a>. Cilium and BNF were both unfamiliar technologies to me and so began my learning. This part of the journey concludes with <a href="https://www.weave.works/oss/scope/">Weave Scope</a>.</p>
<p>I learned that Cilium is a CNI implementation that may be used with Kubernetes. GKE defaults (but is not limited to) to Google&rsquo;s own CNI implementation (<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/network-overview">link</a>). From a subsequent brief exploration on CNI, I believe Digital Ocean&rsquo;s managed Kubernetes service uses Cillium and Linode Kubernetes Engine uses Calico.</p>
    </div>
    <a href="/posts/191230/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/kubernetes-engine/" class="link blue hover-black">
            Tag: Kubernetes Engine
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191220/" class="link black dim">
        Google Cloud Platform (GCP) Exporter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Earlier this week I discussed a <a href="/posts/191218/">Linode Prometheus Exporter</a>.</p>
<p>I <a href="https://github.com/metalmatze/digitalocean_exporter/pull/5">added</a> metrics for <a href="https://www.digitalocean.com/products/kubernetes/">Digital Ocean&rsquo;s Managed Kubernetes service</a> to <a href="https://github.com/metalmatze">@metalmatze</a>&rsquo;s <a href="https://github.com/metalmatze/digitalocean_exporter">Digital Ocean Exporter</a>.</p>
<p>This left, metrics for <a href="https://cloud.google.com">Google Cloud Platform (GCP)</a> which has, for many years, been my primary cloud platform. So, today I wrote <a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud Platform</a>.</p>
<p>All 3 of these exporters follow the template laid down by @metalmatze and, because each of these services has a well-written Golang SDK, it&rsquo;s straightforward to implement an exporter for each of them.</p>
    </div>
    <a href="/posts/191220/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190924/" class="link black dim">
        Kubernetes Engine and Free Tier
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Google Cloud Platform <a href="https://cloud.google.com/free/">Free Tier</a> appears (<span style="color:red">please verify this for yourself</span>) to provide the ability to run a(n admittedly miniscule) Kubernetes cluster for free. So, why do this? It provides a definitive Kubernetes (Engine) experience on Google Cloud Platform that you may use for learning and testing.</p>
<p>Kubernetes Engine the master node(s) and the control plane are <a href="https://cloud.google.com/kubernetes-engine/pricing">free</a>.</p>
<p>Kubernetes (i.e. Compute Engine) nodes potentially incur charges including for the VM runtime and any attached storage, snapshots etc. However, charges for these resources can be partially covered by the Free Tier.</p>
    </div>
    <a href="/posts/190924/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/ingress/" class="link blue hover-black">
            Tag: Ingress
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191211/" class="link black dim">
        NGINX Ingress
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a couple of deployment options (Google Compute Engine; Kubernetes) for an open-source project. The Kubernetes deployment provides <code>NodePort</code> and (TCP) <code>LoadBalancer</code> options and I&rsquo;ve been trying (unsuccessfully) to add HTTPS Load-balancing.</p>
<p>I should (!) try to deploy to <a href="https://cloud.google.com/kubernetes-engine/">Google Kubernetes Engine (GKE)</a> but I&rsquo;ve been using <a href="https://microk8s.io">microk8s</a>, Digital Ocean <a href="https://www.digitalocean.com/products/kubernetes/">Managed Kubernetes</a> and the Linode <a href="https://www.linode.com/products/kubernetes/">LKE</a> Beta. Each of these requires an implementation of Ingress controller. For GKE, GCP&rsquo;s HTTP/S Load-balancer (GCLB) is used. But, for the other services, NGINX Ingress is a good option and so I&rsquo;ve been exploring NGINX Ingress (Controller) <a href="https://kubernetes.github.io/ingress-nginx/">link</a>. This Ingress appears to work except that I&rsquo;ve been unable to get it to work with mutual TLS between the (NGINX) proxy and my backend services.</p>
    </div>
    <a href="/posts/191211/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/nginx/" class="link blue hover-black">
            Tag: NGINX
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/191211/" class="link black dim">
        NGINX Ingress
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a couple of deployment options (Google Compute Engine; Kubernetes) for an open-source project. The Kubernetes deployment provides <code>NodePort</code> and (TCP) <code>LoadBalancer</code> options and I&rsquo;ve been trying (unsuccessfully) to add HTTPS Load-balancing.</p>
<p>I should (!) try to deploy to <a href="https://cloud.google.com/kubernetes-engine/">Google Kubernetes Engine (GKE)</a> but I&rsquo;ve been using <a href="https://microk8s.io">microk8s</a>, Digital Ocean <a href="https://www.digitalocean.com/products/kubernetes/">Managed Kubernetes</a> and the Linode <a href="https://www.linode.com/products/kubernetes/">LKE</a> Beta. Each of these requires an implementation of Ingress controller. For GKE, GCP&rsquo;s HTTP/S Load-balancer (GCLB) is used. But, for the other services, NGINX Ingress is a good option and so I&rsquo;ve been exploring NGINX Ingress (Controller) <a href="https://kubernetes.github.io/ingress-nginx/">link</a>. This Ingress appears to work except that I&rsquo;ve been unable to get it to work with mutual TLS between the (NGINX) proxy and my backend services.</p>
    </div>
    <a href="/posts/191211/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/cadvisor/" class="link blue hover-black">
            Tag: Cadvisor
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190925/" class="link black dim">
        Run cAdvisor when using Docker Compose
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://github.com/google/cadvisor"><code>cAdvisor</code></a> has long been a favorite monitoring tool of mine. I&rsquo;m using Docker Compose for local testing and have begun including a <code>cAdvisor</code> in my <code>docker-compose.yaml</code> files.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#f92672">cadvisor</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">google/cadvisor:${CADVISOR_VERSION}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">cadvisor</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># command:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># - --prometheus_endpoint=&#34;/metrics&#34; # Default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;/:/rootfs:ro&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;/var/run:/var/run:rw&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;/sys:/sys:ro&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;/var/snap/docker/current:/var/lib/docker:ro&#34;</span> <span style="color:#75715e">#- &#34;/var/lib/docker/:/var/lib/docker:ro&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">expose</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;8080&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">8080</span>:<span style="color:#ae81ff">8080</span>
</span></span></code></pre></div><p>I&rsquo;d not realized until recently, that <code>cAdvisor</code> also surfaces a Prometheus metrics endpoint and so, if you do follow this path and you&rsquo;re also using Prometheus, don&rsquo;t forget to add <code>cAdvisor</code> to your Prometheus targets.</p>
    </div>
    <a href="/posts/190925/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/docker-compose/" class="link blue hover-black">
            Tag: Docker-Compose
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190925/" class="link black dim">
        Run cAdvisor when using Docker Compose
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://github.com/google/cadvisor"><code>cAdvisor</code></a> has long been a favorite monitoring tool of mine. I&rsquo;m using Docker Compose for local testing and have begun including a <code>cAdvisor</code> in my <code>docker-compose.yaml</code> files.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#f92672">cadvisor</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">google/cadvisor:${CADVISOR_VERSION}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">cadvisor</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># command:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># - --prometheus_endpoint=&#34;/metrics&#34; # Default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;/:/rootfs:ro&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;/var/run:/var/run:rw&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;/sys:/sys:ro&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;/var/snap/docker/current:/var/lib/docker:ro&#34;</span> <span style="color:#75715e">#- &#34;/var/lib/docker/:/var/lib/docker:ro&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">expose</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;8080&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">8080</span>:<span style="color:#ae81ff">8080</span>
</span></span></code></pre></div><p>I&rsquo;d not realized until recently, that <code>cAdvisor</code> also surfaces a Prometheus metrics endpoint and so, if you do follow this path and you&rsquo;re also using Prometheus, don&rsquo;t forget to add <code>cAdvisor</code> to your Prometheus targets.</p>
    </div>
    <a href="/posts/190925/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/vs-code/" class="link blue hover-black">
            Tag: Vs-Code
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190610/" class="link black dim">
        Visual Studio Code: gopls and YAML
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The Go team is developing a <a href="https://langserver.org/">Language Server Protocol [LSP]</a> implementation) called <a href="https://github.com/golang/go/wiki/gopls"><code>gopls</code></a>. Visual Studio Code (and others) support LSP. Other languages (e.g. Python have LSP <a href="https://github.com/Microsoft/python-language-server">implementations</a> too). I&rsquo;ve been using <code>gopls</code> for some time. It works (mostly) very well and replaces multiple, indepedent tools with two (<code>gopls</code> and <a href="https://github.com/go-delve/delve"><code>delve</code></a>).</p>
<p>My Visual Studio Code settings that include <code>gopls</code> is:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span>    <span style="color:#f92672">&#34;go.autocompleteUnimportedPackages&#34;: </span><span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;go.useLanguageServer&#34;: </span><span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;[go]&#34;: </span>{
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;editor.snippetSuggestions&#34;: </span><span style="color:#e6db74">&#34;none&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;editor.formatOnSave&#34;: </span><span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;editor.codeActionsOnSave&#34;: </span>{
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;source.organizeImports&#34;: </span><span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;gopls&#34;: </span>{
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;usePlaceholders&#34;: </span><span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;wantCompletionDocumentation&#34;: </span><span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;go.toolsEnvVars&#34;: </span>{
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;go.languageServerFlags&#34;: </span>[
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;-rpc.trace&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;serve&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;--debug=localhost:6060&#34;</span>,
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;go.enableCodeLens&#34;: </span>{
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;references&#34;: </span><span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;runtest&#34;: </span><span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    },
</span></span></code></pre></div><p>One of the Google engineers working on <code>gopls</code> gave a comprehensive and interesting <a href="https://lnkd.in/g-ykasj">overview</a> of the tool at GopherCon 2019.</p>
    </div>
    <a href="/posts/190610/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
        <h2 class="f1">
          <a href="/tags/pypi-transparency/" class="link blue hover-black">
            Tag: Pypi-Transparency
          </a>
        </h2>
        
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/190907/" class="link black dim">
        pypi-transparency
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>The goal of pypi-transparency is very similar to the underlying motivation for the Golang team&rsquo;s <a href="https://sum.golang.org/">Checksum Database</a> (also built with Trillian).</p>
<p>Even though, <a href="https://pypi.org">PyPi</a> provides hashes of the content of packages it hosts, the developer must trust that PyPi&rsquo;s data is consistent. One ambition with pypi-transparency is to provide a companion, tamperproof log of PyPi package files in order to provide a double-check of these hashes.</p>
<p>It is important to understand what this does (and does not) provide. There&rsquo;s no validation of a package&rsquo;s content. The only calculation is that, on first observation, a SHA-256 hash is computed of the package&rsquo;s content and the hash is recorded. If the package is subsequently altered, it&rsquo;s very probable that the hash will change and this provides a signal to the user that the package&rsquo;s contents has changed. Because pypi-transparency uses a tamperproof log, it&rsquo;s very difficult to update the hash recorded in the tamperproof log, to reflect this change. Corrolary: pypi-transparency will record the hashes of packages that include malicious code.</p>
    </div>
    <a href="/posts/190907/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        
      
    </section>
  </div>

    </main>
    <footer class="bg-dark-blue bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://pretired.dazwilkin.com/" >
    &copy;  (p)retired 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>