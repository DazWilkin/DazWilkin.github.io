<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Google Cloud Events protobufs and SDKs | (p)retired</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="I&rsquo;ve written before about Ackal&rsquo;s use of Firestore and subscribing to Firestore document CRUD events:

Routing Firestore events to GKE with Eventarc
Cloud Firestore Triggers in Golang using Firestore triggers

I find Google&rsquo;s Eventarc documentation to be confusing and, in typical Google fashion, even though open-sourced, you often need to do some legwork to find relevant sources, viz:

Google&rsquo;s Protobufs for Eventarc (using cloudevents) google-cloudevents1
Convenience (since you can generate these using protoc) language-specific types generated from the above e.g. google-cloudevents-go; google-cloudevents-python etc.

1 &ndash; IIUC EventArc is the Google service. It carries Google Events that are CloudEvents. These are defined by protocol buffers schemas.">
    <meta name="generator" content="Hugo 0.137.0-DEV">
    
    
    
    
      <meta name="robots" content="index, follow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.6034ebad1bcaca305e5bfb3c7e4e0693f922718ecee81314bab17d117b4bab5b.css" >



    
    
    
      

    

    

    <script data-goatcounter="https://pretired.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
 
    <meta property="og:url" content="https://pretired.dazwilkin.com/posts/240405/">
  <meta property="og:site_name" content="(p)retired">
  <meta property="og:title" content="Google Cloud Events protobufs and SDKs">
  <meta property="og:description" content="I’ve written before about Ackal’s use of Firestore and subscribing to Firestore document CRUD events:
Routing Firestore events to GKE with Eventarc Cloud Firestore Triggers in Golang using Firestore triggers I find Google’s Eventarc documentation to be confusing and, in typical Google fashion, even though open-sourced, you often need to do some legwork to find relevant sources, viz:
Google’s Protobufs for Eventarc (using cloudevents) google-cloudevents1 Convenience (since you can generate these using protoc) language-specific types generated from the above e.g. google-cloudevents-go; google-cloudevents-python etc. 1 – IIUC EventArc is the Google service. It carries Google Events that are CloudEvents. These are defined by protocol buffers schemas.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-05T00:00:00-07:00">
    <meta property="article:modified_time" content="2024-04-05T00:00:00-07:00">
    <meta property="article:tag" content="Firestore">
    <meta property="article:tag" content="Eventarc">
    <meta property="article:tag" content="Protobufs">
    <meta property="article:tag" content="Rust">
    <meta property="article:tag" content="Golang">
    <meta property="article:tag" content="Tonic">

  <meta itemprop="name" content="Google Cloud Events protobufs and SDKs">
  <meta itemprop="description" content="I’ve written before about Ackal’s use of Firestore and subscribing to Firestore document CRUD events:
Routing Firestore events to GKE with Eventarc Cloud Firestore Triggers in Golang using Firestore triggers I find Google’s Eventarc documentation to be confusing and, in typical Google fashion, even though open-sourced, you often need to do some legwork to find relevant sources, viz:
Google’s Protobufs for Eventarc (using cloudevents) google-cloudevents1 Convenience (since you can generate these using protoc) language-specific types generated from the above e.g. google-cloudevents-go; google-cloudevents-python etc. 1 – IIUC EventArc is the Google service. It carries Google Events that are CloudEvents. These are defined by protocol buffers schemas.">
  <meta itemprop="datePublished" content="2024-04-05T00:00:00-07:00">
  <meta itemprop="dateModified" content="2024-04-05T00:00:00-07:00">
  <meta itemprop="wordCount" content="1213">
  <meta itemprop="keywords" content="Firestore,Eventarc,Protobufs,Rust,Golang,Tonic,Prost">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Google Cloud Events protobufs and SDKs">
  <meta name="twitter:description" content="I’ve written before about Ackal’s use of Firestore and subscribing to Firestore document CRUD events:
Routing Firestore events to GKE with Eventarc Cloud Firestore Triggers in Golang using Firestore triggers I find Google’s Eventarc documentation to be confusing and, in typical Google fashion, even though open-sourced, you often need to do some legwork to find relevant sources, viz:
Google’s Protobufs for Eventarc (using cloudevents) google-cloudevents1 Convenience (since you can generate these using protoc) language-specific types generated from the above e.g. google-cloudevents-go; google-cloudevents-python etc. 1 – IIUC EventArc is the Google service. It carries Google Events that are CloudEvents. These are defined by protocol buffers schemas.">

      
    
	
  </head>

  <body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-dark-blue">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        (p)retired
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
    
    <a href="https://github.com/DazWilkin" target="_blank" rel="noopener" class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://www.linkedin.com/in/dazwilkin/" target="_blank" rel="noopener" class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://medium.com/@DazWilkin" target="_blank" rel="noopener" class="medium ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Medium link" aria-label="follow on Medium——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 170 170;" version="1.1" viewBox="0 0 170 170"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M46.5340803,65.2157554 C46.6968378,63.6076572 46.0836,62.018231 44.8828198,60.93592 L32.6512605,46.2010582 L32.6512605,44 L70.6302521,44 L99.9859944,108.380952 L125.794585,44 L162,44 L162,46.2010582 L151.542017,56.2281011 C150.640424,56.9153477 150.193188,58.0448862 150.380019,59.1628454 L150.380019,132.837155 C150.193188,133.955114 150.640424,135.084652 151.542017,135.771899 L161.755369,145.798942 L161.755369,148 L110.38282,148 L110.38282,145.798942 L120.963119,135.527337 C122.002801,134.487948 122.002801,134.182246 122.002801,132.592593 L122.002801,73.0417402 L92.585901,147.755438 L88.6106443,147.755438 L54.3622782,73.0417402 L54.3622782,123.115814 C54.0767278,125.221069 54.7759199,127.3406 56.2581699,128.863022 L70.0186741,145.55438 L70.0186741,147.755438 L31,147.755438 L31,145.55438 L44.7605042,128.863022 C46.2319621,127.338076 46.8903838,125.204485 46.5340803,123.115814 L46.5340803,65.2157554 Z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://stackoverflow.com/users/609290/dazwilkin" target="_blank" rel="noopener" class="stackoverflow ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Stack Overflow link" aria-label="follow on Stack Overflow——Opens in a new window">
      
        <span class="icon"><svg
    style="enable-background:new 0 0 67 67;"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    
>
    <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm.869 5.903l3.114 4.567-.975.665-3.115-4.567.976-.665zm-2.812 2.585l4.84 2.838-.6 1.017-4.842-2.838.602-1.017zm-1.276 2.724l5.413 1.521-.291 1.077-5.428-1.458.306-1.14zm-.588 2.461l5.687.569-.103 1.12-5.691-.513.107-1.176zm-.169 2.16h5.835v1.167h-5.835v-1.167zm7.976 3.167h-10v-6h1v5h8v-5h1v6zm.195-8.602l-.945-5.446 1.162-.202.947 5.446-1.164.202z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside>
      




      <h1 class="f1 athelas mt3 mb1">Google Cloud Events protobufs and SDKs</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2024-04-05T00:00:00-07:00">April 5, 2024</time>
      

      
      
        <span class="f6 mv4 dib tracked"> - 6 minutes read </span>
        <span class="f6 mv4 dib tracked"> - 1213 words </span>
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>I&rsquo;ve written before about <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s use of <a href="https://cloud.google.com/firestore">Firestore</a> and subscribing to Firestore document CRUD events:</p>
<ul>
<li><a href="/posts/230530/">Routing Firestore events to GKE with Eventarc</a></li>
<li><a href="/posts/210413/">Cloud Firestore Triggers in Golang</a> using <a href="https://cloud.google.com/functions/docs/calling/cloud-firestore">Firestore triggers</a></li>
</ul>
<p>I find Google&rsquo;s <a href="cloud.google.com/eventarc">Eventarc</a> documentation to be confusing and, in typical Google fashion, even though open-sourced, you often need to do some legwork to find relevant sources, viz:</p>
<ul>
<li>Google&rsquo;s Protobufs for Eventarc (using <a href="https://cloudevents.io/">cloudevents</a>) <a href="https://github.com/googleapis/google-cloudevents"><code>google-cloudevents</code></a><!-- raw HTML omitted -->1<!-- raw HTML omitted --></li>
<li>Convenience (since you can generate these using <code>protoc</code>) language-specific types generated from the above e.g. <a href="https://github.com/googleapis/google-cloudevents-go"><code>google-cloudevents-go</code></a>; <a href="https://github.com/googleapis/google-cloudevents-python"><code>google-cloudevents-python</code></a> etc.</li>
</ul>
<p><!-- raw HTML omitted -->1<!-- raw HTML omitted --> &ndash; IIUC EventArc is the Google service. It carries Google Events that are CloudEvents. These are defined by protocol buffers schemas.</p>
<p>Google documents the <a href="https://cloud.google.com/eventarc/docs/reference/supported-events">Event types support by Eventarc</a> and, for the purposes of this discussion, we can grep <a href="https://cloud.google.com/eventarc/docs/reference/supported-events#cloud-firestore">Cloud Firestore</a> events which include both &ldquo;native&rdquo; (Firestore for real) and &ldquo;datastore&rdquo; (<a href="https://cloud.google.com/datastore">Firestore in Datastore mode</a>) events:</p>
<ul>
<li><code>google.cloud.datastore.entity.v1.created</code></li>
<li><code>google.cloud.datastore.entity.v1.deleted</code></li>
<li><code>google.cloud.datastore.entity.v1.updated</code></li>
<li><code>google.cloud.datastore.entity.v1.written</code></li>
<li><code>google.cloud.firestore.document.v1.created</code></li>
<li><code>google.cloud.firestore.document.v1.deleted</code></li>
<li><code>google.cloud.firestore.document.v1.updated</code></li>
<li><code>google.cloud.firestore.document.v1.written</code></li>
</ul>
<p>These event types are very useful in determining which protocol buffer Messages are used:</p>
<ul>
<li>Firestore Firestore uses protobuf package <a href="https://github.com/googleapis/google-cloudevents/tree/main/proto/google/events/cloud/firestore/v1"><code>google.events.cloud.firestore.v1</code></a></li>
<li>Firestore in Datastore mode uses <a href="https://github.com/googleapis/google-cloudevents/tree/main/proto/google/events/cloud/datastore/v1"><code>google.events.cloud.datastore.v1</code></a></li>
</ul>
<blockquote>
<p><strong>NOTE</strong> This seems rather complex but is the result of the historical evolution: what was Datastore and is now Firestore in Datastore mode, Firestore (which is an evolution of Firebase) and Firebase are all same-same-but-different services.</p>
</blockquote>
<blockquote>
<p><strong>NOTE</strong> [Firebase] has a distinct set of event types and uses its own protobuf package <a href="https://github.com/googleapis/google-cloudevents/tree/main/proto/google/events/firebase"><code>google.events.firebase</code></a> namespace for its services</p>
</blockquote>
<p>Before we proceed, note that an event type of e.g. <code>google.cloud.firestore.document.v1.created</code> is represented by a protocol buffer package (!) called <code>google.events.cloud.firestore.v1</code>. Again, the difference is necessary but it can be confusing.</p>
<p>Both Firestore and Datastore protocol bufffer packages comprise: <code>data.proto</code> and <code>events.proto</code>. For each package, <code>events.proto</code> maps event type to Messages (!) in the package. For example:</p>
<p>Firestore&rsquo;s <a href="https://github.com/googleapis/google-cloudevents/blob/253fda0fbfb4db55c9fb684073792df0ee9cd7b9/proto/google/events/cloud/firestore/v1/events.proto#L40"><code>DocumentCreatedEvent</code></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-protobuf" data-lang="protobuf"><span style="display:flex;"><span><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">DocumentCreatedEvent</span> {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">option</span> (google.events.cloud_event_type) <span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>      <span style="color:#e6db74">&#34;google.cloud.firestore.document.v1.created&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#f92672">...</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#75715e">// The data associated with the event
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  DocumentEventData data <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>And, for Firestore, every Message corresponding to an event, carries <a href="https://github.com/googleapis/google-cloudevents/blob/253fda0fbfb4db55c9fb684073792df0ee9cd7b9/proto/google/events/cloud/firestore/v1/data.proto#L28"><code>DocumentEventData</code></a> defined in <code>data.proto</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-protobuf" data-lang="protobuf"><span style="display:flex;"><span><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">DocumentEventData</span> {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  Document value <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  Document old_value <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  DocumentMask update_mask <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Datastore&rsquo;s <a href="https://github.com/googleapis/google-cloudevents/blob/253fda0fbfb4db55c9fb684073792df0ee9cd7b9/proto/google/events/cloud/datastore/v1/events.proto#L40"><code>EntityCreatedEvent</code></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-protobuf" data-lang="protobuf"><span style="display:flex;"><span><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">EntityCreatedEvent</span> {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">option</span> (google.events.cloud_event_type) <span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>      <span style="color:#e6db74">&#34;google.cloud.datastore.entity.v1.created&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#f92672">...</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#75715e">// The data associated with the event.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  EntityEventData data <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>And, for Datastore, every Message corresponding to an event, carries <a href="https://github.com/googleapis/google-cloudevents/blob/253fda0fbfb4db55c9fb684073792df0ee9cd7b9/proto/google/events/cloud/datastore/v1/data.proto#L29"><code>EntityEventData</code></a> defined in <code>data.proto</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-protobuf" data-lang="protobuf"><span style="display:flex;"><span><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">EntityEventData</span> {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  EntityResult value <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  EntityResult old_value <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  PropertyMask update_mask <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>These <code>*Event</code> Messages represent the schema for the event data that&rsquo;s delivered by Eventarc as the result of a Firestore document trigger. Your code will need to unmarshal the (often-times base64-encoded) message into the appropriate protobuf Message for processing.</p>
<p>At the top-level, the two services&rsquo; event Messages are similar. This is because for each CRUD event (whether a Firestore document or a Datastore entity), Eventarc delivers an event (represented by a Message) that potentially (!) includes the (current|new) <code>value</code>, the (prior) <code>old_value</code> and a mask indicating which properties changed for update events. The rule is:</p>
<ul>
<li><code>created</code> has a (new) <code>value</code> and an empty <code>old_value</code></li>
<li><code>deleted</code> has an empty <code>value</code> and the <code>old_value</code></li>
<li><code>updated</code> has a (new) <code>value</code> and the previous <code>old_value</code> <strong>and</strong> a mask</li>
<li><code>written</code> (<code>created</code>|<code>deleted</code>|<code>updated</code>) infer which from <code>value</code> and <code>old_value</code></li>
</ul>
<p>If you&rsquo;ve subscribed to <code>created</code>,<code>deleted</code> and <code>updated</code> events, your code will confirm that the e.g. <code>DocumentEventData</code> comprises <code>value</code> and|or <code>old_value</code> and mask values and process accordingly.</p>
<p>If you&rsquo;ve subscribed to the generic <code>written</code> event, your code will need to determine which event is implied by inspecting whether <code>value</code> and <code>old_value</code> (or the mask) has content.</p>
<p>The Firestore <code>Document</code> Message and Datastore <code>EntityResult</code> Message are markedly different and so I&rsquo;ll summarize the (simpler) Firestore <code>Document</code> Message. As you&rsquo;d expected, an identifier (<code>name</code>) which is the fully-qualified path to the document (<code>projects/{project}/databases/{database}/documents/{document_path}</code>) and then a map of the document fields (name|value) and created|updated timestamps:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-protobuf" data-lang="protobuf"><span style="display:flex;"><span><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">Document</span> {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">string</span> name <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  map&lt;<span style="color:#66d9ef">string</span>, Value&gt; fields <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  google.protobuf.Timestamp create_time <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  google.protobuf.Timestamp update_time <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>At this point, your code will become specific to your need, in <a href="https://ack.al" data-goatcounter-click="ack.al">Ackal</a>&rsquo;s usage, Firestore events result in Kubernetes Resources being mutated.</p>
<p>For debugging, it&rsquo;s useful to be able to decode protocol buffer messages that you receive. <code>protoc</code> is useful for this but requires some configuration in order to be able to parse Google&rsquo;s Protobufs for Eventarc. You will want to clone:</p>
<ul>
<li><a href="https://github.com/googleapis/googleapis"><code>googleapis/googleapis</code></a> this repo represents protobufs for all Google&rsquo;s services and includes the set of <a href="https://github.com/googleapis/googleapis/tree/master/google/type"><code>google.type</code></a> including <code>LatLng</code> which is used by the events protos</li>
<li><a href="https://github.com/googleapis/google-cloudevents"><code>googleapis/google-cloudevents</code></a></li>
</ul>
<p>You should <strong>not</strong> need to clone <a href="https://github.com/protocolbuffers"><code>github.com/protocolbuffers</code></a> which includes Google&rsquo;s Well-Known Types (<a href="https://github.com/protocolbuffers/protobuf/tree/main/src/google/protobuf"><code>google.protobuf</code></a>) since these <strong>should</strong> be accessible to <code>protoc</code> automatically.</p>
<p>Then, given e.g. a Firestore [<code>DocumentEventData</code>] base64-encoded (binary) <code>message</code>, you can:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Paths to the Protocol Buffers root</span>
</span></span><span style="display:flex;"><span>GOOGLEAPIS_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/googleapis&#34;</span>
</span></span><span style="display:flex;"><span>CLOUDEVENTS_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/google-cloudevents/proto&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PACKAGE_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;google/events/cloud/firestore/v1&#34;</span>
</span></span><span style="display:flex;"><span>PACKAGE_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;google.events.cloud.firestore.v1&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MESSAGE_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;DocumentEventData&#34;</span>
</span></span><span style="display:flex;"><span>MESSAGE_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;data.proto&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>more messsage <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| base64 --decode --wrap<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| protoc <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--decode<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PACKAGE_NAME<span style="color:#e6db74">}</span>.<span style="color:#e6db74">${</span>MESSAGE_NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--proto_path<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>GOOGLEAPIS_PATH<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--proto_path<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>CLOUDEVENTS_PATH<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">${</span>CLOUDEVENTS_PATH<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PACKAGE_PATH<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>MESSAGE_FILE<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>And receive something of the form:</p>
<pre tabindex="0"><code>value {
  name: &#34;projects/{project_id}/databases/{database_id}/documents/{document_path}&#34;
  fields {
    key: &#34;Birthday&#34;
    value {
      timestamp_value {
        seconds: 1530316800
      }
    }
  }
  fields {
    key: &#34;ID&#34;
    value {
      integer_value: 1
    }
  }
  fields {
    key: &#34;Name&#34;
    value {
      string_value: &#34;Freddie&#34;
    }
  }
  create_time {
    seconds: 1712275200
  }
  update_time {
    seconds: 1712275200
  }
}
</code></pre><blockquote>
<p><strong>NOTE</strong> The hex version of the above is: <code>0a8d010a4770726f6a656374732f7b70726f6a6563745f69647d2f6461746162617365732f7b64617461626173655f69647d2f646f63756d656e74732f7b646f63756d656e745f706174687d12080a0249441202100112120a044e616d65120a8a01074672656464696512140a08426972746864617912085206088090dbd9051a060880febcb00622060880febcb006</code></p>
</blockquote>
<p>And, since we can generate the types ourselves using <code>protoc</code>, here&rsquo;s the Rust version:</p>
<p><code>Cargo.toml</code>:</p>
<pre tabindex="0"><code>[package]
name = &#34;cloudevents-firestore&#34;
version = &#34;0.1.0&#34;
edition = &#34;2021&#34;

[build-dependencies]
tonic-build = &#34;0.11.0&#34;

[dependencies]
prost = &#34;0.12.4&#34;
prost-types = &#34;0.12.4&#34;
tonic = &#34;0.11.0&#34;
</code></pre><p><code>build.rs</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::{env,path::PathBuf};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() -&gt; Result<span style="color:#f92672">&lt;</span>(), Box<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">dyn</span> std::error::Error<span style="color:#f92672">&gt;&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> out_dir<span style="color:#f92672">=</span>PathBuf::from(env::var(<span style="color:#e6db74">&#34;OUT_DIR&#34;</span>)
</span></span><span style="display:flex;"><span>        .expect(<span style="color:#e6db74">&#34;unable to determine `OUT_DIR`&#34;</span>));
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// `file_descriptor_set_path` appends `.pb` to the file that&#39;s created
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    tonic_build::configure()
</span></span><span style="display:flex;"><span>        .build_server(<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>        .file_descriptor_set_path(out_dir.join(<span style="color:#e6db74">&#34;firestore.pb&#34;</span>))
</span></span><span style="display:flex;"><span>        .compile(
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&amp;</span>[<span style="color:#e6db74">&#34;/path/to/google-cloudevents/proto/google/events/cloud/firestore/v1/data.proto&#34;</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&amp;</span>[
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/path/to/googleapis&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/path/to/google-cloudevents/proto&#34;</span>
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>        )<span style="color:#f92672">?</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Ok(())
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And:
<code>main.rs</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">mod</span> google {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">mod</span> events {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">mod</span> cloud {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">mod</span> firestore {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">mod</span> v1 {
</span></span><span style="display:flex;"><span>                    tonic::include_proto!(<span style="color:#e6db74">&#34;google.events.cloud.firestore.v1&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">mod</span> r#<span style="color:#66d9ef">type</span> {
</span></span><span style="display:flex;"><span>        tonic::include_proto!(<span style="color:#e6db74">&#34;google.r#type&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> google::events::cloud::firestore::v1::{
</span></span><span style="display:flex;"><span>    value::ValueType::{IntegerValue, StringValue, TimestampValue},
</span></span><span style="display:flex;"><span>    Document, DocumentEventData, Value,
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> prost::Message;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> prost_types::Timestamp;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::collections::HashMap;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">NAME</span>: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;projects/{project_id}/databases/{database_id}/documents/{document_path}&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> birthday <span style="color:#f92672">=</span> Timestamp::date(<span style="color:#ae81ff">2018</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">30</span>).expect(<span style="color:#e6db74">&#34;unable to parse birthday&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> create_time <span style="color:#f92672">=</span> Some(Timestamp {
</span></span><span style="display:flex;"><span>        seconds: <span style="color:#ae81ff">1712275200</span>,
</span></span><span style="display:flex;"><span>        nanos: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> update_time <span style="color:#f92672">=</span> create_time.clone();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> message <span style="color:#f92672">=</span> DocumentEventData {
</span></span><span style="display:flex;"><span>        value: Some(Document {
</span></span><span style="display:flex;"><span>            name: <span style="color:#a6e22e">NAME</span>.to_string(),
</span></span><span style="display:flex;"><span>            fields: <span style="color:#a6e22e">HashMap</span>::from([
</span></span><span style="display:flex;"><span>                (
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;ID&#34;</span>.to_string(),
</span></span><span style="display:flex;"><span>                    Value {
</span></span><span style="display:flex;"><span>                        value_type: Some(IntegerValue(<span style="color:#ae81ff">1</span>)),
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                ),
</span></span><span style="display:flex;"><span>                (
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;Name&#34;</span>.to_string(),
</span></span><span style="display:flex;"><span>                    Value {
</span></span><span style="display:flex;"><span>                        value_type: Some(
</span></span><span style="display:flex;"><span>                          StringValue(<span style="color:#e6db74">&#34;Freddie&#34;</span>.to_string()),
</span></span><span style="display:flex;"><span>                        ),
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                ),
</span></span><span style="display:flex;"><span>                (
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;Birthday&#34;</span>.to_string(),
</span></span><span style="display:flex;"><span>                    Value {
</span></span><span style="display:flex;"><span>                        value_type: Some(
</span></span><span style="display:flex;"><span>                          TimestampValue(birthday),
</span></span><span style="display:flex;"><span>                        ),
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                ),
</span></span><span style="display:flex;"><span>            ]),
</span></span><span style="display:flex;"><span>            create_time: <span style="color:#a6e22e">create_time</span>,
</span></span><span style="display:flex;"><span>            update_time: <span style="color:#a6e22e">update_time</span>,
</span></span><span style="display:flex;"><span>        }),
</span></span><span style="display:flex;"><span>        old_value: None,
</span></span><span style="display:flex;"><span>        update_mask: None,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> data <span style="color:#f92672">=</span> message.encode_to_vec();
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{:?}</span><span style="color:#e6db74">&#34;</span>, data);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> hex_string <span style="color:#f92672">=</span> String::new();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> byte <span style="color:#66d9ef">in</span> <span style="color:#f92672">&amp;</span>data {
</span></span><span style="display:flex;"><span>        hex_string.push_str(<span style="color:#f92672">&amp;</span>format!(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{:02X}</span><span style="color:#e6db74">&#34;</span>, byte));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span>, hex_string);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Running the above example should generate the same output as this Golang equivalent:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log/slog&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/googleapis/google-cloudevents-go/cloud/firestoredata&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/protobuf/proto&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/protobuf/types/known/timestamppb&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span> = <span style="color:#e6db74">&#34;projects/{project_id}/databases/{database_id}/documents/{document_path}&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">created</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">timestamppb</span>.<span style="color:#a6e22e">New</span>(
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Date</span>(<span style="color:#ae81ff">2024</span>, <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">April</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">UTC</span>),
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">data</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestoredata</span>.<span style="color:#a6e22e">DocumentEventData</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Value</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestoredata</span>.<span style="color:#a6e22e">Document</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Name</span>: <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Fields</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#f92672">*</span><span style="color:#a6e22e">firestoredata</span>.<span style="color:#a6e22e">Value</span>{
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;ID&#34;</span>: {
</span></span><span style="display:flex;"><span>					<span style="color:#a6e22e">ValueType</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestoredata</span>.<span style="color:#a6e22e">Value_IntegerValue</span>{
</span></span><span style="display:flex;"><span>						<span style="color:#a6e22e">IntegerValue</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>					},
</span></span><span style="display:flex;"><span>				},
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;Name&#34;</span>: {
</span></span><span style="display:flex;"><span>					<span style="color:#a6e22e">ValueType</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestoredata</span>.<span style="color:#a6e22e">Value_StringValue</span>{
</span></span><span style="display:flex;"><span>						<span style="color:#a6e22e">StringValue</span>: <span style="color:#e6db74">&#34;Freddie&#34;</span>,
</span></span><span style="display:flex;"><span>					},
</span></span><span style="display:flex;"><span>				},
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;Birthday&#34;</span>: {
</span></span><span style="display:flex;"><span>					<span style="color:#a6e22e">ValueType</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestoredata</span>.<span style="color:#a6e22e">Value_TimestampValue</span>{
</span></span><span style="display:flex;"><span>						<span style="color:#a6e22e">TimestampValue</span>: <span style="color:#a6e22e">timestamppb</span>.<span style="color:#a6e22e">New</span>(
</span></span><span style="display:flex;"><span>							<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Date</span>(<span style="color:#ae81ff">2018</span>, <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">June</span>, <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">UTC</span>),
</span></span><span style="display:flex;"><span>						),
</span></span><span style="display:flex;"><span>					},
</span></span><span style="display:flex;"><span>				},
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">CreateTime</span>: <span style="color:#a6e22e">created</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">UpdateTime</span>: <span style="color:#a6e22e">created</span>,
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">OldValue</span>:   <span style="color:#66d9ef">nil</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">UpdateMask</span>: <span style="color:#66d9ef">nil</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Data&#34;</span>, <span style="color:#e6db74">&#34;data&#34;</span>, <span style="color:#a6e22e">data</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">proto</span>.<span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">data</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#e6db74">&#34;unable to marshal data&#34;</span>, <span style="color:#e6db74">&#34;err&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Exit</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Message&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%x&#34;</span>, <span style="color:#a6e22e">b</span>))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul class="pa0">
  
   <li class="list di">
     <a href="/tags/firestore/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Firestore</a>
   </li>
  
   <li class="list di">
     <a href="/tags/eventarc/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Eventarc</a>
   </li>
  
   <li class="list di">
     <a href="/tags/protobufs/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Protobufs</a>
   </li>
  
   <li class="list di">
     <a href="/tags/rust/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Rust</a>
   </li>
  
   <li class="list di">
     <a href="/tags/golang/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Golang</a>
   </li>
  
   <li class="list di">
     <a href="/tags/tonic/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Tonic</a>
   </li>
  
   <li class="list di">
     <a href="/tags/prost/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Prost</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/posts/240325/">Prost! Tonic w/ a dash of JSON</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/201113/">Akri</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/200817/">WASM Transparency</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/200807/">waPC and MsgPack (Rust|Golang)</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/240307/">Prometheus Protobufs and Native Histograms</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/240130/">Navigating Koyeb&#39;s API with Rust</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/230530/">Routing Firestore events to GKE with Eventarc</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/221128/">Maintaining Container Images</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/221117/">Delegate domain-wide authority using Golang</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/221106/">Basic programmatic access to GitHub Issues</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/211018/">Golang Structured Logging w/ Google Cloud Logging (2)</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/210928/">Golang Structured Logging w/ Google Cloud Logging</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/210924/">GitHub help with dependency management</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/210724/">gRPC Interceptors and in-memory gRPC connections</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/210716/">Stripe</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-dark-blue bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://pretired.dazwilkin.com/" >
    &copy;  (p)retired 2024 
  </a>
    <div>
<div class="ananke-socials">
  
    
    <a href="https://github.com/DazWilkin" target="_blank" rel="noopener" class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://www.linkedin.com/in/dazwilkin/" target="_blank" rel="noopener" class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://medium.com/@DazWilkin" target="_blank" rel="noopener" class="medium ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Medium link" aria-label="follow on Medium——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 170 170;" version="1.1" viewBox="0 0 170 170"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M46.5340803,65.2157554 C46.6968378,63.6076572 46.0836,62.018231 44.8828198,60.93592 L32.6512605,46.2010582 L32.6512605,44 L70.6302521,44 L99.9859944,108.380952 L125.794585,44 L162,44 L162,46.2010582 L151.542017,56.2281011 C150.640424,56.9153477 150.193188,58.0448862 150.380019,59.1628454 L150.380019,132.837155 C150.193188,133.955114 150.640424,135.084652 151.542017,135.771899 L161.755369,145.798942 L161.755369,148 L110.38282,148 L110.38282,145.798942 L120.963119,135.527337 C122.002801,134.487948 122.002801,134.182246 122.002801,132.592593 L122.002801,73.0417402 L92.585901,147.755438 L88.6106443,147.755438 L54.3622782,73.0417402 L54.3622782,123.115814 C54.0767278,125.221069 54.7759199,127.3406 56.2581699,128.863022 L70.0186741,145.55438 L70.0186741,147.755438 L31,147.755438 L31,145.55438 L44.7605042,128.863022 C46.2319621,127.338076 46.8903838,125.204485 46.5340803,123.115814 L46.5340803,65.2157554 Z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://stackoverflow.com/users/609290/dazwilkin" target="_blank" rel="noopener" class="stackoverflow ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Stack Overflow link" aria-label="follow on Stack Overflow——Opens in a new window">
      
        <span class="icon"><svg
    style="enable-background:new 0 0 67 67;"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    
>
    <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm.869 5.903l3.114 4.567-.975.665-3.115-4.567.976-.665zm-2.812 2.585l4.84 2.838-.6 1.017-4.842-2.838.602-1.017zm-1.276 2.724l5.413 1.521-.291 1.077-5.428-1.458.306-1.14zm-.588 2.461l5.687.569-.103 1.12-5.691-.513.107-1.176zm-.169 2.16h5.835v1.167h-5.835v-1.167zm7.976 3.167h-10v-6h1v5h8v-5h1v6zm.195-8.602l-.945-5.446 1.162-.202.947 5.446-1.164.202z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>
</div>
  </div>
</footer>

  </body>
</html>