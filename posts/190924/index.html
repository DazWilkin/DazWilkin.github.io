<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>(p)retired  | 190924</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.59.0-DEV" />
    
    
      <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="190924" />
<meta property="og:description" content="Google Cloud Platform Free Tier appears (please verify this for yourself) the ability to run a(n admittedly miniscule) Kubernetes cluster for free. So, why do this? It provides a definitive Kubernetes (Engine) experience on Google Cloud Platform that you may use for learning and testing.
Kubernetes Engine the master node(s) and the control plane are free.
Kubernetes (i.e. Compute Engine) nodes potentially incur charges including for the VM runtime and any attached storage, snapshots etc." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://pretired.dazwilkin.com/posts/190924/" />
<meta property="article:published_time" content="2019-09-24T09:40:14-07:00" />
<meta property="article:modified_time" content="2019-09-24T09:40:14-07:00" />
<meta itemprop="name" content="190924">
<meta itemprop="description" content="Google Cloud Platform Free Tier appears (please verify this for yourself) the ability to run a(n admittedly miniscule) Kubernetes cluster for free. So, why do this? It provides a definitive Kubernetes (Engine) experience on Google Cloud Platform that you may use for learning and testing.
Kubernetes Engine the master node(s) and the control plane are free.
Kubernetes (i.e. Compute Engine) nodes potentially incur charges including for the VM runtime and any attached storage, snapshots etc.">


<meta itemprop="datePublished" content="2019-09-24T09:40:14-07:00" />
<meta itemprop="dateModified" content="2019-09-24T09:40:14-07:00" />
<meta itemprop="wordCount" content="499">



<meta itemprop="keywords" content="Google Cloud Platform,Kubernetes,Kubernetes Engine,GKE," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="190924"/>
<meta name="twitter:description" content="Google Cloud Platform Free Tier appears (please verify this for yourself) the ability to run a(n admittedly miniscule) Kubernetes cluster for free. So, why do this? It provides a definitive Kubernetes (Engine) experience on Google Cloud Platform that you may use for learning and testing.
Kubernetes Engine the master node(s) and the control plane are free.
Kubernetes (i.e. Compute Engine) nodes potentially incur charges including for the VM runtime and any attached storage, snapshots etc."/>

      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-RF7WY9KGR3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
  </head>

  <body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://pretired.dazwilkin.com/" class="f3 fw2 hover-white no-underline white-90 dib">
      (p)retired
    </a>
    <div class="flex-l items-center">
      

      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">190924</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2019-09-24T09:40:14-07:00">September 24, 2019</time>
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Google Cloud Platform <a href="https://cloud.google.com/free/">Free Tier</a> appears (<span style="color:red">please verify this for yourself</span>) the ability to run a(n admittedly miniscule) Kubernetes cluster for free. So, why do this? It provides a definitive Kubernetes (Engine) experience on Google Cloud Platform that you may use for learning and testing.</p>

<p>Kubernetes Engine the master node(s) and the control plane are <a href="https://cloud.google.com/kubernetes-engine/pricing">free</a>.</p>

<p>Kubernetes (i.e. Compute Engine) nodes potentially incur charges including for the VM runtime and any attached storage, snapshots etc. However, charges for these resources can be partially covered by the Free Tier.</p>

<p>As of writing, Compute Engine under the Free Tier provides:</p>

<ul>
<li>1 f1-micro instance per month (US regions only â€” excluding Northern Virginia [us-east4])</li>
<li>30 GB-months HDD</li>
<li>5 GB-months snapshot in select regions</li>
<li>1 GB network egress from North America to all region destinations per month (excluding China and Australia)</li>
</ul>

<p>Curiously, testing confirms that, to be free, this must be a &ldquo;<strong>non</strong>&ndash;preemptible&rdquo; instance. The cheaper &ldquo;preemptible&rdquo; instances incur charges. Go figure!</p>

<p>The documentation says: &ldquo;Your Always Free f1-micro instance limit is by time, not by instance. Each month, eligible use of all of your f1-micro instances are free until you have used a number of hours equal to the total hours in the current month. Usage calculations are combined across the supported regions.&rdquo;</p>

<p>So, you may use 1 non-preemptible f1-micro instance 24x7 or (!) you may use e.g. 3 f1-micro instances <strong>each</strong> for 8 hours/day (24/3x7). Or any (!?) multiple thereof e.g. 24 instances for 1 hour/day (24/24x7)</p>

<p>Similarly, the 30 GB-months HDD means you may use 3 instances <strong>each</strong> with a (paltry) 10GB HDD for (24x7)/3.</p>

<p><span style="color:red">Once again, please do not take my word for this. Try it for yourself and verify.</span></p>

<p>You will incur charges for TCP Load-balancing (<code>--type=LoadBalancer</code>) and HTTP/S Load-balancing including those provisioned by Ingress objects.</p>

<p>So, you can provision a 3-node Kubernetes cluster in us-west1 (3 zones) using a command of the form:</p>

<pre><code class="language-bash">gcloud beta container clusters create ${CLUSTER} \
--project=${PROJECT} \
--region=us-west1 \
--no-enable-basic-auth \
--no-issue-client-certificate \
--release-channel=rapid \
--machine-type=f1-micro \
--image-type=COS_CONTAINERD \
--disk-type=pd-standard \
--disk-size=10 \
--metadata=disable-legacy-endpoints=true \
--num-nodes=1 \
--enable-stackdriver-kubernetes \
--enable-ip-alias \
--enable-autoupgrade \
--enable-autorepair \
--shielded-secure-boot
</code></pre>

<p>You may append <code>--async</code> to run this command asynchronously.</p>

<p>Because we&rsquo;re trying to stay within the Free Tier, it&rsquo;s <strong>very</strong> important that you delete this cluster before you exhaust the month&rsquo;s free quota. Unfortunately, there&rsquo;s currently (!?) no systematic way to have GCP defer the deletion of a resource to a future point in time but, with some diligence in ensuring you use the correct command and hoping that you don&rsquo;t lose power, Internet access etc., you can create a compensating <code>gcloud beta container clusters delete</code> and schedule this using Linux&rsquo;s <code>at</code>:</p>

<pre><code class="language-bash">echo &quot;gcloud beta container clusters delete ${CLUSTER} --project=${PROJECT} --region=us-west1 --quiet&quot; \
| at -f /dev/stdin now + 2 hour
</code></pre>

<p><strong>NB</strong> Because <code>at</code> runs commands under its own environment, you need to be careful with referencing environment variables.</p>

<p><strong>NB</strong> It doesn&rsquo;t make a huge difference but, you can combine (<code>&amp;&amp;</code>) the create and delete commands.</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/google-cloud-platform" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Google Cloud Platform</a>
   </li>
  
   <li class="list">
     <a href="/tags/kubernetes" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Kubernetes</a>
   </li>
  
   <li class="list">
     <a href="/tags/kubernetes-engine" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Kubernetes Engine</a>
   </li>
  
   <li class="list">
     <a href="/tags/gke" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">GKE</a>
   </li>
  
</ul>
<div class="mt6">
      
      
      </div>
    </section>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://pretired.dazwilkin.com/" >
    &copy; 2019 (p)retired
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
