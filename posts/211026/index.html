<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Firebase Auth authorized domains | (p)retired</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Firebase Auth authorized domains">
    <meta name="generator" content="Hugo 0.146.0-DEV">
    
    
    
    
      <meta name="robots" content="index, follow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.d05fb5f317fcf33b3a52936399bdf6f47dc776516e1692e412ec7d76f4a5faa2.css" >




    
    
    
      

    

    

    <script data-goatcounter="https://pretired.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
 
    <meta property="og:url" content="https://pretired.dazwilkin.com/posts/211026/">
  <meta property="og:site_name" content="(p)retired">
  <meta property="og:title" content="Firebase Auth authorized domains">
  <meta property="og:description" content="Firebase Auth authorized domains">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-10-26T00:00:00-07:00">
    <meta property="article:modified_time" content="2021-10-26T00:00:00-07:00">
    <meta property="article:tag" content="Firebase-Auth">
    <meta property="article:tag" content="Cloud-Run">

  <meta itemprop="name" content="Firebase Auth authorized domains">
  <meta itemprop="description" content="Firebase Auth authorized domains">
  <meta itemprop="datePublished" content="2021-10-26T00:00:00-07:00">
  <meta itemprop="dateModified" content="2021-10-26T00:00:00-07:00">
  <meta itemprop="wordCount" content="1148">
  <meta itemprop="keywords" content="Firebase-Auth,Cloud-Run">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Firebase Auth authorized domains">
  <meta name="twitter:description" content="Firebase Auth authorized domains">

      
    
	
  </head>

  <body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-dark-blue">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        (p)retired
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Firebase Auth authorized domains</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2021-10-26T00:00:00-07:00">October 26, 2021</time>
      

      
      
        <span class="f6 mv4 dib tracked"> - 6 minutes read </span>
        <span class="f6 mv4 dib tracked"> - 1148 words </span>
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>I&rsquo;m using Firebase Authentication in a project to authenticate users of various OAuth2 identity systems. Firebase Authentication requires a set of Authorized Domains.</p>
<p>The (web) app that interacts with Firebase Authentication is deployed to Cloud Run.  The Authorized Domains list must include the app&rsquo;s Cloud Run service URL.</p>
<p>Cloud Run service URLs vary by Project (ID). They are a combination of the service name, a hash (?) of the Project (ID) and <code>.a.run.app</code>.</p>
<p>As I&rsquo;m testing the app, I want to be able to programmatically update the list of Firebase Auth&rsquo;s authorized domains.</p>
<h2 id="curl"><a href="https://curl.se/"><code>curl</code></a></h2>
<p>The solution (more on this below) is to <a href="https://curl.se/"><code>curl</code></a> Google&rsquo;s Identity Platform (?) endpoint: <code>identitytoolkit.googleapis.com/admin/v2</code>. The flow is:</p>
<ul>
<li><a href="https://cloud.google.com/identity-platform/docs/reference/rest/v2/projects/getConfig">getConfig</a></li>
<li>extract the list of <code>authorizedDomains</code> from the current (!) <a href="https://cloud.google.com/identity-platform/docs/reference/rest/v2/Config"><code>Config</code></a></li>
<li>add the Cloud Run service URL and then <a href="https://cloud.google.com/identity-platform/docs/reference/rest/v2/projects/updateConfig">updateConfig</a></li>
<li>field masking the <a href="https://cloud.google.com/identity-platform/docs/reference/rest/v2/Config"><code>Config</code></a> body so that I need only provide <code>authorizedDomains</code>:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Firebase Authentication project ID</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://identitytoolkit.googleapis.com/v2/projects/</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MASK<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;authorizedDomains&#34;</span>
</span></span><span style="display:flex;"><span>FILTER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;.</span><span style="color:#e6db74">${</span>MASK<span style="color:#e6db74">}</span><span style="color:#e6db74"> | . += [\&#34;</span><span style="color:#e6db74">${</span>HOST<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;] | { \&#34;</span><span style="color:#e6db74">${</span>MASK<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;: . }&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DATA<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --request GET <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --header <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --header <span style="color:#e6db74">&#34;Accept: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --compressed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">${</span>URL<span style="color:#e6db74">}</span>/config <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| jq <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>FILTER<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span>
</span></span></code></pre></div><p>So the <a href="https://stedolan.github.io/jq/"><code>jq</code></a> <code>FILTER</code> is very likely sub-optimal, but it works.</p>
<p>Assuming <code>Config</code> contains <code>authorizedDomains</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;authorizedDomnains&#34;</span>: [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;foo&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;bar&#34;</span>,
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We grab the array (<code>[...]</code>) and add an array (!) to it containing the URL (<code>${HOST}</code>) of a Cloud Run Service.</p>
<blockquote>
<p><strong>NOTE</strong> This is one way to grab the service URL, given the service name and project is. This returns only the fully-qualified host (i.e. <code>some-service-xxxxxxxxxx-xx.a.run.app</code>) from the URL:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>HOST<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>gcloud run services describe <span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --platform<span style="color:#f92672">=</span>managed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --region<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --format<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;value(status.address.url)&#34;</span><span style="color:#66d9ef">)</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>HOST<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>HOST#https://<span style="color:#e6db74">}</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>echo <span style="color:#e6db74">${</span>HOST<span style="color:#e6db74">}</span>
</span></span></code></pre></div></blockquote>
<p>Then &ndash; and there&rsquo;s very likely a way to do this without extracting <code>authorizedDomains</code> from the JSON only to put it back &ndash; is to take the result of list append and return:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;authorizedDomains&#34;</span>: [<span style="color:#960050;background-color:#1e0010">...</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This is all that&rsquo;s needed for the <code>Config</code> we give to <code>updateConfig</code> because we can use a field mask to tell the service we&rsquo;re only updating <code>authorizedDomains</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--request PATCH <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Accept: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--data <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>DATA<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--compressed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">${</span>URL<span style="color:#e6db74">}</span>/config?updateMask<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>MASK<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>That should work!</p>
<p>One important consideration is that you won&rsquo;t be able to perform this using your regular human credentials obtained using <code>gcloud auth print-access-token</code>. This is because the project that backs <code>gcloud</code> does not have the Identity Platform service enabled.</p>
<p>You&rsquo;ll want to:</p>
<ul>
<li>Enable <code>identitytoolkit</code> service</li>
<li>Create a Service Account in Firebase Auth project</li>
<li>Activate the Service Account in <code>gcloud</code></li>
<li>Generate an access token using it</li>
</ul>
<p>Something along the lines of:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Firebase Auth project ID</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Enable the Identity Platform service</span>
</span></span><span style="display:flex;"><span>SERVICE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;identitytoolkit&#34;</span>
</span></span><span style="display:flex;"><span>gcloud services enable <span style="color:#e6db74">${</span>SERVICE<span style="color:#e6db74">}</span>.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ACCOUNT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your preference</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>EMAIL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span><span style="color:#e6db74">@</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">.iam.gserviceaccount.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account in Firebase Auth project</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts create <span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Grant it sufficient permissions</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Unclear whether firebaseauth.admin is correct</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://cloud.google.com/identity-platform/docs/access-control</span>
</span></span><span style="display:flex;"><span>gcloud projects add-iam-policy-binding <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--member<span style="color:#f92672">=</span>serviceAccount:<span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--role<span style="color:#f92672">=</span>roles/firebaseauth.admin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create a key</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts keys create <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--iam-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Retain current active account</span>
</span></span><span style="display:flex;"><span>DEFAULT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>gcloud config get-value account<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Activate Service Account</span>
</span></span><span style="display:flex;"><span>gcloud auth activate-service-account <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--key-file<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Revert to previously active account</span>
</span></span><span style="display:flex;"><span>gcloud config set account <span style="color:#e6db74">${</span>DEFAULT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate access token using the Service Account</span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>gcloud auth print-access-token <span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span><span style="color:#66d9ef">)</span>
</span></span></code></pre></div><p>When you&rsquo;re done, you may want to revoke the credentials of the Service Account and delete it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud auth revoke <span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts delete <span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><h2 id="sdks-or-not">SDKs&hellip; or not</h2>
<p>I&rsquo;m familiar with Google&rsquo;s myriad language SDKs but I had problems with Identity Toolkit|Platform v2|v3.</p>
<p>I&rsquo;m confident there aren&rsquo;t Cloud Client Libraries for it for Golang or Python.</p>
<p>There should (!) be API Client Libraries because these are machine|auto-generated.</p>
<p>However, starting with <a href="https://developers.google.com/apis-explorer">APIs Explorer</a>, <a href="https://developers.google.com/identity/toolkit/web/reference/">Identity Toolkit API</a> redirects instead of listing the APIs methods.</p>
<p>The <a href="https://cloud.google.com/identity-platform/docs/reference/rest/v2/projects/getConfig">getConfig</a> and <a href="https://cloud.google.com/identity-platform/docs/reference/rest/v2/projects/updateConfig">updateConfig</a> that I referenced previously are anchored around this page:</p>
<p><a href="https://cloud.google.com/identity-platform/docs/reference/rest">https://cloud.google.com/identity-platform/docs/reference/rest</a></p>
<p>Which is called &ldquo;Identity Platform&rdquo; not &ldquo;Identity Toolkit&rdquo;.</p>
<p>OK&hellip;</p>
<p>There are 2 discovery documents associated with the api: <a href="https://identitytoolkit.googleapis.com/$discovery/rest?version=v1">v1</a> and <a href="https://identitytoolkit.googleapis.com/$discovery/rest?version=v2">v2</a>. We may return to those.</p>
<h3 id="golang">Golang</h3>
<p>The only API I was able to find for the Golang API Client Library is v3 (!)</p>
<p><a href="https://pkg.go.dev/google.golang.org/api@v0.59.0/identitytoolkit/v3">https://pkg.go.dev/google.golang.org/api@v0.59.0/identitytoolkit/v3</a></p>
<p>This was last updated to v0.59.0 on 22-October-2021. So it&rsquo;s current.</p>
<p>A type called <a href="https://pkg.go.dev/google.golang.org/api@v0.59.0/identitytoolkit/v3#RelyingpartyService">RelyingpartyService</a> includes methods:</p>
<ul>
<li><a href="https://pkg.go.dev/google.golang.org/api@v0.59.0/identitytoolkit/v3#RelyingpartyService.GetProjectConfig">GetProjectConfig</a></li>
<li><a href="https://pkg.go.dev/google.golang.org/api@v0.59.0/identitytoolkit/v3#RelyingpartyService.SetProjectConfig">SetProjectConfig</a></li>
</ul>
<p>Which certainly appear to match <code>getConfig</code> and <code>updateConfig</code> and indeed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/api/identitytoolkit/v3&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/api/option&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Client</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">svc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">identitytoolkit</span>.<span style="color:#a6e22e">Service</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewClient</span>() (<span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">opts</span> <span style="color:#f92672">:=</span> []<span style="color:#a6e22e">option</span>.<span style="color:#a6e22e">ClientOption</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">option</span>.<span style="color:#a6e22e">WithScopes</span>(<span style="color:#e6db74">&#34;https://www.googleapis.com/auth/cloud-platform&#34;</span>),
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">svc</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">identitytoolkit</span>.<span style="color:#a6e22e">NewService</span>(
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ctx</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">opts</span><span style="color:#f92672">...</span>,
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Client</span>{}, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Client</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">svc</span>: <span style="color:#a6e22e">svc</span>,
</span></span><span style="display:flex;"><span>	}, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>) <span style="color:#a6e22e">GetDomains</span>() ([]<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">resp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">svc</span>.<span style="color:#a6e22e">Relyingparty</span>.<span style="color:#a6e22e">GetProjectConfig</span>().<span style="color:#a6e22e">Fields</span>(<span style="color:#e6db74">&#34;authorizedDomains&#34;</span>).<span style="color:#a6e22e">Do</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">AuthorizedDomains</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">client</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewClient</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">authorizedDomains</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">GetDomains</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">authorizedDomains</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As expected logs something of the form:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>2021/10/26 13:22:10 [
</span></span><span style="display:flex;"><span>    localhost
</span></span><span style="display:flex;"><span>    ${PROJECT}.firebaseapp.com
</span></span><span style="display:flex;"><span>    ${PROJECT}.web.app
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> <code>*.firebaseapp.com</code> and <code>*.web.app</code> are default authorized domains.</p></blockquote>
<p>But, I&rsquo;m unable to get <code>SetProjectConfig</code> to work:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/api/identitytoolkit/v3&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/api/option&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Client</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">svc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">identitytoolkit</span>.<span style="color:#a6e22e">Service</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewClient</span>() (<span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">opts</span> <span style="color:#f92672">:=</span> []<span style="color:#a6e22e">option</span>.<span style="color:#a6e22e">ClientOption</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">option</span>.<span style="color:#a6e22e">WithScopes</span>(<span style="color:#e6db74">&#34;https://www.googleapis.com/auth/cloud-platform&#34;</span>),
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">svc</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">identitytoolkit</span>.<span style="color:#a6e22e">NewService</span>(
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ctx</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">opts</span><span style="color:#f92672">...</span>,
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Client</span>{}, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Client</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">svc</span>: <span style="color:#a6e22e">svc</span>,
</span></span><span style="display:flex;"><span>	}, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>) <span style="color:#a6e22e">GetDomains</span>() ([]<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">resp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">svc</span>.<span style="color:#a6e22e">Relyingparty</span>.<span style="color:#a6e22e">GetProjectConfig</span>().<span style="color:#a6e22e">Fields</span>(<span style="color:#e6db74">&#34;authorizedDomains&#34;</span>).<span style="color:#a6e22e">Do</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">AuthorizedDomains</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>) <span style="color:#a6e22e">AddDomain</span>(<span style="color:#a6e22e">domain</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">domains</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">GetDomains</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">domains</span> = append(<span style="color:#a6e22e">domains</span>, <span style="color:#a6e22e">domain</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">SetDomains</span>(<span style="color:#a6e22e">domains</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>) <span style="color:#a6e22e">SetDomains</span>(<span style="color:#a6e22e">domains</span> []<span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rqst</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">identitytoolkit</span>.<span style="color:#a6e22e">IdentitytoolkitRelyingpartySetProjectConfigRequest</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rqst</span>.<span style="color:#a6e22e">AuthorizedDomains</span> = <span style="color:#a6e22e">domains</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">svc</span>.<span style="color:#a6e22e">Relyingparty</span>.<span style="color:#a6e22e">SetProjectConfig</span>(<span style="color:#a6e22e">rqst</span>).<span style="color:#a6e22e">Fields</span>(<span style="color:#e6db74">&#34;authorizedDomains&#34;</span>).<span style="color:#a6e22e">Do</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">client</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewClient</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">authorizedDomains</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">GetDomains</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">authorizedDomains</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">AddDomain</span>(<span style="color:#e6db74">&#34;xxx.com&#34;</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Instead I receive:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>The requested URL &lt;code&gt;/identitytoolkit/v3/relyingparty/setProjectConfig?alt=json&amp;amp;fields=authorizedDomains&amp;amp;prettyPrint=false&lt;/code&gt; was not found on this server.
</span></span></code></pre></div><h3 id="python">Python</h3>
<p>It appears &ndash; though I&rsquo;ve yet not tried this &ndash; that Python&rsquo;s SDK is the same:</p>
<p>The documentation is:</p>
<p><a href="https://googleapis.github.io/google-api-python-client/docs/dyn/identitytoolkit_v3.html">https://googleapis.github.io/google-api-python-client/docs/dyn/identitytoolkit_v3.html</a></p>
<p>And:</p>
<ul>
<li><a href="https://googleapis.github.io/google-api-python-client/docs/dyn/identitytoolkit_v3.relyingparty.html#getProjectConfig">getProjectConfig</a></li>
<li><a href="https://googleapis.github.io/google-api-python-client/docs/dyn/identitytoolkit_v3.relyingparty.html#setProjectConfig">setProjectConfig</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#f92672">from</span> googleapiclient.discovery <span style="color:#f92672">import</span> build
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> googleapiclient.errors <span style="color:#f92672">import</span> HttpError
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> google.auth
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SCOPES <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;https://www.googleapis.com/auth/cloud-platform&#39;</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Client</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self,creds):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>svc <span style="color:#f92672">=</span> build(<span style="color:#e6db74">&#34;identitytoolkit&#34;</span>,<span style="color:#e6db74">&#34;v3&#34;</span>,credentials<span style="color:#f92672">=</span>creds)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_domains</span>(self):
</span></span><span style="display:flex;"><span>        rqst <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>svc<span style="color:#f92672">.</span>relyingparty()<span style="color:#f92672">.</span>getProjectConfig()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            resp <span style="color:#f92672">=</span> rqst<span style="color:#f92672">.</span>execute()
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> resp[<span style="color:#e6db74">&#34;authorizedDomains&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> HttpError <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;[</span><span style="color:#e6db74">{code}</span><span style="color:#e6db74">] </span><span style="color:#e6db74">{message}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(code<span style="color:#f92672">=</span>e<span style="color:#f92672">.</span>resp<span style="color:#f92672">.</span>status,message<span style="color:#f92672">=</span>e<span style="color:#f92672">.</span>resp<span style="color:#f92672">.</span>reason))
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_domain</span>(self,domain):
</span></span><span style="display:flex;"><span>        domains<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>get_domains()
</span></span><span style="display:flex;"><span>        domains<span style="color:#f92672">.</span>append(domain)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>set_domains(domains)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> HttpError <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;[</span><span style="color:#e6db74">{code}</span><span style="color:#e6db74">] </span><span style="color:#e6db74">{message}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(code<span style="color:#f92672">=</span>e<span style="color:#f92672">.</span>resp<span style="color:#f92672">.</span>status,message<span style="color:#f92672">=</span>e<span style="color:#f92672">.</span>resp<span style="color:#f92672">.</span>reason))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_domains</span>(self,domains):
</span></span><span style="display:flex;"><span>        rqst <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>svc<span style="color:#f92672">.</span>relyingparty()<span style="color:#f92672">.</span>setProjectConfig()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            resp<span style="color:#f92672">=</span>rqst<span style="color:#f92672">.</span>execute()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> HttpError <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;[</span><span style="color:#e6db74">{code}</span><span style="color:#e6db74">] </span><span style="color:#e6db74">{message}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(code<span style="color:#f92672">=</span>e<span style="color:#f92672">.</span>resp<span style="color:#f92672">.</span>status,message<span style="color:#f92672">=</span>e<span style="color:#f92672">.</span>resp<span style="color:#f92672">.</span>reason))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    creds, project_id <span style="color:#f92672">=</span> google<span style="color:#f92672">.</span>auth<span style="color:#f92672">.</span>default(scopes<span style="color:#f92672">=</span>SCOPES)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    client <span style="color:#f92672">=</span> Client(creds)
</span></span><span style="display:flex;"><span>    domains<span style="color:#f92672">=</span>client<span style="color:#f92672">.</span>get_domains()
</span></span><span style="display:flex;"><span>    print(domains)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    client<span style="color:#f92672">.</span>add_domain(<span style="color:#e6db74">&#34;baz&#34;</span>)
</span></span><span style="display:flex;"><span>    domains<span style="color:#f92672">=</span>client<span style="color:#f92672">.</span>get_domains()
</span></span><span style="display:flex;"><span>    print(domains)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><p>It&rsquo;s noteworthy that Python&rsquo;s error includes the URL:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>&lt;HttpError 404 when requesting https://www.googleapis.com/identitytoolkit/v3/relyingparty/setProjectConfig?alt=json returned &#34;Not Found&#34;
</span></span></code></pre></div><h3 id="discovery">Discovery</h3>
<p>The Discovery <a href="https://identitytoolkit.googleapis.com/$discovery/rest?version=v2">document</a> for &ldquo;v2&rdquo; includes <code>getConfig</code> and <code>updateConfig</code> but I&rsquo;ve been unable to generate a client from the document for this version to try it out.</p>
<ul class="pa0">
  
   <li class="list di">
     <a href="/tags/firebase-auth/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Firebase-Auth</a>
   </li>
  
   <li class="list di">
     <a href="/tags/cloud-run/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Cloud-Run</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/posts/211005/">Scraping metrics exposed by Google Cloud Run services that require authentication</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/210907/">`gcloud beta run services replace`</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/210608/">Cloud Endpoints combine OpenAPI and gRPC... or not!</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/210520/">Consul discovers Google Cloud Run</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/210519/">Multiplexing gRPC and HTTP (Prometheus) endpoints with Cloud Run</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/210419/">Prometheus Service Discovery w/ Consul for Cloud Run</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/210316/">Programmatically deploying Cloud Run services (Golang|Python)</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-dark-blue bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://pretired.dazwilkin.com/" >
    &copy;  (p)retired 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>