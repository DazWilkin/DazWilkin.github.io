<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>gRPC Firestore `Listen` | (p)retired</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="A question on Stack overflow Firestore gRPC Listen does not send deletions piqued by interest but created a second problem for me: I&rsquo;m unable to get its Listen method to work using gRPCurl.
For what follows, you will need:

a Google Project with Firestore enabled and a database (default: (default)) containing a Collection (e.g. Dogs) with at least one Document (e.g. freddie)
googleapis cloned locally in order to access Protobufs

Summary

  
      
          client
          server
          R
          See
      
  
  
      
          gRPCurl
          firestore.googleapis.com:443
          ✅
          link
      
      
          Go client
          firestore.googleapis.com:443
          ✅
          link
      
      
          gRPCurl
          Go server
          ✅
          link
      
      
          Go client
          Go server
          ✅
          link
      
  

I subsequently tried this using Postman and it also works (✅).">
    <meta name="generator" content="Hugo 0.153.0-DEV">
    
    
    
    
      <meta name="robots" content="index, follow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.cf4aecb341f2e16e80e407465df095cee730d71e19c4574f8e9b28d163dc4225.css" >



  


    

    
    
      

    

    

    <script data-goatcounter="https://pretired.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
 
    <meta property="og:url" content="https://pretired.dazwilkin.com/posts/250210/">
  <meta property="og:site_name" content="(p)retired">
  <meta property="og:title" content="gRPC Firestore `Listen`">
  <meta property="og:description" content="A question on Stack overflow Firestore gRPC Listen does not send deletions piqued by interest but created a second problem for me: I’m unable to get its Listen method to work using gRPCurl.
For what follows, you will need:
a Google Project with Firestore enabled and a database (default: (default)) containing a Collection (e.g. Dogs) with at least one Document (e.g. freddie) googleapis cloned locally in order to access Protobufs Summary client server R See gRPCurl firestore.googleapis.com:443 ✅ link Go client firestore.googleapis.com:443 ✅ link gRPCurl Go server ✅ link Go client Go server ✅ link I subsequently tried this using Postman and it also works (✅).">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-02-10T00:00:00-08:00">
    <meta property="article:modified_time" content="2025-02-10T00:00:00-08:00">
    <meta property="article:tag" content="Google">
    <meta property="article:tag" content="Firesotore">
    <meta property="article:tag" content="GRPC">

  <meta itemprop="name" content="gRPC Firestore `Listen`">
  <meta itemprop="description" content="A question on Stack overflow Firestore gRPC Listen does not send deletions piqued by interest but created a second problem for me: I’m unable to get its Listen method to work using gRPCurl.
For what follows, you will need:
a Google Project with Firestore enabled and a database (default: (default)) containing a Collection (e.g. Dogs) with at least one Document (e.g. freddie) googleapis cloned locally in order to access Protobufs Summary client server R See gRPCurl firestore.googleapis.com:443 ✅ link Go client firestore.googleapis.com:443 ✅ link gRPCurl Go server ✅ link Go client Go server ✅ link I subsequently tried this using Postman and it also works (✅).">
  <meta itemprop="datePublished" content="2025-02-10T00:00:00-08:00">
  <meta itemprop="dateModified" content="2025-02-10T00:00:00-08:00">
  <meta itemprop="wordCount" content="1443">
  <meta itemprop="keywords" content="Google,Firesotore,GRPC">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="gRPC Firestore `Listen`">
  <meta name="twitter:description" content="A question on Stack overflow Firestore gRPC Listen does not send deletions piqued by interest but created a second problem for me: I’m unable to get its Listen method to work using gRPCurl.
For what follows, you will need:
a Google Project with Firestore enabled and a database (default: (default)) containing a Collection (e.g. Dogs) with at least one Document (e.g. freddie) googleapis cloned locally in order to access Protobufs Summary client server R See gRPCurl firestore.googleapis.com:443 ✅ link Go client firestore.googleapis.com:443 ✅ link gRPCurl Go server ✅ link Go client Go server ✅ link I subsequently tried this using Postman and it also works (✅).">

      
    
	
  </head>

  <body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-dark-blue">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        (p)retired
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l mw8 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">gRPC Firestore `Listen`</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2025-02-10T00:00:00-08:00">February 10, 2025</time>
      

      
      
        <span class="f6 mv4 dib tracked"> - 7 minutes read </span>
        <span class="f6 mv4 dib tracked"> - 1443 words </span>
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>A question on Stack overflow <a href="https://stackoverflow.com/questions/79422094">Firestore gRPC Listen does not send deletions</a> piqued by interest but created a second problem for me: I&rsquo;m unable to get its <a href="https://cloud.google.com/firestore/docs/reference/rpc/google.firestore.v1#google.firestore.v1.Firestore.Listen"><code>Listen</code></a> method to work using <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a>.</p>
<p>For what follows, you will need:</p>
<ol>
<li>a Google Project with Firestore enabled and a database (default: <code>(default)</code>) containing a Collection (e.g. <code>Dogs</code>) with at least one Document (e.g. <code>freddie</code>)</li>
<li><a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a> cloned locally in order to access Protobufs</li>
</ol>
<h2 id="summary">Summary</h2>
<table>
  <thead>
      <tr>
          <th>client</th>
          <th>server</th>
          <th>R</th>
          <th>See</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>gRPCurl</code></td>
          <td><code>firestore.googleapis.com:443</code></td>
          <td>✅</td>
          <td><a href="#grpcurl-listen-against-google-endpoint">link</a></td>
      </tr>
      <tr>
          <td>Go client</td>
          <td><code>firestore.googleapis.com:443</code></td>
          <td>✅</td>
          <td><a href="#go-client-listen-against-google-endpoint">link</a></td>
      </tr>
      <tr>
          <td><code>gRPCurl</code></td>
          <td>Go server</td>
          <td>✅</td>
          <td><a href="#grpcurl-listen-against-go-server">link</a></td>
      </tr>
      <tr>
          <td>Go client</td>
          <td>Go server</td>
          <td>✅</td>
          <td><a href="#go-client-listen-against-go-server">link</a></td>
      </tr>
  </tbody>
</table>
<p>I subsequently tried this using <a href="https://www.postman.com/">Postman</a> and it also works (✅).</p>
<h2 id="grpcurl-listen-against-google-endpoint">gRPCurl <code>Listen</code> against Google endpoint</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GOOGLEAPIS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/googleapis&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PACKAGE_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;google/firestore/v1&#34;</span>
</span></span><span style="display:flex;"><span>PACKAGE_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;google.firestore.v1&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SERVICE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Firestore&#34;</span>
</span></span><span style="display:flex;"><span>METHOD<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Listen&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DATABASE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;projects/</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">/databases/(default)&#34;</span>
</span></span><span style="display:flex;"><span>PARENT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>DATABASE<span style="color:#e6db74">}</span><span style="color:#e6db74">/documents&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>COLLECTION_ID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Dogs&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>gcloud auth print-access-token<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;firestore.googleapis.com:443&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DATA<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  \&#34;database\&#34;:\&#34;</span><span style="color:#e6db74">${</span>DATABASE<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  \&#34;add_target\&#34;:{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    \&#34;query\&#34;:{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      \&#34;parent\&#34;:\&#34;</span><span style="color:#e6db74">${</span>PARENT<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      \&#34;structured_query\&#34;:{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;from\&#34;:[
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">           {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             \&#34;collection_id\&#34;:\&#34;</span><span style="color:#e6db74">${</span>COLLECTION_ID<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">           }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Expects JSON request data (stream) on stdin</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Unable to get this to work with a heredoc</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Using copy-paste instead</span>
</span></span><span style="display:flex;"><span>grpcurl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>-H <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>-H <span style="color:#e6db74">&#34;google-cloud-resource-prefix: </span><span style="color:#e6db74">${</span>DATABASE<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>--import-path <span style="color:#e6db74">${</span>GOOGLEAPIS<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>--proto <span style="color:#e6db74">${</span>GOOGLEAPIS<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PACKAGE_PATH<span style="color:#e6db74">}</span>/firestore.proto <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>-d @ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">${</span>PACKAGE_NAME<span style="color:#e6db74">}</span>.<span style="color:#e6db74">${</span>SERVICE<span style="color:#e6db74">}</span>.<span style="color:#e6db74">${</span>METHOD<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>And then pasting the value of <code>${DATA}</code> into stdin yields:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;documentChange&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;document&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;projects/{project}/databases/(default)/documents/Dogs/bo&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;fields&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Camp&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;booleanValue&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Name`&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;stringValue&#34;</span>: <span style="color:#e6db74">&#34;Bo&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;createTime&#34;</span>: <span style="color:#e6db74">&#34;2025-02-10T19:35:51.131456Z&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;updateTime&#34;</span>: <span style="color:#e6db74">&#34;2025-02-10T19:41:42.082855Z&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;targetIds&#34;</span>: [
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;documentChange&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;document&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;projects/{project}/databases/(default)/documents/Dogs/freddie&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;fields&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Age&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;integerValue&#34;</span>: <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Camp&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;booleanValue&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Name&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;stringValue&#34;</span>: <span style="color:#e6db74">&#34;Frederik Jack&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;createTime&#34;</span>: <span style="color:#e6db74">&#34;2025-02-08T00:38:50.523731Z&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;updateTime&#34;</span>: <span style="color:#e6db74">&#34;2025-02-10T22:08:42.706849Z&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;targetIds&#34;</span>: [
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>For what follows, <code>${DATA}</code> is (<code>{PROJECT}</code> redacts Project ID):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;database&#34;</span>: <span style="color:#e6db74">&#34;projects/{project}/databases/(default)&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;add_target&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parent&#34;</span>: <span style="color:#e6db74">&#34;projects/{project}/databases/(default)/documents&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;structured_query&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;from&#34;</span>: [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;collection_id&#34;</span>: <span style="color:#e6db74">&#34;Dogs&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="go-client-listen-against-google-endpoint">Go client <code>Listen</code> against Google endpoint</h2>
<p>I wrote a Golang client using Google&rsquo;s published Firestore subs (<a href="https://pkg.go.dev/cloud.google.com/go/firestore@v1.18.0/apiv1/firestorepb"><code>firestorepb</code></a> v1.18.0).</p>
<p><code>go.mod</code>:</p>
<pre tabindex="0"><code>module ...

go 1.23.4

require (
	cloud.google.com/go/firestore v1.18.0
	google.golang.org/api v0.214.0
	google.golang.org/grpc v1.67.3
)
</code></pre><p><code>main.go</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;flag&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;io&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;sync&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;cloud.google.com/go/firestore/apiv1/firestorepb&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;golang.org/x/oauth2/google&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/grpc&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/grpc/credentials&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/grpc/credentials/oauth&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/grpc/metadata&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/protobuf/encoding/protojson&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">endpoint</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;endpoint&#34;</span>, <span style="color:#e6db74">&#34;firestore.googleapis.com:443&#34;</span>, <span style="color:#e6db74">&#34;gRPC service endpoint (host:port)&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Parse</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">project</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;PROJECT&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">project</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#e6db74">&#34;Unable to get PROJECT from the environment&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">cancel</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">WithCancel</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">cancel</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">scopes</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;https://www.googleapis.com/auth/cloud-platform&#34;</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">creds</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">FindDefaultCredentials</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">scopes</span><span style="color:#f92672">...</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;error obtaining credentials: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Debugging</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// tok, err := creds.TokenSource.Token()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// if err != nil {</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 	panic(err)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// }</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// log.Println(tok.AccessToken)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">opts</span> <span style="color:#f92672">:=</span> []<span style="color:#a6e22e">grpc</span>.<span style="color:#a6e22e">DialOption</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">grpc</span>.<span style="color:#a6e22e">WithTransportCredentials</span>(<span style="color:#a6e22e">credentials</span>.<span style="color:#a6e22e">NewClientTLSFromCert</span>(<span style="color:#66d9ef">nil</span>, <span style="color:#e6db74">&#34;&#34;</span>)),
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">grpc</span>.<span style="color:#a6e22e">WithPerRPCCredentials</span>(<span style="color:#a6e22e">oauth</span>.<span style="color:#a6e22e">TokenSource</span>{<span style="color:#a6e22e">TokenSource</span>: <span style="color:#a6e22e">creds</span>.<span style="color:#a6e22e">TokenSource</span>}),
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">grpc</span>.<span style="color:#a6e22e">NewClient</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">endpoint</span>, <span style="color:#a6e22e">opts</span><span style="color:#f92672">...</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;error creating client: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">client</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">NewFirestoreClient</span>(<span style="color:#a6e22e">conn</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">database</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;projects/%s/databases/(default)&#34;</span>, <span style="color:#a6e22e">project</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">parent</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%s/documents&#34;</span>, <span style="color:#a6e22e">database</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Metadata required by the service</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// If not present, the command errors requesting this value be set</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">md</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">metadata</span>.<span style="color:#a6e22e">New</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">string</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;google-cloud-resource-prefix&#34;</span>: <span style="color:#a6e22e">database</span>,
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ctx</span> = <span style="color:#a6e22e">metadata</span>.<span style="color:#a6e22e">NewOutgoingContext</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">md</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">listener</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Listen</span>(<span style="color:#a6e22e">ctx</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;error creating listener: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">listener</span>.<span style="color:#a6e22e">CloseSend</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rqst</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">ListenRequest</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Database</span>: <span style="color:#a6e22e">database</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">TargetChange</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">ListenRequest_AddTarget</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">AddTarget</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">Target</span>{
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">TargetType</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">Target_Query</span>{
</span></span><span style="display:flex;"><span>					<span style="color:#a6e22e">Query</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">Target_QueryTarget</span>{
</span></span><span style="display:flex;"><span>						<span style="color:#a6e22e">Parent</span>: <span style="color:#a6e22e">parent</span>,
</span></span><span style="display:flex;"><span>						<span style="color:#a6e22e">QueryType</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">Target_QueryTarget_StructuredQuery</span>{
</span></span><span style="display:flex;"><span>							<span style="color:#a6e22e">StructuredQuery</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">StructuredQuery</span>{
</span></span><span style="display:flex;"><span>								<span style="color:#a6e22e">From</span>: []<span style="color:#f92672">*</span><span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">StructuredQuery_CollectionSelector</span>{
</span></span><span style="display:flex;"><span>									{
</span></span><span style="display:flex;"><span>										<span style="color:#a6e22e">CollectionId</span>: <span style="color:#e6db74">&#34;Dogs&#34;</span>,
</span></span><span style="display:flex;"><span>									},
</span></span><span style="display:flex;"><span>								},
</span></span><span style="display:flex;"><span>							},
</span></span><span style="display:flex;"><span>						},
</span></span><span style="display:flex;"><span>					},
</span></span><span style="display:flex;"><span>				},
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Validate that the gRPCurl &#39;DATA&#39; variable matches</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">protojson</span>.<span style="color:#a6e22e">MarshalOptions</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">UseProtoNames</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>	}.<span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">rqst</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(string(<span style="color:#a6e22e">b</span>))
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Send the request</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">listener</span>.<span style="color:#a6e22e">Send</span>(<span style="color:#a6e22e">rqst</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;error sending request: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Listen for responses</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">wg</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">resp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">listener</span>.<span style="color:#a6e22e">Recv</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">EOF</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Stream closed by server&#34;</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;error receiving response: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">resp</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Wait</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Yields:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>2025/02/10 14:31:25 {&#34;database&#34;:&#34;projects/{project}/databases/(default)&#34;,&#34;add_target&#34;:{&#34;query&#34;:{&#34;parent&#34;:&#34;projects/{project}/databases/(default)/documents&#34;,&#34;structured_query&#34;:{&#34;from&#34;:[{&#34;collection_id&#34;:&#34;Dogs&#34;}]}}}}
</span></span><span style="display:flex;"><span>2025/02/10 14:31:26 target_change:{target_change_type:ADD target_ids:1}
</span></span><span style="display:flex;"><span>2025/02/10 14:31:26 document_change:{document:{name:&#34;projects/{project}/databases/(default)/documents/Dogs/bo&#34; fields:{key:&#34;Camp&#34; value:{boolean_value:true}} fields:{key:&#34;Name`&#34; value:{string_value:&#34;Bo&#34;}} create_time:{seconds:1739216151 nanos:131456000} update_time:{seconds:1739216502 nanos:82855000}} target_ids:1}
</span></span><span style="display:flex;"><span>2025/02/10 14:31:26 document_change:{document:{name:&#34;projects/{project}/databases/(default)/documents/Dogs/freddie&#34; fields:{key:&#34;Age&#34; value:{integer_value:6}} fields:{key:&#34;Camp&#34; value:{boolean_value:true}} fields:{key:&#34;Name&#34; value:{string_value:&#34;Frederik Jack&#34;}} fields:{key:&#34;Nickname&#34; value:{string_value:&#34;Boober&#34;}} create_time:{seconds:1738975130 nanos:523731000} update_time:{seconds:1739225322 nanos:706849000}} target_ids:1}
</span></span><span style="display:flex;"><span>2025/02/10 14:31:26 document_change:{document:{name:&#34;projects/{project}/databases/(default)/documents/Dogs/kaido&#34; fields:{key:&#34;Age&#34; value:{integer_value:8}} fields:{key:&#34;Name&#34; value:{string_value:&#34;Kaido&#34;}} create_time:{seconds:1738984268 nanos:543266000} update_time:{seconds:1738984268 nanos:543266000}} target_ids:1}
</span></span><span style="display:flex;"><span>2025/02/10 14:31:26 document_change:{document:{name:&#34;projects/{project}/databases/(default)/documents/Dogs/louie&#34; fields:{key:&#34;Age&#34; value:{integer_value:6}} fields:{key:&#34;Camp&#34; value:{boolean_value:false}} fields:{key:&#34;Name&#34; value:{string_value:&#34;Louie&#34;}} create_time:{seconds:1738984352 nanos:3340000} update_time:{seconds:1739037801 nanos:467026000}} target_ids:1}
</span></span><span style="display:flex;"><span>2025/02/10 14:31:26 document_change:{document:{name:&#34;projects/{project}/databases/(default)/documents/Dogs/rocky&#34; fields:{key:&#34;Camp&#34; value:{boolean_value:true}} fields:{key:&#34;Name&#34; value:{string_value:&#34;Rocky&#34;}} create_time:{seconds:1739216409 nanos:763704000} update_time:{seconds:1739216409 nanos:763704000}} target_ids:1}
</span></span><span style="display:flex;"><span>2025/02/10 14:31:26 target_change:{target_change_type:CURRENT target_ids:1 resume_token:&#34;\n\t\x08\xe8ι\xa6\x94\xba\x8b\x03&#34; read_time:{seconds:1739226686 nanos:56296000}}
</span></span><span style="display:flex;"><span>2025/02/10 14:31:26 target_change:{resume_token:&#34;\n\t\x08\xe8ι\xa6\x94\xba\x8b\x03&#34; read_time:{seconds:1739226686 nanos:56296000}}
</span></span><span style="display:flex;"><span>2025/02/10 14:31:26 filter:{target_id:1 count:5 unchanged_names:{bits:{bitmap:&#34;\\\xf7\xa57$i\xe33#\xdau\x00\x19&#34; padding:3} hash_count:14}}
</span></span><span style="display:flex;"><span>2025/02/10 14:31:26 target_change:{resume_token:&#34;\n\t\x08\xe4⽦\x94\xba\x8b\x03&#34; read_time:{seconds:1739226686 nanos:124388000}}
</span></span></code></pre></div><p>I confirmed that the JSON produced by <code>protojson.Marshal</code> of <code>rqst</code> matches that used in the gPRPCurl above.</p>
<p>I generated an access token from the code and used this in the gRPCurl example.</p>
<h2 id="grpcurl-listen-against-go-server">gRPCurl <code>Listen</code> against Go server</h2>
<p>I implemented the <code>Listen</code> method in a Go server:</p>
<p><code>main.go</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;cloud.google.com/go/firestore/apiv1/firestorepb&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/grpc&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">lis</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Listen</span>(<span style="color:#e6db74">&#34;tcp&#34;</span>, <span style="color:#e6db74">&#34;:50051&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;[main] failed to listen: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">grpc</span>.<span style="color:#a6e22e">NewServer</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">RegisterFirestoreServer</span>(<span style="color:#a6e22e">s</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Server</span>{})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;[main] server listening: %v&#34;</span>, <span style="color:#a6e22e">lis</span>.<span style="color:#a6e22e">Addr</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Serve</span>(<span style="color:#a6e22e">lis</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;failed to serve: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>server.go</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;sync&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;cloud.google.com/go/firestore/apiv1/firestorepb&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/grpc/metadata&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/protobuf/encoding/protojson&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/protobuf/types/known/timestamppb&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Server only implements `Listen` method in the interface</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// var _ firestorepb.FirestoreServer = Server{}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Server</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">UnimplementedFirestoreServer</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Listen implements firestorepb.FirestoreServer</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#a6e22e">Server</span>) <span style="color:#a6e22e">Listen</span>(<span style="color:#a6e22e">stream</span> <span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">Firestore_ListenServer</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;[Listen] entered&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">md</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">metadata</span>.<span style="color:#a6e22e">FromIncomingContext</span>(<span style="color:#a6e22e">stream</span>.<span style="color:#a6e22e">Context</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">ok</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;[Listen] metadata not found&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">md</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;[Listen] Key: %s, Values: %v\n&#34;</span>, <span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">v</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Recv method</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rqst</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">stream</span>.<span style="color:#a6e22e">Recv</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;[Listen] Recv error: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Confirm that this matches that gRPCurl produces</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">protojson</span>.<span style="color:#a6e22e">MarshalOptions</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">UseProtoNames</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>	}.<span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">rqst</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;[Listen] rqst: %s&#34;</span>, <span style="color:#a6e22e">b</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Send method</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">wg</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">targetIDs</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int32</span>{<span style="color:#ae81ff">0</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">now</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">ts</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">timestamppb</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">now</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">name</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;d-%d&#34;</span>, <span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">Unix</span>())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">resp</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">ListenResponse</span>{
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">ResponseType</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">ListenResponse_DocumentChange</span>{
</span></span><span style="display:flex;"><span>					<span style="color:#a6e22e">DocumentChange</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">DocumentChange</span>{
</span></span><span style="display:flex;"><span>						<span style="color:#a6e22e">Document</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">firestorepb</span>.<span style="color:#a6e22e">Document</span>{
</span></span><span style="display:flex;"><span>							<span style="color:#a6e22e">Name</span>:       <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>							<span style="color:#a6e22e">CreateTime</span>: <span style="color:#a6e22e">ts</span>,
</span></span><span style="display:flex;"><span>							<span style="color:#a6e22e">UpdateTime</span>: <span style="color:#a6e22e">ts</span>,
</span></span><span style="display:flex;"><span>						},
</span></span><span style="display:flex;"><span>						<span style="color:#a6e22e">TargetIds</span>: <span style="color:#a6e22e">targetIDs</span>,
</span></span><span style="display:flex;"><span>					},
</span></span><span style="display:flex;"><span>				},
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">stream</span>.<span style="color:#a6e22e">Send</span>(<span style="color:#a6e22e">resp</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;[Listen] Send error: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Wait</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><a href="https://tailscale.com">Tailscale</a> is excellent and it provides a mechanism to expose a local TCP endpoint via TLS.</p>
<p>If you don&rsquo;t use Tailscale, you&rsquo;ll want to find a solution to this.</p>
<p>Running the above server on <code>localhost:50051</code> and then:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tailscale funnel --https<span style="color:#f92672">=</span><span style="color:#ae81ff">443</span> localhost:50051
</span></span></code></pre></div><p>I can now gRPCurl after changing <code>ENDPOINT={host}.{tailnet}:443</code></p>
<p>Not entirely suprisingly, this works:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>Resolved method descriptor:
</span></span><span style="display:flex;"><span>// Listens to changes. This method is only available via gRPC or WebChannel
</span></span><span style="display:flex;"><span>// (not REST).
</span></span><span style="display:flex;"><span>rpc Listen ( stream .google.firestore.v1.ListenRequest ) returns ( stream .google.firestore.v1.ListenResponse ) {
</span></span><span style="display:flex;"><span>  option (.google.api.http) = {
</span></span><span style="display:flex;"><span>    post: &#34;/v1/{database=projects/*/databases/*}/documents:listen&#34;,
</span></span><span style="display:flex;"><span>    body: &#34;*&#34;
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span>Request metadata to send:
</span></span><span style="display:flex;"><span>authorization: Bearer [REDACTED]
</span></span><span style="display:flex;"><span>google-cloud-resource-prefix: projects/{project}/databases/(default)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span>Response headers received:
</span></span><span style="display:flex;"><span>content-type: application/grpc
</span></span><span style="display:flex;"><span>date: Mon, 10 Feb 2025 22:43:24 GMT
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span>Estimated response size: 49 bytes
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span>Response contents:
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;documentChange&#34;: {
</span></span><span style="display:flex;"><span>    &#34;document&#34;: {
</span></span><span style="display:flex;"><span>      &#34;name&#34;: &#34;d-1739227404&#34;,
</span></span><span style="display:flex;"><span>      &#34;createTime&#34;: &#34;2025-02-10T22:43:24.755594883Z&#34;,
</span></span><span style="display:flex;"><span>      &#34;updateTime&#34;: &#34;2025-02-10T22:43:24.755594883Z&#34;
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;targetIds&#34;: [
</span></span><span style="display:flex;"><span>      0
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span>Estimated response size: 49 bytes
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span>Response contents:
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;documentChange&#34;: {
</span></span><span style="display:flex;"><span>    &#34;document&#34;: {
</span></span><span style="display:flex;"><span>      &#34;name&#34;: &#34;d-1739227409&#34;,
</span></span><span style="display:flex;"><span>      &#34;createTime&#34;: &#34;2025-02-10T22:43:29.758840604Z&#34;,
</span></span><span style="display:flex;"><span>      &#34;updateTime&#34;: &#34;2025-02-10T22:43:29.758840604Z&#34;
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;targetIds&#34;: [
</span></span><span style="display:flex;"><span>      0
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span>Estimated response size: 49 bytes
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span>Response contents:
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;documentChange&#34;: {
</span></span><span style="display:flex;"><span>    &#34;document&#34;: {
</span></span><span style="display:flex;"><span>      &#34;name&#34;: &#34;d-1739227414&#34;,
</span></span><span style="display:flex;"><span>      &#34;createTime&#34;: &#34;2025-02-10T22:43:34.758936603Z&#34;,
</span></span><span style="display:flex;"><span>      &#34;updateTime&#34;: &#34;2025-02-10T22:43:34.758936603Z&#34;
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;targetIds&#34;: [
</span></span><span style="display:flex;"><span>      0
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And, I get a bunch of metadata from a known-working client:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>[Listen] Key: :authority, Values: [{host}.{tailnet}:443]
</span></span><span style="display:flex;"><span>[Listen] Key: accept-encoding, Values: [gzip]
</span></span><span style="display:flex;"><span>[Listen] Key: authorization, Values: [Bearer {REDACTED}]
</span></span><span style="display:flex;"><span>[Listen] Key: content-type, Values: [application/grpc]
</span></span><span style="display:flex;"><span>[Listen] Key: google-cloud-resource-prefix, Values: [projects/{project}/databases/(default)]
</span></span><span style="display:flex;"><span>[Listen] Key: grpc-accept-encoding, Values: [gzip]
</span></span><span style="display:flex;"><span>[Listen] Key: user-agent, Values: [grpcurl/dev-build (no version set) grpc-go/1.61.0]
</span></span><span style="display:flex;"><span>[Listen] Key: x-forwarded-for, Values: [100.65.15.44]
</span></span><span style="display:flex;"><span>[Listen] Key: x-forwarded-host, Values: [{host}.{tailnet}:443]
</span></span><span style="display:flex;"><span>[Listen] Key: x-forwarded-proto, Values: [https]
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> The metadata includes <code>grpc-access-encoding: gzip</code> which isn&rsquo;t present using the Go client.</p>
</blockquote>
<p>Leaving a final test</p>
<h2 id="go-client-listen-against-go-server">Go client <code>Listen</code> against Go server</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go run ./cmd/client --endpoint<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{host}.{tailnet}:443&#34;</span>
</span></span></code></pre></div><p>Yields:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>2025/02/10 14:33:22 {&#34;database&#34;:&#34;projects/{project}/databases/(default)&#34;,&#34;add_target&#34;:{&#34;query&#34;:{&#34;parent&#34;:&#34;projects/{project}/databases/(default)/documents&#34;,&#34;structured_query&#34;:{&#34;from&#34;:[{&#34;collection_id&#34;:&#34;Dogs&#34;}]}}}}
</span></span><span style="display:flex;"><span>2025/02/10 14:33:22 target_change:{target_change_type:ADD target_ids:1}
</span></span><span style="display:flex;"><span>2025/02/10 14:33:22 document_change:{document:{name:&#34;projects/{project}/databases/(default)/documents/Dogs/bo&#34; fields:{key:&#34;Camp&#34; value:{boolean_value:true}} fields:{key:&#34;Name`&#34; value:{string_value:&#34;Bo&#34;}} create_time:{seconds:1739216151 nanos:131456000} update_time:{seconds:1739216502 nanos:82855000}} target_ids:1}
</span></span><span style="display:flex;"><span>2025/02/10 14:33:22 document_change:{document:{name:&#34;projects/{project}/databases/(default)/documents/Dogs/freddie&#34; fields:{key:&#34;Age&#34; value:{integer_value:6}} fields:{key:&#34;Camp&#34; value:{boolean_value:true}} fields:{key:&#34;Name&#34; value:{string_value:&#34;Frederik Jack&#34;}} fields:{key:&#34;Nickname&#34; value:{string_value:&#34;Boober&#34;}} create_time:{seconds:1738975130 nanos:523731000} update_time:{seconds:1739225322 nanos:706849000}} target_ids:1}
</span></span><span style="display:flex;"><span>2025/02/10 14:33:22 document_change:{document:{name:&#34;projects/{project}/databases/(default)/documents/Dogs/kaido&#34; fields:{key:&#34;Age&#34; value:{integer_value:8}} fields:{key:&#34;Name&#34; value:{string_value:&#34;Kaido&#34;}} create_time:{seconds:1738984268 nanos:543266000} update_time:{seconds:1738984268 nanos:543266000}} target_ids:1}
</span></span><span style="display:flex;"><span>2025/02/10 14:33:22 document_change:{document:{name:&#34;projects/{project}/databases/(default)/documents/Dogs/louie&#34; fields:{key:&#34;Age&#34; value:{integer_value:6}} fields:{key:&#34;Camp&#34; value:{boolean_value:false}} fields:{key:&#34;Name&#34; value:{string_value:&#34;Louie&#34;}} create_time:{seconds:1738984352 nanos:3340000} update_time:{seconds:1739037801 nanos:467026000}} target_ids:1}
</span></span><span style="display:flex;"><span>2025/02/10 14:33:22 document_change:{document:{name:&#34;projects/{project}/databases/(default)/documents/Dogs/rocky&#34; fields:{key:&#34;Camp&#34; value:{boolean_value:true}} fields:{key:&#34;Name&#34; value:{string_value:&#34;Rocky&#34;}} create_time:{seconds:1739216409 nanos:763704000} update_time:{seconds:1739216409 nanos:763704000}} target_ids:1}
</span></span><span style="display:flex;"><span>2025/02/10 14:33:22 target_change:{target_change_type:CURRENT target_ids:1 resume_token:&#34;\n\t\x08\xc3\xe1\xe7ݔ\xba\x8b\x03&#34; read_time:{seconds:1739226802 nanos:155715000}}
</span></span><span style="display:flex;"><span>2025/02/10 14:33:22 target_change:{resume_token:&#34;\n\t\x08\xc3\xe1\xe7ݔ\xba\x8b\x03&#34; read_time:{seconds:1739226802 nanos:155715000}}
</span></span><span style="display:flex;"><span>2025/02/10 14:33:22 filter:{target_id:1 count:5 unchanged_names:{bits:{bitmap:&#34;\\\xf7\xa57$i\xe33#\xdau\x00\x19&#34; padding:3} hash_count:14}}
</span></span><span style="display:flex;"><span>2025/02/10 14:33:22 target_change:{resume_token:&#34;\n\t\x08͢\xeaݔ\xba\x8b\x03&#34; read_time:{seconds:1739226802 nanos:196813000}}
</span></span></code></pre></div><p>And, the metadata:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>[Listen] Key: :authority, Values: [{host}.{tailnet}:443]
</span></span><span style="display:flex;"><span>[Listen] Key: accept-encoding, Values: [gzip]
</span></span><span style="display:flex;"><span>[Listen] Key: authorization, Values: [Bearer {REDACTED}]
</span></span><span style="display:flex;"><span>[Listen] Key: content-type, Values: [application/grpc]
</span></span><span style="display:flex;"><span>[Listen] Key: google-cloud-resource-prefix, Values: [projects/{project}/databases/(default)]
</span></span><span style="display:flex;"><span>[Listen] Key: user-agent, Values: [grpc-go/1.67.3]
</span></span><span style="display:flex;"><span>[Listen] Key: x-forwarded-for, Values: [100.65.15.44]
</span></span><span style="display:flex;"><span>[Listen] Key: x-forwarded-host, Values: [{host}.{tailnet}:443]
</span></span><span style="display:flex;"><span>[Listen] Key: x-forwarded-proto, Values: [https]
</span></span></code></pre></div><ul class="pa0">
  
   <li class="list di">
     <a href="/tags/google/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Google</a>
   </li>
  
   <li class="list di">
     <a href="/tags/firesotore/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Firesotore</a>
   </li>
  
   <li class="list di">
     <a href="/tags/grpc/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">GRPC</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/posts/240409/">Google Cloud Translation w/ gRPC 3 ways</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/200403/">Rust Crate Transparency &amp;&amp; Rust SDK for Google Trillian</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/200326/">Google Trillian on Cloud Run</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/200325/">gRPC, Cloud Run &amp; Endpoints</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/200320/">Golang gRPC Cloud Run</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/240927/">Cloud Run with a gRPC probe</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/240430/">Securing gRPC services using Tailscale</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/240307/">Prometheus Protobufs and Native Histograms</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/240117/">Gnarly Protocol Buffers compilation</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/231222/">Listing Cloud Logging log-based metrics using gRPC</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/230413/">Filtering metrics w/ Google Managed Prometheus</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/230404/">Azure Container Apps</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/230314/">Access Google Services using gRPC</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/221128/">Maintaining Container Images</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/221117/">Delegate domain-wide authority using Golang</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-dark-blue bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://pretired.dazwilkin.com/" >
    &copy;  (p)retired 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>