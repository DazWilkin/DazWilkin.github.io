<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Deploying to K3s | (p)retired</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="A simple deployment of cAdvisor to K3s and to confirm the ability to expose Ingresses using Tailscale Kubernetes Operator (TLS) and &ndash; since it&rsquo;s already installed with K3s &ndash; Traefik (non-TLS).
local image = &#34;gcr.io/cadvisor/cadvisor:latest&#34;;

local labels = {
  app: &#34;cadvisor&#34;,
};

local name = std.extVar(&#34;NAME&#34;);

local node_ip = std.extVar(&#34;NODE_IP&#34;);

local port = 8080;

local deployment = {
  apiVersion: &#34;apps/v1&#34;,
  kind: &#34;Deployment&#34;,
  metadata: {
    name: name,
    labels: labels,
  },
  spec: {
    replicas: 1,
    selector: {
      matchLabels: labels,
    },
    template: {
      metadata: {
        labels: labels,
      },
      spec: {
        containers: [
          {
            name: name,
            image: image,
            ports: [
              {
                name: &#34;http&#34;,
                containerPort: 8080,
                protocol: &#34;TCP&#34;,
              },
            ],
            resources: {
              limits: {
                memory: &#34;500Mi&#34;,
              },
              requests: {
                cpu: &#34;250m&#34;,
                memory: &#34;250Mi&#34;,
              },
            },
            securityContext: {
              allowPrivilegeEscalation: false,
              privileged: false,
              readOnlyRootFilesystem: true,
              runAsGroup: 1000,
              runAsNonRoot: true,
              runAsUser: 1000,
            },
          },
        ],
      },
    },
  },
};


local ingresses = [
  {
    // Tailscale Ingress TLS (non-public)
    apiVersion: &#34;networking.k8s.io/v1&#34;,
    kind: &#34;Ingress&#34;,
    metadata: {
      name: &#34;tailscale&#34;,
      labels: labels,
    },
    spec: {
      ingressClassName: &#34;tailscale&#34;,
      defaultBackend: {
        service: {
          name: name,
          port: {
            number: port,
          },
        },
      },
      tls: [
        {
          hosts: [
            name,
          ],
        },
      ],
    },
  },
  {
    // Traefik Ingress non-TLS (non-public)
    apiVersion: &#34;networking.k8s.io/v1&#34;,
    kind: &#34;Ingress&#34;,
    metadata: {
      name: &#34;traefik&#34;,
      labels: labels,
    },
    spec: {
      ingressClassName: &#34;traefik&#34;,
      rules: [
        {
          host: std.format(
              &#34;%(name)s.%(node_ip)s.nip.io&#34;, {
                name: name,
                node_ip: node_ip,
              },
            ),
          http: {
            paths: [
              {
                path: &#34;/&#34;,
                pathType: &#34;Prefix&#34;,
                backend: {
                  service: {
                    name: name,
                    port: {
                      number: port,
                    },
                  },
                },
              },
            ],
          },
        },
      ],
    },
  },
];

local prometheusrule = {
  // Alternatively parameterize the duration
  local duration = 10,

  apiVersion: &#34;monitoring.coreos.com/v1&#34;,
  kind: &#34;PrometheusRule&#34;,
  metadata: {
    name: name,
    labels: labels,
  },
  spec: {
    groups: [
      {
        name: name,
        rules: [
          {
            alert: &#34;TestcAdvsiorDown&#34;,
            annotations: {
              summary: &#34;Test cAdvisor instance is down or not scraping metrics.&#34;,
              description: std.format(
                &#34;The cAdvisor instance {{ $labels.instance }} has not been scraping metrics for more than %(duration)s minutes.&#34;, {
                  duration: duration,
                },
              ),
            },
            expr: &#34;absent(cadvisor_version_info{namespace=\&#34;k3s-test\&#34;}) or (cadvisor_version_info{namespace=\&#34;k3s-test\&#34;}!=1)&#34;,
            &#34;for&#34;: std.format(
              &#34;%(duration)sm&#34;, {
                duration: duration,
              },
            ),
            labels: labels {
              severity: &#34;warning&#34;,
            },
          },
        ],
      },
    ],
  },
};

local service = {
  apiVersion: &#34;v1&#34;,
  kind: &#34;Service&#34;,
  metadata: {
    name: name,
    labels: labels,
  },
  spec: {
    selector: labels,
    ports: [
      {
        name: &#34;http&#34;,
        port: port,
        targetPort: port,
        protocol: &#34;TCP&#34;,
      },
    ],
  },
};

local serviceaccount = {
  apiVersion: &#34;v1&#34;,
  kind: &#34;ServiceAccount&#34;,
  metadata: {
    name: name,
    labels: labels,
  },
};

local servicemonitor = {
  apiVersion: &#34;monitoring.coreos.com/v1&#34;,
  kind: &#34;ServiceMonitor&#34;,
  metadata: {
    name: name,
    labels: labels,
  },
  spec: {
    selector: {
      matchLabels: labels,
    },
    endpoints: [
      {
        interval: &#34;120s&#34;,
        path: &#34;/metrics&#34;,
        port: &#34;http&#34;,
        scrapeTimeout: &#34;30s&#34;,
      },
    ],
  },
};

// Output
{
  apiVersion: &#34;v1&#34;,
  kind: &#34;List&#34;,
  items: [
    deployment,
    prometheusrule,
    service,
    serviceaccount,
    servicemonitor,
  ] &#43; ingresses,
}
I like to have a script that applies Jsonnet to the file:">
    <meta name="generator" content="Hugo 0.153.0-DEV">
    
    
    
    
      <meta name="robots" content="index, follow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.cf4aecb341f2e16e80e407465df095cee730d71e19c4574f8e9b28d163dc4225.css" >



  


    

    
    
      

    

    

    <script data-goatcounter="https://pretired.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
 
    <meta property="og:url" content="https://pretired.dazwilkin.com/posts/251121/">
  <meta property="og:site_name" content="(p)retired">
  <meta property="og:title" content="Deploying to K3s">
  <meta property="og:description" content="A simple deployment of cAdvisor to K3s and to confirm the ability to expose Ingresses using Tailscale Kubernetes Operator (TLS) and – since it’s already installed with K3s – Traefik (non-TLS).
local image = &#34;gcr.io/cadvisor/cadvisor:latest&#34;; local labels = { app: &#34;cadvisor&#34;, }; local name = std.extVar(&#34;NAME&#34;); local node_ip = std.extVar(&#34;NODE_IP&#34;); local port = 8080; local deployment = { apiVersion: &#34;apps/v1&#34;, kind: &#34;Deployment&#34;, metadata: { name: name, labels: labels, }, spec: { replicas: 1, selector: { matchLabels: labels, }, template: { metadata: { labels: labels, }, spec: { containers: [ { name: name, image: image, ports: [ { name: &#34;http&#34;, containerPort: 8080, protocol: &#34;TCP&#34;, }, ], resources: { limits: { memory: &#34;500Mi&#34;, }, requests: { cpu: &#34;250m&#34;, memory: &#34;250Mi&#34;, }, }, securityContext: { allowPrivilegeEscalation: false, privileged: false, readOnlyRootFilesystem: true, runAsGroup: 1000, runAsNonRoot: true, runAsUser: 1000, }, }, ], }, }, }, }; local ingresses = [ { // Tailscale Ingress TLS (non-public) apiVersion: &#34;networking.k8s.io/v1&#34;, kind: &#34;Ingress&#34;, metadata: { name: &#34;tailscale&#34;, labels: labels, }, spec: { ingressClassName: &#34;tailscale&#34;, defaultBackend: { service: { name: name, port: { number: port, }, }, }, tls: [ { hosts: [ name, ], }, ], }, }, { // Traefik Ingress non-TLS (non-public) apiVersion: &#34;networking.k8s.io/v1&#34;, kind: &#34;Ingress&#34;, metadata: { name: &#34;traefik&#34;, labels: labels, }, spec: { ingressClassName: &#34;traefik&#34;, rules: [ { host: std.format( &#34;%(name)s.%(node_ip)s.nip.io&#34;, { name: name, node_ip: node_ip, }, ), http: { paths: [ { path: &#34;/&#34;, pathType: &#34;Prefix&#34;, backend: { service: { name: name, port: { number: port, }, }, }, }, ], }, }, ], }, }, ]; local prometheusrule = { // Alternatively parameterize the duration local duration = 10, apiVersion: &#34;monitoring.coreos.com/v1&#34;, kind: &#34;PrometheusRule&#34;, metadata: { name: name, labels: labels, }, spec: { groups: [ { name: name, rules: [ { alert: &#34;TestcAdvsiorDown&#34;, annotations: { summary: &#34;Test cAdvisor instance is down or not scraping metrics.&#34;, description: std.format( &#34;The cAdvisor instance {{ $labels.instance }} has not been scraping metrics for more than %(duration)s minutes.&#34;, { duration: duration, }, ), }, expr: &#34;absent(cadvisor_version_info{namespace=\&#34;k3s-test\&#34;}) or (cadvisor_version_info{namespace=\&#34;k3s-test\&#34;}!=1)&#34;, &#34;for&#34;: std.format( &#34;%(duration)sm&#34;, { duration: duration, }, ), labels: labels { severity: &#34;warning&#34;, }, }, ], }, ], }, }; local service = { apiVersion: &#34;v1&#34;, kind: &#34;Service&#34;, metadata: { name: name, labels: labels, }, spec: { selector: labels, ports: [ { name: &#34;http&#34;, port: port, targetPort: port, protocol: &#34;TCP&#34;, }, ], }, }; local serviceaccount = { apiVersion: &#34;v1&#34;, kind: &#34;ServiceAccount&#34;, metadata: { name: name, labels: labels, }, }; local servicemonitor = { apiVersion: &#34;monitoring.coreos.com/v1&#34;, kind: &#34;ServiceMonitor&#34;, metadata: { name: name, labels: labels, }, spec: { selector: { matchLabels: labels, }, endpoints: [ { interval: &#34;120s&#34;, path: &#34;/metrics&#34;, port: &#34;http&#34;, scrapeTimeout: &#34;30s&#34;, }, ], }, }; // Output { apiVersion: &#34;v1&#34;, kind: &#34;List&#34;, items: [ deployment, prometheusrule, service, serviceaccount, servicemonitor, ] &#43; ingresses, } I like to have a script that applies Jsonnet to the file:">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-11-21T00:00:00-08:00">
    <meta property="article:modified_time" content="2025-11-21T00:00:00-08:00">
    <meta property="article:tag" content="Kubernetes">
    <meta property="article:tag" content="Microk8s">
    <meta property="article:tag" content="K3s">
    <meta property="article:tag" content="Kube-Prometheus">
    <meta property="article:tag" content="Tailscale Operator">
    <meta property="article:tag" content="Jsonnet">

  <meta itemprop="name" content="Deploying to K3s">
  <meta itemprop="description" content="A simple deployment of cAdvisor to K3s and to confirm the ability to expose Ingresses using Tailscale Kubernetes Operator (TLS) and – since it’s already installed with K3s – Traefik (non-TLS).
local image = &#34;gcr.io/cadvisor/cadvisor:latest&#34;; local labels = { app: &#34;cadvisor&#34;, }; local name = std.extVar(&#34;NAME&#34;); local node_ip = std.extVar(&#34;NODE_IP&#34;); local port = 8080; local deployment = { apiVersion: &#34;apps/v1&#34;, kind: &#34;Deployment&#34;, metadata: { name: name, labels: labels, }, spec: { replicas: 1, selector: { matchLabels: labels, }, template: { metadata: { labels: labels, }, spec: { containers: [ { name: name, image: image, ports: [ { name: &#34;http&#34;, containerPort: 8080, protocol: &#34;TCP&#34;, }, ], resources: { limits: { memory: &#34;500Mi&#34;, }, requests: { cpu: &#34;250m&#34;, memory: &#34;250Mi&#34;, }, }, securityContext: { allowPrivilegeEscalation: false, privileged: false, readOnlyRootFilesystem: true, runAsGroup: 1000, runAsNonRoot: true, runAsUser: 1000, }, }, ], }, }, }, }; local ingresses = [ { // Tailscale Ingress TLS (non-public) apiVersion: &#34;networking.k8s.io/v1&#34;, kind: &#34;Ingress&#34;, metadata: { name: &#34;tailscale&#34;, labels: labels, }, spec: { ingressClassName: &#34;tailscale&#34;, defaultBackend: { service: { name: name, port: { number: port, }, }, }, tls: [ { hosts: [ name, ], }, ], }, }, { // Traefik Ingress non-TLS (non-public) apiVersion: &#34;networking.k8s.io/v1&#34;, kind: &#34;Ingress&#34;, metadata: { name: &#34;traefik&#34;, labels: labels, }, spec: { ingressClassName: &#34;traefik&#34;, rules: [ { host: std.format( &#34;%(name)s.%(node_ip)s.nip.io&#34;, { name: name, node_ip: node_ip, }, ), http: { paths: [ { path: &#34;/&#34;, pathType: &#34;Prefix&#34;, backend: { service: { name: name, port: { number: port, }, }, }, }, ], }, }, ], }, }, ]; local prometheusrule = { // Alternatively parameterize the duration local duration = 10, apiVersion: &#34;monitoring.coreos.com/v1&#34;, kind: &#34;PrometheusRule&#34;, metadata: { name: name, labels: labels, }, spec: { groups: [ { name: name, rules: [ { alert: &#34;TestcAdvsiorDown&#34;, annotations: { summary: &#34;Test cAdvisor instance is down or not scraping metrics.&#34;, description: std.format( &#34;The cAdvisor instance {{ $labels.instance }} has not been scraping metrics for more than %(duration)s minutes.&#34;, { duration: duration, }, ), }, expr: &#34;absent(cadvisor_version_info{namespace=\&#34;k3s-test\&#34;}) or (cadvisor_version_info{namespace=\&#34;k3s-test\&#34;}!=1)&#34;, &#34;for&#34;: std.format( &#34;%(duration)sm&#34;, { duration: duration, }, ), labels: labels { severity: &#34;warning&#34;, }, }, ], }, ], }, }; local service = { apiVersion: &#34;v1&#34;, kind: &#34;Service&#34;, metadata: { name: name, labels: labels, }, spec: { selector: labels, ports: [ { name: &#34;http&#34;, port: port, targetPort: port, protocol: &#34;TCP&#34;, }, ], }, }; local serviceaccount = { apiVersion: &#34;v1&#34;, kind: &#34;ServiceAccount&#34;, metadata: { name: name, labels: labels, }, }; local servicemonitor = { apiVersion: &#34;monitoring.coreos.com/v1&#34;, kind: &#34;ServiceMonitor&#34;, metadata: { name: name, labels: labels, }, spec: { selector: { matchLabels: labels, }, endpoints: [ { interval: &#34;120s&#34;, path: &#34;/metrics&#34;, port: &#34;http&#34;, scrapeTimeout: &#34;30s&#34;, }, ], }, }; // Output { apiVersion: &#34;v1&#34;, kind: &#34;List&#34;, items: [ deployment, prometheusrule, service, serviceaccount, servicemonitor, ] &#43; ingresses, } I like to have a script that applies Jsonnet to the file:">
  <meta itemprop="datePublished" content="2025-11-21T00:00:00-08:00">
  <meta itemprop="dateModified" content="2025-11-21T00:00:00-08:00">
  <meta itemprop="wordCount" content="578">
  <meta itemprop="keywords" content="Kubernetes,Microk8s,K3s,Kube-Prometheus,Tailscale Operator,Jsonnet,Traefik">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Deploying to K3s">
  <meta name="twitter:description" content="A simple deployment of cAdvisor to K3s and to confirm the ability to expose Ingresses using Tailscale Kubernetes Operator (TLS) and – since it’s already installed with K3s – Traefik (non-TLS).
local image = &#34;gcr.io/cadvisor/cadvisor:latest&#34;; local labels = { app: &#34;cadvisor&#34;, }; local name = std.extVar(&#34;NAME&#34;); local node_ip = std.extVar(&#34;NODE_IP&#34;); local port = 8080; local deployment = { apiVersion: &#34;apps/v1&#34;, kind: &#34;Deployment&#34;, metadata: { name: name, labels: labels, }, spec: { replicas: 1, selector: { matchLabels: labels, }, template: { metadata: { labels: labels, }, spec: { containers: [ { name: name, image: image, ports: [ { name: &#34;http&#34;, containerPort: 8080, protocol: &#34;TCP&#34;, }, ], resources: { limits: { memory: &#34;500Mi&#34;, }, requests: { cpu: &#34;250m&#34;, memory: &#34;250Mi&#34;, }, }, securityContext: { allowPrivilegeEscalation: false, privileged: false, readOnlyRootFilesystem: true, runAsGroup: 1000, runAsNonRoot: true, runAsUser: 1000, }, }, ], }, }, }, }; local ingresses = [ { // Tailscale Ingress TLS (non-public) apiVersion: &#34;networking.k8s.io/v1&#34;, kind: &#34;Ingress&#34;, metadata: { name: &#34;tailscale&#34;, labels: labels, }, spec: { ingressClassName: &#34;tailscale&#34;, defaultBackend: { service: { name: name, port: { number: port, }, }, }, tls: [ { hosts: [ name, ], }, ], }, }, { // Traefik Ingress non-TLS (non-public) apiVersion: &#34;networking.k8s.io/v1&#34;, kind: &#34;Ingress&#34;, metadata: { name: &#34;traefik&#34;, labels: labels, }, spec: { ingressClassName: &#34;traefik&#34;, rules: [ { host: std.format( &#34;%(name)s.%(node_ip)s.nip.io&#34;, { name: name, node_ip: node_ip, }, ), http: { paths: [ { path: &#34;/&#34;, pathType: &#34;Prefix&#34;, backend: { service: { name: name, port: { number: port, }, }, }, }, ], }, }, ], }, }, ]; local prometheusrule = { // Alternatively parameterize the duration local duration = 10, apiVersion: &#34;monitoring.coreos.com/v1&#34;, kind: &#34;PrometheusRule&#34;, metadata: { name: name, labels: labels, }, spec: { groups: [ { name: name, rules: [ { alert: &#34;TestcAdvsiorDown&#34;, annotations: { summary: &#34;Test cAdvisor instance is down or not scraping metrics.&#34;, description: std.format( &#34;The cAdvisor instance {{ $labels.instance }} has not been scraping metrics for more than %(duration)s minutes.&#34;, { duration: duration, }, ), }, expr: &#34;absent(cadvisor_version_info{namespace=\&#34;k3s-test\&#34;}) or (cadvisor_version_info{namespace=\&#34;k3s-test\&#34;}!=1)&#34;, &#34;for&#34;: std.format( &#34;%(duration)sm&#34;, { duration: duration, }, ), labels: labels { severity: &#34;warning&#34;, }, }, ], }, ], }, }; local service = { apiVersion: &#34;v1&#34;, kind: &#34;Service&#34;, metadata: { name: name, labels: labels, }, spec: { selector: labels, ports: [ { name: &#34;http&#34;, port: port, targetPort: port, protocol: &#34;TCP&#34;, }, ], }, }; local serviceaccount = { apiVersion: &#34;v1&#34;, kind: &#34;ServiceAccount&#34;, metadata: { name: name, labels: labels, }, }; local servicemonitor = { apiVersion: &#34;monitoring.coreos.com/v1&#34;, kind: &#34;ServiceMonitor&#34;, metadata: { name: name, labels: labels, }, spec: { selector: { matchLabels: labels, }, endpoints: [ { interval: &#34;120s&#34;, path: &#34;/metrics&#34;, port: &#34;http&#34;, scrapeTimeout: &#34;30s&#34;, }, ], }, }; // Output { apiVersion: &#34;v1&#34;, kind: &#34;List&#34;, items: [ deployment, prometheusrule, service, serviceaccount, servicemonitor, ] &#43; ingresses, } I like to have a script that applies Jsonnet to the file:">

      
    
	
  </head>

  <body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-dark-blue">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        (p)retired
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l mw8 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Deploying to K3s</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2025-11-21T00:00:00-08:00">November 21, 2025</time>
      

      
      
        <span class="f6 mv4 dib tracked"> - 3 minutes read </span>
        <span class="f6 mv4 dib tracked"> - 578 words </span>
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>A simple deployment of <a href="https://github.com/google/cadvisor">cAdvisor</a> to K3s and to confirm the ability to expose Ingresses using Tailscale <a href="https://tailscale.com/kb/1236/kubernetes-operator">Kubernetes Operator</a> (TLS) and &ndash; since it&rsquo;s already installed with K3s &ndash; <a href="https://github.com/traefik/traefik">Traefik</a> (non-TLS).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Jsonnet" data-lang="Jsonnet"><span style="display:flex;"><span><span style="color:#66d9ef">local</span> image <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gcr.io/cadvisor/cadvisor:latest&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> labels <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  app: <span style="color:#e6db74">&#34;cadvisor&#34;</span>,
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> name <span style="color:#f92672">=</span> std.extVar(<span style="color:#e6db74">&#34;NAME&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> node_ip <span style="color:#f92672">=</span> std.extVar(<span style="color:#e6db74">&#34;NODE_IP&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> port <span style="color:#f92672">=</span> <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> deployment <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  apiVersion: <span style="color:#e6db74">&#34;apps/v1&#34;</span>,
</span></span><span style="display:flex;"><span>  kind: <span style="color:#e6db74">&#34;Deployment&#34;</span>,
</span></span><span style="display:flex;"><span>  metadata: {
</span></span><span style="display:flex;"><span>    name: name,
</span></span><span style="display:flex;"><span>    labels: labels,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  spec: {
</span></span><span style="display:flex;"><span>    replicas: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    selector: {
</span></span><span style="display:flex;"><span>      matchLabels: labels,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    template: {
</span></span><span style="display:flex;"><span>      metadata: {
</span></span><span style="display:flex;"><span>        labels: labels,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      spec: {
</span></span><span style="display:flex;"><span>        containers: [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            name: name,
</span></span><span style="display:flex;"><span>            image: image,
</span></span><span style="display:flex;"><span>            ports: [
</span></span><span style="display:flex;"><span>              {
</span></span><span style="display:flex;"><span>                name: <span style="color:#e6db74">&#34;http&#34;</span>,
</span></span><span style="display:flex;"><span>                containerPort: <span style="color:#ae81ff">8080</span>,
</span></span><span style="display:flex;"><span>                protocol: <span style="color:#e6db74">&#34;TCP&#34;</span>,
</span></span><span style="display:flex;"><span>              },
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            resources: {
</span></span><span style="display:flex;"><span>              limits: {
</span></span><span style="display:flex;"><span>                memory: <span style="color:#e6db74">&#34;500Mi&#34;</span>,
</span></span><span style="display:flex;"><span>              },
</span></span><span style="display:flex;"><span>              requests: {
</span></span><span style="display:flex;"><span>                cpu: <span style="color:#e6db74">&#34;250m&#34;</span>,
</span></span><span style="display:flex;"><span>                memory: <span style="color:#e6db74">&#34;250Mi&#34;</span>,
</span></span><span style="display:flex;"><span>              },
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            securityContext: {
</span></span><span style="display:flex;"><span>              allowPrivilegeEscalation: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>              privileged: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>              readOnlyRootFilesystem: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>              runAsGroup: <span style="color:#ae81ff">1000</span>,
</span></span><span style="display:flex;"><span>              runAsNonRoot: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>              runAsUser: <span style="color:#ae81ff">1000</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> ingresses <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Tailscale Ingress TLS (non-public)
</span></span></span><span style="display:flex;"><span>    apiVersion: <span style="color:#e6db74">&#34;networking.k8s.io/v1&#34;</span>,
</span></span><span style="display:flex;"><span>    kind: <span style="color:#e6db74">&#34;Ingress&#34;</span>,
</span></span><span style="display:flex;"><span>    metadata: {
</span></span><span style="display:flex;"><span>      name: <span style="color:#e6db74">&#34;tailscale&#34;</span>,
</span></span><span style="display:flex;"><span>      labels: labels,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    spec: {
</span></span><span style="display:flex;"><span>      ingressClassName: <span style="color:#e6db74">&#34;tailscale&#34;</span>,
</span></span><span style="display:flex;"><span>      defaultBackend: {
</span></span><span style="display:flex;"><span>        service: {
</span></span><span style="display:flex;"><span>          name: name,
</span></span><span style="display:flex;"><span>          port: {
</span></span><span style="display:flex;"><span>            number: port,
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      tls: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          hosts: [
</span></span><span style="display:flex;"><span>            name,
</span></span><span style="display:flex;"><span>          ],
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Traefik Ingress non-TLS (non-public)
</span></span></span><span style="display:flex;"><span>    apiVersion: <span style="color:#e6db74">&#34;networking.k8s.io/v1&#34;</span>,
</span></span><span style="display:flex;"><span>    kind: <span style="color:#e6db74">&#34;Ingress&#34;</span>,
</span></span><span style="display:flex;"><span>    metadata: {
</span></span><span style="display:flex;"><span>      name: <span style="color:#e6db74">&#34;traefik&#34;</span>,
</span></span><span style="display:flex;"><span>      labels: labels,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    spec: {
</span></span><span style="display:flex;"><span>      ingressClassName: <span style="color:#e6db74">&#34;traefik&#34;</span>,
</span></span><span style="display:flex;"><span>      rules: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          host: std.format(
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#34;%(name)s.%(node_ip)s.nip.io&#34;</span>, {
</span></span><span style="display:flex;"><span>                name: name,
</span></span><span style="display:flex;"><span>                node_ip: node_ip,
</span></span><span style="display:flex;"><span>              },
</span></span><span style="display:flex;"><span>            ),
</span></span><span style="display:flex;"><span>          http: {
</span></span><span style="display:flex;"><span>            paths: [
</span></span><span style="display:flex;"><span>              {
</span></span><span style="display:flex;"><span>                path: <span style="color:#e6db74">&#34;/&#34;</span>,
</span></span><span style="display:flex;"><span>                pathType: <span style="color:#e6db74">&#34;Prefix&#34;</span>,
</span></span><span style="display:flex;"><span>                backend: {
</span></span><span style="display:flex;"><span>                  service: {
</span></span><span style="display:flex;"><span>                    name: name,
</span></span><span style="display:flex;"><span>                    port: {
</span></span><span style="display:flex;"><span>                      number: port,
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                  },
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>              },
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> prometheusrule <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Alternatively parameterize the duration
</span></span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">local</span> duration <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  apiVersion: <span style="color:#e6db74">&#34;monitoring.coreos.com/v1&#34;</span>,
</span></span><span style="display:flex;"><span>  kind: <span style="color:#e6db74">&#34;PrometheusRule&#34;</span>,
</span></span><span style="display:flex;"><span>  metadata: {
</span></span><span style="display:flex;"><span>    name: name,
</span></span><span style="display:flex;"><span>    labels: labels,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  spec: {
</span></span><span style="display:flex;"><span>    groups: [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        name: name,
</span></span><span style="display:flex;"><span>        rules: [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            alert: <span style="color:#e6db74">&#34;TestcAdvsiorDown&#34;</span>,
</span></span><span style="display:flex;"><span>            annotations: {
</span></span><span style="display:flex;"><span>              summary: <span style="color:#e6db74">&#34;Test cAdvisor instance is down or not scraping metrics.&#34;</span>,
</span></span><span style="display:flex;"><span>              description: std.format(
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;The cAdvisor instance {{ $labels.instance }} has not been scraping metrics for more than %(duration)s minutes.&#34;</span>, {
</span></span><span style="display:flex;"><span>                  duration: duration,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>              ),
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            expr: <span style="color:#e6db74">&#34;absent(cadvisor_version_info{namespace=</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">k3s-test</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">}) or (cadvisor_version_info{namespace=</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">k3s-test</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">}!=1)&#34;</span>,
</span></span><span style="display:flex;"><span>            &#34;for&#34;: std.format(
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#34;%(duration)sm&#34;</span>, {
</span></span><span style="display:flex;"><span>                duration: duration,
</span></span><span style="display:flex;"><span>              },
</span></span><span style="display:flex;"><span>            ),
</span></span><span style="display:flex;"><span>            labels: labels {
</span></span><span style="display:flex;"><span>              severity: <span style="color:#e6db74">&#34;warning&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> service <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  apiVersion: <span style="color:#e6db74">&#34;v1&#34;</span>,
</span></span><span style="display:flex;"><span>  kind: <span style="color:#e6db74">&#34;Service&#34;</span>,
</span></span><span style="display:flex;"><span>  metadata: {
</span></span><span style="display:flex;"><span>    name: name,
</span></span><span style="display:flex;"><span>    labels: labels,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  spec: {
</span></span><span style="display:flex;"><span>    selector: labels,
</span></span><span style="display:flex;"><span>    ports: [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        name: <span style="color:#e6db74">&#34;http&#34;</span>,
</span></span><span style="display:flex;"><span>        port: port,
</span></span><span style="display:flex;"><span>        targetPort: port,
</span></span><span style="display:flex;"><span>        protocol: <span style="color:#e6db74">&#34;TCP&#34;</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> serviceaccount <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  apiVersion: <span style="color:#e6db74">&#34;v1&#34;</span>,
</span></span><span style="display:flex;"><span>  kind: <span style="color:#e6db74">&#34;ServiceAccount&#34;</span>,
</span></span><span style="display:flex;"><span>  metadata: {
</span></span><span style="display:flex;"><span>    name: name,
</span></span><span style="display:flex;"><span>    labels: labels,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> servicemonitor <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  apiVersion: <span style="color:#e6db74">&#34;monitoring.coreos.com/v1&#34;</span>,
</span></span><span style="display:flex;"><span>  kind: <span style="color:#e6db74">&#34;ServiceMonitor&#34;</span>,
</span></span><span style="display:flex;"><span>  metadata: {
</span></span><span style="display:flex;"><span>    name: name,
</span></span><span style="display:flex;"><span>    labels: labels,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  spec: {
</span></span><span style="display:flex;"><span>    selector: {
</span></span><span style="display:flex;"><span>      matchLabels: labels,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    endpoints: [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        interval: <span style="color:#e6db74">&#34;120s&#34;</span>,
</span></span><span style="display:flex;"><span>        path: <span style="color:#e6db74">&#34;/metrics&#34;</span>,
</span></span><span style="display:flex;"><span>        port: <span style="color:#e6db74">&#34;http&#34;</span>,
</span></span><span style="display:flex;"><span>        scrapeTimeout: <span style="color:#e6db74">&#34;30s&#34;</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Output
</span></span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  apiVersion: <span style="color:#e6db74">&#34;v1&#34;</span>,
</span></span><span style="display:flex;"><span>  kind: <span style="color:#e6db74">&#34;List&#34;</span>,
</span></span><span style="display:flex;"><span>  items: [
</span></span><span style="display:flex;"><span>    deployment,
</span></span><span style="display:flex;"><span>    prometheusrule,
</span></span><span style="display:flex;"><span>    service,
</span></span><span style="display:flex;"><span>    serviceaccount,
</span></span><span style="display:flex;"><span>    servicemonitor,
</span></span><span style="display:flex;"><span>  ] <span style="color:#f92672">+</span> ingresses,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I like to have a script that applies Jsonnet to the file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env bash
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span>TAILNET<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...ts.net&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Get the internal IP of the first (only) node to be used by Traefik Ingress</span>
</span></span><span style="display:flex;"><span>NODE_IP<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  kubectl get nodes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  --output<span style="color:#f92672">=</span>jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.items[0].status.addresses[?(@.type==&#34;InternalIP&#34;)].address}&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>jsonnet <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>--ext-str NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>--ext-str NODE_IP<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>NODE_IP<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>kubernetes.jsonnet
</span></span></code></pre></div><p>and apply it using:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>NAMESPACE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>./kubernetes.sh <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>| jq -r . <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>| kubectl apply <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  --filename<span style="color:#f92672">=</span>- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  --namespace<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>NAMESPACE<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>This should yield:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get ingress --namespace<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>NAMESPACE<span style="color:#e6db74">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>NAME      CLASS       HOSTS                   ADDRESS        PORTS     AGE
</span></span><span style="display:flex;"><span>test      tailscale   *                       test.{TAILNET} 80, 443   19h
</span></span><span style="display:flex;"><span>traefik   traefik     test.{NODE_IP}.nip.io   {NODE_IP}      80        46m
</span></span></code></pre></div><p>And:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span>TAILNET<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...ts.net&#34;</span>
</span></span><span style="display:flex;"><span>NODE_IP<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ENDPOINTS<span style="color:#f92672">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;https://</span><span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">${</span>TAILNET<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;http://</span><span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">${</span>NODE_IP<span style="color:#e6db74">}</span><span style="color:#e6db74">.nip.io&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ENDPOINT in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ENDPOINTS[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>--silent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>--url <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span><span style="color:#e6db74">/metrics&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>--output /dev/null <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>--write-out <span style="color:#e6db74">&#39;%{response_code}\n&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>200
</span></span><span style="display:flex;"><span>200
</span></span></code></pre></div><p>That&rsquo;s all!</p>
<ul class="pa0">
  
   <li class="list di">
     <a href="/tags/kubernetes/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Kubernetes</a>
   </li>
  
   <li class="list di">
     <a href="/tags/microk8s/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Microk8s</a>
   </li>
  
   <li class="list di">
     <a href="/tags/k3s/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">K3s</a>
   </li>
  
   <li class="list di">
     <a href="/tags/kube-prometheus/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Kube-Prometheus</a>
   </li>
  
   <li class="list di">
     <a href="/tags/tailscale-operator/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Tailscale Operator</a>
   </li>
  
   <li class="list di">
     <a href="/tags/jsonnet/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Jsonnet</a>
   </li>
  
   <li class="list di">
     <a href="/tags/traefik/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Traefik</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/posts/251119/">Migrating to K3s</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/240216/">MicroK8s operability add-on</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/210305/">Prometheus VPA Recommendations</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/201217/">Kubernetes Device Plugins</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/201113/">Akri</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/201022/">akri</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/250620/">Tailscale client metrics service discovery to Prometheus</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/240529/">Using Rust to generate Kubernetes CRD</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/240528/">Using Delve to debug Go containers on Kubernetes</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/230215/">Secure (TLS) gRPC services with LKE</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/220603/">Secure (TLS) gRPC services with VKE</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/220602/">Vultr CLI and JSON output</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/210222/">Dapr</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/210122/">Krustlet on DO Managed Kubernetes</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/210108/">Kubernetes cert-manager</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-dark-blue bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://pretired.dazwilkin.com/" >
    &copy;  (p)retired 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>