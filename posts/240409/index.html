<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Google Cloud Translation w/ gRPC 3 ways | (p)retired</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="General
You&rsquo;ll need a Google Cloud project with Cloud Translation (translate.googleapis.com) enabled and a Service Account (and key) with suitable permissions in order to run the following.
BILLING=&#34;...&#34; # Your Billing ID (gcloud billing accounts list)
PROJECT=&#34;...&#34; # Your Project ID
ACCOUNT=&#34;tester&#34;

EMAIL=&#34;${ACCOUNT}@${PROJECT}.iam.gserviceaccount.com&#34;

ROLES=(
    &#34;roles/cloudtranslate.user&#34;
    &#34;roles/serviceusage.serviceUsageConsumer&#34;
)

# Create Project
gcloud projects create ${PROJECT}

# Associate Project with your Billing Account
gcloud billing accounts link ${PROJECT} \
--billing-account=${BILLING}

# Enable Cloud Translation
gcloud services enable translate.googleapis.com \
--project=${PROJECT}

# Create Service Account
gcloud iam service-accounts create ${ACCOUNT} \
--project=${PROJECT}

# Create Service Account Key
gcloud iam service-accounts keys create ${PWD}/${ACCOUNT}.json \
--iam-account=${EMAIL} \
--project=${PROJECT}

# Update Project IAM permissions
for ROLE in &#34;${ROLES[@]}&#34;
do
  gcloud projects add-iam-policy-binding ${PROJECT} \
  --member=serviceAccount:${EMAIL} \
  --role=${ROLE}
done
For the code, you&rsquo;ll need to install protoc and preferably have it in your path.">
    <meta name="generator" content="Hugo 0.148.0-DEV">
    
    
    
    
      <meta name="robots" content="index, follow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.8d048772ae72ab11245a0e296d1f2a36d3e3dd376c6c867394d6cc659c68fc37.css" >




    

    
    
      

    

    

    <script data-goatcounter="https://pretired.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
 
    <meta property="og:url" content="https://pretired.dazwilkin.com/posts/240409/">
  <meta property="og:site_name" content="(p)retired">
  <meta property="og:title" content="Google Cloud Translation w/ gRPC 3 ways">
  <meta property="og:description" content="General You’ll need a Google Cloud project with Cloud Translation (translate.googleapis.com) enabled and a Service Account (and key) with suitable permissions in order to run the following.
BILLING=&#34;...&#34; # Your Billing ID (gcloud billing accounts list) PROJECT=&#34;...&#34; # Your Project ID ACCOUNT=&#34;tester&#34; EMAIL=&#34;${ACCOUNT}@${PROJECT}.iam.gserviceaccount.com&#34; ROLES=( &#34;roles/cloudtranslate.user&#34; &#34;roles/serviceusage.serviceUsageConsumer&#34; ) # Create Project gcloud projects create ${PROJECT} # Associate Project with your Billing Account gcloud billing accounts link ${PROJECT} \ --billing-account=${BILLING} # Enable Cloud Translation gcloud services enable translate.googleapis.com \ --project=${PROJECT} # Create Service Account gcloud iam service-accounts create ${ACCOUNT} \ --project=${PROJECT} # Create Service Account Key gcloud iam service-accounts keys create ${PWD}/${ACCOUNT}.json \ --iam-account=${EMAIL} \ --project=${PROJECT} # Update Project IAM permissions for ROLE in &#34;${ROLES[@]}&#34; do gcloud projects add-iam-policy-binding ${PROJECT} \ --member=serviceAccount:${EMAIL} \ --role=${ROLE} done For the code, you’ll need to install protoc and preferably have it in your path.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-09T00:00:00-07:00">
    <meta property="article:modified_time" content="2024-04-09T00:00:00-07:00">
    <meta property="article:tag" content="Google">
    <meta property="article:tag" content="Translation">
    <meta property="article:tag" content="GRPC">
    <meta property="article:tag" content="GRPCurl">
    <meta property="article:tag" content="Rust">
    <meta property="article:tag" content="Golang">

  <meta itemprop="name" content="Google Cloud Translation w/ gRPC 3 ways">
  <meta itemprop="description" content="General You’ll need a Google Cloud project with Cloud Translation (translate.googleapis.com) enabled and a Service Account (and key) with suitable permissions in order to run the following.
BILLING=&#34;...&#34; # Your Billing ID (gcloud billing accounts list) PROJECT=&#34;...&#34; # Your Project ID ACCOUNT=&#34;tester&#34; EMAIL=&#34;${ACCOUNT}@${PROJECT}.iam.gserviceaccount.com&#34; ROLES=( &#34;roles/cloudtranslate.user&#34; &#34;roles/serviceusage.serviceUsageConsumer&#34; ) # Create Project gcloud projects create ${PROJECT} # Associate Project with your Billing Account gcloud billing accounts link ${PROJECT} \ --billing-account=${BILLING} # Enable Cloud Translation gcloud services enable translate.googleapis.com \ --project=${PROJECT} # Create Service Account gcloud iam service-accounts create ${ACCOUNT} \ --project=${PROJECT} # Create Service Account Key gcloud iam service-accounts keys create ${PWD}/${ACCOUNT}.json \ --iam-account=${EMAIL} \ --project=${PROJECT} # Update Project IAM permissions for ROLE in &#34;${ROLES[@]}&#34; do gcloud projects add-iam-policy-binding ${PROJECT} \ --member=serviceAccount:${EMAIL} \ --role=${ROLE} done For the code, you’ll need to install protoc and preferably have it in your path.">
  <meta itemprop="datePublished" content="2024-04-09T00:00:00-07:00">
  <meta itemprop="dateModified" content="2024-04-09T00:00:00-07:00">
  <meta itemprop="wordCount" content="1077">
  <meta itemprop="keywords" content="Google,Translation,GRPC,GRPCurl,Rust,Golang,Dotnet">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Google Cloud Translation w/ gRPC 3 ways">
  <meta name="twitter:description" content="General You’ll need a Google Cloud project with Cloud Translation (translate.googleapis.com) enabled and a Service Account (and key) with suitable permissions in order to run the following.
BILLING=&#34;...&#34; # Your Billing ID (gcloud billing accounts list) PROJECT=&#34;...&#34; # Your Project ID ACCOUNT=&#34;tester&#34; EMAIL=&#34;${ACCOUNT}@${PROJECT}.iam.gserviceaccount.com&#34; ROLES=( &#34;roles/cloudtranslate.user&#34; &#34;roles/serviceusage.serviceUsageConsumer&#34; ) # Create Project gcloud projects create ${PROJECT} # Associate Project with your Billing Account gcloud billing accounts link ${PROJECT} \ --billing-account=${BILLING} # Enable Cloud Translation gcloud services enable translate.googleapis.com \ --project=${PROJECT} # Create Service Account gcloud iam service-accounts create ${ACCOUNT} \ --project=${PROJECT} # Create Service Account Key gcloud iam service-accounts keys create ${PWD}/${ACCOUNT}.json \ --iam-account=${EMAIL} \ --project=${PROJECT} # Update Project IAM permissions for ROLE in &#34;${ROLES[@]}&#34; do gcloud projects add-iam-policy-binding ${PROJECT} \ --member=serviceAccount:${EMAIL} \ --role=${ROLE} done For the code, you’ll need to install protoc and preferably have it in your path.">

      
    
	
  </head>

  <body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-dark-blue">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        (p)retired
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l mw8 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Google Cloud Translation w/ gRPC 3 ways</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2024-04-09T00:00:00-07:00">April 9, 2024</time>
      

      
      
        <span class="f6 mv4 dib tracked"> - 6 minutes read </span>
        <span class="f6 mv4 dib tracked"> - 1077 words </span>
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h2 id="general">General</h2>
<p>You&rsquo;ll need a Google Cloud project with Cloud Translation (<code>translate.googleapis.com</code>) enabled and a Service Account (and key) with suitable permissions in order to run the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BILLING<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Billing ID (gcloud billing accounts list)</span>
</span></span><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Project ID</span>
</span></span><span style="display:flex;"><span>ACCOUNT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tester&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>EMAIL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span><span style="color:#e6db74">@</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">.iam.gserviceaccount.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ROLES<span style="color:#f92672">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/cloudtranslate.user&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;roles/serviceusage.serviceUsageConsumer&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Project</span>
</span></span><span style="display:flex;"><span>gcloud projects create <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Associate Project with your Billing Account</span>
</span></span><span style="display:flex;"><span>gcloud billing accounts link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Enable Cloud Translation</span>
</span></span><span style="display:flex;"><span>gcloud services enable translate.googleapis.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts create <span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create Service Account Key</span>
</span></span><span style="display:flex;"><span>gcloud iam service-accounts keys create <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--iam-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update Project IAM permissions</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ROLE in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ROLES[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  gcloud projects add-iam-policy-binding <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --member<span style="color:#f92672">=</span>serviceAccount:<span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>ROLE<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>For the code, you&rsquo;ll need to install <a href="https://github.com/protocolbuffers/protobuf"><code>protoc</code></a> and preferably have it in your path.</p>
<p>You&rsquo;ll also need to clone Google&rsquo;s <a href="https://github.com/googleapis/googleapis"><code>googleapis</code></a> repo. The repo contains Google&rsquo;s protobuf definitions for all its services</p>
<h2 id="grpcurl"><a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a></h2>
<p>Let&rsquo;s test a translation using a known working client:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#75715e"># Your Project ID</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Retain current default auth account</span>
</span></span><span style="display:flex;"><span>AUTH<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  gcloud config get account<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Activate the Service Account (for use with gcloud)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Side effect is to change the current auth account</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This account is associated with {EMAIL}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># We will use it to create tokens to access the service</span>
</span></span><span style="display:flex;"><span>gcloud auth activate-service-account <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--key-file<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Revert to previous default auth account</span>
</span></span><span style="display:flex;"><span>gcloud config set account <span style="color:#e6db74">${</span>AUTH<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Get a token for the service using the Service Account</span>
</span></span><span style="display:flex;"><span>TOKEN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  gcloud auth print-access-token <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GOOGLEAPIS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/googleapis&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>LOCATION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;global&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Path is &#34;translate&#34; but Package is &#34;translation&#34;</span>
</span></span><span style="display:flex;"><span>PACKAGE_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;google/cloud/translate/v3&#34;</span>
</span></span><span style="display:flex;"><span>PACKAGE_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;google.cloud.translation.v3&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SERVICE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;TranslationService&#34;</span>
</span></span><span style="display:flex;"><span>METHOD<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;TranslateText&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DATA<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    \&#34;contents\&#34;: [\&#34;The quick brown fox jumps over the lazy dog\&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    \&#34;source_language_code\&#34;: \&#34;en-US\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    \&#34;target_language_code\&#34;: \&#34;zh-CN\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    \&#34;parent\&#34;: \&#34;projects/</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">/locations/</span><span style="color:#e6db74">${</span>LOCATION<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;translate.googleapis.com:443&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>grpcurl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-H <span style="color:#e6db74">&#34;X-Goog-User-Project: </span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-H <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--import-path <span style="color:#e6db74">${</span>GOOGLEAPIS<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--proto <span style="color:#e6db74">${</span>GOOGLEAPIS<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>PACKAGE_PATH<span style="color:#e6db74">}</span>/translation_service.proto <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-d <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>DATA<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">${</span>ENDPOINT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">${</span>PACKAGE_NAME<span style="color:#e6db74">}</span>.<span style="color:#e6db74">${</span>SERVICE<span style="color:#e6db74">}</span>.<span style="color:#e6db74">${</span>METHOD<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>Yields:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;translations&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;translatedText&#34;</span>: <span style="color:#e6db74">&#34;敏捷的棕色狐狸跳过了懒狗&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="net">.NET</h2>
<p>I prefer to use .NET through a container:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Use the Service Account key with Application Default Credentials</span>
</span></span><span style="display:flex;"><span>export GOOGLE_APPLICATION_CREDENTIALS<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Folder on the host to contain the app</span>
</span></span><span style="display:flex;"><span>mkdir app
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Microsoft .NET SDK</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Mount app folder</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Mount Application Default Credentials</span>
</span></span><span style="display:flex;"><span>podman run <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--interactive --tty --rm <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/app:/app <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json:/secrets/key.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--env<span style="color:#f92672">=</span>GOOGLE_APPLICATION_CREDENTIALS<span style="color:#f92672">=</span>/secrets/key.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/app mcr.microsoft.com/dotnet/sdk:8.0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>bash
</span></span></code></pre></div><p>Google provides .NET|NuGet packages for <a href="https://www.nuget.org/packages/Google.Cloud.Translate.V3">Cloud Translate v3</a>.</p>
<p>From within the container shell:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>dotnet new console
</span></span><span style="display:flex;"><span>dotnet add package Google.Cloud.Translate.V3 --version 3.6.0
</span></span></code></pre></div><p>And then edit <code>Program.cs</code> to contain:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Google.Cloud.Translate.V3;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">string</span> project = <span style="color:#e6db74">&#34;{PROJECT}&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">string</span> location = <span style="color:#e6db74">&#34;global&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> parent = String.Format(<span style="color:#e6db74">&#34;projects/{0}/locations/{1}&#34;</span>,project,location);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> client = TranslationServiceClient.Create();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TranslateTextRequest request = <span style="color:#66d9ef">new</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Contents = {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;The quick brown fox jumps over the lazy dog&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    SourceLanguageCode = <span style="color:#e6db74">&#34;en-US&#34;</span>,
</span></span><span style="display:flex;"><span>    TargetLanguageCode = <span style="color:#e6db74">&#34;zh-CN&#34;</span>,
</span></span><span style="display:flex;"><span>    Parent = parent,
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TranslateTextResponse response = client.TranslateText(request);
</span></span><span style="display:flex;"><span>Console.WriteLine(response);
</span></span></code></pre></div><p>Then:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>dotnet run
</span></span></code></pre></div><h2 id="rust">Rust</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Use the Service Account key with Application Default Credentials</span>
</span></span><span style="display:flex;"><span>export GOOGLE_APPLICATION_CREDENTIALS<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>ACCOUNT<span style="color:#e6db74">}</span>.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cargo new --bin rust
</span></span></code></pre></div><p>Because rust&rsquo;s <a href="https://crates.io/crates/tonic-build"><code>tonic-build</code></a> uses <code>protoc</code>, it can be confusing if you don&rsquo;t have <code>protoc</code> in your PATH and wonder why code isn&rsquo;t being generated.</p>
<p><code>Cargo.toml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-TOML" data-lang="TOML"><span style="display:flex;"><span>[<span style="color:#a6e22e">package</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">name</span> = <span style="color:#e6db74">&#34;rust&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">version</span> = <span style="color:#e6db74">&#34;0.0.1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">edition</span> = <span style="color:#e6db74">&#34;2021&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#a6e22e">dependencies</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tokio</span> = { <span style="color:#a6e22e">version</span> = <span style="color:#e6db74">&#34;1.0&#34;</span>, <span style="color:#a6e22e">features</span> = [<span style="color:#e6db74">&#34;full&#34;</span>] }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">prost</span> = <span style="color:#e6db74">&#34;0.12.4&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">prost-types</span> = <span style="color:#e6db74">&#34;0.12.4&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tonic</span> = { <span style="color:#a6e22e">version</span> = <span style="color:#e6db74">&#34;0.11.0&#34;</span>, <span style="color:#a6e22e">features</span> = [<span style="color:#e6db74">&#34;tls&#34;</span>, <span style="color:#e6db74">&#34;tls-roots&#34;</span>,<span style="color:#e6db74">&#34;transport&#34;</span>] }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gcp_auth</span> = <span style="color:#e6db74">&#34;0.11.0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#a6e22e">build-dependencies</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">prost</span> = <span style="color:#e6db74">&#34;0.12.4&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tonic-build</span> = <span style="color:#e6db74">&#34;0.11.0&#34;</span>
</span></span></code></pre></div><p><code>build.rs</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::{env, path::PathBuf};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">GOOGLEAPIS</span>: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/path/to/googleapis&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() -&gt; Result<span style="color:#f92672">&lt;</span>(), Box<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">dyn</span> std::error::Error<span style="color:#f92672">&gt;&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Required by prost-reflection to create descriptors.bin in correct OUT_DIR
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> out_dir <span style="color:#f92672">=</span> PathBuf::from(env::var(<span style="color:#e6db74">&#34;OUT_DIR&#34;</span>).expect(<span style="color:#e6db74">&#34;unable to determine `OUT_DIR`&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// `file_descriptor_set_path` appends `.bin` to the file that&#39;s created
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    tonic_build::configure()
</span></span><span style="display:flex;"><span>        .build_client(<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>        .build_server(<span style="color:#66d9ef">false</span>)
</span></span><span style="display:flex;"><span>        .file_descriptor_set_path(out_dir.join(<span style="color:#e6db74">&#34;translate.bin&#34;</span>))
</span></span><span style="display:flex;"><span>        .compile(
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&amp;</span>[<span style="color:#a6e22e">format!</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">/google/cloud/translate/v3/translation_service.proto&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">$</span>{<span style="color:#66d9ef">GOOGLEAPIS</span>},
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&amp;</span>[<span style="color:#66d9ef">GOOGLEAPIS</span>],
</span></span><span style="display:flex;"><span>        )<span style="color:#f92672">?</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Ok(())
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And:
<code>client.rs</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">mod</span> google {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">mod</span> cloud {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">mod</span> translation {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">mod</span> v3 {
</span></span><span style="display:flex;"><span>                tonic::<span style="color:#a6e22e">include_proto!</span>(<span style="color:#e6db74">&#34;google.cloud.translation.v3&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">mod</span> longrunning {
</span></span><span style="display:flex;"><span>        tonic::<span style="color:#a6e22e">include_proto!</span>(<span style="color:#e6db74">&#34;google.longrunning&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">mod</span> rpc {
</span></span><span style="display:flex;"><span>        tonic::<span style="color:#a6e22e">include_proto!</span>(<span style="color:#e6db74">&#34;google.rpc&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> gcp_auth::AuthenticationManager;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> google::cloud::translation::v3::{
</span></span><span style="display:flex;"><span>    translation_service_client::TranslationServiceClient, TranslateTextRequest,
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::{collections::HashMap, env};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> tonic::{
</span></span><span style="display:flex;"><span>    metadata::MetadataValue,
</span></span><span style="display:flex;"><span>    transport::{channel::ClientTlsConfig, Channel},
</span></span><span style="display:flex;"><span>    Request,
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">URL</span>: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://translate.googleapis.com:443&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">CLOUD_PLATFORM</span>: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://www.googleapis.com/auth/cloud-platform&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#[tokio::main]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() -&gt; Result<span style="color:#f92672">&lt;</span>(), Box<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">dyn</span> std::error::Error<span style="color:#f92672">&gt;&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> _ <span style="color:#f92672">=</span> env::var(<span style="color:#e6db74">&#34;GOOGLE_APPLICATION_CREDENTIALS&#34;</span>)
</span></span><span style="display:flex;"><span>        .expect(<span style="color:#e6db74">&#34;expected GOOGLE_APPLICATION_CREDENTIALS in environment&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> project <span style="color:#f92672">=</span> env::var(<span style="color:#e6db74">&#34;PROJECT&#34;</span>)
</span></span><span style="display:flex;"><span>        .expect(<span style="color:#e6db74">&#34;expected PROJECT in environment&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> location <span style="color:#f92672">=</span> env::var(<span style="color:#e6db74">&#34;LOCATION&#34;</span>)
</span></span><span style="display:flex;"><span>        .unwrap_or_else(<span style="color:#f92672">|</span>_<span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;global&#34;</span>.to_string());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> uri: <span style="color:#a6e22e">tonic</span>::transport::Uri <span style="color:#f92672">=</span> <span style="color:#66d9ef">URL</span>
</span></span><span style="display:flex;"><span>        .parse()
</span></span><span style="display:flex;"><span>        .expect(<span style="color:#e6db74">&#34;valid gRPC URL&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> config <span style="color:#f92672">=</span> ClientTlsConfig::new();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> endpoint <span style="color:#f92672">=</span> Channel::builder(uri)
</span></span><span style="display:flex;"><span>        .tls_config(config)
</span></span><span style="display:flex;"><span>        .expect(<span style="color:#e6db74">&#34;unable to configure TLS&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> channel <span style="color:#f92672">=</span> endpoint
</span></span><span style="display:flex;"><span>        .connect()
</span></span><span style="display:flex;"><span>        .<span style="color:#66d9ef">await</span>
</span></span><span style="display:flex;"><span>        .expect(<span style="color:#e6db74">&#34;Unable to connect&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> authentication_manager <span style="color:#f92672">=</span> AuthenticationManager::new().<span style="color:#66d9ef">await</span><span style="color:#f92672">?</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> scopes <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>[<span style="color:#66d9ef">CLOUD_PLATFORM</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> token <span style="color:#f92672">=</span> authentication_manager.get_token(scopes).<span style="color:#66d9ef">await</span><span style="color:#f92672">?</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> token: <span style="color:#a6e22e">MetadataValue</span><span style="color:#f92672">&lt;</span>_<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">format!</span>(<span style="color:#e6db74">&#34;Bearer </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span>, token.as_str())
</span></span><span style="display:flex;"><span>        .parse()
</span></span><span style="display:flex;"><span>        .expect(<span style="color:#e6db74">&#34;unable to parse token&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> client <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        TranslationServiceClient::with_interceptor(channel, <span style="color:#66d9ef">move</span> <span style="color:#f92672">|</span><span style="color:#66d9ef">mut</span> req: <span style="color:#a6e22e">Request</span><span style="color:#f92672">&lt;</span>()<span style="color:#f92672">&gt;|</span> {
</span></span><span style="display:flex;"><span>            req.metadata_mut().insert(<span style="color:#e6db74">&#34;authorization&#34;</span>, token.clone());
</span></span><span style="display:flex;"><span>            Ok(req)
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> parent <span style="color:#f92672">=</span> <span style="color:#a6e22e">format!</span>(<span style="color:#e6db74">&#34;projects/</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">/locations/</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span>, project, location);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> msg <span style="color:#f92672">=</span> TranslateTextRequest {
</span></span><span style="display:flex;"><span>        contents: <span style="color:#a6e22e">vec</span><span style="color:#f92672">!</span>[<span style="color:#e6db74">&#34;The quick brown fox jumps over the lazy dog&#34;</span>.to_owned()],
</span></span><span style="display:flex;"><span>        mime_type: <span style="color:#e6db74">&#34;&#34;</span>.to_owned(),
</span></span><span style="display:flex;"><span>        source_language_code: <span style="color:#e6db74">&#34;en-US&#34;</span>.to_owned(),
</span></span><span style="display:flex;"><span>        target_language_code: <span style="color:#e6db74">&#34;zh-CN&#34;</span>.to_owned(),
</span></span><span style="display:flex;"><span>        parent: <span style="color:#a6e22e">parent</span>,
</span></span><span style="display:flex;"><span>        model: <span style="color:#e6db74">&#34;&#34;</span>.to_owned(),
</span></span><span style="display:flex;"><span>        glossary_config: None,
</span></span><span style="display:flex;"><span>        labels: <span style="color:#a6e22e">HashMap</span>::new(),
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> request <span style="color:#f92672">=</span> tonic::Request::new(msg);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> response <span style="color:#f92672">=</span> client.translate_text(request).<span style="color:#66d9ef">await</span><span style="color:#f92672">?</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> message <span style="color:#f92672">=</span> response.get_ref();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    message.translations.iter().for_each(<span style="color:#f92672">|</span>translation<span style="color:#f92672">|</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">println!</span>(<span style="color:#e6db74">&#34;Translated text: </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span>, translation.translated_text);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Ok(())
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="golang">Golang</h2>
<p>For Go, we can use the Google-generated <a href="https://pkg.go.dev/cloud.google.com/go/translate">sources</a> for Cloud Translation:</p>
<p><code>go.mod</code>:</p>
<pre tabindex="0"><code>module golang

go 1.22.0

require (
	cloud.google.com/go/translate v1.10.2
	golang.org/x/oauth2 v0.17.0
	google.golang.org/grpc v1.62.1
)
</code></pre><p>And:
<code>main.go</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;crypto/tls&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;flag&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log/slog&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">pb</span> <span style="color:#e6db74">&#34;cloud.google.com/go/translate/apiv3/translatepb&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;golang.org/x/oauth2/google&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/grpc&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/grpc/credentials&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;google.golang.org/grpc/credentials/oauth&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">endpoint</span> = <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;endpoint&#34;</span>, <span style="color:#e6db74">&#34;translate.googleapis.com:443&#34;</span>, <span style="color:#e6db74">&#34;Endpoint of Google Translate service&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">project</span> <span style="color:#66d9ef">string</span> = <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;PROJECT&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">location</span> <span style="color:#66d9ef">string</span> = <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;LOCATION&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Parse</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">parent</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;projects/%s/locations/%s&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">project</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">location</span>,
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">message</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pb</span>.<span style="color:#a6e22e">TranslateTextRequest</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Contents</span>: []<span style="color:#66d9ef">string</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;The quick brown fox jumps over the lazy dog&#34;</span>,
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">MimeType</span>:           <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">SourceLanguageCode</span>: <span style="color:#e6db74">&#34;en-US&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">TargetLanguageCode</span>: <span style="color:#e6db74">&#34;zh-CN&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Parent</span>:             <span style="color:#a6e22e">parent</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Model</span>:              <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">GlossaryConfig</span>:     <span style="color:#66d9ef">nil</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Labels</span>:             <span style="color:#66d9ef">nil</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">scopes</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;https://www.googleapis.com/auth/cloud-platform&#34;</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">tokensource</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">DefaultTokenSource</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">scopes</span><span style="color:#f92672">...</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;unable to create DefaultTokenSource&#34;</span>, <span style="color:#e6db74">&#34;err&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Exit</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">grpc</span>.<span style="color:#a6e22e">Dial</span>(
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">*</span><span style="color:#a6e22e">endpoint</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">grpc</span>.<span style="color:#a6e22e">WithTransportCredentials</span>(
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">credentials</span>.<span style="color:#a6e22e">NewTLS</span>(
</span></span><span style="display:flex;"><span>				<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">tls</span>.<span style="color:#a6e22e">Config</span>{
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">InsecureSkipVerify</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>				},
</span></span><span style="display:flex;"><span>			),
</span></span><span style="display:flex;"><span>		),
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">grpc</span>.<span style="color:#a6e22e">WithPerRPCCredentials</span>(
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">oauth</span>.<span style="color:#a6e22e">TokenSource</span>{
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">TokenSource</span>: <span style="color:#a6e22e">tokensource</span>,
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>		),
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;unable to dial&#34;</span>, <span style="color:#e6db74">&#34;err&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">pb</span>.<span style="color:#a6e22e">NewTranslationServiceClient</span>(<span style="color:#a6e22e">conn</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">cancel</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">WithTimeout</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>,
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">cancel</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">resp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">TranslateText</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">message</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#e6db74">&#34;failed to call TranslateText&#34;</span>, <span style="color:#e6db74">&#34;err&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">translation</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">Translations</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">slog</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Translation&#34;</span>, <span style="color:#e6db74">&#34;text&#34;</span>, <span style="color:#a6e22e">translation</span>.<span style="color:#a6e22e">TranslatedText</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="tidy">Tidy</h2>
<p>You may want to revoke the Service Account&rsquo;s credentials when you&rsquo;re done:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud auth revoke <span style="color:#e6db74">${</span>EMAIL<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>And delete the Project if you&rsquo;re certain that you no longer need it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud auth delete projects <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> --quiet
</span></span></code></pre></div><ul class="pa0">
  
   <li class="list di">
     <a href="/tags/google/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Google</a>
   </li>
  
   <li class="list di">
     <a href="/tags/translation/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Translation</a>
   </li>
  
   <li class="list di">
     <a href="/tags/grpc/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">GRPC</a>
   </li>
  
   <li class="list di">
     <a href="/tags/grpcurl/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">GRPCurl</a>
   </li>
  
   <li class="list di">
     <a href="/tags/rust/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Rust</a>
   </li>
  
   <li class="list di">
     <a href="/tags/golang/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Golang</a>
   </li>
  
   <li class="list di">
     <a href="/tags/dotnet/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Dotnet</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/posts/200325/">gRPC, Cloud Run &amp; Endpoints</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/200403/">Rust Crate Transparency &amp;&amp; Rust SDK for Google Trillian</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/200326/">Google Trillian on Cloud Run</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/200320/">Golang gRPC Cloud Run</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/240405/">Google Cloud Events protobufs and SDKs</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/231222/">Listing Cloud Logging log-based metrics using gRPC</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/230314/">Access Google Services using gRPC</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/221128/">Maintaining Container Images</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/221117/">Delegate domain-wide authority using Golang</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/201113/">Akri</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/200817/">WASM Transparency</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/200807/">waPC and MsgPack (Rust|Golang)</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/240325/">Prost! Tonic w/ a dash of JSON</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/240307/">Prometheus Protobufs and Native Histograms</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/240130/">Navigating Koyeb&#39;s API with Rust</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-dark-blue bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://pretired.dazwilkin.com/" >
    &copy;  (p)retired 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>