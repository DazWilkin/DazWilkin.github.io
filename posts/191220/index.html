<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>(p)retired  | Google Cloud Platform (GCP) Exporter</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.61.0-DEV" />
    
    
      <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="Google Cloud Platform (GCP) Exporter" />
<meta property="og:description" content="Earlier this week I discussed a Linode Prometheus Exporter.
I added metrics for Digital Ocean&#39;s Managed Kubernetes service to @metalmatze&lsquo;s Digital Ocean Exporter.
This left, metrics for Google Cloud Platform (GCP) which has, for many years, been my primary cloud platform. So, today I wrote Prometheus Exporter for Google Cloud Platform.
All 3 of these exporters follow the template laid down by @metalmatze and, because each of these services has a well-written Golang SDK, it&#39;s straightforward to implement an exporter for each of them." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://pretired.dazwilkin.com/posts/191220/" />
<meta property="article:published_time" content="2019-12-20T00:00:00-07:00" />
<meta property="article:modified_time" content="2019-12-20T00:00:00-07:00" />
<meta itemprop="name" content="Google Cloud Platform (GCP) Exporter">
<meta itemprop="description" content="Earlier this week I discussed a Linode Prometheus Exporter.
I added metrics for Digital Ocean&#39;s Managed Kubernetes service to @metalmatze&lsquo;s Digital Ocean Exporter.
This left, metrics for Google Cloud Platform (GCP) which has, for many years, been my primary cloud platform. So, today I wrote Prometheus Exporter for Google Cloud Platform.
All 3 of these exporters follow the template laid down by @metalmatze and, because each of these services has a well-written Golang SDK, it&#39;s straightforward to implement an exporter for each of them.">
<meta itemprop="datePublished" content="2019-12-20T00:00:00-07:00" />
<meta itemprop="dateModified" content="2019-12-20T00:00:00-07:00" />
<meta itemprop="wordCount" content="482">



<meta itemprop="keywords" content="Golang,Prometheus&#34;,GCP,Kubernetes Engine,Compute Engine," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Google Cloud Platform (GCP) Exporter"/>
<meta name="twitter:description" content="Earlier this week I discussed a Linode Prometheus Exporter.
I added metrics for Digital Ocean&#39;s Managed Kubernetes service to @metalmatze&lsquo;s Digital Ocean Exporter.
This left, metrics for Google Cloud Platform (GCP) which has, for many years, been my primary cloud platform. So, today I wrote Prometheus Exporter for Google Cloud Platform.
All 3 of these exporters follow the template laid down by @metalmatze and, because each of these services has a well-written Golang SDK, it&#39;s straightforward to implement an exporter for each of them."/>

      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-148669951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
  </head>

  <body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://pretired.dazwilkin.com/" class="f3 fw2 hover-white no-underline white-90 dib">
      (p)retired
    </a>
    <div class="flex-l items-center">
      

      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Google Cloud Platform (GCP) Exporter</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2019-12-20T00:00:00-07:00">December 20, 2019</time>
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Earlier this week I discussed a <a href="https://pretired.dazwilkin.com/posts/191218/">Linode Prometheus Exporter</a>.</p>
<p>I <a href="https://github.com/metalmatze/digitalocean_exporter/pull/5">added</a> metrics for <a href="https://www.digitalocean.com/products/kubernetes/">Digital Ocean's Managed Kubernetes service</a> to <a href="https://github.com/metalmatze">@metalmatze</a>&lsquo;s <a href="https://github.com/metalmatze/digitalocean_exporter">Digital Ocean Exporter</a>.</p>
<p>This left, metrics for <a href="https://cloud.google.com">Google Cloud Platform (GCP)</a> which has, for many years, been my primary cloud platform. So, today I wrote <a href="https://github.com/DazWilkin/gcp-exporter">Prometheus Exporter for Google Cloud Platform</a>.</p>
<p>All 3 of these exporters follow the template laid down by @metalmatze and, because each of these services has a well-written Golang SDK, it's straightforward to implement an exporter for each of them.</p>
<p>The Google Cloud Platform exporter is described in the <a href="https://github.com/DazWilkin/gcp-exporter/blob/master/README.md">README</a>.</p>
<p>My primary service on all of these platforms is Kubernetes and so, for GCP, my first Collector was for Kubernetes Engine. Because of the dependency Kubernetes Engine has on Compute Engine (instances, load-balancers etc.), I've implemented some metrics for Compute Engine too. The other service that shows up on my GCP bills (very cheaply!) is Cloud Storage and so that's the 3rd Collector in the Exporter. As always, if there's another service that you want added, please submit an issue and, if you're willing, a PR :-)</p>
<p>One&hellip; frustration with GCP's Golang SDKs is that Google has not yet fully implemented the current-generation so-called Cloud Client Libraries in Golang for all of the platform's services. The biggest omission, is Compute Engine itself. In order to stay consistent, I've defaulted to use the older API Client Libraries for Kubernetes Engine, Compute Engine and Cloud Storage.</p>
<p>It is possible for a Google account to have access to many-many GCP projects and for each project to have access to many-many e.g. Compute Engine instances. To ensure that the Exporter completes and that it covers the majority of use-cases, by default the Exporter will only produce metrics for 10 projects (adjusted using the flag <code>--max_projects</code>). Similarly, if a project contains more than 500 instances, metrics will only be produced for 500 instances. This includes instance counts being limited to 500.</p>
<p>The Exporter also uses Google's (excellent) <a href="https://cloud.google.com/docs/authentication/production#finding_credentials_automatically">Application Default Credentials</a>. This simplifies code through a mechanism by attempting to find relevant authentication credentials. Generally, for a proces such as the Exporter, it should run under a (non-human) service account. However, because it's likely that users of the Exporter will want the Exporter to gather metrics for their perception of GCP, the documentation explains using <code>gcloud auth application-default login</code> as a mechanism to create ADCs for a user's (human) Google (e.g. Gmail) account.</p>
<p>As with the other Exporters. The goal here is to develop a consistent approach to monitoring multiple cloud services platforms to be able to determine if I leave resources (e.g. Kubernetes clusters) running unintentionally. The Exporters are scraped by Prometheus and alerting rules are defined that fire when I leave clusters (and instances) running for too long. AlertManager receives the alerts and, in my case, sends me a Gmail. Hopefully (!) I am then in a position to delete redundant resources.</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/golang" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Golang</a>
   </li>
  
   <li class="list">
     <a href="/tags/prometheus" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Prometheus&#34;</a>
   </li>
  
   <li class="list">
     <a href="/tags/gcp" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">GCP</a>
   </li>
  
   <li class="list">
     <a href="/tags/kubernetes-engine" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Kubernetes Engine</a>
   </li>
  
   <li class="list">
     <a href="/tags/compute-engine" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Compute Engine</a>
   </li>
  
</ul>
<div class="mt6">
      
      
      </div>
    </section>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/posts/191218/">Linode Prometheus Exporter</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/190924/">Kubernetes Engine and Free Tier</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://pretired.dazwilkin.com/" >
    &copy; 2019 (p)retired
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
