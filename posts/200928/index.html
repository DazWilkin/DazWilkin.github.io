<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  
  <title>Rube Goldberg Cloud Build machine for solving Quadratic equations | (p)retired</title>
  <meta name="viewport" content="width=device-width,minimum-scale=1">
  <meta name="description"
    content="A Rube Goldberg machine for Google Cloud Build that solves quadratic equations">
  <meta name="generator" content="Hugo 0.80.0" />
  
  
  <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
  

  
  
  <link href="/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css" rel="stylesheet">
  

  

  
  

  

  

  <link href="https://us-central1-webmention.cloudfunctions.net/webmention" rel="webmention" />

  <meta property="og:title" content="Rube Goldberg Cloud Build machine for solving Quadratic equations" />
<meta property="og:description" content="A Rube Goldberg machine for Google Cloud Build that solves quadratic equations" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://pretired.dazwilkin.com/posts/200928/" />
<meta property="article:published_time" content="2020-09-28T00:00:00-07:00" />
<meta property="article:modified_time" content="2020-09-28T00:00:00-07:00" />
<meta itemprop="name" content="Rube Goldberg Cloud Build machine for solving Quadratic equations">
<meta itemprop="description" content="A Rube Goldberg machine for Google Cloud Build that solves quadratic equations">
<meta itemprop="datePublished" content="2020-09-28T00:00:00-07:00" />
<meta itemprop="dateModified" content="2020-09-28T00:00:00-07:00" />
<meta itemprop="wordCount" content="2117">



<meta itemprop="keywords" content="Cloud Build," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Rube Goldberg Cloud Build machine for solving Quadratic equations"/>
<meta name="twitter:description" content="A Rube Goldberg machine for Google Cloud Build that solves quadratic equations"/>

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-148669951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  
  
</head>

<body
  class="ma0 avenir bg-near-white production">

  
   
  

  <header>
    <div class="bg-dark-blue">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        (p)retired
      
    </a>
    <div class="flex-l items-center">
      

      
      


<a href="https://stackoverflow.com/users/609290/dazwilkin" target="_blank" class="link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Stack Overflow link" rel="noopener" aria-label="follow on Stack Overflowâ€”â€”Opens in a new window">
  <svg height="32px" 
    style="enable-background:new 0 0 67 67;"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    width="32px"
>
    <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm.869 5.903l3.114 4.567-.975.665-3.115-4.567.976-.665zm-2.812 2.585l4.84 2.838-.6 1.017-4.842-2.838.602-1.017zm-1.276 2.724l5.413 1.521-.291 1.077-5.428-1.458.306-1.14zm-.588 2.461l5.687.569-.103 1.12-5.691-.513.107-1.176zm-.169 2.16h5.835v1.167h-5.835v-1.167zm7.976 3.167h-10v-6h1v5h8v-5h1v6zm.195-8.602l-.945-5.446 1.162-.202.947 5.446-1.164.202z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>






<a href="https://www.linkedin.com/in/dazwilkin/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedInâ€”â€”Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://github.com/DazWilkin" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Githubâ€”â€”Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>




<a href="https://medium.com/@DazWilkin" target="_blank" class="link-transition medium link dib z-999 pt3 pt0-l mr1" title="Medium link" rel="noopener" aria-label="follow on Mediumâ€”â€”Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 170 170;" version="1.1" viewBox="0 0 170 170" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M46.5340803,65.2157554 C46.6968378,63.6076572 46.0836,62.018231 44.8828198,60.93592 L32.6512605,46.2010582 L32.6512605,44 L70.6302521,44 L99.9859944,108.380952 L125.794585,44 L162,44 L162,46.2010582 L151.542017,56.2281011 C150.640424,56.9153477 150.193188,58.0448862 150.380019,59.1628454 L150.380019,132.837155 C150.193188,133.955114 150.640424,135.084652 151.542017,135.771899 L161.755369,145.798942 L161.755369,148 L110.38282,148 L110.38282,145.798942 L120.963119,135.527337 C122.002801,134.487948 122.002801,134.182246 122.002801,132.592593 L122.002801,73.0417402 L92.585901,147.755438 L88.6106443,147.755438 L54.3622782,73.0417402 L54.3622782,123.115814 C54.0767278,125.221069 54.7759199,127.3406 56.2581699,128.863022 L70.0186741,145.55438 L70.0186741,147.755438 L31,147.755438 L31,145.55438 L44.7605042,128.863022 C46.2319621,127.338076 46.8903838,125.204485 46.5340803,123.115814 L46.5340803,65.2157554 Z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>





    </div>
  </div>
</nav>

    </div>
  </header>



  <main class="pb7" role="main">
    
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://pretired.dazwilkin.com/posts/200928/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://pretired.dazwilkin.com/posts/200928/&amp;text=Rube%20Goldberg%20Cloud%20Build%20machine%20for%20solving%20Quadratic%20equations" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://pretired.dazwilkin.com/posts/200928/&amp;title=Rube%20Goldberg%20Cloud%20Build%20machine%20for%20solving%20Quadratic%20equations" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Rube Goldberg Cloud Build machine for solving Quadratic equations</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2020-09-28T00:00:00-07:00">September 28, 2020</time>

      
      
        <span class="f6 mv4 dib tracked"> - 10 minutes read</span>
        <span class="f6 mv4 dib tracked"> - 2117 words</span>
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Google <a href="https://cloud.google.com/cloud-build/docs/build-config">Cloud Build</a> is described by Google as a &ldquo;CI/CD platform&rdquo; but it&rsquo;s fundamentally a service that permits a series of containers to be chained together in a pipeline, optionally leveraging shared data.</p>
<p>As a CI/CD platform, it can be used to lint, test, compile and build software but, if you were looking for a way to explain its basic awesomeness, you could&hellip; I don&rsquo;t know&hellip; build a Rube Goldberg style machine that solves Quadratic equations using it ðŸ˜„</p>
<p>As many schoolchildren know, quadratic equations can always be solved using the <a href="https://en.wikipedia.org/wiki/Quadratic_formula">Quadratic formula</a>. This solves equations of the form <code>axÂ²+bx+c=0</code> and provides at most 2 roots.</p>
<blockquote>
<p><strong>NOTE</strong> what follows should not be used as a production solution for solving Equdratic equations</p>
</blockquote>
<blockquote>
<p><strong>NOTE</strong> if you&rsquo;re allergic to Quadratic equations, don&rsquo;t use this solution.</p>
</blockquote>
<blockquote>
<p><strong>NOTE</strong> This solutoin contains no (!) error handling</p>
</blockquote>
<p>We&rsquo;re going to use bash and <a href="https://www.gnu.org/software/bc/manual/html_mono/bc.html">bc</a>.</p>
<p>This calculation could be performed very simply but there would be no fun in that. We&rsquo;re not trying to find the simplest solution, remember.</p>
<p>For convenience &ndash; I&rsquo;ll explain more about this below &ndash; we will use 3 files (<code>a</code>,<code>b</code>,<code>c</code>) to hold the values from the formula.</p>
<p>E.g. for <code>8xÂ²-10x+3=0</code>, we&rsquo;ll use:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">echo <span style="color:#e6db74">&#34;8&#34;</span> &gt; a
echo <span style="color:#e6db74">&#34;-10&#34;</span> &gt; b
echo <span style="color:#e6db74">&#34;3&#34;</span> &gt; c
</code></pre></div><p>We can output the equation using:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">echo <span style="color:#e6db74">&#34;Quadratic: </span><span style="color:#66d9ef">$(</span>cat a<span style="color:#66d9ef">)</span><span style="color:#e6db74">xÂ²+</span><span style="color:#66d9ef">$(</span>cat b<span style="color:#66d9ef">)</span><span style="color:#e6db74">x+</span><span style="color:#66d9ef">$(</span>cat c<span style="color:#66d9ef">)</span><span style="color:#e6db74">s=0&#34;</span>
</code></pre></div><blockquote>
<p><strong>NOTE</strong> bonus point if you wish to replace the static <code>+</code> with <code>-</code> for negative values of <code>b</code> and <code>c</code></p>
</blockquote>
<p>There are other ways to achieve this result in bash that may be more elegant or efficient but, for simplicity and consistency, we&rsquo;ll use <code>echo</code> throughout</p>
<p>Then, rather than calculate the roots in a single step, we&rsquo;ll perform each constituent calculation in its own step, outputting these, intermediate results to a file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
echo <span style="color:#e6db74">&#34;Quadratic: </span><span style="color:#66d9ef">$(</span>cat a<span style="color:#66d9ef">)</span><span style="color:#e6db74">xÂ²+</span><span style="color:#66d9ef">$(</span>cat b<span style="color:#66d9ef">)</span><span style="color:#e6db74">x+</span><span style="color:#66d9ef">$(</span>cat c<span style="color:#66d9ef">)</span><span style="color:#e6db74">s=0&#34;</span>

echo <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>cat b<span style="color:#66d9ef">)</span><span style="color:#e6db74"> * </span><span style="color:#66d9ef">$(</span>cat b<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> | bc -l &gt; b2
echo <span style="color:#e6db74">&#34;4 * </span><span style="color:#66d9ef">$(</span>cat a<span style="color:#66d9ef">)</span><span style="color:#e6db74"> * </span><span style="color:#66d9ef">$(</span>cat c<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> | bc -l &gt; 4ac
echo <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>cat b2<span style="color:#66d9ef">)</span><span style="color:#e6db74"> - </span><span style="color:#66d9ef">$(</span>cat 4ac<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> | bc -l &gt; b2-4ac

rm b2 4ac

echo <span style="color:#e6db74">&#34;sqrt(</span><span style="color:#66d9ef">$(</span>cat b2-4ac<span style="color:#66d9ef">)</span><span style="color:#e6db74">)&#34;</span> | bc -l &gt; sqrt

rm b2-4ac

echo <span style="color:#e6db74">&#34;-(</span><span style="color:#66d9ef">$(</span>cat b<span style="color:#66d9ef">)</span><span style="color:#e6db74">)+</span><span style="color:#66d9ef">$(</span>cat sqrt<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> | bc -l &gt; add
echo <span style="color:#e6db74">&#34;-(</span><span style="color:#66d9ef">$(</span>cat b<span style="color:#66d9ef">)</span><span style="color:#e6db74">)-</span><span style="color:#66d9ef">$(</span>cat sqrt<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> | bc -l &gt; sub

rm sqrt

echo <span style="color:#e6db74">&#34;2 * </span><span style="color:#66d9ef">$(</span>cat a<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> | bc -l &gt; 2a

echo <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>cat add<span style="color:#66d9ef">)</span><span style="color:#e6db74">/</span><span style="color:#66d9ef">$(</span>cat 2a<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> | bc -l &gt; root1
echo <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>cat sub<span style="color:#66d9ef">)</span><span style="color:#e6db74">/</span><span style="color:#66d9ef">$(</span>cat 2a<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> | bc -l &gt; root2

rm 2a add sub

<span style="color:#75715e"># Complete</span>
echo <span style="color:#e6db74">&#34;Roots are: </span><span style="color:#66d9ef">$(</span>cat root1<span style="color:#66d9ef">)</span><span style="color:#e6db74">; </span><span style="color:#66d9ef">$(</span>cat root2<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>

rm root1 root2
</code></pre></div><p>After creating the files <code>a</code>,<code>b</code> and <code>c</code>, you could simply paste the script above into your shell to produce the result:</p>
<pre><code class="language-console" data-lang="console">Roots are: .75000000000000000000; .50000000000000000000
</code></pre><p>OK, so we have our calculator, how do we transform this into a Cloud Build configuration file?</p>
<p>Using Cloud Build, each step (<code>echo ...</code>, <code>rm ...</code>) in our calculation becomes a step in the Cloud Build process. Each step corresponds to the use of some container image. Any container image may be used by Cloud Build (as long the image is accessible to the service) and, when run, the container may be configured with arguments, working directory etc.</p>
<p>Behind the scenes, Cloud Build creates a VM for our job and it runs the containers (per the configuration file) in this VM. But, from where does it get data that it requires? The data may come from anywhere that a container image can acquire the data. A container could do an HTTP get, it could query a SQL database, another cloud service &hellip;. anything.</p>
<p>But, there&rsquo;s a unique location for data in Cloud Build that corresponds to the VM&rsquo;s filing system and a unique location in that filing system called <code>/workspace</code>. The <code>/workspace</code> directory receives source files that you designate when you trigger a build with <code>gcloud builds submit ..</code> (or equivalent) <strong>and</strong> by default, each step mounts <code>/workspace</code> as the container&rsquo;s working directory.</p>
<p>The latter is similar to assuming that every step does something of the form:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span>/workspace:/workspace some-image <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>...
</code></pre></div><p>This is important because the filing system is the only location within the build process where you can persist data.</p>
<p>You may read data from environment variables but environment variable updates will <strong>not</strong> persist across Cloud Build steps.</p>
<p>You may read and write data to arbitrary out-of-process locations e.g. via an API, SQL database etc.</p>
<p>What does this mean for our Rube Goldberg calculator? It means that we will recreate our inputs (<code>a</code>,<code>b</code> and <code>c</code>) automatically in Cloud Build when we perform the <code>gcloud builds submit ...</code> by including <code>${PWD}</code> or (more succinctly) <code>.</code>, i.e. <code>gcloud builds submit ${PWD} ...</code> and it means we can create files corresponding to the intermediate steps as a way to persist these values through the steps of the calculation.</p>
<p>Let&rsquo;s create a local (not Cloud Build) bash script that uses Docker images for each of our steps:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;echo &#34;Quadratic: $(cat a)xÂ²+$(cat b)x+$(cat c)s=0&#34;&#39;</span>

docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;echo &#34;$(cat b) * $(cat b)&#34; | bc -l &gt; b2&#39;</span>

docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;echo &#34;4 * $(cat a) * $(cat c)&#34; | bc -l &gt; 4ac&#39;</span>

docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;echo &#34;$(cat b2) - $(cat 4ac)&#34; | bc -l &gt; b2-4ac&#39;</span>

docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;rm b2 4ac&#39;</span>

docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;echo &#34;sqrt($(cat b2-4ac))&#34; | bc -l &gt; sqrt&#39;</span>

docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;rm b2-4ac&#39;</span>

docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;echo &#34;-($(cat b))+$(cat sqrt)&#34; | bc -l &gt; add&#39;</span>

docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;echo &#34;-($(cat b))-$(cat sqrt)&#34; | bc -l &gt; sub&#39;</span>

docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;rm sqrt&#39;</span>

docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;echo &#34;2 * $(cat a)&#34; | bc -l &gt; 2a&#39;</span>

docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;echo &#34;$(cat add)/$(cat 2a)&#34; | bc -l &gt; root1&#39;</span>

docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;echo &#34;$(cat sub)/$(cat 2a)&#34; | bc -l &gt; root2&#39;</span>

docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;rm 2a add sub&#39;</span>

<span style="color:#75715e"># Complete</span>
docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;echo &#34;Roots are: $(cat root1); $(cat root2)&#34;&#39;</span>

docker run <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--volume<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>:/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--workdir<span style="color:#f92672">=</span>/workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>busybox ash -c <span style="color:#e6db74">&#39;rm root1 root2&#39;</span>
</code></pre></div><p>As before, you should be able to paste these commands into your shell to calculate the roots.</p>
<p>We&rsquo;re using <code>busybox</code> here as a small container image that includes many useful Linux utilities including <code>bc</code>.</p>
<p>You should see the same <code>bc</code> commands as before.</p>
<p>The only other addition is the use of <code>--workdir=/workspace</code> and <code>--volume=${PWD}:/workspace</code>. The volume flag mounts the current directory (<code>{PWD}</code>) into each container&rsquo;s <code>/workspace</code> directory. The workdir flag makes <code>/workspace</code> the working directory for the containers. Effectively, these 2 flags resemble the behavior of steps in the Cloud Build service.</p>
<p>OK, we&rsquo;re now ready to try our calculator on Cloud Build. You should (!) be able to run the following commands <strong>without</strong> incurring a bill along as you use less than 120-minutes of Cloud Build per day (<a href="https://cloud.google.com/cloud-build/pricing">link</a>). This is because Cloud Build is included as part of Google&rsquo;s <a href="https://cloud.google.com/free">Free Tier</a>.</p>
<p>First we&rsquo;ll create a project, enable billing (required), and enable Cloud Build:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">PROJECT<span style="color:#f92672">=[[</span>YOUR-PROJECT<span style="color:#f92672">]]</span>
BILLING<span style="color:#f92672">=[[</span>YOUR-BILLING<span style="color:#f92672">]]</span>

gcloud projects create <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>

gcloud beta billing projects link <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--billing-account<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>BILLING<span style="color:#e6db74">}</span>

gcloud services enable cloudbuild.googleapis.com <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</code></pre></div><blockquote>
<p><strong>NOTE</strong> To get your billing account, you can <code>BILLING=$(gcloud alpha billing accounts list --format=&quot;value(name)&quot;)</code></p>
</blockquote>
<p>Then we can create our <code>cloudbuild.yaml</code> file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-YAML" data-lang="YAML"><span style="color:#f92672">steps</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#39;echo &#34;Quadratic: $(cat a)xÂ²+$(cat b)x+$(cat c)s=0&#34;&#39;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#39;echo &#34;$(cat b) * $(cat b)&#34; | bc -l &gt; b2&#39;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#39;echo &#34;4 * $(cat a) * $(cat c)&#34; | bc -l &gt; 4ac&#39;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#39;echo &#34;$(cat b2) - $(cat 4ac)&#34; | bc -l &gt; b2-4ac&#39;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#34;rm b2 4ac&#34;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#39;echo &#34;sqrt($(cat b2-4ac))&#34; | bc -l &gt; sqrt&#39;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#34;rm b2-4ac&#34;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#39;echo &#34;-($(cat b)) + $(cat sqrt)&#34; | bc -l &gt; add&#39;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#39;echo &#34;-($(cat b)) - $(cat sqrt)&#34; | bc -l &gt; sub&#39;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#34;rm sqrt&#34;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#39;echo &#34;2 * $(cat a)&#34; | bc -l &gt; 2a&#39;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#39;echo &#34;$(cat add)/$(cat 2a)&#34; | bc -l &gt; root1&#39;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#39;echo &#34;$(cat sub)/$(cat 2a)&#34; | bc -l &gt; root2&#39;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#34;rm 2a add sub&#34;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#39;echo &#34;Roots are: $(cat root1); $(cat root2)&#34;&#39;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">args</span>:
      - <span style="color:#ae81ff">ash</span>
      - -<span style="color:#ae81ff">c</span>
      - <span style="color:#e6db74">&#34;rm root1 root2&#34;</span>
</code></pre></div><p>And then we can submit the calculation.</p>
<p>Don&rsquo;t forget to create <code>a</code>, <code>b</code> and <code>c</code> in your hosts current working directory:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">gcloud builds submit <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--config<span style="color:#f92672">=</span>./cloudbuild.yaml <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</code></pre></div><p>For me, this yields:</p>
<pre><code class="language-console" data-lang="console">BUILD
Starting Step #0
Step #0: Pulling image: busybox
Step #0: Using default tag: latest
Step #0: latest: Pulling from library/busybox
Step #0: Digest: sha256:2ca5e69e...
Step #0: Status: Downloaded newer image for busybox:latest
Step #0: docker.io/library/busybox:latest
Step #0: Quadratic: 8xÂ²+-10x+3s=0
Finished Step #0
Starting Step #1
Step #1: Already have image: busybox
Finished Step #1
Starting Step #2
Step #2: Already have image: busybox
Finished Step #2
Starting Step #3
Step #3: Already have image: busybox
Finished Step #3
Starting Step #4
Step #4: Already have image: busybox
Finished Step #4
Starting Step #5
Step #5: Already have image: busybox
Finished Step #5
Starting Step #6
Step #6: Already have image: busybox
Finished Step #6
Starting Step #7
Step #7: Already have image: busybox
Finished Step #7
Starting Step #8
Step #8: Already have image: busybox
Finished Step #8
Starting Step #9
Step #9: Already have image: busybox
Finished Step #9
Starting Step #10
Step #10: Already have image: busybox
Finished Step #10
Starting Step #11
Step #11: Already have image: busybox
Finished Step #11
Starting Step #12
Step #12: Already have image: busybox
Finished Step #12
Starting Step #13
Step #13: Already have image: busybox
Finished Step #13
Starting Step #14
Step #14: Already have image: busybox
Step #14: Roots are: .75000000000000000000; .50000000000000000000
Finished Step #14
Starting Step #15
Step #15: Already have image: busybox
Finished Step #15
PUSH
DONE
</code></pre><p>The key here is the output from step #14, the 15th (starting from 0):</p>
<pre><code class="language-console" data-lang="console">Step #14: Roots are: .75000000000000000000; .50000000000000000000
</code></pre><blockquote>
<p><strong>NOTE</strong> since we&rsquo;re using an ephemeral service and the storage is ~free, we could remote the steps that remove the intermediate files</p>
</blockquote>
<p>If, for some crazy reason, you wish to persist the results, then we can add artifacts to the configuration.</p>
<p>Create a Cloud Storage bucket:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">BUCKET<span style="color:#f92672">=[</span>YOUR-BUCKET<span style="color:#f92672">]</span>
gsutil mb -p <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> gs://<span style="color:#e6db74">${</span>BUCKET<span style="color:#e6db74">}</span>
</code></pre></div><p>And then revise the Cloud Build configuration, removing the step that deletes <code>root1</code> and <code>root2</code>, and replacing it with an <code>artifacts</code> configuration that references the files and the GCS bucket:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-YAML" data-lang="YAML">  <span style="color:#75715e"># - name: busybox</span>
  <span style="color:#75715e">#   args:</span>
  <span style="color:#75715e">#     - ash</span>
  <span style="color:#75715e">#     - -c</span>
  <span style="color:#75715e">#     - &#34;rm root1 root2&#34;</span>
<span style="color:#f92672">artifacts</span>:
  <span style="color:#f92672">objects</span>:
    <span style="color:#f92672">location</span>: <span style="color:#e6db74">&#34;gs://[[YOUR-BUCKET]]/&#34;</span>
    <span style="color:#f92672">paths</span>:
      - <span style="color:#e6db74">&#34;root1&#34;</span>
      - <span style="color:#e6db74">&#34;root2&#34;</span>
</code></pre></div><p>and then:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">gsutil ls gs://<span style="color:#e6db74">${</span>BUCKET<span style="color:#e6db74">}</span>
gs://<span style="color:#f92672">[</span>YOUR-PROJECT<span style="color:#f92672">]</span>/artifacts-ef3b...f98e.json
gs://<span style="color:#f92672">[</span>YOUR-PROJECT<span style="color:#f92672">]</span>/root1
gs://<span style="color:#f92672">[</span>YOUR-PROJECT<span style="color:#f92672">]</span>/root2
</code></pre></div><p>As you expect, the <code>root?</code> files contain the roots.</p>
<p>The <code>artifacts-*.json</code> file contains (in this case):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JSON" data-lang="JSON">{
    <span style="color:#f92672">&#34;location&#34;</span>:<span style="color:#e6db74">&#34;gs://[[YOUR-BUCKET]]/root1#1601321178905090&#34;</span>,
    <span style="color:#f92672">&#34;file_hash&#34;</span>:[{
        <span style="color:#f92672">&#34;file_hash&#34;</span>:[{
            <span style="color:#f92672">&#34;type&#34;</span>:<span style="color:#ae81ff">2</span>,
            <span style="color:#f92672">&#34;value&#34;</span>:<span style="color:#e6db74">&#34;dVVtNERLMStyalZXZGprSVF4ajhxUT09&#34;</span>
        }]
    }]
}
{
    <span style="color:#f92672">&#34;location&#34;</span>:<span style="color:#e6db74">&#34;gs://[[YOUR-BUCKET]]/root2#1601321186774984&#34;</span>,
    <span style="color:#f92672">&#34;file_hash&#34;</span>:[{
        <span style="color:#f92672">&#34;file_hash&#34;</span>:[{
            <span style="color:#f92672">&#34;type&#34;</span>:<span style="color:#ae81ff">2</span>,
            <span style="color:#f92672">&#34;value&#34;</span>:<span style="color:#e6db74">&#34;VWtsODlSS1hmRjI4RFA4Q3JSdjhSdz09&#34;</span>
        }]
    }]
}
</code></pre></div><blockquote>
<p><strong>NOTE</strong> the structure of this artifacts file is explained <a href="https://cloud.google.com/cloud-build/docs/building/store-build-artifacts#store-artifact-storage">here</a></p>
</blockquote>
<p>We can have <code>gsutil</code> (re)compute files' hashes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">gsutil gs://<span style="color:#f92672">[[</span>YOUR-BUCKET<span style="color:#f92672">]]</span>/root1
Hashes <span style="color:#f92672">[</span>base64<span style="color:#f92672">]</span> <span style="color:#66d9ef">for</span> root1:
    Hash <span style="color:#f92672">(</span>md5<span style="color:#f92672">)</span>:        uUm4DK1+rjVWdjkIQxj8qQ<span style="color:#f92672">==</span>
    Hash <span style="color:#f92672">(</span>crc32c<span style="color:#f92672">)</span>:     oR1wYQ<span style="color:#f92672">==</span>
</code></pre></div><blockquote>
<p><strong>NOTE</strong> the md5 hash value</p>
</blockquote>
<p>And:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">gsutil cat gs://<span style="color:#f92672">[[</span>YOUR-BUCKET<span style="color:#f92672">]]</span>/root1 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>| md5sum <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>| head --bytes<span style="color:#f92672">=</span><span style="color:#ae81ff">32</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>| xxd -revert -plain <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>| base64
uUm4DK1+rjVWdjkIQxj8qQ<span style="color:#f92672">==</span>
</code></pre></div><blockquote>
<p><strong>NOTE</strong> importantly, when using bash&rsquo;s <code>md5sum</code> utility we get a hexdump value that must be (using <code>xxd</code>) reverted to binary</p>
</blockquote>
<p>Hopefully, the above overly-complex Cloud Build example has helped explain the very general-purpose utility of Cloud Build.</p>
<p>To tidy up, you may simple delete everything:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">gcloud projects delete <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> --quiet
</code></pre></div><ul class="pa0">
  
   <li class="list">
     <a href="/tags/cloud-build" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Cloud Build</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/posts/200206/">Cloud Build wishlist: Mountable Golang Modules Proxy</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

  </main>
  <footer class="bg-dark-blue bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://pretired.dazwilkin.com/" >
    &copy;  (p)retired 2021 
  </a>
    <div>


<a href="https://stackoverflow.com/users/609290/dazwilkin" target="_blank" class="link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Stack Overflow link" rel="noopener" aria-label="follow on Stack Overflowâ€”â€”Opens in a new window">
  <svg height="32px" 
    style="enable-background:new 0 0 67 67;"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    width="32px"
>
    <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm.869 5.903l3.114 4.567-.975.665-3.115-4.567.976-.665zm-2.812 2.585l4.84 2.838-.6 1.017-4.842-2.838.602-1.017zm-1.276 2.724l5.413 1.521-.291 1.077-5.428-1.458.306-1.14zm-.588 2.461l5.687.569-.103 1.12-5.691-.513.107-1.176zm-.169 2.16h5.835v1.167h-5.835v-1.167zm7.976 3.167h-10v-6h1v5h8v-5h1v6zm.195-8.602l-.945-5.446 1.162-.202.947 5.446-1.164.202z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>






<a href="https://www.linkedin.com/in/dazwilkin/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedInâ€”â€”Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://github.com/DazWilkin" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Githubâ€”â€”Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>




<a href="https://medium.com/@DazWilkin" target="_blank" class="link-transition medium link dib z-999 pt3 pt0-l mr1" title="Medium link" rel="noopener" aria-label="follow on Mediumâ€”â€”Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 170 170;" version="1.1" viewBox="0 0 170 170" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M46.5340803,65.2157554 C46.6968378,63.6076572 46.0836,62.018231 44.8828198,60.93592 L32.6512605,46.2010582 L32.6512605,44 L70.6302521,44 L99.9859944,108.380952 L125.794585,44 L162,44 L162,46.2010582 L151.542017,56.2281011 C150.640424,56.9153477 150.193188,58.0448862 150.380019,59.1628454 L150.380019,132.837155 C150.193188,133.955114 150.640424,135.084652 151.542017,135.771899 L161.755369,145.798942 L161.755369,148 L110.38282,148 L110.38282,145.798942 L120.963119,135.527337 C122.002801,134.487948 122.002801,134.182246 122.002801,132.592593 L122.002801,73.0417402 L92.585901,147.755438 L88.6106443,147.755438 L54.3622782,73.0417402 L54.3622782,123.115814 C54.0767278,125.221069 54.7759199,127.3406 56.2581699,128.863022 L70.0186741,145.55438 L70.0186741,147.755438 L31,147.755438 L31,145.55438 L44.7605042,128.863022 C46.2319621,127.338076 46.8903838,125.204485 46.5340803,123.115814 L46.5340803,65.2157554 Z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>




</div>
  </div>
</footer>

  

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


</body>

</html>