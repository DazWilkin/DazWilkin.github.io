<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Using `gcloud ... --format` with arbitrary returned data | (p)retired</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Using `gcloud` with arbitrary returned data">
    <meta name="generator" content="Hugo 0.125.0-DEV">
    
    
    
    
      <meta name="robots" content="index, follow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.e7eb24d4e86966f8bcd5dd198bc521b41a6cbbb3bae6e7c7d36e2270a8841bd7.css" >



    
    
    
      

    

    

    <script data-goatcounter="https://pretired.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
 
    <meta property="og:url" content="https://pretired.dazwilkin.com/posts/211022/">
  <meta property="og:site_name" content="(p)retired">
  <meta property="og:title" content="Using `gcloud ... --format` with arbitrary returned data">
  <meta property="og:description" content="Using `gcloud` with arbitrary returned data">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-10-22T00:00:00-07:00">
    <meta property="article:modified_time" content="2021-10-22T00:00:00-07:00">
    <meta property="article:tag" content="Gcloud">

  <meta itemprop="name" content="Using `gcloud ... --format` with arbitrary returned data">
  <meta itemprop="description" content="Using `gcloud` with arbitrary returned data">
  <meta itemprop="datePublished" content="2021-10-22T00:00:00-07:00">
  <meta itemprop="dateModified" content="2021-10-22T00:00:00-07:00">
  <meta itemprop="wordCount" content="1217">
  <meta itemprop="keywords" content="Gcloud"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Using `gcloud ... --format` with arbitrary returned data">
<meta name="twitter:description" content="Using `gcloud` with arbitrary returned data">

      
  


    
	
  </head>

  <body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-dark-blue">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        (p)retired
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
    
    <a href="https://github.com/DazWilkin" target="_blank" rel="noopener" class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://www.linkedin.com/in/dazwilkin/" target="_blank" rel="noopener" class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://medium.com/@DazWilkin" target="_blank" rel="noopener" class="medium ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Medium link" aria-label="follow on Medium——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 170 170;" version="1.1" viewBox="0 0 170 170"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M46.5340803,65.2157554 C46.6968378,63.6076572 46.0836,62.018231 44.8828198,60.93592 L32.6512605,46.2010582 L32.6512605,44 L70.6302521,44 L99.9859944,108.380952 L125.794585,44 L162,44 L162,46.2010582 L151.542017,56.2281011 C150.640424,56.9153477 150.193188,58.0448862 150.380019,59.1628454 L150.380019,132.837155 C150.193188,133.955114 150.640424,135.084652 151.542017,135.771899 L161.755369,145.798942 L161.755369,148 L110.38282,148 L110.38282,145.798942 L120.963119,135.527337 C122.002801,134.487948 122.002801,134.182246 122.002801,132.592593 L122.002801,73.0417402 L92.585901,147.755438 L88.6106443,147.755438 L54.3622782,73.0417402 L54.3622782,123.115814 C54.0767278,125.221069 54.7759199,127.3406 56.2581699,128.863022 L70.0186741,145.55438 L70.0186741,147.755438 L31,147.755438 L31,145.55438 L44.7605042,128.863022 C46.2319621,127.338076 46.8903838,125.204485 46.5340803,123.115814 L46.5340803,65.2157554 Z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://stackoverflow.com/users/609290/dazwilkin" target="_blank" rel="noopener" class="stackoverflow ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Stack Overflow link" aria-label="follow on Stack Overflow——Opens in a new window">
      
        <span class="icon"><svg
    style="enable-background:new 0 0 67 67;"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    
>
    <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm.869 5.903l3.114 4.567-.975.665-3.115-4.567.976-.665zm-2.812 2.585l4.84 2.838-.6 1.017-4.842-2.838.602-1.017zm-1.276 2.724l5.413 1.521-.291 1.077-5.428-1.458.306-1.14zm-.588 2.461l5.687.569-.103 1.12-5.691-.513.107-1.176zm-.169 2.16h5.835v1.167h-5.835v-1.167zm7.976 3.167h-10v-6h1v5h8v-5h1v6zm.195-8.602l-.945-5.446 1.162-.202.947 5.446-1.164.202z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
      
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://pretired.dazwilkin.com/posts/211022/&amp;title=Using%20%60gcloud%20...%20--format%60%20with%20arbitrary%20returned%20data" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn">
        
        <span class="icon"> <svg style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
        
      </a>
    
  </div>


      <h1 class="f1 athelas mt3 mb1">Using `gcloud ... --format` with arbitrary returned data</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2021-10-22T00:00:00-07:00">October 22, 2021</time>
      

      
      
        <span class="f6 mv4 dib tracked"> - 6 minutes read </span>
        <span class="f6 mv4 dib tracked"> - 1217 words </span>
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>If you use <a href="https://stedolan.github.io/jq/"><code>jq</code></a>, you&rsquo;ll know that, its <a href="https://stedolan.github.io/jq/manual/">documentation</a> uses examples that you can try locally or using the excellent <a href="https://jqplay.org"><code>jqplay</code></a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>printf <span style="color:#e6db74">&#34;[1,2,3]&#34;</span> | jq .<span style="color:#f92672">[</span>1:<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>  2,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>And <a href="https://jqplay.org/s/L_n_bO9Ans">here</a></p>
<p>If you use Google Cloud Platform (GCP) CLI, <a href="https://cloud.google.com/sdk/gcloud"><code>gcloud</code></a>, this powerful tool includes JSON output formatting of results (<code>--format=json</code>) and YAML (<code>--format=yaml</code>) etc. and includes a set of so-called <a href="https://cloud.google.com/sdk/gcloud">projections</a> that you can use to format the returned data.</p>
<p>There is a comparable <a href="https://cloud.google.com/sdk/gcloud/reference/topic/projections#slice"><code>slice</code></a> projection that you may use with <code>gcloud</code> and the documentation even includes an example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>1,2,3<span style="color:#f92672">]</span>.slice<span style="color:#f92672">(</span>1:<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>But, you can&rsquo;t try out that command.</p>
<p>You can&rsquo;t:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud just --format<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;json([1,2,3].slice(1:))&#34;</span>
</span></span></code></pre></div><p>To prove to yourself or, more importantly, someone else that it works (correctly).</p>
<p>I <a href="https://stackoverflow.com/search?q=user%3A609290&#43;gcloud&#43;format">often</a> provide this type of example to other developers but, unless we&rsquo;re working with a specific resource, it can be challenging to provide an example.</p>
<p>Using the [<code>slice</code>] projection, how do we provide a developer with an example?</p>
<p>First, let&rsquo;s find a command that returns a list.</p>
<p>An immediate problem is that we want something that&rsquo;s sufficiently generic that any GCP user will be able to test it <strong>without</strong> having to create e.g. a Kubernetes cluster to have a set of resources to use.</p>
<p><code>gcloud projects list</code> is very generic but it&rsquo;s not useful in this case. Even though the underlying response is a JSON object containing a <code>&quot;projects&quot;</code> property that is a list:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud projects list --format<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;yaml&#34;</span> --log-http
</span></span><span style="display:flex;"><span><span style="color:#f92672">====</span> request start <span style="color:#f92672">====</span>
</span></span><span style="display:flex;"><span>uri: https://cloudresourcemanager.googleapis.com/v1/projects?alt<span style="color:#f92672">=</span>json
</span></span><span style="display:flex;"><span><span style="color:#f92672">====</span> request end <span style="color:#f92672">====</span>
</span></span><span style="display:flex;"><span>---- response start ----
</span></span><span style="display:flex;"><span>-- body start --
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;projects&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;projectNumber&#34;</span>: <span style="color:#e6db74">&#34;000000000001&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;projectId&#34;</span>: <span style="color:#e6db74">&#34;foo&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;lifecycleState&#34;</span>: <span style="color:#e6db74">&#34;ACTIVE&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;foo&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;createTime&#34;</span>: <span style="color:#e6db74">&#34;2021-01-01T00:00:00.000Z&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;projectNumber&#34;</span>: <span style="color:#e6db74">&#34;000000000002&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;projectId&#34;</span>: <span style="color:#e6db74">&#34;bar&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;lifecycleState&#34;</span>: <span style="color:#e6db74">&#34;ACTIVE&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;bar&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;createTime&#34;</span>: <span style="color:#e6db74">&#34;2021-01-01T00:00:00.000Z&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>-- body end --
</span></span></code></pre></div><p>After <code>gcloud</code> has proceed it, we&rsquo;re left with only the list items. We can confirm this by formatting the output either as <code>--format=json</code> (an array) or <code>--format=yaml</code> (multiple YAML documents):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;projectNumber&#34;</span>: <span style="color:#e6db74">&#34;000000000001&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;projectId&#34;</span>: <span style="color:#e6db74">&#34;foo&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;lifecycleState&#34;</span>: <span style="color:#e6db74">&#34;ACTIVE&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;foo&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;createTime&#34;</span>: <span style="color:#e6db74">&#34;2021-01-01T00:00:00.000Z&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;projectNumber&#34;</span>: <span style="color:#e6db74">&#34;000000000002&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;projectId&#34;</span>: <span style="color:#e6db74">&#34;bar&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;lifecycleState&#34;</span>: <span style="color:#e6db74">&#34;ACTIVE&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;bar&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;createTime&#34;</span>: <span style="color:#e6db74">&#34;2021-01-01T00:00:00.000Z&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>And:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">createTime</span>: <span style="color:#e6db74">&#39;2021-01-01T00:00:00.000Z&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">lifecycleState</span>: <span style="color:#ae81ff">ACTIVE</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">foo</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">projectId</span>: <span style="color:#ae81ff">foo</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">projectNumber</span>: <span style="color:#e6db74">&#39;000000000001&#39;</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">createTime</span>: <span style="color:#e6db74">&#39;2021-01-01T00:00:00.000Z&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">lifecycleState</span>: <span style="color:#ae81ff">ACTIVE</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">bar</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">projectId</span>: <span style="color:#ae81ff">bar</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">projectNumber</span>: <span style="color:#e6db74">&#39;000000000002&#39;</span>
</span></span><span style="display:flex;"><span>---
</span></span></code></pre></div><p>The problem is that, there&rsquo;s no list for us to <code>slice</code>.</p>
<p>Another option is <code>gcloud services list</code> although this requires that we have a project. That&rsquo;s not too burdensome, so let&rsquo;s use that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud services list --project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> --format<span style="color:#f92672">=</span>JSON --log-http
</span></span><span style="display:flex;"><span><span style="color:#f92672">====</span> request start <span style="color:#f92672">====</span>
</span></span><span style="display:flex;"><span>uri: https://serviceusage.googleapis.com/v1/projects/...
</span></span><span style="display:flex;"><span><span style="color:#f92672">====</span> request end <span style="color:#f92672">====</span>
</span></span><span style="display:flex;"><span>---- response start ----
</span></span><span style="display:flex;"><span>-- body start --
</span></span><span style="display:flex;"><span>-- body start --
</span></span></code></pre></div><p>I&rsquo;m going to format the body as JSON to help:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;services&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;projects/000000000000/services/bigquery.googleapis.com&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;config&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;bigquery.googleapis.com&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;BigQuery API&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;documentation&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;summary&#34;</span>: <span style="color:#e6db74">&#34;A data platform for customers to create, manage, share and query data.&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;quota&#34;</span>: {},
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;authentication&#34;</span>: {},
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;usage&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;requirements&#34;</span>: [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;serviceusage.googleapis.com/tos/cloud&#34;</span>
</span></span><span style="display:flex;"><span>          ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;monitoring&#34;</span>: {}
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;state&#34;</span>: <span style="color:#e6db74">&#34;ENABLED&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parent&#34;</span>: <span style="color:#e6db74">&#34;projects/000000000000&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;projects/000000000000/services/bigquerystorage.googleapis.com&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;config&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;bigquerystorage.googleapis.com&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;BigQuery Storage API&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;documentation&#34;</span>: {},
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;quota&#34;</span>: {},
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;authentication&#34;</span>: {},
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;usage&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;requirements&#34;</span>: [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;serviceusage.googleapis.com/tos/cloud&#34;</span>
</span></span><span style="display:flex;"><span>          ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;monitoredResources&#34;</span>: [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;serviceruntime.googleapis.com/api&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;labels&#34;</span>: [
</span></span><span style="display:flex;"><span>              {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;cloud.googleapis.com/location&#34;</span>
</span></span><span style="display:flex;"><span>              },
</span></span><span style="display:flex;"><span>              {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;cloud.googleapis.com/uid&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;serviceruntime.googleapis.com/consumer_quota&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;labels&#34;</span>: [
</span></span><span style="display:flex;"><span>              {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;cloud.googleapis.com/location&#34;</span>
</span></span><span style="display:flex;"><span>              },
</span></span><span style="display:flex;"><span>              {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;cloud.googleapis.com/uid&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;monitoring&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;consumerDestinations&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;monitoredResource&#34;</span>: <span style="color:#e6db74">&#34;serviceruntime.googleapis.com/api&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;metrics&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;serviceruntime.googleapis.com/api/consumer/quota_used_count&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;serviceruntime.googleapis.com/api/consumer/quota_refund_count&#34;</span>,
</span></span><span style="display:flex;"><span>              ]
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;monitoredResource&#34;</span>: <span style="color:#e6db74">&#34;serviceruntime.googleapis.com/consumer_quota&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;metrics&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;serviceruntime.googleapis.com/quota/rate/consumer/used_count&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;serviceruntime.googleapis.com/quota/rate/consumer/refund_count&#34;</span>,
</span></span><span style="display:flex;"><span>              ]
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;state&#34;</span>: <span style="color:#e6db74">&#34;ENABLED&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parent&#34;</span>: <span style="color:#e6db74">&#34;projects/641009261266&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Which is rich and should provide us with a goodly source of data to use.</p>
<blockquote>
<p><strong>NOTE</strong> Once again we do lose the root property (<code>services</code> this time) but we have other lists to play with.</p>
</blockquote>
<p>Check out <code>biquerystorage.googleapis.com</code> and <code>.config.monitoring.consumerDestions[0].metrics</code>, there are 6 of them:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>FILTER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;config.monitoring.consumerDestinations[0]&#34;</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">&#34;.metrics.len()&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud services list <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--filter<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;config.name=bigquerystorage.googleapis.com&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--format<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;json(</span><span style="color:#e6db74">${</span>FILTER<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>
</span></span></code></pre></div><p>Yields:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;config&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;monitoring&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;consumerDestinations&#34;</span>: [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;metrics&#34;</span>: <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>Now, if we apply <code>slice(1:)</code> there should be 5:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>FILTER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;config.monitoring.consumerDestinations[0]&#34;</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">&#34;.metrics.slice(1:).len()&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud services list <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--filter<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;config.name=bigquerystorage.googleapis.com&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--format<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;json(</span><span style="color:#e6db74">${</span>FILTER<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>
</span></span></code></pre></div><p>Yields:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;config&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;monitoring&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;consumerDestinations&#34;</span>: [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;metrics&#34;</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>So, it&rsquo;s long-winded but it can be done.</p>
<p>I submitted an <a href="https://issuetracker.google.com/issues/203446092">issue</a> to Google&rsquo;s <a href="https://issuetracker.google.com">issustracker</a> and there&rsquo;s a clever <a href="https://issuetracker.google.com/issues/203446092#comment2">workaround</a> that may help with this. It takes advantage of the fact that you can override the endpoint used by <code>gcloud</code> commands.</p>
<p>Overrides are service-specific. So, in the case of <code>gcloud services list</code>, this uses <code>https://serviceusage.googleapis.com</code> and so to override <code>gcloud services</code> commands, we can:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud config set <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  api_endpoint_overrides/serviceusage <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  http://localhost:8080
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> This overrides <code>gcloud services</code> for all local <code>gcloud services</code> calls so be careful that you don&rsquo;t break something else while doing this. When you&rsquo;re done, <code>gcloud config unset api_endpoint_overrides/serviceusage</code>.</p>
</blockquote>
<p>So, what does our new endpoint (<code>htttp://localhost:8080</code>) do? Well, in this case (it differs by <code>gcloud</code> command), for <code>gcloud services list ... --log-http</code>, we see (edited for clarity) that <code>gcloud</code> (!) expects JSON (<code>application/json)</code>:</p>
<pre tabindex="0"><code>==== request start ====
uri: https://serviceusage.googleapis.com/v1/projects/...
method: GET
== headers start ==
b&#39;accept&#39;: b&#39;application/json&#39;
== headers end ==
==== request end ====
---- response start ----
status: 200
-- headers start --
Content-Type: application/json; charset=UTF-8
-- headers end --
</code></pre><p>And so a simple Python HTTP server that provides an acceptable (it must be the structure that <code>gcloud</code> expects) would be:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#f92672">import</span> socketserver
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;&#34;HTTP/1.1 200 OK
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MIME-Version: 1.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Content-Type: application/json
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	&#34;services&#34;: [{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		&#34;name&#34;: &#34;foo&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		&#34;config&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			&#34;name&#34;: &#34;foo&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			&#34;title&#34;: &#34;Foo&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			&#34;documentation&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				&#34;summary&#34;: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			&#34;quota&#34;: </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			&#34;authentication&#34;: </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			&#34;usage&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				&#34;requirements&#34;: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			&#34;monitoredResources&#34;: [{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				&#34;labels&#34;: [{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					&#34;key&#34;: &#34;key-01&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				}],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				&#34;type&#34;: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			}],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			&#34;monitoring&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				&#34;consumerDestinations&#34;: [{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;monitoredResource&#34;: &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					&#34;metrics&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">						&#34;a&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">						&#34;b&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        &#34;c&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				}]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		&#34;state&#34;: &#34;ENABLED&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		&#34;parent&#34;: &#34;projects/000000000000&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	}]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>encode()
</span></span><span style="display:flex;"><span>print(b)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>socketserver<span style="color:#f92672">.</span>TCPServer(
</span></span><span style="display:flex;"><span>    (<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#ae81ff">8080</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">lambda</span> a,b,c:a<span style="color:#f92672">.</span>sendall(s<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>)<span style="color:#f92672">.</span>serve_forever()
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> Credit for the source of the above code to Google.</p>
</blockquote>
<p>Run the above server and then:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Matches the arbitrarily named config provided by our server</span>
</span></span><span style="display:flex;"><span>NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;foo&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FILTER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;config.monitoring.consumerDestinations[0]&#34;</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">&#34;.metrics&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud services list <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--filter<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;config.name=</span><span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--format<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;json(</span><span style="color:#e6db74">${</span>FILTER<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span> 
</span></span></code></pre></div><p>Yields:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;config&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;monitoring&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;consumerDestinations&#34;</span>: [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;metrics&#34;</span>: [
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#34;a&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#34;b&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#34;c&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>And:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>FILTER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;config.monitoring.consumerDestinations[0]&#34;</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">&#34;.metrics.slice(1:).len()&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud services list <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--filter<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;config.name=</span><span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--format<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;json(</span><span style="color:#e6db74">${</span>FILTER<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>
</span></span></code></pre></div><p>Yields:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;config&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;monitoring&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;consumerDestinations&#34;</span>: [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;metrics&#34;</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>You can, of course, just <code>--format=json | jq .</code> and then you get to use <code>jq</code> instead of <code>--format=json</code> and Google&rsquo;s way. The advantage to knowing Google&rsquo;s projections is <code>one less tool</code>. The advantage of use <code>jq</code> is the UNIX ethos of the &ldquo;do one thing well&rdquo;.</p>
<p>Let&rsquo;s conclude with the original <code>jq</code> example applied to <code>gcloud services list</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>FILTER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;.[0]&#34;</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">&#34;|.config.monitoring.consumerDestinations[0].metrics&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud services list
</span></span><span style="display:flex;"><span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--filter<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;config.name=</span><span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--format<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| jq -r <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>FILTER<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><p>Yields:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;a&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;b&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;c&#34;</span>
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>And:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>FILTER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;.[0]&#34;</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">&#34;|.config.monitoring.consumerDestinations[0].metrics[1:]&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud services list
</span></span><span style="display:flex;"><span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--filter<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;config.name=</span><span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--format<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| jq -r <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>FILTER<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;b&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;c&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> <code>jq</code> receives an array of one item from <code>gcloud</code> so we start by grabbing its (<code>.[0]</code>) content. The command is otherwise equivalent but gives us access to all jq`s methods.</p>
</blockquote>
<p><code>jq</code> (I&rsquo;m unsure whether <code>gcloud format</code>) permits filtering arrays by an object&rsquo;s properties:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>FILTER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;.[]&#34;</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">&#34;|select(.config.name=\&#34;foo\&#34;)&#34;</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">&#34;|.config.monitoring.consumerDestinations[]&#34;</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">&#34;|select(.monitoredResource=\&#34;baz\&#34;)|.metrics[1:]&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud services list
</span></span><span style="display:flex;"><span>--project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--filter<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;config.name=</span><span style="color:#e6db74">${</span>NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--format<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| jq -r <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>FILTER<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><p>Yields:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;b&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;c&#34;</span>
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>That&rsquo;s all!</p>
<ul class="pa0">
  
   <li class="list di">
     <a href="/tags/gcloud/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Gcloud</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-dark-blue bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://pretired.dazwilkin.com/" >
    &copy;  (p)retired 2024 
  </a>
    <div>
<div class="ananke-socials">
  
    
    <a href="https://github.com/DazWilkin" target="_blank" rel="noopener" class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://www.linkedin.com/in/dazwilkin/" target="_blank" rel="noopener" class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://medium.com/@DazWilkin" target="_blank" rel="noopener" class="medium ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Medium link" aria-label="follow on Medium——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 170 170;" version="1.1" viewBox="0 0 170 170"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M46.5340803,65.2157554 C46.6968378,63.6076572 46.0836,62.018231 44.8828198,60.93592 L32.6512605,46.2010582 L32.6512605,44 L70.6302521,44 L99.9859944,108.380952 L125.794585,44 L162,44 L162,46.2010582 L151.542017,56.2281011 C150.640424,56.9153477 150.193188,58.0448862 150.380019,59.1628454 L150.380019,132.837155 C150.193188,133.955114 150.640424,135.084652 151.542017,135.771899 L161.755369,145.798942 L161.755369,148 L110.38282,148 L110.38282,145.798942 L120.963119,135.527337 C122.002801,134.487948 122.002801,134.182246 122.002801,132.592593 L122.002801,73.0417402 L92.585901,147.755438 L88.6106443,147.755438 L54.3622782,73.0417402 L54.3622782,123.115814 C54.0767278,125.221069 54.7759199,127.3406 56.2581699,128.863022 L70.0186741,145.55438 L70.0186741,147.755438 L31,147.755438 L31,145.55438 L44.7605042,128.863022 C46.2319621,127.338076 46.8903838,125.204485 46.5340803,123.115814 L46.5340803,65.2157554 Z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://stackoverflow.com/users/609290/dazwilkin" target="_blank" rel="noopener" class="stackoverflow ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Stack Overflow link" aria-label="follow on Stack Overflow——Opens in a new window">
      
        <span class="icon"><svg
    style="enable-background:new 0 0 67 67;"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    
>
    <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm.869 5.903l3.114 4.567-.975.665-3.115-4.567.976-.665zm-2.812 2.585l4.84 2.838-.6 1.017-4.842-2.838.602-1.017zm-1.276 2.724l5.413 1.521-.291 1.077-5.428-1.458.306-1.14zm-.588 2.461l5.687.569-.103 1.12-5.691-.513.107-1.176zm-.169 2.16h5.835v1.167h-5.835v-1.167zm7.976 3.167h-10v-6h1v5h8v-5h1v6zm.195-8.602l-.945-5.446 1.162-.202.947 5.446-1.164.202z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>
</div>
  </div>
</footer>

  </body>
</html>