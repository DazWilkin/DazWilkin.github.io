<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>(p)retired</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="">
    <meta name="generator" content="Hugo 0.148.0-DEV">
    
    
    
    
      <meta name="robots" content="index, follow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.8d048772ae72ab11245a0e296d1f2a36d3e3dd376c6c867394d6cc659c68fc37.css" >




    

    
    
      

    

    
    
      <link href="/posts/index.xml" rel="alternate" type="application/rss+xml" title="(p)retired" />
      <link href="/posts/index.xml" rel="feed" type="application/rss+xml" title="(p)retired" />
      
    

    <script data-goatcounter="https://pretired.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
 
    <meta property="og:url" content="https://pretired.dazwilkin.com/posts/">
  <meta property="og:site_name" content="(p)retired">
  <meta property="og:title" content="Posts">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Posts">
  <meta itemprop="datePublished" content="2025-06-12T00:00:00-07:00">
  <meta itemprop="dateModified" content="2025-06-12T00:00:00-07:00">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Posts">

      
    
	
  </head>

  <body class="ma0 avenir bg-near-white production">

    

  <header>
    <div class="pb3-m pb6-l bg-dark-blue">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        (p)retired
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

      <div class="tc-l pv3 ph3 ph4-ns">
        <h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">
          Posts
        </h1>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
  <article class="pa3 pa4-ns nested-copy-line-height">
    <section class="cf ph3 ph5-l pv3 pv4-l f4 tc-l center measure-wide lh-copy nested-links mid-gray"></section>
    <section class="flex-ns mt5 flex-wrap justify-around">
      
        <div class="w-100 w-30-l mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210907/" class="link black dim">
        `gcloud beta run services replace`
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><strong>TL;DR</strong> I&rsquo;m working on a project that includes multiple Cloud Run services. I&rsquo;ve been putting my <code>gcloud</code> head on to deploy these services thinking that it&rsquo;s curious there&rsquo;s no way to write the specs as YAML configs. Today, I learned that there is: <a href="https://cloud.google.com/sdk/gcloud/reference/beta/run/services/replace"><code>gcloud beta run services replace</code></a>.</p></blockquote>
<p>What prompted the discovery was some frustration trying to deploy a JSON-valued environment variable to Cloud Run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  local FIREBASE_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    apiKey: </span><span style="color:#e6db74">${</span>FIREBASE_API_KEY<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    authDomain: </span><span style="color:#e6db74">${</span>FIREBASE_AUTH_DOMAIN<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    projectId: </span><span style="color:#e6db74">${</span>FIREBASE_PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    storageBucket: </span><span style="color:#e6db74">${</span>FIREBASE_STORAGE_BUCKET<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    messagingSenderId: </span><span style="color:#e6db74">${</span>FIREBASE_MESSAGING_SENDER<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    appId: </span><span style="color:#e6db74">${</span>FIREBASE_APP<span style="color:#e6db74">}</span><span style="color:#e6db74">}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  gcloud run deploy <span style="color:#e6db74">${</span>SRV_NAME<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --image<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMAGE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --command<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/server&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --args<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;--endpoint=:</span><span style="color:#e6db74">${</span>PORT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --set-env-vars<span style="color:#f92672">=</span>FIREBASE_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>FIREBASE_CONFIG<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --max-instances<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --memory<span style="color:#f92672">=</span>256Mi <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --ingress<span style="color:#f92672">=</span>all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --platform<span style="color:#f92672">=</span>managed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --port<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PORT<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --allow-unauthenticated <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --region<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>REGION<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p><code>gcloud</code> balks at this.</p>
    </div>
    <a href="/posts/210907/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210902/" class="link black dim">
        Infrastructure as Code
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="problem">Problem</h2>
<p>I&rsquo;m building an application that comprises:</p>
<ul>
<li>Kubernetes¹</li>
<li>Kubernetes Operator</li>
<li>Cloud Firestore</li>
<li>Cloud Functions</li>
<li>Cloud Run</li>
<li>Cloud Endpoints</li>
<li>Stripe</li>
<li>Firebase Authentication</li>
</ul>
<blockquote>
<p>¹ - I&rsquo;m using Google Kubernetes Engine (GKE) but may include other managed Kubernetes offerings (e.g. Digital Ocean, Linode, Oracle). GKE clusters are manageable by <code>gcloud</code> but other platforms require other CLI tools. All are accessible from bash but are these supported by e.g. Terraform (see below)?</p></blockquote>
<p>Many of the components are packaged as container images and, because I&rsquo;m using GitHub to host the project&rsquo;s repos (I&rsquo;ll leave the monorepo discussion for another post), I&rsquo;ve become inculcated and use GitHub Container Registry (GHCR) as the container repo.</p>
    </div>
    <a href="/posts/210902/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210730/" class="link black dim">
        Renewing Firebase Authentication ID tokens with gRPC
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written before about a project in which I&rsquo;m using Firebase Authentication in combination with Google Cloud Endpoints and a gRPC service running on Cloud Run:</p>
<ul>
<li><a href="/posts/210614/">Firebase Authentication, Cloud Endpoints and gRPC (1of2)</a></li>
<li><a href="/posts/210618/">Firebase Authentication, Cloud Endpoints and gRPC (2of2)</a></li>
</ul>
<p>This works well with one caveat, the ID tokens (JWTs) minted by Firebase Authentication have a 3600 second (one hour) lifetime.</p>
<p>The user flow in my app is that whenever the user invokes the app&rsquo;s CLI:</p>
    </div>
    <a href="/posts/210730/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210724/" class="link black dim">
        gRPC Interceptors and in-memory gRPC connections
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>For&hellip; reasons, I wanted to pre-filter gRPC requests to check for authorization. Authorization is implemented as a &lsquo;micro-service&rsquo; and I wanted the authorization server to run in the same process as the gRPC client.</p>
<p>TL;DR:</p>
<ul>
<li>Shiju&rsquo;s <a href="https://shijuvar.medium.com/writing-grpc-interceptors-in-go-bf3e7671fe48">&ldquo;Writing gRPC Interceptors in Go&rdquo;</a> is great</li>
<li>This Stack overflow <a href="https://stackoverflow.com/a/52080545/609290">answer</a> ostensibly for writing unit tests for gRPC got me an in-process server</li>
</ul>
<p>What follows stands on these folks&rsquo; shoulders&hellip;</p>
<p>A key motivator for me to write blog posts is that helps me ensure that I understand things. Writing this post, I realized I&rsquo;d not researched gRPC Interceptors and, as luck would have it, I found some interesting content, not on <a href="https://grpc.io"><code>grpc.io</code></a> but on the <a href="https://github.com/grpc-ecosystem"><code>grpc-ecosystem</code></a> repo, specifically <a href="https://github.com/grpc-ecosystem/go-grpc-middleware">Go gRPC middleware</a>. But, I refer again to Shiju&rsquo;s clear and helpful <a href="https://shijuvar.medium.com/writing-grpc-interceptors-in-go-bf3e7671fe48">&ldquo;Writing gRPC Interceptors in Go&rdquo;</a></p>
    </div>
    <a href="/posts/210724/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210716/" class="link black dim">
        Stripe
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>It&rsquo;s been almost a month since my last post. I&rsquo;ve been occupied learning <a href="https://stripe.com">Stripe</a> and integrating it into an application that I&rsquo;m developing. The app benefits from a billing mechanism for prospective customers and, as far as I can tell, Stripe is the solution. I&rsquo;d be interested in hearing perspectives on alternatives.</p>
<p>As with any platform, there&rsquo;s good and bad and I&rsquo;ll summarize my perspective on Stripe here. It&rsquo;s been some time since I developed in JavaScript and this lack of familiarity has meant that the solution took longer than I wanted to develop. That said, before this component, I developed integration with <a href="https://firebase.google.com/products/auth">Firebase Authentication</a> and that required JavaScript&rsquo;ing too and that was much easier (and more enjoyable).</p>
    </div>
    <a href="/posts/210716/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210618/" class="link black dim">
        Firebase Authentication, Cloud Endpoints and gRPC (2of2)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Earlier this week, I wrote about using <a href="/posts/210614/">Firebase Authentcation, Cloud Endpoints and gRPC (1of2)</a>. Since then, I <a href="https://github.com/GoogleCloudPlatform/esp-v2/issues/542">learned some more</a> and added a gRPC interceptor to implement basic authorization for the service.</p>
<h2 id="espv2---allow-unauthenticated">ESPv2 <code>--allow-unauthenticated</code></h2>
<p>The Cloud Enpoints (ESPv2) proxy must be run as <code>--allow-unauthenticated</code> on Cloud Run to ensure that requests make it to the proxy where the request is authenticated and only authenticated requests make it on to the backend service. Thanks Google&rsquo;s <a href="https://github.com/nareddyt">Teju Nareddy</a>!</p>
    </div>
    <a href="/posts/210618/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210614/" class="link black dim">
        Firebase Authentication, Cloud Endpoints and gRPC (1of2)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;m building a service that requires user authentication. The primary endpoint is a gRPC-based service. I would like to consider using certificate-based auth but this feels&hellip; challenging. Instead, I have been aware of, but never used, <a href="https://firebase.google.com/products/auth">Firebase Authentication</a> and was interested to see that <a href="https://cloud.google.com/endpoints">Cloud Endpoints</a> includes Firebase Authentication as one of its supported auth mechanisms. Curiosity piqued, I confirmed that gRPC supports <a href="https://grpc.io/docs/guides/auth/#using-google-token-based-authentication">Google token-based authentication</a>.</p>
<p>The following is a summary of what I did but I&rsquo;ll leave the extensive documentation to Google, (Google&rsquo;s) Firebase and gRPC, all of which, in this case, provide really good explanations.</p>
    </div>
    <a href="/posts/210614/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210608/" class="link black dim">
        Cloud Endpoints combine OpenAPI and gRPC... or not!
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>See:</p>
<ul>
<li><a href="/posts/210519/">Multiplexing gRPC and HTTP endpoints with Cloud Run</a></li>
<li><a href="/posts/200325/">gRPC, Cloud Run &amp; Endpoints</a></li>
<li><a href="https://github.com/GoogleCloudPlatform/esp-v2/issues/523">ESPv2: Configure Cloud Endpoints to proxy traffic to a Cloud Run multiplexed (gRPC|HTTP) service</a></li>
</ul>
<p>Challenges:</p>
<ul>
<li>Cloud Run permits single port</li>
<li>Cloud Run services publishing e.g. gRPC and Prometheus, must multiplex transports</li>
<li>Cloud Run services publishing multiplexed transports are <em>challenging</em> to expose using Cloud Endpoints</li>
</ul>
<h2 id="hypothesis-1-multiplexed-transports-work-with-cloud-run">Hypothesis #1: Multiplexed transports work with Cloud Run</h2>
<p>See: <a href="/posts/210519/">Multiplexing gRPC and HTTP endpoints with Cloud Run</a></p>
    </div>
    <a href="/posts/210608/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210527/" class="link black dim">
        Struggling with Golang structs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Julia&rsquo;s post <a href="https://jvns.ca/blog/2021/05/24/blog-about-what-you-ve-struggled-with/">Blog about what you&rsquo;ve struggled with</a> resonates because I&rsquo;ve been struggling with Golang structs in a project. Not the definitions of structs but seemingly needing to reproduce them across the project. I realize that each instance of these resources differs from the others but I&rsquo;m particularly concerned by having to duplicate method implementations on them.</p>
<p>I&rsquo;m kinda hoping that I see the solution to my problem by writing it out. If you&rsquo;re reading this, I didn&rsquo;t :-(</p>
    </div>
    <a href="/posts/210527/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
          <div class="w-100 mb4 nested-copy-line-height relative bg-white">
  <div class="mb3 pa4 gray overflow-hidden bg-white">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/210520/" class="link black dim">
        Consul discovers Google Cloud Run
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I&rsquo;ve written a basic <code>discoverer</code> of Google <a href="https://cloud.google.com/run">Cloud Run</a> services. This is for a project and it extends work done in some previous posts to <a href="/posts/210519/">Multiplex gRPC and Prometheus with Cloud Run</a> and to use <a href="/posts/210419/">Consul for Prometheus service discovery</a>.</p>
<p>This solution:</p>
<ul>
<li>Accepts a set of Google Cloud Platform (GCP) projects</li>
<li>Trawls them for Cloud Run services</li>
<li>Assumes that the services expose Prometheus metrics on <code>:443/metrics</code></li>
<li>Relabels the services</li>
<li>Surfaces any discovered Cloud Run services&rsquo; metrics in Prometheus</li>
</ul>
<p>You&rsquo;ll need Docker and Docker Compose.</p>
    </div>
    <a href="/posts/210520/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
    </section>
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/posts/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/7/" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/6/" aria-label="Page 6" class="page-link" role="button">6</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/7/" aria-label="Page 7" class="page-link" role="button">7</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 8" class="page-link" role="button">8</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/9/" aria-label="Page 9" class="page-link" role="button">9</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/10/" aria-label="Page 10" class="page-link" role="button">10</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/9/" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/15/" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul></article>

    </main>
    <footer class="bg-dark-blue bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://pretired.dazwilkin.com/" >
    &copy;  (p)retired 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>