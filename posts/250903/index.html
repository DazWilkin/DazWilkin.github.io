<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Bare Metal: DS18B20 | (p)retired</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="I&rsquo;ve been working through Google&rsquo;s Comprehensive Rust and, for the past couple of weeks, the Bare Metal Rust standalone course that uses the (excellent) micro:bit v2 that has a Nordic Semiconductor nRF52833 (an ARM Cortex-M4; interestingly its USB interface is also implemented using an ARM Cortex M0).
There&rsquo;s a wealth of Rust tutorials for microcontrollers and I bought an ESP32-C3-DevKit-RUST-1 for another tutorial and spent some time with my favorite Pi Pico and a newly-acquired Debug Probe.">
    <meta name="generator" content="Hugo 0.153.0-DEV">
    
    
    
    
      <meta name="robots" content="index, follow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.cf4aecb341f2e16e80e407465df095cee730d71e19c4574f8e9b28d163dc4225.css" >



  


    

    
    
      

    

    

    <script data-goatcounter="https://pretired.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
 
    <meta property="og:url" content="https://pretired.dazwilkin.com/posts/250903/">
  <meta property="og:site_name" content="(p)retired">
  <meta property="og:title" content="Bare Metal: DS18B20">
  <meta property="og:description" content="I’ve been working through Google’s Comprehensive Rust and, for the past couple of weeks, the Bare Metal Rust standalone course that uses the (excellent) micro:bit v2 that has a Nordic Semiconductor nRF52833 (an ARM Cortex-M4; interestingly its USB interface is also implemented using an ARM Cortex M0).
There’s a wealth of Rust tutorials for microcontrollers and I bought an ESP32-C3-DevKit-RUST-1 for another tutorial and spent some time with my favorite Pi Pico and a newly-acquired Debug Probe.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-03T00:00:00-07:00">
    <meta property="article:modified_time" content="2025-09-03T00:00:00-07:00">
    <meta property="article:tag" content="Rust">
    <meta property="article:tag" content="Pico">
    <meta property="article:tag" content="ESP32-C3">
    <meta property="article:tag" content="Wokwi">
    <meta property="article:tag" content="DS18B20">
    <meta property="article:tag" content="1-Wire">

  <meta itemprop="name" content="Bare Metal: DS18B20">
  <meta itemprop="description" content="I’ve been working through Google’s Comprehensive Rust and, for the past couple of weeks, the Bare Metal Rust standalone course that uses the (excellent) micro:bit v2 that has a Nordic Semiconductor nRF52833 (an ARM Cortex-M4; interestingly its USB interface is also implemented using an ARM Cortex M0).
There’s a wealth of Rust tutorials for microcontrollers and I bought an ESP32-C3-DevKit-RUST-1 for another tutorial and spent some time with my favorite Pi Pico and a newly-acquired Debug Probe.">
  <meta itemprop="datePublished" content="2025-09-03T00:00:00-07:00">
  <meta itemprop="dateModified" content="2025-09-03T00:00:00-07:00">
  <meta itemprop="wordCount" content="1179">
  <meta itemprop="keywords" content="Rust,Pico,ESP32-C3,Wokwi,DS18B20,1-Wire">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Bare Metal: DS18B20">
  <meta name="twitter:description" content="I’ve been working through Google’s Comprehensive Rust and, for the past couple of weeks, the Bare Metal Rust standalone course that uses the (excellent) micro:bit v2 that has a Nordic Semiconductor nRF52833 (an ARM Cortex-M4; interestingly its USB interface is also implemented using an ARM Cortex M0).
There’s a wealth of Rust tutorials for microcontrollers and I bought an ESP32-C3-DevKit-RUST-1 for another tutorial and spent some time with my favorite Pi Pico and a newly-acquired Debug Probe.">

      
    
	
  </head>

  <body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-dark-blue">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        (p)retired
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l mw8 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Bare Metal: DS18B20</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2025-09-03T00:00:00-07:00">September 3, 2025</time>
      

      
      
        <span class="f6 mv4 dib tracked"> - 6 minutes read </span>
        <span class="f6 mv4 dib tracked"> - 1179 words </span>
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>I&rsquo;ve been working through Google&rsquo;s <a href="https://google.github.io/comprehensive-rust/">Comprehensive Rust</a> and, for the past couple of weeks, the <a href="https://google.github.io/comprehensive-rust/bare-metal.html">Bare Metal Rust</a> standalone course that uses the (excellent) <a href="https://tech.microbit.org/hardware/2-0-revision/">micro:bit v2</a> that has a Nordic Semiconductor <a href="https://tech.microbit.org/hardware/2-0-revision/#nrf52-application-processor">nRF52833</a> (an ARM Cortex-M4; interestingly its USB interface is also implemented using an ARM Cortex M0).</p>
<p>There&rsquo;s a wealth of Rust tutorials for microcontrollers and I bought an <a href="https://www.espressif.com/en/dev-board/esp32-c3-devkit-rust-1-en">ESP32-C3-DevKit-RUST-1</a> for another tutorial and spent some time with my favorite <a href="https://www.raspberrypi.com/products/raspberry-pi-pico/">Pi Pico</a> and a newly-acquired <a href="https://www.raspberrypi.com/products/debug-probe/">Debug Probe</a>.</p>
<p>I&rsquo;m going to blog in reverse order on these experiences starting with several <strong>unsuccessful</strong> attempts to interact with 5 <a href="https://www.analog.com/en/products/ds18b20.html">DS18B20</a> (thermometer) sensors using Rust on an ESP32-C3 and then, trying to find a solution that worked, Python on a Pico.</p>
<p>DS18B20s use <a href="https://www.analog.com/en/product-category/1wire-devices.html">1-Wire</a>. 1-Wire is a very straightforward protocol (akin to 1<sup>2</sup>C, SPI etc.). It is a serial communication protocol that, as its name hints, uses a single wire for data (the data wire can also be used for &ldquo;parasitic&rdquo; power).</p>
<p>Here are some diagrams:</p>
<p><img src="/images/250903.esp32-c3.ds18b20.png" alt="1-Wire ESP32-C3 w/ 5 DS18B20"></p>
<p><a href="https://gist.github.com/DazWilkin/65bda633715986023d0d76fc1e9319ff#file-esp32-c3-diagram-json"><code>diagram.json</code></a></p>
<p><img src="/images/250903.pico.ds18b20.png" alt="1-Wire Pi Pico w/ 5 DS18B20"></p>
<p><a href="https://gist.github.com/DazWilkin/65bda633715986023d0d76fc1e9319ff#file-pico-diagram-json"><code>diagram.json</code></a></p>
<p>Those of you who are familiar with it, will recognize this as the really excellent <a href="https://wokwi.com">Wokwi</a> simulator that includes several microcontrollers (including Arduinos but not micro:bits) and a slew of peripherals.</p>
<blockquote>
<p><strong>NOTE</strong> It is <em>possible</em> that the reason these examples don&rsquo;t work is a 1-Wire timing issue running under Wokwi. I should buy some <a href="https://www.adafruit.com/product/374">DS18B20</a> and try this in our simulation.</p>
</blockquote>
<p>Wokwi is extensible, comprising multiple repos that implement the MCUs and peripherals including a C implementation of the <a href="https://github.com/bonnyr/wokwi-ds1820-custom-chip">DS18B20</a>. This enables the <code>DS18B20</code> device in Wokwi including permitting the following <code>diagram.json</code> entry:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;board-ds18b20&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;temp1&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;top&#34;</span>: <span style="color:#ae81ff">-40</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;left&#34;</span>: <span style="color:#ae81ff">90</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;attrs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;deviceID&#34;</span>: <span style="color:#e6db74">&#34;000000000001&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;familyCode&#34;</span>: <span style="color:#e6db74">&#34;40&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;tempWaveForm&#34;</span>: <span style="color:#e6db74">&#34;sine&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;tempWaveFreq&#34;</span>: <span style="color:#e6db74">&#34;100&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> The values in the <code>attrs</code> object are documented <a href="https://github.com/bonnyr/wokwi-ds1820-custom-chip?tab=readme-ov-file#attributes">here</a></p>
</blockquote>
<p>This repo is this peripheral&rsquo;s implementation and it functions somewhat like a server. Even though I haven&rsquo;t been able to get the Rust and Python (clients) running on the microcontrollers doesn&rsquo;t work, the peripheral appears (!?) to work correctly. Here&rsquo;s the output from Wokwi&rsquo;s &ldquo;CHIP CONSOLE&rdquo;:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>*** DS18B20 chip initialising...
</span></span><span style="display:flex;"><span>reading temp mode: sine
</span></span><span style="display:flex;"><span>*** DS18B20 setting attributes:
</span></span><span style="display:flex;"><span>  genDebug: 0
</span></span><span style="display:flex;"><span>  owDebug: 0
</span></span><span style="display:flex;"><span>  temperature: 0.000000
</span></span><span style="display:flex;"><span>  familyCode: 28
</span></span><span style="display:flex;"><span>  minTemp: -55.000000
</span></span><span style="display:flex;"><span>  maxTemp: 125.000000
</span></span><span style="display:flex;"><span>  temp_freq: 100.000000
</span></span><span style="display:flex;"><span>  temp_mode: 2
</span></span><span style="display:flex;"><span>  deviceID: 2800000000000140
</span></span><span style="display:flex;"><span>DS18B20 chip initialised
</span></span><span style="display:flex;"><span>*** DS18B20 chip initialising...
</span></span><span style="display:flex;"><span>reading temp mode: sine
</span></span><span style="display:flex;"><span>*** DS18B20 setting attributes:
</span></span><span style="display:flex;"><span>  genDebug: 0
</span></span><span style="display:flex;"><span>  owDebug: 0
</span></span><span style="display:flex;"><span>  temperature: 0.000000
</span></span><span style="display:flex;"><span>  familyCode: 28
</span></span><span style="display:flex;"><span>  minTemp: -55.000000
</span></span><span style="display:flex;"><span>  maxTemp: 125.000000
</span></span><span style="display:flex;"><span>  temp_freq: 100.000000
</span></span><span style="display:flex;"><span>  temp_mode: 2
</span></span><span style="display:flex;"><span>  deviceID: 28000000000002a2
</span></span><span style="display:flex;"><span>DS18B20 chip initialised
</span></span><span style="display:flex;"><span>*** DS18B20 chip initialising...
</span></span><span style="display:flex;"><span>reading temp mode: sine
</span></span><span style="display:flex;"><span>*** DS18B20 setting attributes:
</span></span><span style="display:flex;"><span>  genDebug: 0
</span></span><span style="display:flex;"><span>  owDebug: 0
</span></span><span style="display:flex;"><span>  temperature: 0.000000
</span></span><span style="display:flex;"><span>  familyCode: 28
</span></span><span style="display:flex;"><span>  minTemp: -55.000000
</span></span><span style="display:flex;"><span>  maxTemp: 125.000000
</span></span><span style="display:flex;"><span>  temp_freq: 100.000000
</span></span><span style="display:flex;"><span>  temp_mode: 2
</span></span><span style="display:flex;"><span>  deviceID: 28000000000003fc
</span></span><span style="display:flex;"><span>DS18B20 chip initialised
</span></span><span style="display:flex;"><span>*** DS18B20 chip initialising...
</span></span><span style="display:flex;"><span>reading temp mode: sine
</span></span><span style="display:flex;"><span>*** DS18B20 setting attributes:
</span></span><span style="display:flex;"><span>  genDebug: 0
</span></span><span style="display:flex;"><span>  owDebug: 0
</span></span><span style="display:flex;"><span>  temperature: 0.000000
</span></span><span style="display:flex;"><span>  familyCode: 28
</span></span><span style="display:flex;"><span>  minTemp: -55.000000
</span></span><span style="display:flex;"><span>  maxTemp: 125.000000
</span></span><span style="display:flex;"><span>  temp_freq: 100.000000
</span></span><span style="display:flex;"><span>  temp_mode: 2
</span></span><span style="display:flex;"><span>  deviceID: 280000000000047f
</span></span><span style="display:flex;"><span>DS18B20 chip initialised
</span></span><span style="display:flex;"><span>*** DS18B20 chip initialising...
</span></span><span style="display:flex;"><span>reading temp mode: sine
</span></span><span style="display:flex;"><span>*** DS18B20 setting attributes:
</span></span><span style="display:flex;"><span>  genDebug: 0
</span></span><span style="display:flex;"><span>  owDebug: 0
</span></span><span style="display:flex;"><span>  temperature: 0.000000
</span></span><span style="display:flex;"><span>  familyCode: 28
</span></span><span style="display:flex;"><span>  minTemp: -55.000000
</span></span><span style="display:flex;"><span>  maxTemp: 125.000000
</span></span><span style="display:flex;"><span>  temp_freq: 100.000000
</span></span><span style="display:flex;"><span>  temp_mode: 2
</span></span><span style="display:flex;"><span>  deviceID: 2800000000000521
</span></span><span style="display:flex;"><span>DS18B20 chip initialised
</span></span></code></pre></div><blockquote>
<p><strong>NOTE</strong> There are 5 <code>DS18B20 chip initialised</code>. Each of which has <code>familyCode: 0x28</code> and, although the <code>deviceID</code> are present <code>family-code:address:CRC</code> (instead of <code>CRC:address:family-code</code>) and, the CRCs disagree with my calculations (see below), you can see e.g. <code>000000000001</code> and on.</p>
</blockquote>
<p>1-Wire devices have a hard-coded ROM 64-bit (8-byte) address comprising most-significant byte CRC, 6 bytes of &ldquo;address&rdquo; and a least-significant byte called the family code, uniquely identifying the type of sensor (in this case DS18B20 are <code>0x28</code> (<code>40</code>)).</p>
<p>Interestingly if your printer rejects a cartridge or your Apple computer dislikes a power supply, it&rsquo;s likely because these peripherals use 1-Wire devices and the host device is decoding the peripheral&rsquo;s ROM to determine whether it&rsquo;s a valid peripheral.</p>
<p>There are 2 CRCs used by 1-Wire. These are <a href="https://www.analog.com/en/resources/technical-articles/understanding-and-using-cyclic-redundancy-checks-with-maxim-1wire-and-ibutton-products.html">documented</a>. My (Rust) code appears to be an accurate implementation of the 8-bit 1-Wire CRC <strong>but</strong> my CRC calculations don&rsquo;t agree with those produced by the Wokwi device:</p>
<table>
  <thead>
      <tr>
          <th>CRC</th>
          <th>Serial Number</th>
          <th>Family Code</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>0xa2</code></td>
          <td><code>0x00000001B81C</code></td>
          <td><code>0x02</code></td>
          <td>Example given in documentation</td>
      </tr>
      <tr>
          <td><code>0x29</code></td>
          <td><code>0x000000000001</code></td>
          <td><code>0x28</code></td>
          <td>Wokwi DS18B20 #1</td>
      </tr>
      <tr>
          <td><code>0x70</code></td>
          <td><code>0x000000000002</code></td>
          <td><code>0x28</code></td>
          <td>Wokwi DS18B20 #2</td>
      </tr>
      <tr>
          <td><code>0x47</code></td>
          <td><code>0x000000000003</code></td>
          <td><code>0x28</code></td>
          <td>Wokwi DS18B20 #3</td>
      </tr>
      <tr>
          <td><code>0xc2</code></td>
          <td><code>0x000000000004</code></td>
          <td><code>0x28</code></td>
          <td>Wokwi DS18B20 #4</td>
      </tr>
      <tr>
          <td><code>0xf5</code></td>
          <td><code>0x000000000005</code></td>
          <td><code>0x28</code></td>
          <td>Wokwi DS18B20 #5</td>
      </tr>
  </tbody>
</table>
<blockquote>
<p><strong>NOTE</strong> My CRC calculator agrees with the documented example and validates with the CRC check (prepending the CRC to the ROM) and recalculating results in <code>0x00</code>.</p>
</blockquote>
<p>The Rust example is implemented using the <a href="https://crates.io/crates/onewire"><code>onewire</code></a> crate.</p>
<p>Unfortunately, it fails to read temperatures from any of the DS18B20s:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>SP-ROM:esp32c3-api1-20210207
</span></span><span style="display:flex;"><span>Build:Feb  7 2021
</span></span><span style="display:flex;"><span>rst:0x1 (POWERON),boot:0xc (SPI_FAST_FLASH_BOOT)
</span></span><span style="display:flex;"><span>SPIWP:0xee
</span></span><span style="display:flex;"><span>mode:DIO, clock div:1
</span></span><span style="display:flex;"><span>load:0x3fcd6100,len:0x420
</span></span><span style="display:flex;"><span>load:0x403ce000,len:0x90c
</span></span><span style="display:flex;"><span>load:0x403d0000,len:0x2370
</span></span><span style="display:flex;"><span>entry 0x403ce000
</span></span><span style="display:flex;"><span>INFO - Logger initialized
</span></span><span style="display:flex;"><span>INFO - Embassy initialized
</span></span><span style="display:flex;"><span>INFO - LED on
</span></span><span style="display:flex;"><span>INFO - [ds18b20_task] Task started
</span></span><span style="display:flex;"><span>INFO - Presence pulse detected
</span></span><span style="display:flex;"><span>INFO - Adding temperature sensor ([40, 0, 0, 0, 0, 0, 4, 127])
</span></span><span style="display:flex;"><span>INFO - Adding temperature sensor ([40, 0, 0, 0, 0, 0, 2, 162])
</span></span><span style="display:flex;"><span>INFO - Adding temperature sensor ([40, 0, 0, 0, 0, 0, 1, 64])
</span></span><span style="display:flex;"><span>INFO - Adding temperature sensor ([40, 0, 0, 0, 0, 0, 5, 33])
</span></span><span style="display:flex;"><span>INFO - Adding temperature sensor ([40, 0, 0, 0, 0, 0, 3, 252])
</span></span><span style="display:flex;"><span>INFO - Waiting for measurement to finish
</span></span><span style="display:flex;"><span>INFO - Starting temperature measurement
</span></span><span style="display:flex;"><span>INFO - Reading temperature
</span></span><span style="display:flex;"><span>ERROR - Failed to read temperature: CrcMismatch { computed: 201, expected: 255 }
</span></span><span style="display:flex;"><span>INFO - Starting temperature measurement
</span></span><span style="display:flex;"><span>INFO - Reading temperature
</span></span><span style="display:flex;"><span>ERROR - Failed to read temperature: CrcMismatch { computed: 79, expected: 0 }
</span></span><span style="display:flex;"><span>INFO - Starting temperature measurement
</span></span><span style="display:flex;"><span>INFO - Reading temperature
</span></span><span style="display:flex;"><span>ERROR - Failed to read temperature: CrcMismatch { computed: 201, expected: 255 }
</span></span><span style="display:flex;"><span>INFO - Starting temperature measurement
</span></span><span style="display:flex;"><span>INFO - Reading temperature
</span></span><span style="display:flex;"><span>ERROR - Failed to read temperature: CrcMismatch { computed: 201, expected: 255 }
</span></span><span style="display:flex;"><span>INFO - Starting temperature measurement
</span></span><span style="display:flex;"><span>INFO - Reading temperature
</span></span><span style="display:flex;"><span>ERROR - Failed to read temperature: CrcMismatch { computed: 201, expected: 255 }
</span></span><span style="display:flex;"><span>INFO - Cycle finished. Waiting 5 second
</span></span></code></pre></div><p>It finds the 5 DS18B20s (<code>Adding temperature sensor</code>) and determines the correct family code (<code>40</code>==<code>0x28</code>) and serial numbers. It finds CRCs by serial number: <code>64</code> (<code>0x40</code>),<code>162</code> (<code>0xa2</code>),<code>252</code> (<code>0xfc</code>) ,<code>127</code> (<code>0x7f</code>),<code>33</code> (<code>0x21</code>). The values correpond to the CRCs calculated by <code>wokwi-ds1820-custom-chip</code> so I assume they are correct and my calculator is incorrect.</p>
<p>The MicroPython repo includes definitions of <a href="https://github.com/micropython/micropython-lib/tree/bdc4706cc700ae1c0a4520e252897bb0e03c327b/micropython/drivers/bus/onewire"><code>onewire</code></a> and <a href="https://github.com/micropython/micropython-lib/tree/bdc4706cc700ae1c0a4520e252897bb0e03c327b/micropython/drivers/sensor/ds18x20"><code>ds18x20</code></a>. So these libraries are available by default to MicroPython code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> ds18x20
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> onewire
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> machine <span style="color:#f92672">import</span> Pin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    pin <span style="color:#f92672">=</span> machine<span style="color:#f92672">.</span>Pin(<span style="color:#ae81ff">5</span>, machine<span style="color:#f92672">.</span>Pin<span style="color:#f92672">.</span>OPEN_DRAIN)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>    pin <span style="color:#f92672">=</span> machine<span style="color:#f92672">.</span>Pin(<span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;OPEN_DRAIN unavailable: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ow <span style="color:#f92672">=</span> onewire<span style="color:#f92672">.</span>OneWire(machine<span style="color:#f92672">.</span>Pin(<span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;ow.reset() presence: </span><span style="color:#e6db74">{</span>bool(ow<span style="color:#f92672">.</span>reset())<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>roms <span style="color:#f92672">=</span> ow<span style="color:#f92672">.</span>scan()
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;ow.scan() -&gt; </span><span style="color:#e6db74">{</span>[bytes(r)<span style="color:#f92672">.</span>hex() <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> roms]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sensors <span style="color:#f92672">=</span> ds18x20<span style="color:#f92672">.</span>DS18X20(ow)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>roms <span style="color:#f92672">=</span> sensors<span style="color:#f92672">.</span>scan()
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;sensors.scan(): </span><span style="color:#e6db74">{</span>[r<span style="color:#f92672">.</span>hex() <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> roms]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>    sensors<span style="color:#f92672">.</span>convert_temp()
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep_ms(<span style="color:#ae81ff">750</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> rom <span style="color:#f92672">in</span> roms:
</span></span><span style="display:flex;"><span>        t <span style="color:#f92672">=</span> sensors<span style="color:#f92672">.</span>read_temp(rom)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>rom<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>t<span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> °C&#34;</span>)
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><p>I won&rsquo;t reproduce the <code>CHIPS CONSOLE</code> output because it is essentially the same as when using the ESP32-C3.</p>
<p>Disappontingly, the Python code is unable to scan for devices</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>ow.reset() presence: True
</span></span><span style="display:flex;"><span>ow.scan() -&gt; []
</span></span><span style="display:flex;"><span>sensors.scan(): []
</span></span></code></pre></div><p>The smart money (i.e. LLMs) thinks that the issue is the timing inaccuracies/specificity when using the emulator. The only way that I could prove this would be to reproduce the circuits in our simulation.</p>
<p>Watch this space!</p>
<ul class="pa0">
  
   <li class="list di">
     <a href="/tags/rust/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Rust</a>
   </li>
  
   <li class="list di">
     <a href="/tags/pico/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Pico</a>
   </li>
  
   <li class="list di">
     <a href="/tags/esp32-c3/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">ESP32-C3</a>
   </li>
  
   <li class="list di">
     <a href="/tags/wokwi/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Wokwi</a>
   </li>
  
   <li class="list di">
     <a href="/tags/ds18b20/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">DS18B20</a>
   </li>
  
   <li class="list di">
     <a href="/tags/1-wire/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">1-Wire</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/posts/250627/">Gemini Code Assist &#39;agent&#39; mode without `npx mcp-remote` (2/3)</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/250626/">Gemini Code Assist &#39;agent&#39; mode without `npx mcp-remote` (1/3)</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/240811/">XML-RPC in Rust and Python</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/230310/">Kubernetes Operators</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/190930/">PyPi Transparency Client (Rust)</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-dark-blue bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://pretired.dazwilkin.com/" >
    &copy;  (p)retired 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>